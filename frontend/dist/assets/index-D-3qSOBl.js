var S2=Object.defineProperty;var T2=(r,n,l)=>n in r?S2(r,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[n]=l;var Bl=(r,n,l)=>T2(r,typeof n!="symbol"?n+"":n,l);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))p(_);new MutationObserver(_=>{for(const T of _)if(T.type==="childList")for(const w of T.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&p(w)}).observe(document,{childList:!0,subtree:!0});function l(_){const T={};return _.integrity&&(T.integrity=_.integrity),_.referrerPolicy&&(T.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?T.credentials="include":_.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function p(_){if(_.ep)return;_.ep=!0;const T=l(_);fetch(_.href,T)}})();var k2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xx(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Kx={exports:{}},Dp={},Jx={exports:{}},Rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ph=Symbol.for("react.element"),E2=Symbol.for("react.portal"),I2=Symbol.for("react.fragment"),C2=Symbol.for("react.strict_mode"),P2=Symbol.for("react.profiler"),A2=Symbol.for("react.provider"),M2=Symbol.for("react.context"),z2=Symbol.for("react.forward_ref"),D2=Symbol.for("react.suspense"),R2=Symbol.for("react.memo"),L2=Symbol.for("react.lazy"),Iv=Symbol.iterator;function B2(r){return r===null||typeof r!="object"?null:(r=Iv&&r[Iv]||r["@@iterator"],typeof r=="function"?r:null)}var Yx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Qx=Object.assign,e0={};function pu(r,n,l){this.props=r,this.context=n,this.refs=e0,this.updater=l||Yx}pu.prototype.isReactComponent={};pu.prototype.setState=function(r,n){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,n,"setState")};pu.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function t0(){}t0.prototype=pu.prototype;function qg(r,n,l){this.props=r,this.context=n,this.refs=e0,this.updater=l||Yx}var Zg=qg.prototype=new t0;Zg.constructor=qg;Qx(Zg,pu.prototype);Zg.isPureReactComponent=!0;var Cv=Array.isArray,r0=Object.prototype.hasOwnProperty,Gg={current:null},i0={key:!0,ref:!0,__self:!0,__source:!0};function n0(r,n,l){var p,_={},T=null,w=null;if(n!=null)for(p in n.ref!==void 0&&(w=n.ref),n.key!==void 0&&(T=""+n.key),n)r0.call(n,p)&&!i0.hasOwnProperty(p)&&(_[p]=n[p]);var d=arguments.length-2;if(d===1)_.children=l;else if(1<d){for(var j=Array(d),Y=0;Y<d;Y++)j[Y]=arguments[Y+2];_.children=j}if(r&&r.defaultProps)for(p in d=r.defaultProps,d)_[p]===void 0&&(_[p]=d[p]);return{$$typeof:ph,type:r,key:T,ref:w,props:_,_owner:Gg.current}}function F2(r,n){return{$$typeof:ph,type:r.type,key:n,ref:r.ref,props:r.props,_owner:r._owner}}function Hg(r){return typeof r=="object"&&r!==null&&r.$$typeof===ph}function O2(r){var n={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(l){return n[l]})}var Pv=/\/+/g;function pm(r,n){return typeof r=="object"&&r!==null&&r.key!=null?O2(""+r.key):n.toString(36)}function jd(r,n,l,p,_){var T=typeof r;(T==="undefined"||T==="boolean")&&(r=null);var w=!1;if(r===null)w=!0;else switch(T){case"string":case"number":w=!0;break;case"object":switch(r.$$typeof){case ph:case E2:w=!0}}if(w)return w=r,_=_(w),r=p===""?"."+pm(w,0):p,Cv(_)?(l="",r!=null&&(l=r.replace(Pv,"$&/")+"/"),jd(_,n,l,"",function(Y){return Y})):_!=null&&(Hg(_)&&(_=F2(_,l+(!_.key||w&&w.key===_.key?"":(""+_.key).replace(Pv,"$&/")+"/")+r)),n.push(_)),1;if(w=0,p=p===""?".":p+":",Cv(r))for(var d=0;d<r.length;d++){T=r[d];var j=p+pm(T,d);w+=jd(T,n,l,j,_)}else if(j=B2(r),typeof j=="function")for(r=j.call(r),d=0;!(T=r.next()).done;)T=T.value,j=p+pm(T,d++),w+=jd(T,n,l,j,_);else if(T==="object")throw n=String(r),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return w}function xd(r,n,l){if(r==null)return r;var p=[],_=0;return jd(r,p,"","",function(T){return n.call(l,T,_++)}),p}function N2(r){if(r._status===-1){var n=r._result;n=n(),n.then(function(l){(r._status===0||r._status===-1)&&(r._status=1,r._result=l)},function(l){(r._status===0||r._status===-1)&&(r._status=2,r._result=l)}),r._status===-1&&(r._status=0,r._result=n)}if(r._status===1)return r._result.default;throw r._result}var Bi={current:null},Ud={transition:null},V2={ReactCurrentDispatcher:Bi,ReactCurrentBatchConfig:Ud,ReactCurrentOwner:Gg};function s0(){throw Error("act(...) is not supported in production builds of React.")}Rt.Children={map:xd,forEach:function(r,n,l){xd(r,function(){n.apply(this,arguments)},l)},count:function(r){var n=0;return xd(r,function(){n++}),n},toArray:function(r){return xd(r,function(n){return n})||[]},only:function(r){if(!Hg(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Rt.Component=pu;Rt.Fragment=I2;Rt.Profiler=P2;Rt.PureComponent=qg;Rt.StrictMode=C2;Rt.Suspense=D2;Rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V2;Rt.act=s0;Rt.cloneElement=function(r,n,l){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var p=Qx({},r.props),_=r.key,T=r.ref,w=r._owner;if(n!=null){if(n.ref!==void 0&&(T=n.ref,w=Gg.current),n.key!==void 0&&(_=""+n.key),r.type&&r.type.defaultProps)var d=r.type.defaultProps;for(j in n)r0.call(n,j)&&!i0.hasOwnProperty(j)&&(p[j]=n[j]===void 0&&d!==void 0?d[j]:n[j])}var j=arguments.length-2;if(j===1)p.children=l;else if(1<j){d=Array(j);for(var Y=0;Y<j;Y++)d[Y]=arguments[Y+2];p.children=d}return{$$typeof:ph,type:r.type,key:_,ref:T,props:p,_owner:w}};Rt.createContext=function(r){return r={$$typeof:M2,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:A2,_context:r},r.Consumer=r};Rt.createElement=n0;Rt.createFactory=function(r){var n=n0.bind(null,r);return n.type=r,n};Rt.createRef=function(){return{current:null}};Rt.forwardRef=function(r){return{$$typeof:z2,render:r}};Rt.isValidElement=Hg;Rt.lazy=function(r){return{$$typeof:L2,_payload:{_status:-1,_result:r},_init:N2}};Rt.memo=function(r,n){return{$$typeof:R2,type:r,compare:n===void 0?null:n}};Rt.startTransition=function(r){var n=Ud.transition;Ud.transition={};try{r()}finally{Ud.transition=n}};Rt.unstable_act=s0;Rt.useCallback=function(r,n){return Bi.current.useCallback(r,n)};Rt.useContext=function(r){return Bi.current.useContext(r)};Rt.useDebugValue=function(){};Rt.useDeferredValue=function(r){return Bi.current.useDeferredValue(r)};Rt.useEffect=function(r,n){return Bi.current.useEffect(r,n)};Rt.useId=function(){return Bi.current.useId()};Rt.useImperativeHandle=function(r,n,l){return Bi.current.useImperativeHandle(r,n,l)};Rt.useInsertionEffect=function(r,n){return Bi.current.useInsertionEffect(r,n)};Rt.useLayoutEffect=function(r,n){return Bi.current.useLayoutEffect(r,n)};Rt.useMemo=function(r,n){return Bi.current.useMemo(r,n)};Rt.useReducer=function(r,n,l){return Bi.current.useReducer(r,n,l)};Rt.useRef=function(r){return Bi.current.useRef(r)};Rt.useState=function(r){return Bi.current.useState(r)};Rt.useSyncExternalStore=function(r,n,l){return Bi.current.useSyncExternalStore(r,n,l)};Rt.useTransition=function(){return Bi.current.useTransition()};Rt.version="18.3.1";Jx.exports=Rt;var _t=Jx.exports;const j2=Xx(_t);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U2=_t,$2=Symbol.for("react.element"),q2=Symbol.for("react.fragment"),Z2=Object.prototype.hasOwnProperty,G2=U2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,H2={key:!0,ref:!0,__self:!0,__source:!0};function o0(r,n,l){var p,_={},T=null,w=null;l!==void 0&&(T=""+l),n.key!==void 0&&(T=""+n.key),n.ref!==void 0&&(w=n.ref);for(p in n)Z2.call(n,p)&&!H2.hasOwnProperty(p)&&(_[p]=n[p]);if(r&&r.defaultProps)for(p in n=r.defaultProps,n)_[p]===void 0&&(_[p]=n[p]);return{$$typeof:$2,type:r,key:T,ref:w,props:_,_owner:G2.current}}Dp.Fragment=q2;Dp.jsx=o0;Dp.jsxs=o0;Kx.exports=Dp;var ze=Kx.exports,$m={},a0={exports:{}},vn={},l0={exports:{}},u0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function n(We,lt){var pt=We.length;We.push(lt);e:for(;0<pt;){var Tt=pt-1>>>1,Ft=We[Tt];if(0<_(Ft,lt))We[Tt]=lt,We[pt]=Ft,pt=Tt;else break e}}function l(We){return We.length===0?null:We[0]}function p(We){if(We.length===0)return null;var lt=We[0],pt=We.pop();if(pt!==lt){We[0]=pt;e:for(var Tt=0,Ft=We.length,nr=Ft>>>1;Tt<nr;){var br=2*(Tt+1)-1,Fr=We[br],qr=br+1,Sr=We[qr];if(0>_(Fr,pt))qr<Ft&&0>_(Sr,Fr)?(We[Tt]=Sr,We[qr]=pt,Tt=qr):(We[Tt]=Fr,We[br]=pt,Tt=br);else if(qr<Ft&&0>_(Sr,pt))We[Tt]=Sr,We[qr]=pt,Tt=qr;else break e}}return lt}function _(We,lt){var pt=We.sortIndex-lt.sortIndex;return pt!==0?pt:We.id-lt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;r.unstable_now=function(){return T.now()}}else{var w=Date,d=w.now();r.unstable_now=function(){return w.now()-d}}var j=[],Y=[],me=1,te=null,$=3,Ie=!1,Me=!1,Le=!1,yt=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ce(We){for(var lt=l(Y);lt!==null;){if(lt.callback===null)p(Y);else if(lt.startTime<=We)p(Y),lt.sortIndex=lt.expirationTime,n(j,lt);else break;lt=l(Y)}}function Se(We){if(Le=!1,ce(We),!Me)if(l(j)!==null)Me=!0,ri(je);else{var lt=l(Y);lt!==null&&Br(Se,lt.startTime-We)}}function je(We,lt){Me=!1,Le&&(Le=!1,ae(Ye),Ye=-1),Ie=!0;var pt=$;try{for(ce(lt),te=l(j);te!==null&&(!(te.expirationTime>lt)||We&&!mt());){var Tt=te.callback;if(typeof Tt=="function"){te.callback=null,$=te.priorityLevel;var Ft=Tt(te.expirationTime<=lt);lt=r.unstable_now(),typeof Ft=="function"?te.callback=Ft:te===l(j)&&p(j),ce(lt)}else p(j);te=l(j)}if(te!==null)var nr=!0;else{var br=l(Y);br!==null&&Br(Se,br.startTime-lt),nr=!1}return nr}finally{te=null,$=pt,Ie=!1}}var Ne=!1,Fe=null,Ye=-1,kt=5,it=-1;function mt(){return!(r.unstable_now()-it<kt)}function Et(){if(Fe!==null){var We=r.unstable_now();it=We;var lt=!0;try{lt=Fe(!0,We)}finally{lt?Mt():(Ne=!1,Fe=null)}}else Ne=!1}var Mt;if(typeof ne=="function")Mt=function(){ne(Et)};else if(typeof MessageChannel<"u"){var Yt=new MessageChannel,wr=Yt.port2;Yt.port1.onmessage=Et,Mt=function(){wr.postMessage(null)}}else Mt=function(){yt(Et,0)};function ri(We){Fe=We,Ne||(Ne=!0,Mt())}function Br(We,lt){Ye=yt(function(){We(r.unstable_now())},lt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(We){We.callback=null},r.unstable_continueExecution=function(){Me||Ie||(Me=!0,ri(je))},r.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):kt=0<We?Math.floor(1e3/We):5},r.unstable_getCurrentPriorityLevel=function(){return $},r.unstable_getFirstCallbackNode=function(){return l(j)},r.unstable_next=function(We){switch($){case 1:case 2:case 3:var lt=3;break;default:lt=$}var pt=$;$=lt;try{return We()}finally{$=pt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(We,lt){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var pt=$;$=We;try{return lt()}finally{$=pt}},r.unstable_scheduleCallback=function(We,lt,pt){var Tt=r.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?Tt+pt:Tt):pt=Tt,We){case 1:var Ft=-1;break;case 2:Ft=250;break;case 5:Ft=1073741823;break;case 4:Ft=1e4;break;default:Ft=5e3}return Ft=pt+Ft,We={id:me++,callback:lt,priorityLevel:We,startTime:pt,expirationTime:Ft,sortIndex:-1},pt>Tt?(We.sortIndex=pt,n(Y,We),l(j)===null&&We===l(Y)&&(Le?(ae(Ye),Ye=-1):Le=!0,Br(Se,pt-Tt))):(We.sortIndex=Ft,n(j,We),Me||Ie||(Me=!0,ri(je))),We},r.unstable_shouldYield=mt,r.unstable_wrapCallback=function(We){var lt=$;return function(){var pt=$;$=lt;try{return We.apply(this,arguments)}finally{$=pt}}}})(u0);l0.exports=u0;var W2=l0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X2=_t,_n=W2;function Ee(r){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+r,l=1;l<arguments.length;l++)n+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+r+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c0=new Set,Kc={};function Va(r,n){ou(r,n),ou(r+"Capture",n)}function ou(r,n){for(Kc[r]=n,r=0;r<n.length;r++)c0.add(n[r])}var Zs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qm=Object.prototype.hasOwnProperty,K2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Av={},Mv={};function J2(r){return qm.call(Mv,r)?!0:qm.call(Av,r)?!1:K2.test(r)?Mv[r]=!0:(Av[r]=!0,!1)}function Y2(r,n,l,p){if(l!==null&&l.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return p?!1:l!==null?!l.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Q2(r,n,l,p){if(n===null||typeof n>"u"||Y2(r,n,l,p))return!0;if(p)return!1;if(l!==null)switch(l.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Fi(r,n,l,p,_,T,w){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=p,this.attributeNamespace=_,this.mustUseProperty=l,this.propertyName=r,this.type=n,this.sanitizeURL=T,this.removeEmptyString=w}var hi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){hi[r]=new Fi(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var n=r[0];hi[n]=new Fi(n,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){hi[r]=new Fi(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){hi[r]=new Fi(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){hi[r]=new Fi(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){hi[r]=new Fi(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){hi[r]=new Fi(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){hi[r]=new Fi(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){hi[r]=new Fi(r,5,!1,r.toLowerCase(),null,!1,!1)});var Wg=/[\-:]([a-z])/g;function Xg(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var n=r.replace(Wg,Xg);hi[n]=new Fi(n,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var n=r.replace(Wg,Xg);hi[n]=new Fi(n,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var n=r.replace(Wg,Xg);hi[n]=new Fi(n,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){hi[r]=new Fi(r,1,!1,r.toLowerCase(),null,!1,!1)});hi.xlinkHref=new Fi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){hi[r]=new Fi(r,1,!1,r.toLowerCase(),null,!0,!0)});function Kg(r,n,l,p){var _=hi.hasOwnProperty(n)?hi[n]:null;(_!==null?_.type!==0:p||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(Q2(n,l,_,p)&&(l=null),p||_===null?J2(n)&&(l===null?r.removeAttribute(n):r.setAttribute(n,""+l)):_.mustUseProperty?r[_.propertyName]=l===null?_.type===3?!1:"":l:(n=_.attributeName,p=_.attributeNamespace,l===null?r.removeAttribute(n):(_=_.type,l=_===3||_===4&&l===!0?"":""+l,p?r.setAttributeNS(p,n,l):r.setAttribute(n,l))))}var Xs=X2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,wd=Symbol.for("react.element"),jl=Symbol.for("react.portal"),Ul=Symbol.for("react.fragment"),Jg=Symbol.for("react.strict_mode"),Zm=Symbol.for("react.profiler"),h0=Symbol.for("react.provider"),d0=Symbol.for("react.context"),Yg=Symbol.for("react.forward_ref"),Gm=Symbol.for("react.suspense"),Hm=Symbol.for("react.suspense_list"),Qg=Symbol.for("react.memo"),Do=Symbol.for("react.lazy"),p0=Symbol.for("react.offscreen"),zv=Symbol.iterator;function kc(r){return r===null||typeof r!="object"?null:(r=zv&&r[zv]||r["@@iterator"],typeof r=="function"?r:null)}var xr=Object.assign,fm;function Lc(r){if(fm===void 0)try{throw Error()}catch(l){var n=l.stack.trim().match(/\n( *(at )?)/);fm=n&&n[1]||""}return`
`+fm+r}var mm=!1;function gm(r,n){if(!r||mm)return"";mm=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(Y){var p=Y}Reflect.construct(r,[],n)}else{try{n.call()}catch(Y){p=Y}r.call(n.prototype)}else{try{throw Error()}catch(Y){p=Y}r()}}catch(Y){if(Y&&p&&typeof Y.stack=="string"){for(var _=Y.stack.split(`
`),T=p.stack.split(`
`),w=_.length-1,d=T.length-1;1<=w&&0<=d&&_[w]!==T[d];)d--;for(;1<=w&&0<=d;w--,d--)if(_[w]!==T[d]){if(w!==1||d!==1)do if(w--,d--,0>d||_[w]!==T[d]){var j=`
`+_[w].replace(" at new "," at ");return r.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",r.displayName)),j}while(1<=w&&0<=d);break}}}finally{mm=!1,Error.prepareStackTrace=l}return(r=r?r.displayName||r.name:"")?Lc(r):""}function eS(r){switch(r.tag){case 5:return Lc(r.type);case 16:return Lc("Lazy");case 13:return Lc("Suspense");case 19:return Lc("SuspenseList");case 0:case 2:case 15:return r=gm(r.type,!1),r;case 11:return r=gm(r.type.render,!1),r;case 1:return r=gm(r.type,!0),r;default:return""}}function Wm(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Ul:return"Fragment";case jl:return"Portal";case Zm:return"Profiler";case Jg:return"StrictMode";case Gm:return"Suspense";case Hm:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case d0:return(r.displayName||"Context")+".Consumer";case h0:return(r._context.displayName||"Context")+".Provider";case Yg:var n=r.render;return r=r.displayName,r||(r=n.displayName||n.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Qg:return n=r.displayName||null,n!==null?n:Wm(r.type)||"Memo";case Do:n=r._payload,r=r._init;try{return Wm(r(n))}catch{}}return null}function tS(r){var n=r.type;switch(r.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=n.render,r=r.displayName||r.name||"",n.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Wm(n);case 8:return n===Jg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Wo(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function f0(r){var n=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function rS(r){var n=f0(r)?"checked":"value",l=Object.getOwnPropertyDescriptor(r.constructor.prototype,n),p=""+r[n];if(!r.hasOwnProperty(n)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var _=l.get,T=l.set;return Object.defineProperty(r,n,{configurable:!0,get:function(){return _.call(this)},set:function(w){p=""+w,T.call(this,w)}}),Object.defineProperty(r,n,{enumerable:l.enumerable}),{getValue:function(){return p},setValue:function(w){p=""+w},stopTracking:function(){r._valueTracker=null,delete r[n]}}}}function bd(r){r._valueTracker||(r._valueTracker=rS(r))}function m0(r){if(!r)return!1;var n=r._valueTracker;if(!n)return!0;var l=n.getValue(),p="";return r&&(p=f0(r)?r.checked?"true":"false":r.value),r=p,r!==l?(n.setValue(r),!0):!1}function np(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Xm(r,n){var l=n.checked;return xr({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??r._wrapperState.initialChecked})}function Dv(r,n){var l=n.defaultValue==null?"":n.defaultValue,p=n.checked!=null?n.checked:n.defaultChecked;l=Wo(n.value!=null?n.value:l),r._wrapperState={initialChecked:p,initialValue:l,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function g0(r,n){n=n.checked,n!=null&&Kg(r,"checked",n,!1)}function Km(r,n){g0(r,n);var l=Wo(n.value),p=n.type;if(l!=null)p==="number"?(l===0&&r.value===""||r.value!=l)&&(r.value=""+l):r.value!==""+l&&(r.value=""+l);else if(p==="submit"||p==="reset"){r.removeAttribute("value");return}n.hasOwnProperty("value")?Jm(r,n.type,l):n.hasOwnProperty("defaultValue")&&Jm(r,n.type,Wo(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(r.defaultChecked=!!n.defaultChecked)}function Rv(r,n,l){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var p=n.type;if(!(p!=="submit"&&p!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+r._wrapperState.initialValue,l||n===r.value||(r.value=n),r.defaultValue=n}l=r.name,l!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,l!==""&&(r.name=l)}function Jm(r,n,l){(n!=="number"||np(r.ownerDocument)!==r)&&(l==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+l&&(r.defaultValue=""+l))}var Bc=Array.isArray;function Ql(r,n,l,p){if(r=r.options,n){n={};for(var _=0;_<l.length;_++)n["$"+l[_]]=!0;for(l=0;l<r.length;l++)_=n.hasOwnProperty("$"+r[l].value),r[l].selected!==_&&(r[l].selected=_),_&&p&&(r[l].defaultSelected=!0)}else{for(l=""+Wo(l),n=null,_=0;_<r.length;_++){if(r[_].value===l){r[_].selected=!0,p&&(r[_].defaultSelected=!0);return}n!==null||r[_].disabled||(n=r[_])}n!==null&&(n.selected=!0)}}function Ym(r,n){if(n.dangerouslySetInnerHTML!=null)throw Error(Ee(91));return xr({},n,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function Lv(r,n){var l=n.value;if(l==null){if(l=n.children,n=n.defaultValue,l!=null){if(n!=null)throw Error(Ee(92));if(Bc(l)){if(1<l.length)throw Error(Ee(93));l=l[0]}n=l}n==null&&(n=""),l=n}r._wrapperState={initialValue:Wo(l)}}function y0(r,n){var l=Wo(n.value),p=Wo(n.defaultValue);l!=null&&(l=""+l,l!==r.value&&(r.value=l),n.defaultValue==null&&r.defaultValue!==l&&(r.defaultValue=l)),p!=null&&(r.defaultValue=""+p)}function Bv(r){var n=r.textContent;n===r._wrapperState.initialValue&&n!==""&&n!==null&&(r.value=n)}function _0(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qm(r,n){return r==null||r==="http://www.w3.org/1999/xhtml"?_0(n):r==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Sd,v0=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,l,p,_){MSApp.execUnsafeLocalFunction(function(){return r(n,l,p,_)})}:r}(function(r,n){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=n;else{for(Sd=Sd||document.createElement("div"),Sd.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=Sd.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;n.firstChild;)r.appendChild(n.firstChild)}});function Jc(r,n){if(n){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=n;return}}r.textContent=n}var Vc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},iS=["Webkit","ms","Moz","O"];Object.keys(Vc).forEach(function(r){iS.forEach(function(n){n=n+r.charAt(0).toUpperCase()+r.substring(1),Vc[n]=Vc[r]})});function x0(r,n,l){return n==null||typeof n=="boolean"||n===""?"":l||typeof n!="number"||n===0||Vc.hasOwnProperty(r)&&Vc[r]?(""+n).trim():n+"px"}function w0(r,n){r=r.style;for(var l in n)if(n.hasOwnProperty(l)){var p=l.indexOf("--")===0,_=x0(l,n[l],p);l==="float"&&(l="cssFloat"),p?r.setProperty(l,_):r[l]=_}}var nS=xr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function eg(r,n){if(n){if(nS[r]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(Ee(137,r));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(Ee(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(Ee(61))}if(n.style!=null&&typeof n.style!="object")throw Error(Ee(62))}}function tg(r,n){if(r.indexOf("-")===-1)return typeof n.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rg=null;function ey(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var ig=null,eu=null,tu=null;function Fv(r){if(r=gh(r)){if(typeof ig!="function")throw Error(Ee(280));var n=r.stateNode;n&&(n=Op(n),ig(r.stateNode,r.type,n))}}function b0(r){eu?tu?tu.push(r):tu=[r]:eu=r}function S0(){if(eu){var r=eu,n=tu;if(tu=eu=null,Fv(r),n)for(r=0;r<n.length;r++)Fv(n[r])}}function T0(r,n){return r(n)}function k0(){}var ym=!1;function E0(r,n,l){if(ym)return r(n,l);ym=!0;try{return T0(r,n,l)}finally{ym=!1,(eu!==null||tu!==null)&&(k0(),S0())}}function Yc(r,n){var l=r.stateNode;if(l===null)return null;var p=Op(l);if(p===null)return null;l=p[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(r=r.type,p=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!p;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(Ee(231,n,typeof l));return l}var ng=!1;if(Zs)try{var Ec={};Object.defineProperty(Ec,"passive",{get:function(){ng=!0}}),window.addEventListener("test",Ec,Ec),window.removeEventListener("test",Ec,Ec)}catch{ng=!1}function sS(r,n,l,p,_,T,w,d,j){var Y=Array.prototype.slice.call(arguments,3);try{n.apply(l,Y)}catch(me){this.onError(me)}}var jc=!1,sp=null,op=!1,sg=null,oS={onError:function(r){jc=!0,sp=r}};function aS(r,n,l,p,_,T,w,d,j){jc=!1,sp=null,sS.apply(oS,arguments)}function lS(r,n,l,p,_,T,w,d,j){if(aS.apply(this,arguments),jc){if(jc){var Y=sp;jc=!1,sp=null}else throw Error(Ee(198));op||(op=!0,sg=Y)}}function ja(r){var n=r,l=r;if(r.alternate)for(;n.return;)n=n.return;else{r=n;do n=r,n.flags&4098&&(l=n.return),r=n.return;while(r)}return n.tag===3?l:null}function I0(r){if(r.tag===13){var n=r.memoizedState;if(n===null&&(r=r.alternate,r!==null&&(n=r.memoizedState)),n!==null)return n.dehydrated}return null}function Ov(r){if(ja(r)!==r)throw Error(Ee(188))}function uS(r){var n=r.alternate;if(!n){if(n=ja(r),n===null)throw Error(Ee(188));return n!==r?null:r}for(var l=r,p=n;;){var _=l.return;if(_===null)break;var T=_.alternate;if(T===null){if(p=_.return,p!==null){l=p;continue}break}if(_.child===T.child){for(T=_.child;T;){if(T===l)return Ov(_),r;if(T===p)return Ov(_),n;T=T.sibling}throw Error(Ee(188))}if(l.return!==p.return)l=_,p=T;else{for(var w=!1,d=_.child;d;){if(d===l){w=!0,l=_,p=T;break}if(d===p){w=!0,p=_,l=T;break}d=d.sibling}if(!w){for(d=T.child;d;){if(d===l){w=!0,l=T,p=_;break}if(d===p){w=!0,p=T,l=_;break}d=d.sibling}if(!w)throw Error(Ee(189))}}if(l.alternate!==p)throw Error(Ee(190))}if(l.tag!==3)throw Error(Ee(188));return l.stateNode.current===l?r:n}function C0(r){return r=uS(r),r!==null?P0(r):null}function P0(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var n=P0(r);if(n!==null)return n;r=r.sibling}return null}var A0=_n.unstable_scheduleCallback,Nv=_n.unstable_cancelCallback,cS=_n.unstable_shouldYield,hS=_n.unstable_requestPaint,Pr=_n.unstable_now,dS=_n.unstable_getCurrentPriorityLevel,ty=_n.unstable_ImmediatePriority,M0=_n.unstable_UserBlockingPriority,ap=_n.unstable_NormalPriority,pS=_n.unstable_LowPriority,z0=_n.unstable_IdlePriority,Rp=null,ys=null;function fS(r){if(ys&&typeof ys.onCommitFiberRoot=="function")try{ys.onCommitFiberRoot(Rp,r,void 0,(r.current.flags&128)===128)}catch{}}var Qn=Math.clz32?Math.clz32:yS,mS=Math.log,gS=Math.LN2;function yS(r){return r>>>=0,r===0?32:31-(mS(r)/gS|0)|0}var Td=64,kd=4194304;function Fc(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function lp(r,n){var l=r.pendingLanes;if(l===0)return 0;var p=0,_=r.suspendedLanes,T=r.pingedLanes,w=l&268435455;if(w!==0){var d=w&~_;d!==0?p=Fc(d):(T&=w,T!==0&&(p=Fc(T)))}else w=l&~_,w!==0?p=Fc(w):T!==0&&(p=Fc(T));if(p===0)return 0;if(n!==0&&n!==p&&!(n&_)&&(_=p&-p,T=n&-n,_>=T||_===16&&(T&4194240)!==0))return n;if(p&4&&(p|=l&16),n=r.entangledLanes,n!==0)for(r=r.entanglements,n&=p;0<n;)l=31-Qn(n),_=1<<l,p|=r[l],n&=~_;return p}function _S(r,n){switch(r){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vS(r,n){for(var l=r.suspendedLanes,p=r.pingedLanes,_=r.expirationTimes,T=r.pendingLanes;0<T;){var w=31-Qn(T),d=1<<w,j=_[w];j===-1?(!(d&l)||d&p)&&(_[w]=_S(d,n)):j<=n&&(r.expiredLanes|=d),T&=~d}}function og(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function D0(){var r=Td;return Td<<=1,!(Td&4194240)&&(Td=64),r}function _m(r){for(var n=[],l=0;31>l;l++)n.push(r);return n}function fh(r,n,l){r.pendingLanes|=n,n!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,n=31-Qn(n),r[n]=l}function xS(r,n){var l=r.pendingLanes&~n;r.pendingLanes=n,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=n,r.mutableReadLanes&=n,r.entangledLanes&=n,n=r.entanglements;var p=r.eventTimes;for(r=r.expirationTimes;0<l;){var _=31-Qn(l),T=1<<_;n[_]=0,p[_]=-1,r[_]=-1,l&=~T}}function ry(r,n){var l=r.entangledLanes|=n;for(r=r.entanglements;l;){var p=31-Qn(l),_=1<<p;_&n|r[p]&n&&(r[p]|=n),l&=~_}}var Jt=0;function R0(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var L0,iy,B0,F0,O0,ag=!1,Ed=[],No=null,Vo=null,jo=null,Qc=new Map,eh=new Map,Lo=[],wS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Vv(r,n){switch(r){case"focusin":case"focusout":No=null;break;case"dragenter":case"dragleave":Vo=null;break;case"mouseover":case"mouseout":jo=null;break;case"pointerover":case"pointerout":Qc.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":eh.delete(n.pointerId)}}function Ic(r,n,l,p,_,T){return r===null||r.nativeEvent!==T?(r={blockedOn:n,domEventName:l,eventSystemFlags:p,nativeEvent:T,targetContainers:[_]},n!==null&&(n=gh(n),n!==null&&iy(n)),r):(r.eventSystemFlags|=p,n=r.targetContainers,_!==null&&n.indexOf(_)===-1&&n.push(_),r)}function bS(r,n,l,p,_){switch(n){case"focusin":return No=Ic(No,r,n,l,p,_),!0;case"dragenter":return Vo=Ic(Vo,r,n,l,p,_),!0;case"mouseover":return jo=Ic(jo,r,n,l,p,_),!0;case"pointerover":var T=_.pointerId;return Qc.set(T,Ic(Qc.get(T)||null,r,n,l,p,_)),!0;case"gotpointercapture":return T=_.pointerId,eh.set(T,Ic(eh.get(T)||null,r,n,l,p,_)),!0}return!1}function N0(r){var n=Pa(r.target);if(n!==null){var l=ja(n);if(l!==null){if(n=l.tag,n===13){if(n=I0(l),n!==null){r.blockedOn=n,O0(r.priority,function(){B0(l)});return}}else if(n===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function $d(r){if(r.blockedOn!==null)return!1;for(var n=r.targetContainers;0<n.length;){var l=lg(r.domEventName,r.eventSystemFlags,n[0],r.nativeEvent);if(l===null){l=r.nativeEvent;var p=new l.constructor(l.type,l);rg=p,l.target.dispatchEvent(p),rg=null}else return n=gh(l),n!==null&&iy(n),r.blockedOn=l,!1;n.shift()}return!0}function jv(r,n,l){$d(r)&&l.delete(n)}function SS(){ag=!1,No!==null&&$d(No)&&(No=null),Vo!==null&&$d(Vo)&&(Vo=null),jo!==null&&$d(jo)&&(jo=null),Qc.forEach(jv),eh.forEach(jv)}function Cc(r,n){r.blockedOn===n&&(r.blockedOn=null,ag||(ag=!0,_n.unstable_scheduleCallback(_n.unstable_NormalPriority,SS)))}function th(r){function n(_){return Cc(_,r)}if(0<Ed.length){Cc(Ed[0],r);for(var l=1;l<Ed.length;l++){var p=Ed[l];p.blockedOn===r&&(p.blockedOn=null)}}for(No!==null&&Cc(No,r),Vo!==null&&Cc(Vo,r),jo!==null&&Cc(jo,r),Qc.forEach(n),eh.forEach(n),l=0;l<Lo.length;l++)p=Lo[l],p.blockedOn===r&&(p.blockedOn=null);for(;0<Lo.length&&(l=Lo[0],l.blockedOn===null);)N0(l),l.blockedOn===null&&Lo.shift()}var ru=Xs.ReactCurrentBatchConfig,up=!0;function TS(r,n,l,p){var _=Jt,T=ru.transition;ru.transition=null;try{Jt=1,ny(r,n,l,p)}finally{Jt=_,ru.transition=T}}function kS(r,n,l,p){var _=Jt,T=ru.transition;ru.transition=null;try{Jt=4,ny(r,n,l,p)}finally{Jt=_,ru.transition=T}}function ny(r,n,l,p){if(up){var _=lg(r,n,l,p);if(_===null)Cm(r,n,p,cp,l),Vv(r,p);else if(bS(_,r,n,l,p))p.stopPropagation();else if(Vv(r,p),n&4&&-1<wS.indexOf(r)){for(;_!==null;){var T=gh(_);if(T!==null&&L0(T),T=lg(r,n,l,p),T===null&&Cm(r,n,p,cp,l),T===_)break;_=T}_!==null&&p.stopPropagation()}else Cm(r,n,p,null,l)}}var cp=null;function lg(r,n,l,p){if(cp=null,r=ey(p),r=Pa(r),r!==null)if(n=ja(r),n===null)r=null;else if(l=n.tag,l===13){if(r=I0(n),r!==null)return r;r=null}else if(l===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;r=null}else n!==r&&(r=null);return cp=r,null}function V0(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dS()){case ty:return 1;case M0:return 4;case ap:case pS:return 16;case z0:return 536870912;default:return 16}default:return 16}}var Fo=null,sy=null,qd=null;function j0(){if(qd)return qd;var r,n=sy,l=n.length,p,_="value"in Fo?Fo.value:Fo.textContent,T=_.length;for(r=0;r<l&&n[r]===_[r];r++);var w=l-r;for(p=1;p<=w&&n[l-p]===_[T-p];p++);return qd=_.slice(r,1<p?1-p:void 0)}function Zd(r){var n=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&n===13&&(r=13)):r=n,r===10&&(r=13),32<=r||r===13?r:0}function Id(){return!0}function Uv(){return!1}function xn(r){function n(l,p,_,T,w){this._reactName=l,this._targetInst=_,this.type=p,this.nativeEvent=T,this.target=w,this.currentTarget=null;for(var d in r)r.hasOwnProperty(d)&&(l=r[d],this[d]=l?l(T):T[d]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Id:Uv,this.isPropagationStopped=Uv,this}return xr(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Id)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Id)},persist:function(){},isPersistent:Id}),n}var fu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oy=xn(fu),mh=xr({},fu,{view:0,detail:0}),ES=xn(mh),vm,xm,Pc,Lp=xr({},mh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ay,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Pc&&(Pc&&r.type==="mousemove"?(vm=r.screenX-Pc.screenX,xm=r.screenY-Pc.screenY):xm=vm=0,Pc=r),vm)},movementY:function(r){return"movementY"in r?r.movementY:xm}}),$v=xn(Lp),IS=xr({},Lp,{dataTransfer:0}),CS=xn(IS),PS=xr({},mh,{relatedTarget:0}),wm=xn(PS),AS=xr({},fu,{animationName:0,elapsedTime:0,pseudoElement:0}),MS=xn(AS),zS=xr({},fu,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),DS=xn(zS),RS=xr({},fu,{data:0}),qv=xn(RS),LS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},BS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function OS(r){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(r):(r=FS[r])?!!n[r]:!1}function ay(){return OS}var NS=xr({},mh,{key:function(r){if(r.key){var n=LS[r.key]||r.key;if(n!=="Unidentified")return n}return r.type==="keypress"?(r=Zd(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?BS[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ay,charCode:function(r){return r.type==="keypress"?Zd(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Zd(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),VS=xn(NS),jS=xr({},Lp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zv=xn(jS),US=xr({},mh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ay}),$S=xn(US),qS=xr({},fu,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZS=xn(qS),GS=xr({},Lp,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),HS=xn(GS),WS=[9,13,27,32],ly=Zs&&"CompositionEvent"in window,Uc=null;Zs&&"documentMode"in document&&(Uc=document.documentMode);var XS=Zs&&"TextEvent"in window&&!Uc,U0=Zs&&(!ly||Uc&&8<Uc&&11>=Uc),Gv=" ",Hv=!1;function $0(r,n){switch(r){case"keyup":return WS.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function q0(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var $l=!1;function KS(r,n){switch(r){case"compositionend":return q0(n);case"keypress":return n.which!==32?null:(Hv=!0,Gv);case"textInput":return r=n.data,r===Gv&&Hv?null:r;default:return null}}function JS(r,n){if($l)return r==="compositionend"||!ly&&$0(r,n)?(r=j0(),qd=sy=Fo=null,$l=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return U0&&n.locale!=="ko"?null:n.data;default:return null}}var YS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wv(r){var n=r&&r.nodeName&&r.nodeName.toLowerCase();return n==="input"?!!YS[r.type]:n==="textarea"}function Z0(r,n,l,p){b0(p),n=hp(n,"onChange"),0<n.length&&(l=new oy("onChange","change",null,l,p),r.push({event:l,listeners:n}))}var $c=null,rh=null;function QS(r){rw(r,0)}function Bp(r){var n=Gl(r);if(m0(n))return r}function eT(r,n){if(r==="change")return n}var G0=!1;if(Zs){var bm;if(Zs){var Sm="oninput"in document;if(!Sm){var Xv=document.createElement("div");Xv.setAttribute("oninput","return;"),Sm=typeof Xv.oninput=="function"}bm=Sm}else bm=!1;G0=bm&&(!document.documentMode||9<document.documentMode)}function Kv(){$c&&($c.detachEvent("onpropertychange",H0),rh=$c=null)}function H0(r){if(r.propertyName==="value"&&Bp(rh)){var n=[];Z0(n,rh,r,ey(r)),E0(QS,n)}}function tT(r,n,l){r==="focusin"?(Kv(),$c=n,rh=l,$c.attachEvent("onpropertychange",H0)):r==="focusout"&&Kv()}function rT(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Bp(rh)}function iT(r,n){if(r==="click")return Bp(n)}function nT(r,n){if(r==="input"||r==="change")return Bp(n)}function sT(r,n){return r===n&&(r!==0||1/r===1/n)||r!==r&&n!==n}var ts=typeof Object.is=="function"?Object.is:sT;function ih(r,n){if(ts(r,n))return!0;if(typeof r!="object"||r===null||typeof n!="object"||n===null)return!1;var l=Object.keys(r),p=Object.keys(n);if(l.length!==p.length)return!1;for(p=0;p<l.length;p++){var _=l[p];if(!qm.call(n,_)||!ts(r[_],n[_]))return!1}return!0}function Jv(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Yv(r,n){var l=Jv(r);r=0;for(var p;l;){if(l.nodeType===3){if(p=r+l.textContent.length,r<=n&&p>=n)return{node:l,offset:n-r};r=p}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Jv(l)}}function W0(r,n){return r&&n?r===n?!0:r&&r.nodeType===3?!1:n&&n.nodeType===3?W0(r,n.parentNode):"contains"in r?r.contains(n):r.compareDocumentPosition?!!(r.compareDocumentPosition(n)&16):!1:!1}function X0(){for(var r=window,n=np();n instanceof r.HTMLIFrameElement;){try{var l=typeof n.contentWindow.location.href=="string"}catch{l=!1}if(l)r=n.contentWindow;else break;n=np(r.document)}return n}function uy(r){var n=r&&r.nodeName&&r.nodeName.toLowerCase();return n&&(n==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||n==="textarea"||r.contentEditable==="true")}function oT(r){var n=X0(),l=r.focusedElem,p=r.selectionRange;if(n!==l&&l&&l.ownerDocument&&W0(l.ownerDocument.documentElement,l)){if(p!==null&&uy(l)){if(n=p.start,r=p.end,r===void 0&&(r=n),"selectionStart"in l)l.selectionStart=n,l.selectionEnd=Math.min(r,l.value.length);else if(r=(n=l.ownerDocument||document)&&n.defaultView||window,r.getSelection){r=r.getSelection();var _=l.textContent.length,T=Math.min(p.start,_);p=p.end===void 0?T:Math.min(p.end,_),!r.extend&&T>p&&(_=p,p=T,T=_),_=Yv(l,T);var w=Yv(l,p);_&&w&&(r.rangeCount!==1||r.anchorNode!==_.node||r.anchorOffset!==_.offset||r.focusNode!==w.node||r.focusOffset!==w.offset)&&(n=n.createRange(),n.setStart(_.node,_.offset),r.removeAllRanges(),T>p?(r.addRange(n),r.extend(w.node,w.offset)):(n.setEnd(w.node,w.offset),r.addRange(n)))}}for(n=[],r=l;r=r.parentNode;)r.nodeType===1&&n.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<n.length;l++)r=n[l],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var aT=Zs&&"documentMode"in document&&11>=document.documentMode,ql=null,ug=null,qc=null,cg=!1;function Qv(r,n,l){var p=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;cg||ql==null||ql!==np(p)||(p=ql,"selectionStart"in p&&uy(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),qc&&ih(qc,p)||(qc=p,p=hp(ug,"onSelect"),0<p.length&&(n=new oy("onSelect","select",null,n,l),r.push({event:n,listeners:p}),n.target=ql)))}function Cd(r,n){var l={};return l[r.toLowerCase()]=n.toLowerCase(),l["Webkit"+r]="webkit"+n,l["Moz"+r]="moz"+n,l}var Zl={animationend:Cd("Animation","AnimationEnd"),animationiteration:Cd("Animation","AnimationIteration"),animationstart:Cd("Animation","AnimationStart"),transitionend:Cd("Transition","TransitionEnd")},Tm={},K0={};Zs&&(K0=document.createElement("div").style,"AnimationEvent"in window||(delete Zl.animationend.animation,delete Zl.animationiteration.animation,delete Zl.animationstart.animation),"TransitionEvent"in window||delete Zl.transitionend.transition);function Fp(r){if(Tm[r])return Tm[r];if(!Zl[r])return r;var n=Zl[r],l;for(l in n)if(n.hasOwnProperty(l)&&l in K0)return Tm[r]=n[l];return r}var J0=Fp("animationend"),Y0=Fp("animationiteration"),Q0=Fp("animationstart"),ew=Fp("transitionend"),tw=new Map,ex="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ko(r,n){tw.set(r,n),Va(n,[r])}for(var km=0;km<ex.length;km++){var Em=ex[km],lT=Em.toLowerCase(),uT=Em[0].toUpperCase()+Em.slice(1);Ko(lT,"on"+uT)}Ko(J0,"onAnimationEnd");Ko(Y0,"onAnimationIteration");Ko(Q0,"onAnimationStart");Ko("dblclick","onDoubleClick");Ko("focusin","onFocus");Ko("focusout","onBlur");Ko(ew,"onTransitionEnd");ou("onMouseEnter",["mouseout","mouseover"]);ou("onMouseLeave",["mouseout","mouseover"]);ou("onPointerEnter",["pointerout","pointerover"]);ou("onPointerLeave",["pointerout","pointerover"]);Va("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Va("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Va("onBeforeInput",["compositionend","keypress","textInput","paste"]);Va("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Va("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Va("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oc));function tx(r,n,l){var p=r.type||"unknown-event";r.currentTarget=l,lS(p,n,void 0,r),r.currentTarget=null}function rw(r,n){n=(n&4)!==0;for(var l=0;l<r.length;l++){var p=r[l],_=p.event;p=p.listeners;e:{var T=void 0;if(n)for(var w=p.length-1;0<=w;w--){var d=p[w],j=d.instance,Y=d.currentTarget;if(d=d.listener,j!==T&&_.isPropagationStopped())break e;tx(_,d,Y),T=j}else for(w=0;w<p.length;w++){if(d=p[w],j=d.instance,Y=d.currentTarget,d=d.listener,j!==T&&_.isPropagationStopped())break e;tx(_,d,Y),T=j}}}if(op)throw r=sg,op=!1,sg=null,r}function cr(r,n){var l=n[mg];l===void 0&&(l=n[mg]=new Set);var p=r+"__bubble";l.has(p)||(iw(n,r,2,!1),l.add(p))}function Im(r,n,l){var p=0;n&&(p|=4),iw(l,r,p,n)}var Pd="_reactListening"+Math.random().toString(36).slice(2);function nh(r){if(!r[Pd]){r[Pd]=!0,c0.forEach(function(l){l!=="selectionchange"&&(cT.has(l)||Im(l,!1,r),Im(l,!0,r))});var n=r.nodeType===9?r:r.ownerDocument;n===null||n[Pd]||(n[Pd]=!0,Im("selectionchange",!1,n))}}function iw(r,n,l,p){switch(V0(n)){case 1:var _=TS;break;case 4:_=kS;break;default:_=ny}l=_.bind(null,n,l,r),_=void 0,!ng||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(_=!0),p?_!==void 0?r.addEventListener(n,l,{capture:!0,passive:_}):r.addEventListener(n,l,!0):_!==void 0?r.addEventListener(n,l,{passive:_}):r.addEventListener(n,l,!1)}function Cm(r,n,l,p,_){var T=p;if(!(n&1)&&!(n&2)&&p!==null)e:for(;;){if(p===null)return;var w=p.tag;if(w===3||w===4){var d=p.stateNode.containerInfo;if(d===_||d.nodeType===8&&d.parentNode===_)break;if(w===4)for(w=p.return;w!==null;){var j=w.tag;if((j===3||j===4)&&(j=w.stateNode.containerInfo,j===_||j.nodeType===8&&j.parentNode===_))return;w=w.return}for(;d!==null;){if(w=Pa(d),w===null)return;if(j=w.tag,j===5||j===6){p=T=w;continue e}d=d.parentNode}}p=p.return}E0(function(){var Y=T,me=ey(l),te=[];e:{var $=tw.get(r);if($!==void 0){var Ie=oy,Me=r;switch(r){case"keypress":if(Zd(l)===0)break e;case"keydown":case"keyup":Ie=VS;break;case"focusin":Me="focus",Ie=wm;break;case"focusout":Me="blur",Ie=wm;break;case"beforeblur":case"afterblur":Ie=wm;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ie=$v;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ie=CS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ie=$S;break;case J0:case Y0:case Q0:Ie=MS;break;case ew:Ie=ZS;break;case"scroll":Ie=ES;break;case"wheel":Ie=HS;break;case"copy":case"cut":case"paste":Ie=DS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ie=Zv}var Le=(n&4)!==0,yt=!Le&&r==="scroll",ae=Le?$!==null?$+"Capture":null:$;Le=[];for(var ne=Y,ce;ne!==null;){ce=ne;var Se=ce.stateNode;if(ce.tag===5&&Se!==null&&(ce=Se,ae!==null&&(Se=Yc(ne,ae),Se!=null&&Le.push(sh(ne,Se,ce)))),yt)break;ne=ne.return}0<Le.length&&($=new Ie($,Me,null,l,me),te.push({event:$,listeners:Le}))}}if(!(n&7)){e:{if($=r==="mouseover"||r==="pointerover",Ie=r==="mouseout"||r==="pointerout",$&&l!==rg&&(Me=l.relatedTarget||l.fromElement)&&(Pa(Me)||Me[Gs]))break e;if((Ie||$)&&($=me.window===me?me:($=me.ownerDocument)?$.defaultView||$.parentWindow:window,Ie?(Me=l.relatedTarget||l.toElement,Ie=Y,Me=Me?Pa(Me):null,Me!==null&&(yt=ja(Me),Me!==yt||Me.tag!==5&&Me.tag!==6)&&(Me=null)):(Ie=null,Me=Y),Ie!==Me)){if(Le=$v,Se="onMouseLeave",ae="onMouseEnter",ne="mouse",(r==="pointerout"||r==="pointerover")&&(Le=Zv,Se="onPointerLeave",ae="onPointerEnter",ne="pointer"),yt=Ie==null?$:Gl(Ie),ce=Me==null?$:Gl(Me),$=new Le(Se,ne+"leave",Ie,l,me),$.target=yt,$.relatedTarget=ce,Se=null,Pa(me)===Y&&(Le=new Le(ae,ne+"enter",Me,l,me),Le.target=ce,Le.relatedTarget=yt,Se=Le),yt=Se,Ie&&Me)t:{for(Le=Ie,ae=Me,ne=0,ce=Le;ce;ce=Fl(ce))ne++;for(ce=0,Se=ae;Se;Se=Fl(Se))ce++;for(;0<ne-ce;)Le=Fl(Le),ne--;for(;0<ce-ne;)ae=Fl(ae),ce--;for(;ne--;){if(Le===ae||ae!==null&&Le===ae.alternate)break t;Le=Fl(Le),ae=Fl(ae)}Le=null}else Le=null;Ie!==null&&rx(te,$,Ie,Le,!1),Me!==null&&yt!==null&&rx(te,yt,Me,Le,!0)}}e:{if($=Y?Gl(Y):window,Ie=$.nodeName&&$.nodeName.toLowerCase(),Ie==="select"||Ie==="input"&&$.type==="file")var je=eT;else if(Wv($))if(G0)je=nT;else{je=rT;var Ne=tT}else(Ie=$.nodeName)&&Ie.toLowerCase()==="input"&&($.type==="checkbox"||$.type==="radio")&&(je=iT);if(je&&(je=je(r,Y))){Z0(te,je,l,me);break e}Ne&&Ne(r,$,Y),r==="focusout"&&(Ne=$._wrapperState)&&Ne.controlled&&$.type==="number"&&Jm($,"number",$.value)}switch(Ne=Y?Gl(Y):window,r){case"focusin":(Wv(Ne)||Ne.contentEditable==="true")&&(ql=Ne,ug=Y,qc=null);break;case"focusout":qc=ug=ql=null;break;case"mousedown":cg=!0;break;case"contextmenu":case"mouseup":case"dragend":cg=!1,Qv(te,l,me);break;case"selectionchange":if(aT)break;case"keydown":case"keyup":Qv(te,l,me)}var Fe;if(ly)e:{switch(r){case"compositionstart":var Ye="onCompositionStart";break e;case"compositionend":Ye="onCompositionEnd";break e;case"compositionupdate":Ye="onCompositionUpdate";break e}Ye=void 0}else $l?$0(r,l)&&(Ye="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(Ye="onCompositionStart");Ye&&(U0&&l.locale!=="ko"&&($l||Ye!=="onCompositionStart"?Ye==="onCompositionEnd"&&$l&&(Fe=j0()):(Fo=me,sy="value"in Fo?Fo.value:Fo.textContent,$l=!0)),Ne=hp(Y,Ye),0<Ne.length&&(Ye=new qv(Ye,r,null,l,me),te.push({event:Ye,listeners:Ne}),Fe?Ye.data=Fe:(Fe=q0(l),Fe!==null&&(Ye.data=Fe)))),(Fe=XS?KS(r,l):JS(r,l))&&(Y=hp(Y,"onBeforeInput"),0<Y.length&&(me=new qv("onBeforeInput","beforeinput",null,l,me),te.push({event:me,listeners:Y}),me.data=Fe))}rw(te,n)})}function sh(r,n,l){return{instance:r,listener:n,currentTarget:l}}function hp(r,n){for(var l=n+"Capture",p=[];r!==null;){var _=r,T=_.stateNode;_.tag===5&&T!==null&&(_=T,T=Yc(r,l),T!=null&&p.unshift(sh(r,T,_)),T=Yc(r,n),T!=null&&p.push(sh(r,T,_))),r=r.return}return p}function Fl(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function rx(r,n,l,p,_){for(var T=n._reactName,w=[];l!==null&&l!==p;){var d=l,j=d.alternate,Y=d.stateNode;if(j!==null&&j===p)break;d.tag===5&&Y!==null&&(d=Y,_?(j=Yc(l,T),j!=null&&w.unshift(sh(l,j,d))):_||(j=Yc(l,T),j!=null&&w.push(sh(l,j,d)))),l=l.return}w.length!==0&&r.push({event:n,listeners:w})}var hT=/\r\n?/g,dT=/\u0000|\uFFFD/g;function ix(r){return(typeof r=="string"?r:""+r).replace(hT,`
`).replace(dT,"")}function Ad(r,n,l){if(n=ix(n),ix(r)!==n&&l)throw Error(Ee(425))}function dp(){}var hg=null,dg=null;function pg(r,n){return r==="textarea"||r==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var fg=typeof setTimeout=="function"?setTimeout:void 0,pT=typeof clearTimeout=="function"?clearTimeout:void 0,nx=typeof Promise=="function"?Promise:void 0,fT=typeof queueMicrotask=="function"?queueMicrotask:typeof nx<"u"?function(r){return nx.resolve(null).then(r).catch(mT)}:fg;function mT(r){setTimeout(function(){throw r})}function Pm(r,n){var l=n,p=0;do{var _=l.nextSibling;if(r.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"){if(p===0){r.removeChild(_),th(n);return}p--}else l!=="$"&&l!=="$?"&&l!=="$!"||p++;l=_}while(l);th(n)}function Uo(r){for(;r!=null;r=r.nextSibling){var n=r.nodeType;if(n===1||n===3)break;if(n===8){if(n=r.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return r}function sx(r){r=r.previousSibling;for(var n=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"){if(n===0)return r;n--}else l==="/$"&&n++}r=r.previousSibling}return null}var mu=Math.random().toString(36).slice(2),gs="__reactFiber$"+mu,oh="__reactProps$"+mu,Gs="__reactContainer$"+mu,mg="__reactEvents$"+mu,gT="__reactListeners$"+mu,yT="__reactHandles$"+mu;function Pa(r){var n=r[gs];if(n)return n;for(var l=r.parentNode;l;){if(n=l[Gs]||l[gs]){if(l=n.alternate,n.child!==null||l!==null&&l.child!==null)for(r=sx(r);r!==null;){if(l=r[gs])return l;r=sx(r)}return n}r=l,l=r.parentNode}return null}function gh(r){return r=r[gs]||r[Gs],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Gl(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Ee(33))}function Op(r){return r[oh]||null}var gg=[],Hl=-1;function Jo(r){return{current:r}}function hr(r){0>Hl||(r.current=gg[Hl],gg[Hl]=null,Hl--)}function ar(r,n){Hl++,gg[Hl]=r.current,r.current=n}var Xo={},Ti=Jo(Xo),Ki=Jo(!1),Ra=Xo;function au(r,n){var l=r.type.contextTypes;if(!l)return Xo;var p=r.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===n)return p.__reactInternalMemoizedMaskedChildContext;var _={},T;for(T in l)_[T]=n[T];return p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=n,r.__reactInternalMemoizedMaskedChildContext=_),_}function Ji(r){return r=r.childContextTypes,r!=null}function pp(){hr(Ki),hr(Ti)}function ox(r,n,l){if(Ti.current!==Xo)throw Error(Ee(168));ar(Ti,n),ar(Ki,l)}function nw(r,n,l){var p=r.stateNode;if(n=n.childContextTypes,typeof p.getChildContext!="function")return l;p=p.getChildContext();for(var _ in p)if(!(_ in n))throw Error(Ee(108,tS(r)||"Unknown",_));return xr({},l,p)}function fp(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Xo,Ra=Ti.current,ar(Ti,r),ar(Ki,Ki.current),!0}function ax(r,n,l){var p=r.stateNode;if(!p)throw Error(Ee(169));l?(r=nw(r,n,Ra),p.__reactInternalMemoizedMergedChildContext=r,hr(Ki),hr(Ti),ar(Ti,r)):hr(Ki),ar(Ki,l)}var Vs=null,Np=!1,Am=!1;function sw(r){Vs===null?Vs=[r]:Vs.push(r)}function _T(r){Np=!0,sw(r)}function Yo(){if(!Am&&Vs!==null){Am=!0;var r=0,n=Jt;try{var l=Vs;for(Jt=1;r<l.length;r++){var p=l[r];do p=p(!0);while(p!==null)}Vs=null,Np=!1}catch(_){throw Vs!==null&&(Vs=Vs.slice(r+1)),A0(ty,Yo),_}finally{Jt=n,Am=!1}}return null}var Wl=[],Xl=0,mp=null,gp=0,Mn=[],zn=0,La=null,Us=1,$s="";function Ea(r,n){Wl[Xl++]=gp,Wl[Xl++]=mp,mp=r,gp=n}function ow(r,n,l){Mn[zn++]=Us,Mn[zn++]=$s,Mn[zn++]=La,La=r;var p=Us;r=$s;var _=32-Qn(p)-1;p&=~(1<<_),l+=1;var T=32-Qn(n)+_;if(30<T){var w=_-_%5;T=(p&(1<<w)-1).toString(32),p>>=w,_-=w,Us=1<<32-Qn(n)+_|l<<_|p,$s=T+r}else Us=1<<T|l<<_|p,$s=r}function cy(r){r.return!==null&&(Ea(r,1),ow(r,1,0))}function hy(r){for(;r===mp;)mp=Wl[--Xl],Wl[Xl]=null,gp=Wl[--Xl],Wl[Xl]=null;for(;r===La;)La=Mn[--zn],Mn[zn]=null,$s=Mn[--zn],Mn[zn]=null,Us=Mn[--zn],Mn[zn]=null}var yn=null,gn=null,mr=!1,Yn=null;function aw(r,n){var l=Rn(5,null,null,0);l.elementType="DELETED",l.stateNode=n,l.return=r,n=r.deletions,n===null?(r.deletions=[l],r.flags|=16):n.push(l)}function lx(r,n){switch(r.tag){case 5:var l=r.type;return n=n.nodeType!==1||l.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(r.stateNode=n,yn=r,gn=Uo(n.firstChild),!0):!1;case 6:return n=r.pendingProps===""||n.nodeType!==3?null:n,n!==null?(r.stateNode=n,yn=r,gn=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(l=La!==null?{id:Us,overflow:$s}:null,r.memoizedState={dehydrated:n,treeContext:l,retryLane:1073741824},l=Rn(18,null,null,0),l.stateNode=n,l.return=r,r.child=l,yn=r,gn=null,!0):!1;default:return!1}}function yg(r){return(r.mode&1)!==0&&(r.flags&128)===0}function _g(r){if(mr){var n=gn;if(n){var l=n;if(!lx(r,n)){if(yg(r))throw Error(Ee(418));n=Uo(l.nextSibling);var p=yn;n&&lx(r,n)?aw(p,l):(r.flags=r.flags&-4097|2,mr=!1,yn=r)}}else{if(yg(r))throw Error(Ee(418));r.flags=r.flags&-4097|2,mr=!1,yn=r}}}function ux(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;yn=r}function Md(r){if(r!==yn)return!1;if(!mr)return ux(r),mr=!0,!1;var n;if((n=r.tag!==3)&&!(n=r.tag!==5)&&(n=r.type,n=n!=="head"&&n!=="body"&&!pg(r.type,r.memoizedProps)),n&&(n=gn)){if(yg(r))throw lw(),Error(Ee(418));for(;n;)aw(r,n),n=Uo(n.nextSibling)}if(ux(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Ee(317));e:{for(r=r.nextSibling,n=0;r;){if(r.nodeType===8){var l=r.data;if(l==="/$"){if(n===0){gn=Uo(r.nextSibling);break e}n--}else l!=="$"&&l!=="$!"&&l!=="$?"||n++}r=r.nextSibling}gn=null}}else gn=yn?Uo(r.stateNode.nextSibling):null;return!0}function lw(){for(var r=gn;r;)r=Uo(r.nextSibling)}function lu(){gn=yn=null,mr=!1}function dy(r){Yn===null?Yn=[r]:Yn.push(r)}var vT=Xs.ReactCurrentBatchConfig;function Ac(r,n,l){if(r=l.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(Ee(309));var p=l.stateNode}if(!p)throw Error(Ee(147,r));var _=p,T=""+r;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===T?n.ref:(n=function(w){var d=_.refs;w===null?delete d[T]:d[T]=w},n._stringRef=T,n)}if(typeof r!="string")throw Error(Ee(284));if(!l._owner)throw Error(Ee(290,r))}return r}function zd(r,n){throw r=Object.prototype.toString.call(n),Error(Ee(31,r==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":r))}function cx(r){var n=r._init;return n(r._payload)}function uw(r){function n(ae,ne){if(r){var ce=ae.deletions;ce===null?(ae.deletions=[ne],ae.flags|=16):ce.push(ne)}}function l(ae,ne){if(!r)return null;for(;ne!==null;)n(ae,ne),ne=ne.sibling;return null}function p(ae,ne){for(ae=new Map;ne!==null;)ne.key!==null?ae.set(ne.key,ne):ae.set(ne.index,ne),ne=ne.sibling;return ae}function _(ae,ne){return ae=Go(ae,ne),ae.index=0,ae.sibling=null,ae}function T(ae,ne,ce){return ae.index=ce,r?(ce=ae.alternate,ce!==null?(ce=ce.index,ce<ne?(ae.flags|=2,ne):ce):(ae.flags|=2,ne)):(ae.flags|=1048576,ne)}function w(ae){return r&&ae.alternate===null&&(ae.flags|=2),ae}function d(ae,ne,ce,Se){return ne===null||ne.tag!==6?(ne=Fm(ce,ae.mode,Se),ne.return=ae,ne):(ne=_(ne,ce),ne.return=ae,ne)}function j(ae,ne,ce,Se){var je=ce.type;return je===Ul?me(ae,ne,ce.props.children,Se,ce.key):ne!==null&&(ne.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===Do&&cx(je)===ne.type)?(Se=_(ne,ce.props),Se.ref=Ac(ae,ne,ce),Se.return=ae,Se):(Se=Yd(ce.type,ce.key,ce.props,null,ae.mode,Se),Se.ref=Ac(ae,ne,ce),Se.return=ae,Se)}function Y(ae,ne,ce,Se){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==ce.containerInfo||ne.stateNode.implementation!==ce.implementation?(ne=Om(ce,ae.mode,Se),ne.return=ae,ne):(ne=_(ne,ce.children||[]),ne.return=ae,ne)}function me(ae,ne,ce,Se,je){return ne===null||ne.tag!==7?(ne=Da(ce,ae.mode,Se,je),ne.return=ae,ne):(ne=_(ne,ce),ne.return=ae,ne)}function te(ae,ne,ce){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return ne=Fm(""+ne,ae.mode,ce),ne.return=ae,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case wd:return ce=Yd(ne.type,ne.key,ne.props,null,ae.mode,ce),ce.ref=Ac(ae,null,ne),ce.return=ae,ce;case jl:return ne=Om(ne,ae.mode,ce),ne.return=ae,ne;case Do:var Se=ne._init;return te(ae,Se(ne._payload),ce)}if(Bc(ne)||kc(ne))return ne=Da(ne,ae.mode,ce,null),ne.return=ae,ne;zd(ae,ne)}return null}function $(ae,ne,ce,Se){var je=ne!==null?ne.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number")return je!==null?null:d(ae,ne,""+ce,Se);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case wd:return ce.key===je?j(ae,ne,ce,Se):null;case jl:return ce.key===je?Y(ae,ne,ce,Se):null;case Do:return je=ce._init,$(ae,ne,je(ce._payload),Se)}if(Bc(ce)||kc(ce))return je!==null?null:me(ae,ne,ce,Se,null);zd(ae,ce)}return null}function Ie(ae,ne,ce,Se,je){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return ae=ae.get(ce)||null,d(ne,ae,""+Se,je);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case wd:return ae=ae.get(Se.key===null?ce:Se.key)||null,j(ne,ae,Se,je);case jl:return ae=ae.get(Se.key===null?ce:Se.key)||null,Y(ne,ae,Se,je);case Do:var Ne=Se._init;return Ie(ae,ne,ce,Ne(Se._payload),je)}if(Bc(Se)||kc(Se))return ae=ae.get(ce)||null,me(ne,ae,Se,je,null);zd(ne,Se)}return null}function Me(ae,ne,ce,Se){for(var je=null,Ne=null,Fe=ne,Ye=ne=0,kt=null;Fe!==null&&Ye<ce.length;Ye++){Fe.index>Ye?(kt=Fe,Fe=null):kt=Fe.sibling;var it=$(ae,Fe,ce[Ye],Se);if(it===null){Fe===null&&(Fe=kt);break}r&&Fe&&it.alternate===null&&n(ae,Fe),ne=T(it,ne,Ye),Ne===null?je=it:Ne.sibling=it,Ne=it,Fe=kt}if(Ye===ce.length)return l(ae,Fe),mr&&Ea(ae,Ye),je;if(Fe===null){for(;Ye<ce.length;Ye++)Fe=te(ae,ce[Ye],Se),Fe!==null&&(ne=T(Fe,ne,Ye),Ne===null?je=Fe:Ne.sibling=Fe,Ne=Fe);return mr&&Ea(ae,Ye),je}for(Fe=p(ae,Fe);Ye<ce.length;Ye++)kt=Ie(Fe,ae,Ye,ce[Ye],Se),kt!==null&&(r&&kt.alternate!==null&&Fe.delete(kt.key===null?Ye:kt.key),ne=T(kt,ne,Ye),Ne===null?je=kt:Ne.sibling=kt,Ne=kt);return r&&Fe.forEach(function(mt){return n(ae,mt)}),mr&&Ea(ae,Ye),je}function Le(ae,ne,ce,Se){var je=kc(ce);if(typeof je!="function")throw Error(Ee(150));if(ce=je.call(ce),ce==null)throw Error(Ee(151));for(var Ne=je=null,Fe=ne,Ye=ne=0,kt=null,it=ce.next();Fe!==null&&!it.done;Ye++,it=ce.next()){Fe.index>Ye?(kt=Fe,Fe=null):kt=Fe.sibling;var mt=$(ae,Fe,it.value,Se);if(mt===null){Fe===null&&(Fe=kt);break}r&&Fe&&mt.alternate===null&&n(ae,Fe),ne=T(mt,ne,Ye),Ne===null?je=mt:Ne.sibling=mt,Ne=mt,Fe=kt}if(it.done)return l(ae,Fe),mr&&Ea(ae,Ye),je;if(Fe===null){for(;!it.done;Ye++,it=ce.next())it=te(ae,it.value,Se),it!==null&&(ne=T(it,ne,Ye),Ne===null?je=it:Ne.sibling=it,Ne=it);return mr&&Ea(ae,Ye),je}for(Fe=p(ae,Fe);!it.done;Ye++,it=ce.next())it=Ie(Fe,ae,Ye,it.value,Se),it!==null&&(r&&it.alternate!==null&&Fe.delete(it.key===null?Ye:it.key),ne=T(it,ne,Ye),Ne===null?je=it:Ne.sibling=it,Ne=it);return r&&Fe.forEach(function(Et){return n(ae,Et)}),mr&&Ea(ae,Ye),je}function yt(ae,ne,ce,Se){if(typeof ce=="object"&&ce!==null&&ce.type===Ul&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case wd:e:{for(var je=ce.key,Ne=ne;Ne!==null;){if(Ne.key===je){if(je=ce.type,je===Ul){if(Ne.tag===7){l(ae,Ne.sibling),ne=_(Ne,ce.props.children),ne.return=ae,ae=ne;break e}}else if(Ne.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===Do&&cx(je)===Ne.type){l(ae,Ne.sibling),ne=_(Ne,ce.props),ne.ref=Ac(ae,Ne,ce),ne.return=ae,ae=ne;break e}l(ae,Ne);break}else n(ae,Ne);Ne=Ne.sibling}ce.type===Ul?(ne=Da(ce.props.children,ae.mode,Se,ce.key),ne.return=ae,ae=ne):(Se=Yd(ce.type,ce.key,ce.props,null,ae.mode,Se),Se.ref=Ac(ae,ne,ce),Se.return=ae,ae=Se)}return w(ae);case jl:e:{for(Ne=ce.key;ne!==null;){if(ne.key===Ne)if(ne.tag===4&&ne.stateNode.containerInfo===ce.containerInfo&&ne.stateNode.implementation===ce.implementation){l(ae,ne.sibling),ne=_(ne,ce.children||[]),ne.return=ae,ae=ne;break e}else{l(ae,ne);break}else n(ae,ne);ne=ne.sibling}ne=Om(ce,ae.mode,Se),ne.return=ae,ae=ne}return w(ae);case Do:return Ne=ce._init,yt(ae,ne,Ne(ce._payload),Se)}if(Bc(ce))return Me(ae,ne,ce,Se);if(kc(ce))return Le(ae,ne,ce,Se);zd(ae,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"?(ce=""+ce,ne!==null&&ne.tag===6?(l(ae,ne.sibling),ne=_(ne,ce),ne.return=ae,ae=ne):(l(ae,ne),ne=Fm(ce,ae.mode,Se),ne.return=ae,ae=ne),w(ae)):l(ae,ne)}return yt}var uu=uw(!0),cw=uw(!1),yp=Jo(null),_p=null,Kl=null,py=null;function fy(){py=Kl=_p=null}function my(r){var n=yp.current;hr(yp),r._currentValue=n}function vg(r,n,l){for(;r!==null;){var p=r.alternate;if((r.childLanes&n)!==n?(r.childLanes|=n,p!==null&&(p.childLanes|=n)):p!==null&&(p.childLanes&n)!==n&&(p.childLanes|=n),r===l)break;r=r.return}}function iu(r,n){_p=r,py=Kl=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&n&&(Xi=!0),r.firstContext=null)}function Bn(r){var n=r._currentValue;if(py!==r)if(r={context:r,memoizedValue:n,next:null},Kl===null){if(_p===null)throw Error(Ee(308));Kl=r,_p.dependencies={lanes:0,firstContext:r}}else Kl=Kl.next=r;return n}var Aa=null;function gy(r){Aa===null?Aa=[r]:Aa.push(r)}function hw(r,n,l,p){var _=n.interleaved;return _===null?(l.next=l,gy(n)):(l.next=_.next,_.next=l),n.interleaved=l,Hs(r,p)}function Hs(r,n){r.lanes|=n;var l=r.alternate;for(l!==null&&(l.lanes|=n),l=r,r=r.return;r!==null;)r.childLanes|=n,l=r.alternate,l!==null&&(l.childLanes|=n),l=r,r=r.return;return l.tag===3?l.stateNode:null}var Ro=!1;function yy(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dw(r,n){r=r.updateQueue,n.updateQueue===r&&(n.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function qs(r,n){return{eventTime:r,lane:n,tag:0,payload:null,callback:null,next:null}}function $o(r,n,l){var p=r.updateQueue;if(p===null)return null;if(p=p.shared,jt&2){var _=p.pending;return _===null?n.next=n:(n.next=_.next,_.next=n),p.pending=n,Hs(r,l)}return _=p.interleaved,_===null?(n.next=n,gy(p)):(n.next=_.next,_.next=n),p.interleaved=n,Hs(r,l)}function Gd(r,n,l){if(n=n.updateQueue,n!==null&&(n=n.shared,(l&4194240)!==0)){var p=n.lanes;p&=r.pendingLanes,l|=p,n.lanes=l,ry(r,l)}}function hx(r,n){var l=r.updateQueue,p=r.alternate;if(p!==null&&(p=p.updateQueue,l===p)){var _=null,T=null;if(l=l.firstBaseUpdate,l!==null){do{var w={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};T===null?_=T=w:T=T.next=w,l=l.next}while(l!==null);T===null?_=T=n:T=T.next=n}else _=T=n;l={baseState:p.baseState,firstBaseUpdate:_,lastBaseUpdate:T,shared:p.shared,effects:p.effects},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=n:r.next=n,l.lastBaseUpdate=n}function vp(r,n,l,p){var _=r.updateQueue;Ro=!1;var T=_.firstBaseUpdate,w=_.lastBaseUpdate,d=_.shared.pending;if(d!==null){_.shared.pending=null;var j=d,Y=j.next;j.next=null,w===null?T=Y:w.next=Y,w=j;var me=r.alternate;me!==null&&(me=me.updateQueue,d=me.lastBaseUpdate,d!==w&&(d===null?me.firstBaseUpdate=Y:d.next=Y,me.lastBaseUpdate=j))}if(T!==null){var te=_.baseState;w=0,me=Y=j=null,d=T;do{var $=d.lane,Ie=d.eventTime;if((p&$)===$){me!==null&&(me=me.next={eventTime:Ie,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Me=r,Le=d;switch($=n,Ie=l,Le.tag){case 1:if(Me=Le.payload,typeof Me=="function"){te=Me.call(Ie,te,$);break e}te=Me;break e;case 3:Me.flags=Me.flags&-65537|128;case 0:if(Me=Le.payload,$=typeof Me=="function"?Me.call(Ie,te,$):Me,$==null)break e;te=xr({},te,$);break e;case 2:Ro=!0}}d.callback!==null&&d.lane!==0&&(r.flags|=64,$=_.effects,$===null?_.effects=[d]:$.push(d))}else Ie={eventTime:Ie,lane:$,tag:d.tag,payload:d.payload,callback:d.callback,next:null},me===null?(Y=me=Ie,j=te):me=me.next=Ie,w|=$;if(d=d.next,d===null){if(d=_.shared.pending,d===null)break;$=d,d=$.next,$.next=null,_.lastBaseUpdate=$,_.shared.pending=null}}while(!0);if(me===null&&(j=te),_.baseState=j,_.firstBaseUpdate=Y,_.lastBaseUpdate=me,n=_.shared.interleaved,n!==null){_=n;do w|=_.lane,_=_.next;while(_!==n)}else T===null&&(_.shared.lanes=0);Fa|=w,r.lanes=w,r.memoizedState=te}}function dx(r,n,l){if(r=n.effects,n.effects=null,r!==null)for(n=0;n<r.length;n++){var p=r[n],_=p.callback;if(_!==null){if(p.callback=null,p=l,typeof _!="function")throw Error(Ee(191,_));_.call(p)}}}var yh={},_s=Jo(yh),ah=Jo(yh),lh=Jo(yh);function Ma(r){if(r===yh)throw Error(Ee(174));return r}function _y(r,n){switch(ar(lh,n),ar(ah,r),ar(_s,yh),r=n.nodeType,r){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:Qm(null,"");break;default:r=r===8?n.parentNode:n,n=r.namespaceURI||null,r=r.tagName,n=Qm(n,r)}hr(_s),ar(_s,n)}function cu(){hr(_s),hr(ah),hr(lh)}function pw(r){Ma(lh.current);var n=Ma(_s.current),l=Qm(n,r.type);n!==l&&(ar(ah,r),ar(_s,l))}function vy(r){ah.current===r&&(hr(_s),hr(ah))}var _r=Jo(0);function xp(r){for(var n=r;n!==null;){if(n.tag===13){var l=n.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break;for(;n.sibling===null;){if(n.return===null||n.return===r)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Mm=[];function xy(){for(var r=0;r<Mm.length;r++)Mm[r]._workInProgressVersionPrimary=null;Mm.length=0}var Hd=Xs.ReactCurrentDispatcher,zm=Xs.ReactCurrentBatchConfig,Ba=0,vr=null,Ur=null,ei=null,wp=!1,Zc=!1,uh=0,xT=0;function wi(){throw Error(Ee(321))}function wy(r,n){if(n===null)return!1;for(var l=0;l<n.length&&l<r.length;l++)if(!ts(r[l],n[l]))return!1;return!0}function by(r,n,l,p,_,T){if(Ba=T,vr=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,Hd.current=r===null||r.memoizedState===null?TT:kT,r=l(p,_),Zc){T=0;do{if(Zc=!1,uh=0,25<=T)throw Error(Ee(301));T+=1,ei=Ur=null,n.updateQueue=null,Hd.current=ET,r=l(p,_)}while(Zc)}if(Hd.current=bp,n=Ur!==null&&Ur.next!==null,Ba=0,ei=Ur=vr=null,wp=!1,n)throw Error(Ee(300));return r}function Sy(){var r=uh!==0;return uh=0,r}function ms(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ei===null?vr.memoizedState=ei=r:ei=ei.next=r,ei}function Fn(){if(Ur===null){var r=vr.alternate;r=r!==null?r.memoizedState:null}else r=Ur.next;var n=ei===null?vr.memoizedState:ei.next;if(n!==null)ei=n,Ur=r;else{if(r===null)throw Error(Ee(310));Ur=r,r={memoizedState:Ur.memoizedState,baseState:Ur.baseState,baseQueue:Ur.baseQueue,queue:Ur.queue,next:null},ei===null?vr.memoizedState=ei=r:ei=ei.next=r}return ei}function ch(r,n){return typeof n=="function"?n(r):n}function Dm(r){var n=Fn(),l=n.queue;if(l===null)throw Error(Ee(311));l.lastRenderedReducer=r;var p=Ur,_=p.baseQueue,T=l.pending;if(T!==null){if(_!==null){var w=_.next;_.next=T.next,T.next=w}p.baseQueue=_=T,l.pending=null}if(_!==null){T=_.next,p=p.baseState;var d=w=null,j=null,Y=T;do{var me=Y.lane;if((Ba&me)===me)j!==null&&(j=j.next={lane:0,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),p=Y.hasEagerState?Y.eagerState:r(p,Y.action);else{var te={lane:me,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null};j===null?(d=j=te,w=p):j=j.next=te,vr.lanes|=me,Fa|=me}Y=Y.next}while(Y!==null&&Y!==T);j===null?w=p:j.next=d,ts(p,n.memoizedState)||(Xi=!0),n.memoizedState=p,n.baseState=w,n.baseQueue=j,l.lastRenderedState=p}if(r=l.interleaved,r!==null){_=r;do T=_.lane,vr.lanes|=T,Fa|=T,_=_.next;while(_!==r)}else _===null&&(l.lanes=0);return[n.memoizedState,l.dispatch]}function Rm(r){var n=Fn(),l=n.queue;if(l===null)throw Error(Ee(311));l.lastRenderedReducer=r;var p=l.dispatch,_=l.pending,T=n.memoizedState;if(_!==null){l.pending=null;var w=_=_.next;do T=r(T,w.action),w=w.next;while(w!==_);ts(T,n.memoizedState)||(Xi=!0),n.memoizedState=T,n.baseQueue===null&&(n.baseState=T),l.lastRenderedState=T}return[T,p]}function fw(){}function mw(r,n){var l=vr,p=Fn(),_=n(),T=!ts(p.memoizedState,_);if(T&&(p.memoizedState=_,Xi=!0),p=p.queue,Ty(_w.bind(null,l,p,r),[r]),p.getSnapshot!==n||T||ei!==null&&ei.memoizedState.tag&1){if(l.flags|=2048,hh(9,yw.bind(null,l,p,_,n),void 0,null),ti===null)throw Error(Ee(349));Ba&30||gw(l,n,_)}return _}function gw(r,n,l){r.flags|=16384,r={getSnapshot:n,value:l},n=vr.updateQueue,n===null?(n={lastEffect:null,stores:null},vr.updateQueue=n,n.stores=[r]):(l=n.stores,l===null?n.stores=[r]:l.push(r))}function yw(r,n,l,p){n.value=l,n.getSnapshot=p,vw(n)&&xw(r)}function _w(r,n,l){return l(function(){vw(n)&&xw(r)})}function vw(r){var n=r.getSnapshot;r=r.value;try{var l=n();return!ts(r,l)}catch{return!0}}function xw(r){var n=Hs(r,1);n!==null&&es(n,r,1,-1)}function px(r){var n=ms();return typeof r=="function"&&(r=r()),n.memoizedState=n.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ch,lastRenderedState:r},n.queue=r,r=r.dispatch=ST.bind(null,vr,r),[n.memoizedState,r]}function hh(r,n,l,p){return r={tag:r,create:n,destroy:l,deps:p,next:null},n=vr.updateQueue,n===null?(n={lastEffect:null,stores:null},vr.updateQueue=n,n.lastEffect=r.next=r):(l=n.lastEffect,l===null?n.lastEffect=r.next=r:(p=l.next,l.next=r,r.next=p,n.lastEffect=r)),r}function ww(){return Fn().memoizedState}function Wd(r,n,l,p){var _=ms();vr.flags|=r,_.memoizedState=hh(1|n,l,void 0,p===void 0?null:p)}function Vp(r,n,l,p){var _=Fn();p=p===void 0?null:p;var T=void 0;if(Ur!==null){var w=Ur.memoizedState;if(T=w.destroy,p!==null&&wy(p,w.deps)){_.memoizedState=hh(n,l,T,p);return}}vr.flags|=r,_.memoizedState=hh(1|n,l,T,p)}function fx(r,n){return Wd(8390656,8,r,n)}function Ty(r,n){return Vp(2048,8,r,n)}function bw(r,n){return Vp(4,2,r,n)}function Sw(r,n){return Vp(4,4,r,n)}function Tw(r,n){if(typeof n=="function")return r=r(),n(r),function(){n(null)};if(n!=null)return r=r(),n.current=r,function(){n.current=null}}function kw(r,n,l){return l=l!=null?l.concat([r]):null,Vp(4,4,Tw.bind(null,n,r),l)}function ky(){}function Ew(r,n){var l=Fn();n=n===void 0?null:n;var p=l.memoizedState;return p!==null&&n!==null&&wy(n,p[1])?p[0]:(l.memoizedState=[r,n],r)}function Iw(r,n){var l=Fn();n=n===void 0?null:n;var p=l.memoizedState;return p!==null&&n!==null&&wy(n,p[1])?p[0]:(r=r(),l.memoizedState=[r,n],r)}function Cw(r,n,l){return Ba&21?(ts(l,n)||(l=D0(),vr.lanes|=l,Fa|=l,r.baseState=!0),n):(r.baseState&&(r.baseState=!1,Xi=!0),r.memoizedState=l)}function wT(r,n){var l=Jt;Jt=l!==0&&4>l?l:4,r(!0);var p=zm.transition;zm.transition={};try{r(!1),n()}finally{Jt=l,zm.transition=p}}function Pw(){return Fn().memoizedState}function bT(r,n,l){var p=Zo(r);if(l={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null},Aw(r))Mw(n,l);else if(l=hw(r,n,l,p),l!==null){var _=Li();es(l,r,p,_),zw(l,n,p)}}function ST(r,n,l){var p=Zo(r),_={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null};if(Aw(r))Mw(n,_);else{var T=r.alternate;if(r.lanes===0&&(T===null||T.lanes===0)&&(T=n.lastRenderedReducer,T!==null))try{var w=n.lastRenderedState,d=T(w,l);if(_.hasEagerState=!0,_.eagerState=d,ts(d,w)){var j=n.interleaved;j===null?(_.next=_,gy(n)):(_.next=j.next,j.next=_),n.interleaved=_;return}}catch{}finally{}l=hw(r,n,_,p),l!==null&&(_=Li(),es(l,r,p,_),zw(l,n,p))}}function Aw(r){var n=r.alternate;return r===vr||n!==null&&n===vr}function Mw(r,n){Zc=wp=!0;var l=r.pending;l===null?n.next=n:(n.next=l.next,l.next=n),r.pending=n}function zw(r,n,l){if(l&4194240){var p=n.lanes;p&=r.pendingLanes,l|=p,n.lanes=l,ry(r,l)}}var bp={readContext:Bn,useCallback:wi,useContext:wi,useEffect:wi,useImperativeHandle:wi,useInsertionEffect:wi,useLayoutEffect:wi,useMemo:wi,useReducer:wi,useRef:wi,useState:wi,useDebugValue:wi,useDeferredValue:wi,useTransition:wi,useMutableSource:wi,useSyncExternalStore:wi,useId:wi,unstable_isNewReconciler:!1},TT={readContext:Bn,useCallback:function(r,n){return ms().memoizedState=[r,n===void 0?null:n],r},useContext:Bn,useEffect:fx,useImperativeHandle:function(r,n,l){return l=l!=null?l.concat([r]):null,Wd(4194308,4,Tw.bind(null,n,r),l)},useLayoutEffect:function(r,n){return Wd(4194308,4,r,n)},useInsertionEffect:function(r,n){return Wd(4,2,r,n)},useMemo:function(r,n){var l=ms();return n=n===void 0?null:n,r=r(),l.memoizedState=[r,n],r},useReducer:function(r,n,l){var p=ms();return n=l!==void 0?l(n):n,p.memoizedState=p.baseState=n,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:n},p.queue=r,r=r.dispatch=bT.bind(null,vr,r),[p.memoizedState,r]},useRef:function(r){var n=ms();return r={current:r},n.memoizedState=r},useState:px,useDebugValue:ky,useDeferredValue:function(r){return ms().memoizedState=r},useTransition:function(){var r=px(!1),n=r[0];return r=wT.bind(null,r[1]),ms().memoizedState=r,[n,r]},useMutableSource:function(){},useSyncExternalStore:function(r,n,l){var p=vr,_=ms();if(mr){if(l===void 0)throw Error(Ee(407));l=l()}else{if(l=n(),ti===null)throw Error(Ee(349));Ba&30||gw(p,n,l)}_.memoizedState=l;var T={value:l,getSnapshot:n};return _.queue=T,fx(_w.bind(null,p,T,r),[r]),p.flags|=2048,hh(9,yw.bind(null,p,T,l,n),void 0,null),l},useId:function(){var r=ms(),n=ti.identifierPrefix;if(mr){var l=$s,p=Us;l=(p&~(1<<32-Qn(p)-1)).toString(32)+l,n=":"+n+"R"+l,l=uh++,0<l&&(n+="H"+l.toString(32)),n+=":"}else l=xT++,n=":"+n+"r"+l.toString(32)+":";return r.memoizedState=n},unstable_isNewReconciler:!1},kT={readContext:Bn,useCallback:Ew,useContext:Bn,useEffect:Ty,useImperativeHandle:kw,useInsertionEffect:bw,useLayoutEffect:Sw,useMemo:Iw,useReducer:Dm,useRef:ww,useState:function(){return Dm(ch)},useDebugValue:ky,useDeferredValue:function(r){var n=Fn();return Cw(n,Ur.memoizedState,r)},useTransition:function(){var r=Dm(ch)[0],n=Fn().memoizedState;return[r,n]},useMutableSource:fw,useSyncExternalStore:mw,useId:Pw,unstable_isNewReconciler:!1},ET={readContext:Bn,useCallback:Ew,useContext:Bn,useEffect:Ty,useImperativeHandle:kw,useInsertionEffect:bw,useLayoutEffect:Sw,useMemo:Iw,useReducer:Rm,useRef:ww,useState:function(){return Rm(ch)},useDebugValue:ky,useDeferredValue:function(r){var n=Fn();return Ur===null?n.memoizedState=r:Cw(n,Ur.memoizedState,r)},useTransition:function(){var r=Rm(ch)[0],n=Fn().memoizedState;return[r,n]},useMutableSource:fw,useSyncExternalStore:mw,useId:Pw,unstable_isNewReconciler:!1};function Xn(r,n){if(r&&r.defaultProps){n=xr({},n),r=r.defaultProps;for(var l in r)n[l]===void 0&&(n[l]=r[l]);return n}return n}function xg(r,n,l,p){n=r.memoizedState,l=l(p,n),l=l==null?n:xr({},n,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var jp={isMounted:function(r){return(r=r._reactInternals)?ja(r)===r:!1},enqueueSetState:function(r,n,l){r=r._reactInternals;var p=Li(),_=Zo(r),T=qs(p,_);T.payload=n,l!=null&&(T.callback=l),n=$o(r,T,_),n!==null&&(es(n,r,_,p),Gd(n,r,_))},enqueueReplaceState:function(r,n,l){r=r._reactInternals;var p=Li(),_=Zo(r),T=qs(p,_);T.tag=1,T.payload=n,l!=null&&(T.callback=l),n=$o(r,T,_),n!==null&&(es(n,r,_,p),Gd(n,r,_))},enqueueForceUpdate:function(r,n){r=r._reactInternals;var l=Li(),p=Zo(r),_=qs(l,p);_.tag=2,n!=null&&(_.callback=n),n=$o(r,_,p),n!==null&&(es(n,r,p,l),Gd(n,r,p))}};function mx(r,n,l,p,_,T,w){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(p,T,w):n.prototype&&n.prototype.isPureReactComponent?!ih(l,p)||!ih(_,T):!0}function Dw(r,n,l){var p=!1,_=Xo,T=n.contextType;return typeof T=="object"&&T!==null?T=Bn(T):(_=Ji(n)?Ra:Ti.current,p=n.contextTypes,T=(p=p!=null)?au(r,_):Xo),n=new n(l,T),r.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=jp,r.stateNode=n,n._reactInternals=r,p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=_,r.__reactInternalMemoizedMaskedChildContext=T),n}function gx(r,n,l,p){r=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(l,p),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(l,p),n.state!==r&&jp.enqueueReplaceState(n,n.state,null)}function wg(r,n,l,p){var _=r.stateNode;_.props=l,_.state=r.memoizedState,_.refs={},yy(r);var T=n.contextType;typeof T=="object"&&T!==null?_.context=Bn(T):(T=Ji(n)?Ra:Ti.current,_.context=au(r,T)),_.state=r.memoizedState,T=n.getDerivedStateFromProps,typeof T=="function"&&(xg(r,n,T,l),_.state=r.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(n=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),n!==_.state&&jp.enqueueReplaceState(_,_.state,null),vp(r,l,_,p),_.state=r.memoizedState),typeof _.componentDidMount=="function"&&(r.flags|=4194308)}function hu(r,n){try{var l="",p=n;do l+=eS(p),p=p.return;while(p);var _=l}catch(T){_=`
Error generating stack: `+T.message+`
`+T.stack}return{value:r,source:n,stack:_,digest:null}}function Lm(r,n,l){return{value:r,source:null,stack:l??null,digest:n??null}}function bg(r,n){try{console.error(n.value)}catch(l){setTimeout(function(){throw l})}}var IT=typeof WeakMap=="function"?WeakMap:Map;function Rw(r,n,l){l=qs(-1,l),l.tag=3,l.payload={element:null};var p=n.value;return l.callback=function(){Tp||(Tp=!0,zg=p),bg(r,n)},l}function Lw(r,n,l){l=qs(-1,l),l.tag=3;var p=r.type.getDerivedStateFromError;if(typeof p=="function"){var _=n.value;l.payload=function(){return p(_)},l.callback=function(){bg(r,n)}}var T=r.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(l.callback=function(){bg(r,n),typeof p!="function"&&(qo===null?qo=new Set([this]):qo.add(this));var w=n.stack;this.componentDidCatch(n.value,{componentStack:w!==null?w:""})}),l}function yx(r,n,l){var p=r.pingCache;if(p===null){p=r.pingCache=new IT;var _=new Set;p.set(n,_)}else _=p.get(n),_===void 0&&(_=new Set,p.set(n,_));_.has(l)||(_.add(l),r=jT.bind(null,r,n,l),n.then(r,r))}function _x(r){do{var n;if((n=r.tag===13)&&(n=r.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return r;r=r.return}while(r!==null);return null}function vx(r,n,l,p,_){return r.mode&1?(r.flags|=65536,r.lanes=_,r):(r===n?r.flags|=65536:(r.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(n=qs(-1,1),n.tag=2,$o(l,n,1))),l.lanes|=1),r)}var CT=Xs.ReactCurrentOwner,Xi=!1;function Ri(r,n,l,p){n.child=r===null?cw(n,null,l,p):uu(n,r.child,l,p)}function xx(r,n,l,p,_){l=l.render;var T=n.ref;return iu(n,_),p=by(r,n,l,p,T,_),l=Sy(),r!==null&&!Xi?(n.updateQueue=r.updateQueue,n.flags&=-2053,r.lanes&=~_,Ws(r,n,_)):(mr&&l&&cy(n),n.flags|=1,Ri(r,n,p,_),n.child)}function wx(r,n,l,p,_){if(r===null){var T=l.type;return typeof T=="function"&&!Dy(T)&&T.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(n.tag=15,n.type=T,Bw(r,n,T,p,_)):(r=Yd(l.type,null,p,n,n.mode,_),r.ref=n.ref,r.return=n,n.child=r)}if(T=r.child,!(r.lanes&_)){var w=T.memoizedProps;if(l=l.compare,l=l!==null?l:ih,l(w,p)&&r.ref===n.ref)return Ws(r,n,_)}return n.flags|=1,r=Go(T,p),r.ref=n.ref,r.return=n,n.child=r}function Bw(r,n,l,p,_){if(r!==null){var T=r.memoizedProps;if(ih(T,p)&&r.ref===n.ref)if(Xi=!1,n.pendingProps=p=T,(r.lanes&_)!==0)r.flags&131072&&(Xi=!0);else return n.lanes=r.lanes,Ws(r,n,_)}return Sg(r,n,l,p,_)}function Fw(r,n,l){var p=n.pendingProps,_=p.children,T=r!==null?r.memoizedState:null;if(p.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},ar(Yl,mn),mn|=l;else{if(!(l&1073741824))return r=T!==null?T.baseLanes|l:l,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:r,cachePool:null,transitions:null},n.updateQueue=null,ar(Yl,mn),mn|=r,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=T!==null?T.baseLanes:l,ar(Yl,mn),mn|=p}else T!==null?(p=T.baseLanes|l,n.memoizedState=null):p=l,ar(Yl,mn),mn|=p;return Ri(r,n,_,l),n.child}function Ow(r,n){var l=n.ref;(r===null&&l!==null||r!==null&&r.ref!==l)&&(n.flags|=512,n.flags|=2097152)}function Sg(r,n,l,p,_){var T=Ji(l)?Ra:Ti.current;return T=au(n,T),iu(n,_),l=by(r,n,l,p,T,_),p=Sy(),r!==null&&!Xi?(n.updateQueue=r.updateQueue,n.flags&=-2053,r.lanes&=~_,Ws(r,n,_)):(mr&&p&&cy(n),n.flags|=1,Ri(r,n,l,_),n.child)}function bx(r,n,l,p,_){if(Ji(l)){var T=!0;fp(n)}else T=!1;if(iu(n,_),n.stateNode===null)Xd(r,n),Dw(n,l,p),wg(n,l,p,_),p=!0;else if(r===null){var w=n.stateNode,d=n.memoizedProps;w.props=d;var j=w.context,Y=l.contextType;typeof Y=="object"&&Y!==null?Y=Bn(Y):(Y=Ji(l)?Ra:Ti.current,Y=au(n,Y));var me=l.getDerivedStateFromProps,te=typeof me=="function"||typeof w.getSnapshotBeforeUpdate=="function";te||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(d!==p||j!==Y)&&gx(n,w,p,Y),Ro=!1;var $=n.memoizedState;w.state=$,vp(n,p,w,_),j=n.memoizedState,d!==p||$!==j||Ki.current||Ro?(typeof me=="function"&&(xg(n,l,me,p),j=n.memoizedState),(d=Ro||mx(n,l,d,p,$,j,Y))?(te||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(n.flags|=4194308)):(typeof w.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=p,n.memoizedState=j),w.props=p,w.state=j,w.context=Y,p=d):(typeof w.componentDidMount=="function"&&(n.flags|=4194308),p=!1)}else{w=n.stateNode,dw(r,n),d=n.memoizedProps,Y=n.type===n.elementType?d:Xn(n.type,d),w.props=Y,te=n.pendingProps,$=w.context,j=l.contextType,typeof j=="object"&&j!==null?j=Bn(j):(j=Ji(l)?Ra:Ti.current,j=au(n,j));var Ie=l.getDerivedStateFromProps;(me=typeof Ie=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(d!==te||$!==j)&&gx(n,w,p,j),Ro=!1,$=n.memoizedState,w.state=$,vp(n,p,w,_);var Me=n.memoizedState;d!==te||$!==Me||Ki.current||Ro?(typeof Ie=="function"&&(xg(n,l,Ie,p),Me=n.memoizedState),(Y=Ro||mx(n,l,Y,p,$,Me,j)||!1)?(me||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(p,Me,j),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(p,Me,j)),typeof w.componentDidUpdate=="function"&&(n.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof w.componentDidUpdate!="function"||d===r.memoizedProps&&$===r.memoizedState||(n.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&$===r.memoizedState||(n.flags|=1024),n.memoizedProps=p,n.memoizedState=Me),w.props=p,w.state=Me,w.context=j,p=Y):(typeof w.componentDidUpdate!="function"||d===r.memoizedProps&&$===r.memoizedState||(n.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&$===r.memoizedState||(n.flags|=1024),p=!1)}return Tg(r,n,l,p,T,_)}function Tg(r,n,l,p,_,T){Ow(r,n);var w=(n.flags&128)!==0;if(!p&&!w)return _&&ax(n,l,!1),Ws(r,n,T);p=n.stateNode,CT.current=n;var d=w&&typeof l.getDerivedStateFromError!="function"?null:p.render();return n.flags|=1,r!==null&&w?(n.child=uu(n,r.child,null,T),n.child=uu(n,null,d,T)):Ri(r,n,d,T),n.memoizedState=p.state,_&&ax(n,l,!0),n.child}function Nw(r){var n=r.stateNode;n.pendingContext?ox(r,n.pendingContext,n.pendingContext!==n.context):n.context&&ox(r,n.context,!1),_y(r,n.containerInfo)}function Sx(r,n,l,p,_){return lu(),dy(_),n.flags|=256,Ri(r,n,l,p),n.child}var kg={dehydrated:null,treeContext:null,retryLane:0};function Eg(r){return{baseLanes:r,cachePool:null,transitions:null}}function Vw(r,n,l){var p=n.pendingProps,_=_r.current,T=!1,w=(n.flags&128)!==0,d;if((d=w)||(d=r!==null&&r.memoizedState===null?!1:(_&2)!==0),d?(T=!0,n.flags&=-129):(r===null||r.memoizedState!==null)&&(_|=1),ar(_r,_&1),r===null)return _g(n),r=n.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(n.mode&1?r.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(w=p.children,r=p.fallback,T?(p=n.mode,T=n.child,w={mode:"hidden",children:w},!(p&1)&&T!==null?(T.childLanes=0,T.pendingProps=w):T=qp(w,p,0,null),r=Da(r,p,l,null),T.return=n,r.return=n,T.sibling=r,n.child=T,n.child.memoizedState=Eg(l),n.memoizedState=kg,r):Ey(n,w));if(_=r.memoizedState,_!==null&&(d=_.dehydrated,d!==null))return PT(r,n,w,p,d,_,l);if(T){T=p.fallback,w=n.mode,_=r.child,d=_.sibling;var j={mode:"hidden",children:p.children};return!(w&1)&&n.child!==_?(p=n.child,p.childLanes=0,p.pendingProps=j,n.deletions=null):(p=Go(_,j),p.subtreeFlags=_.subtreeFlags&14680064),d!==null?T=Go(d,T):(T=Da(T,w,l,null),T.flags|=2),T.return=n,p.return=n,p.sibling=T,n.child=p,p=T,T=n.child,w=r.child.memoizedState,w=w===null?Eg(l):{baseLanes:w.baseLanes|l,cachePool:null,transitions:w.transitions},T.memoizedState=w,T.childLanes=r.childLanes&~l,n.memoizedState=kg,p}return T=r.child,r=T.sibling,p=Go(T,{mode:"visible",children:p.children}),!(n.mode&1)&&(p.lanes=l),p.return=n,p.sibling=null,r!==null&&(l=n.deletions,l===null?(n.deletions=[r],n.flags|=16):l.push(r)),n.child=p,n.memoizedState=null,p}function Ey(r,n){return n=qp({mode:"visible",children:n},r.mode,0,null),n.return=r,r.child=n}function Dd(r,n,l,p){return p!==null&&dy(p),uu(n,r.child,null,l),r=Ey(n,n.pendingProps.children),r.flags|=2,n.memoizedState=null,r}function PT(r,n,l,p,_,T,w){if(l)return n.flags&256?(n.flags&=-257,p=Lm(Error(Ee(422))),Dd(r,n,w,p)):n.memoizedState!==null?(n.child=r.child,n.flags|=128,null):(T=p.fallback,_=n.mode,p=qp({mode:"visible",children:p.children},_,0,null),T=Da(T,_,w,null),T.flags|=2,p.return=n,T.return=n,p.sibling=T,n.child=p,n.mode&1&&uu(n,r.child,null,w),n.child.memoizedState=Eg(w),n.memoizedState=kg,T);if(!(n.mode&1))return Dd(r,n,w,null);if(_.data==="$!"){if(p=_.nextSibling&&_.nextSibling.dataset,p)var d=p.dgst;return p=d,T=Error(Ee(419)),p=Lm(T,p,void 0),Dd(r,n,w,p)}if(d=(w&r.childLanes)!==0,Xi||d){if(p=ti,p!==null){switch(w&-w){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(p.suspendedLanes|w)?0:_,_!==0&&_!==T.retryLane&&(T.retryLane=_,Hs(r,_),es(p,r,_,-1))}return zy(),p=Lm(Error(Ee(421))),Dd(r,n,w,p)}return _.data==="$?"?(n.flags|=128,n.child=r.child,n=UT.bind(null,r),_._reactRetry=n,null):(r=T.treeContext,gn=Uo(_.nextSibling),yn=n,mr=!0,Yn=null,r!==null&&(Mn[zn++]=Us,Mn[zn++]=$s,Mn[zn++]=La,Us=r.id,$s=r.overflow,La=n),n=Ey(n,p.children),n.flags|=4096,n)}function Tx(r,n,l){r.lanes|=n;var p=r.alternate;p!==null&&(p.lanes|=n),vg(r.return,n,l)}function Bm(r,n,l,p,_){var T=r.memoizedState;T===null?r.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:p,tail:l,tailMode:_}:(T.isBackwards=n,T.rendering=null,T.renderingStartTime=0,T.last=p,T.tail=l,T.tailMode=_)}function jw(r,n,l){var p=n.pendingProps,_=p.revealOrder,T=p.tail;if(Ri(r,n,p.children,l),p=_r.current,p&2)p=p&1|2,n.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=n.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Tx(r,l,n);else if(r.tag===19)Tx(r,l,n);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break e;for(;r.sibling===null;){if(r.return===null||r.return===n)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}p&=1}if(ar(_r,p),!(n.mode&1))n.memoizedState=null;else switch(_){case"forwards":for(l=n.child,_=null;l!==null;)r=l.alternate,r!==null&&xp(r)===null&&(_=l),l=l.sibling;l=_,l===null?(_=n.child,n.child=null):(_=l.sibling,l.sibling=null),Bm(n,!1,_,l,T);break;case"backwards":for(l=null,_=n.child,n.child=null;_!==null;){if(r=_.alternate,r!==null&&xp(r)===null){n.child=_;break}r=_.sibling,_.sibling=l,l=_,_=r}Bm(n,!0,l,null,T);break;case"together":Bm(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Xd(r,n){!(n.mode&1)&&r!==null&&(r.alternate=null,n.alternate=null,n.flags|=2)}function Ws(r,n,l){if(r!==null&&(n.dependencies=r.dependencies),Fa|=n.lanes,!(l&n.childLanes))return null;if(r!==null&&n.child!==r.child)throw Error(Ee(153));if(n.child!==null){for(r=n.child,l=Go(r,r.pendingProps),n.child=l,l.return=n;r.sibling!==null;)r=r.sibling,l=l.sibling=Go(r,r.pendingProps),l.return=n;l.sibling=null}return n.child}function AT(r,n,l){switch(n.tag){case 3:Nw(n),lu();break;case 5:pw(n);break;case 1:Ji(n.type)&&fp(n);break;case 4:_y(n,n.stateNode.containerInfo);break;case 10:var p=n.type._context,_=n.memoizedProps.value;ar(yp,p._currentValue),p._currentValue=_;break;case 13:if(p=n.memoizedState,p!==null)return p.dehydrated!==null?(ar(_r,_r.current&1),n.flags|=128,null):l&n.child.childLanes?Vw(r,n,l):(ar(_r,_r.current&1),r=Ws(r,n,l),r!==null?r.sibling:null);ar(_r,_r.current&1);break;case 19:if(p=(l&n.childLanes)!==0,r.flags&128){if(p)return jw(r,n,l);n.flags|=128}if(_=n.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),ar(_r,_r.current),p)break;return null;case 22:case 23:return n.lanes=0,Fw(r,n,l)}return Ws(r,n,l)}var Uw,Ig,$w,qw;Uw=function(r,n){for(var l=n.child;l!==null;){if(l.tag===5||l.tag===6)r.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===n)break;for(;l.sibling===null;){if(l.return===null||l.return===n)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};Ig=function(){};$w=function(r,n,l,p){var _=r.memoizedProps;if(_!==p){r=n.stateNode,Ma(_s.current);var T=null;switch(l){case"input":_=Xm(r,_),p=Xm(r,p),T=[];break;case"select":_=xr({},_,{value:void 0}),p=xr({},p,{value:void 0}),T=[];break;case"textarea":_=Ym(r,_),p=Ym(r,p),T=[];break;default:typeof _.onClick!="function"&&typeof p.onClick=="function"&&(r.onclick=dp)}eg(l,p);var w;l=null;for(Y in _)if(!p.hasOwnProperty(Y)&&_.hasOwnProperty(Y)&&_[Y]!=null)if(Y==="style"){var d=_[Y];for(w in d)d.hasOwnProperty(w)&&(l||(l={}),l[w]="")}else Y!=="dangerouslySetInnerHTML"&&Y!=="children"&&Y!=="suppressContentEditableWarning"&&Y!=="suppressHydrationWarning"&&Y!=="autoFocus"&&(Kc.hasOwnProperty(Y)?T||(T=[]):(T=T||[]).push(Y,null));for(Y in p){var j=p[Y];if(d=_!=null?_[Y]:void 0,p.hasOwnProperty(Y)&&j!==d&&(j!=null||d!=null))if(Y==="style")if(d){for(w in d)!d.hasOwnProperty(w)||j&&j.hasOwnProperty(w)||(l||(l={}),l[w]="");for(w in j)j.hasOwnProperty(w)&&d[w]!==j[w]&&(l||(l={}),l[w]=j[w])}else l||(T||(T=[]),T.push(Y,l)),l=j;else Y==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,d=d?d.__html:void 0,j!=null&&d!==j&&(T=T||[]).push(Y,j)):Y==="children"?typeof j!="string"&&typeof j!="number"||(T=T||[]).push(Y,""+j):Y!=="suppressContentEditableWarning"&&Y!=="suppressHydrationWarning"&&(Kc.hasOwnProperty(Y)?(j!=null&&Y==="onScroll"&&cr("scroll",r),T||d===j||(T=[])):(T=T||[]).push(Y,j))}l&&(T=T||[]).push("style",l);var Y=T;(n.updateQueue=Y)&&(n.flags|=4)}};qw=function(r,n,l,p){l!==p&&(n.flags|=4)};function Mc(r,n){if(!mr)switch(r.tailMode){case"hidden":n=r.tail;for(var l=null;n!==null;)n.alternate!==null&&(l=n),n=n.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var p=null;l!==null;)l.alternate!==null&&(p=l),l=l.sibling;p===null?n||r.tail===null?r.tail=null:r.tail.sibling=null:p.sibling=null}}function bi(r){var n=r.alternate!==null&&r.alternate.child===r.child,l=0,p=0;if(n)for(var _=r.child;_!==null;)l|=_.lanes|_.childLanes,p|=_.subtreeFlags&14680064,p|=_.flags&14680064,_.return=r,_=_.sibling;else for(_=r.child;_!==null;)l|=_.lanes|_.childLanes,p|=_.subtreeFlags,p|=_.flags,_.return=r,_=_.sibling;return r.subtreeFlags|=p,r.childLanes=l,n}function MT(r,n,l){var p=n.pendingProps;switch(hy(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bi(n),null;case 1:return Ji(n.type)&&pp(),bi(n),null;case 3:return p=n.stateNode,cu(),hr(Ki),hr(Ti),xy(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(r===null||r.child===null)&&(Md(n)?n.flags|=4:r===null||r.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Yn!==null&&(Lg(Yn),Yn=null))),Ig(r,n),bi(n),null;case 5:vy(n);var _=Ma(lh.current);if(l=n.type,r!==null&&n.stateNode!=null)$w(r,n,l,p,_),r.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!p){if(n.stateNode===null)throw Error(Ee(166));return bi(n),null}if(r=Ma(_s.current),Md(n)){p=n.stateNode,l=n.type;var T=n.memoizedProps;switch(p[gs]=n,p[oh]=T,r=(n.mode&1)!==0,l){case"dialog":cr("cancel",p),cr("close",p);break;case"iframe":case"object":case"embed":cr("load",p);break;case"video":case"audio":for(_=0;_<Oc.length;_++)cr(Oc[_],p);break;case"source":cr("error",p);break;case"img":case"image":case"link":cr("error",p),cr("load",p);break;case"details":cr("toggle",p);break;case"input":Dv(p,T),cr("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!T.multiple},cr("invalid",p);break;case"textarea":Lv(p,T),cr("invalid",p)}eg(l,T),_=null;for(var w in T)if(T.hasOwnProperty(w)){var d=T[w];w==="children"?typeof d=="string"?p.textContent!==d&&(T.suppressHydrationWarning!==!0&&Ad(p.textContent,d,r),_=["children",d]):typeof d=="number"&&p.textContent!==""+d&&(T.suppressHydrationWarning!==!0&&Ad(p.textContent,d,r),_=["children",""+d]):Kc.hasOwnProperty(w)&&d!=null&&w==="onScroll"&&cr("scroll",p)}switch(l){case"input":bd(p),Rv(p,T,!0);break;case"textarea":bd(p),Bv(p);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(p.onclick=dp)}p=_,n.updateQueue=p,p!==null&&(n.flags|=4)}else{w=_.nodeType===9?_:_.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=_0(l)),r==="http://www.w3.org/1999/xhtml"?l==="script"?(r=w.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof p.is=="string"?r=w.createElement(l,{is:p.is}):(r=w.createElement(l),l==="select"&&(w=r,p.multiple?w.multiple=!0:p.size&&(w.size=p.size))):r=w.createElementNS(r,l),r[gs]=n,r[oh]=p,Uw(r,n,!1,!1),n.stateNode=r;e:{switch(w=tg(l,p),l){case"dialog":cr("cancel",r),cr("close",r),_=p;break;case"iframe":case"object":case"embed":cr("load",r),_=p;break;case"video":case"audio":for(_=0;_<Oc.length;_++)cr(Oc[_],r);_=p;break;case"source":cr("error",r),_=p;break;case"img":case"image":case"link":cr("error",r),cr("load",r),_=p;break;case"details":cr("toggle",r),_=p;break;case"input":Dv(r,p),_=Xm(r,p),cr("invalid",r);break;case"option":_=p;break;case"select":r._wrapperState={wasMultiple:!!p.multiple},_=xr({},p,{value:void 0}),cr("invalid",r);break;case"textarea":Lv(r,p),_=Ym(r,p),cr("invalid",r);break;default:_=p}eg(l,_),d=_;for(T in d)if(d.hasOwnProperty(T)){var j=d[T];T==="style"?w0(r,j):T==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,j!=null&&v0(r,j)):T==="children"?typeof j=="string"?(l!=="textarea"||j!=="")&&Jc(r,j):typeof j=="number"&&Jc(r,""+j):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(Kc.hasOwnProperty(T)?j!=null&&T==="onScroll"&&cr("scroll",r):j!=null&&Kg(r,T,j,w))}switch(l){case"input":bd(r),Rv(r,p,!1);break;case"textarea":bd(r),Bv(r);break;case"option":p.value!=null&&r.setAttribute("value",""+Wo(p.value));break;case"select":r.multiple=!!p.multiple,T=p.value,T!=null?Ql(r,!!p.multiple,T,!1):p.defaultValue!=null&&Ql(r,!!p.multiple,p.defaultValue,!0);break;default:typeof _.onClick=="function"&&(r.onclick=dp)}switch(l){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return bi(n),null;case 6:if(r&&n.stateNode!=null)qw(r,n,r.memoizedProps,p);else{if(typeof p!="string"&&n.stateNode===null)throw Error(Ee(166));if(l=Ma(lh.current),Ma(_s.current),Md(n)){if(p=n.stateNode,l=n.memoizedProps,p[gs]=n,(T=p.nodeValue!==l)&&(r=yn,r!==null))switch(r.tag){case 3:Ad(p.nodeValue,l,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Ad(p.nodeValue,l,(r.mode&1)!==0)}T&&(n.flags|=4)}else p=(l.nodeType===9?l:l.ownerDocument).createTextNode(p),p[gs]=n,n.stateNode=p}return bi(n),null;case 13:if(hr(_r),p=n.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(mr&&gn!==null&&n.mode&1&&!(n.flags&128))lw(),lu(),n.flags|=98560,T=!1;else if(T=Md(n),p!==null&&p.dehydrated!==null){if(r===null){if(!T)throw Error(Ee(318));if(T=n.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(Ee(317));T[gs]=n}else lu(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;bi(n),T=!1}else Yn!==null&&(Lg(Yn),Yn=null),T=!0;if(!T)return n.flags&65536?n:null}return n.flags&128?(n.lanes=l,n):(p=p!==null,p!==(r!==null&&r.memoizedState!==null)&&p&&(n.child.flags|=8192,n.mode&1&&(r===null||_r.current&1?$r===0&&($r=3):zy())),n.updateQueue!==null&&(n.flags|=4),bi(n),null);case 4:return cu(),Ig(r,n),r===null&&nh(n.stateNode.containerInfo),bi(n),null;case 10:return my(n.type._context),bi(n),null;case 17:return Ji(n.type)&&pp(),bi(n),null;case 19:if(hr(_r),T=n.memoizedState,T===null)return bi(n),null;if(p=(n.flags&128)!==0,w=T.rendering,w===null)if(p)Mc(T,!1);else{if($r!==0||r!==null&&r.flags&128)for(r=n.child;r!==null;){if(w=xp(r),w!==null){for(n.flags|=128,Mc(T,!1),p=w.updateQueue,p!==null&&(n.updateQueue=p,n.flags|=4),n.subtreeFlags=0,p=l,l=n.child;l!==null;)T=l,r=p,T.flags&=14680066,w=T.alternate,w===null?(T.childLanes=0,T.lanes=r,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=w.childLanes,T.lanes=w.lanes,T.child=w.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=w.memoizedProps,T.memoizedState=w.memoizedState,T.updateQueue=w.updateQueue,T.type=w.type,r=w.dependencies,T.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),l=l.sibling;return ar(_r,_r.current&1|2),n.child}r=r.sibling}T.tail!==null&&Pr()>du&&(n.flags|=128,p=!0,Mc(T,!1),n.lanes=4194304)}else{if(!p)if(r=xp(w),r!==null){if(n.flags|=128,p=!0,l=r.updateQueue,l!==null&&(n.updateQueue=l,n.flags|=4),Mc(T,!0),T.tail===null&&T.tailMode==="hidden"&&!w.alternate&&!mr)return bi(n),null}else 2*Pr()-T.renderingStartTime>du&&l!==1073741824&&(n.flags|=128,p=!0,Mc(T,!1),n.lanes=4194304);T.isBackwards?(w.sibling=n.child,n.child=w):(l=T.last,l!==null?l.sibling=w:n.child=w,T.last=w)}return T.tail!==null?(n=T.tail,T.rendering=n,T.tail=n.sibling,T.renderingStartTime=Pr(),n.sibling=null,l=_r.current,ar(_r,p?l&1|2:l&1),n):(bi(n),null);case 22:case 23:return My(),p=n.memoizedState!==null,r!==null&&r.memoizedState!==null!==p&&(n.flags|=8192),p&&n.mode&1?mn&1073741824&&(bi(n),n.subtreeFlags&6&&(n.flags|=8192)):bi(n),null;case 24:return null;case 25:return null}throw Error(Ee(156,n.tag))}function zT(r,n){switch(hy(n),n.tag){case 1:return Ji(n.type)&&pp(),r=n.flags,r&65536?(n.flags=r&-65537|128,n):null;case 3:return cu(),hr(Ki),hr(Ti),xy(),r=n.flags,r&65536&&!(r&128)?(n.flags=r&-65537|128,n):null;case 5:return vy(n),null;case 13:if(hr(_r),r=n.memoizedState,r!==null&&r.dehydrated!==null){if(n.alternate===null)throw Error(Ee(340));lu()}return r=n.flags,r&65536?(n.flags=r&-65537|128,n):null;case 19:return hr(_r),null;case 4:return cu(),null;case 10:return my(n.type._context),null;case 22:case 23:return My(),null;case 24:return null;default:return null}}var Rd=!1,Si=!1,DT=typeof WeakSet=="function"?WeakSet:Set,rt=null;function Jl(r,n){var l=r.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(p){Ir(r,n,p)}else l.current=null}function Cg(r,n,l){try{l()}catch(p){Ir(r,n,p)}}var kx=!1;function RT(r,n){if(hg=up,r=X0(),uy(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var p=l.getSelection&&l.getSelection();if(p&&p.rangeCount!==0){l=p.anchorNode;var _=p.anchorOffset,T=p.focusNode;p=p.focusOffset;try{l.nodeType,T.nodeType}catch{l=null;break e}var w=0,d=-1,j=-1,Y=0,me=0,te=r,$=null;t:for(;;){for(var Ie;te!==l||_!==0&&te.nodeType!==3||(d=w+_),te!==T||p!==0&&te.nodeType!==3||(j=w+p),te.nodeType===3&&(w+=te.nodeValue.length),(Ie=te.firstChild)!==null;)$=te,te=Ie;for(;;){if(te===r)break t;if($===l&&++Y===_&&(d=w),$===T&&++me===p&&(j=w),(Ie=te.nextSibling)!==null)break;te=$,$=te.parentNode}te=Ie}l=d===-1||j===-1?null:{start:d,end:j}}else l=null}l=l||{start:0,end:0}}else l=null;for(dg={focusedElem:r,selectionRange:l},up=!1,rt=n;rt!==null;)if(n=rt,r=n.child,(n.subtreeFlags&1028)!==0&&r!==null)r.return=n,rt=r;else for(;rt!==null;){n=rt;try{var Me=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(Me!==null){var Le=Me.memoizedProps,yt=Me.memoizedState,ae=n.stateNode,ne=ae.getSnapshotBeforeUpdate(n.elementType===n.type?Le:Xn(n.type,Le),yt);ae.__reactInternalSnapshotBeforeUpdate=ne}break;case 3:var ce=n.stateNode.containerInfo;ce.nodeType===1?ce.textContent="":ce.nodeType===9&&ce.documentElement&&ce.removeChild(ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ee(163))}}catch(Se){Ir(n,n.return,Se)}if(r=n.sibling,r!==null){r.return=n.return,rt=r;break}rt=n.return}return Me=kx,kx=!1,Me}function Gc(r,n,l){var p=n.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var _=p=p.next;do{if((_.tag&r)===r){var T=_.destroy;_.destroy=void 0,T!==void 0&&Cg(n,l,T)}_=_.next}while(_!==p)}}function Up(r,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var l=n=n.next;do{if((l.tag&r)===r){var p=l.create;l.destroy=p()}l=l.next}while(l!==n)}}function Pg(r){var n=r.ref;if(n!==null){var l=r.stateNode;switch(r.tag){case 5:r=l;break;default:r=l}typeof n=="function"?n(r):n.current=r}}function Zw(r){var n=r.alternate;n!==null&&(r.alternate=null,Zw(n)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(n=r.stateNode,n!==null&&(delete n[gs],delete n[oh],delete n[mg],delete n[gT],delete n[yT])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function Gw(r){return r.tag===5||r.tag===3||r.tag===4}function Ex(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Gw(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Ag(r,n,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,n?l.nodeType===8?l.parentNode.insertBefore(r,n):l.insertBefore(r,n):(l.nodeType===8?(n=l.parentNode,n.insertBefore(r,l)):(n=l,n.appendChild(r)),l=l._reactRootContainer,l!=null||n.onclick!==null||(n.onclick=dp));else if(p!==4&&(r=r.child,r!==null))for(Ag(r,n,l),r=r.sibling;r!==null;)Ag(r,n,l),r=r.sibling}function Mg(r,n,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,n?l.insertBefore(r,n):l.appendChild(r);else if(p!==4&&(r=r.child,r!==null))for(Mg(r,n,l),r=r.sibling;r!==null;)Mg(r,n,l),r=r.sibling}var ui=null,Kn=!1;function Mo(r,n,l){for(l=l.child;l!==null;)Hw(r,n,l),l=l.sibling}function Hw(r,n,l){if(ys&&typeof ys.onCommitFiberUnmount=="function")try{ys.onCommitFiberUnmount(Rp,l)}catch{}switch(l.tag){case 5:Si||Jl(l,n);case 6:var p=ui,_=Kn;ui=null,Mo(r,n,l),ui=p,Kn=_,ui!==null&&(Kn?(r=ui,l=l.stateNode,r.nodeType===8?r.parentNode.removeChild(l):r.removeChild(l)):ui.removeChild(l.stateNode));break;case 18:ui!==null&&(Kn?(r=ui,l=l.stateNode,r.nodeType===8?Pm(r.parentNode,l):r.nodeType===1&&Pm(r,l),th(r)):Pm(ui,l.stateNode));break;case 4:p=ui,_=Kn,ui=l.stateNode.containerInfo,Kn=!0,Mo(r,n,l),ui=p,Kn=_;break;case 0:case 11:case 14:case 15:if(!Si&&(p=l.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){_=p=p.next;do{var T=_,w=T.destroy;T=T.tag,w!==void 0&&(T&2||T&4)&&Cg(l,n,w),_=_.next}while(_!==p)}Mo(r,n,l);break;case 1:if(!Si&&(Jl(l,n),p=l.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=l.memoizedProps,p.state=l.memoizedState,p.componentWillUnmount()}catch(d){Ir(l,n,d)}Mo(r,n,l);break;case 21:Mo(r,n,l);break;case 22:l.mode&1?(Si=(p=Si)||l.memoizedState!==null,Mo(r,n,l),Si=p):Mo(r,n,l);break;default:Mo(r,n,l)}}function Ix(r){var n=r.updateQueue;if(n!==null){r.updateQueue=null;var l=r.stateNode;l===null&&(l=r.stateNode=new DT),n.forEach(function(p){var _=$T.bind(null,r,p);l.has(p)||(l.add(p),p.then(_,_))})}}function Wn(r,n){var l=n.deletions;if(l!==null)for(var p=0;p<l.length;p++){var _=l[p];try{var T=r,w=n,d=w;e:for(;d!==null;){switch(d.tag){case 5:ui=d.stateNode,Kn=!1;break e;case 3:ui=d.stateNode.containerInfo,Kn=!0;break e;case 4:ui=d.stateNode.containerInfo,Kn=!0;break e}d=d.return}if(ui===null)throw Error(Ee(160));Hw(T,w,_),ui=null,Kn=!1;var j=_.alternate;j!==null&&(j.return=null),_.return=null}catch(Y){Ir(_,n,Y)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)Ww(n,r),n=n.sibling}function Ww(r,n){var l=r.alternate,p=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Wn(n,r),fs(r),p&4){try{Gc(3,r,r.return),Up(3,r)}catch(Le){Ir(r,r.return,Le)}try{Gc(5,r,r.return)}catch(Le){Ir(r,r.return,Le)}}break;case 1:Wn(n,r),fs(r),p&512&&l!==null&&Jl(l,l.return);break;case 5:if(Wn(n,r),fs(r),p&512&&l!==null&&Jl(l,l.return),r.flags&32){var _=r.stateNode;try{Jc(_,"")}catch(Le){Ir(r,r.return,Le)}}if(p&4&&(_=r.stateNode,_!=null)){var T=r.memoizedProps,w=l!==null?l.memoizedProps:T,d=r.type,j=r.updateQueue;if(r.updateQueue=null,j!==null)try{d==="input"&&T.type==="radio"&&T.name!=null&&g0(_,T),tg(d,w);var Y=tg(d,T);for(w=0;w<j.length;w+=2){var me=j[w],te=j[w+1];me==="style"?w0(_,te):me==="dangerouslySetInnerHTML"?v0(_,te):me==="children"?Jc(_,te):Kg(_,me,te,Y)}switch(d){case"input":Km(_,T);break;case"textarea":y0(_,T);break;case"select":var $=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!T.multiple;var Ie=T.value;Ie!=null?Ql(_,!!T.multiple,Ie,!1):$!==!!T.multiple&&(T.defaultValue!=null?Ql(_,!!T.multiple,T.defaultValue,!0):Ql(_,!!T.multiple,T.multiple?[]:"",!1))}_[oh]=T}catch(Le){Ir(r,r.return,Le)}}break;case 6:if(Wn(n,r),fs(r),p&4){if(r.stateNode===null)throw Error(Ee(162));_=r.stateNode,T=r.memoizedProps;try{_.nodeValue=T}catch(Le){Ir(r,r.return,Le)}}break;case 3:if(Wn(n,r),fs(r),p&4&&l!==null&&l.memoizedState.isDehydrated)try{th(n.containerInfo)}catch(Le){Ir(r,r.return,Le)}break;case 4:Wn(n,r),fs(r);break;case 13:Wn(n,r),fs(r),_=r.child,_.flags&8192&&(T=_.memoizedState!==null,_.stateNode.isHidden=T,!T||_.alternate!==null&&_.alternate.memoizedState!==null||(Py=Pr())),p&4&&Ix(r);break;case 22:if(me=l!==null&&l.memoizedState!==null,r.mode&1?(Si=(Y=Si)||me,Wn(n,r),Si=Y):Wn(n,r),fs(r),p&8192){if(Y=r.memoizedState!==null,(r.stateNode.isHidden=Y)&&!me&&r.mode&1)for(rt=r,me=r.child;me!==null;){for(te=rt=me;rt!==null;){switch($=rt,Ie=$.child,$.tag){case 0:case 11:case 14:case 15:Gc(4,$,$.return);break;case 1:Jl($,$.return);var Me=$.stateNode;if(typeof Me.componentWillUnmount=="function"){p=$,l=$.return;try{n=p,Me.props=n.memoizedProps,Me.state=n.memoizedState,Me.componentWillUnmount()}catch(Le){Ir(p,l,Le)}}break;case 5:Jl($,$.return);break;case 22:if($.memoizedState!==null){Px(te);continue}}Ie!==null?(Ie.return=$,rt=Ie):Px(te)}me=me.sibling}e:for(me=null,te=r;;){if(te.tag===5){if(me===null){me=te;try{_=te.stateNode,Y?(T=_.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(d=te.stateNode,j=te.memoizedProps.style,w=j!=null&&j.hasOwnProperty("display")?j.display:null,d.style.display=x0("display",w))}catch(Le){Ir(r,r.return,Le)}}}else if(te.tag===6){if(me===null)try{te.stateNode.nodeValue=Y?"":te.memoizedProps}catch(Le){Ir(r,r.return,Le)}}else if((te.tag!==22&&te.tag!==23||te.memoizedState===null||te===r)&&te.child!==null){te.child.return=te,te=te.child;continue}if(te===r)break e;for(;te.sibling===null;){if(te.return===null||te.return===r)break e;me===te&&(me=null),te=te.return}me===te&&(me=null),te.sibling.return=te.return,te=te.sibling}}break;case 19:Wn(n,r),fs(r),p&4&&Ix(r);break;case 21:break;default:Wn(n,r),fs(r)}}function fs(r){var n=r.flags;if(n&2){try{e:{for(var l=r.return;l!==null;){if(Gw(l)){var p=l;break e}l=l.return}throw Error(Ee(160))}switch(p.tag){case 5:var _=p.stateNode;p.flags&32&&(Jc(_,""),p.flags&=-33);var T=Ex(r);Mg(r,T,_);break;case 3:case 4:var w=p.stateNode.containerInfo,d=Ex(r);Ag(r,d,w);break;default:throw Error(Ee(161))}}catch(j){Ir(r,r.return,j)}r.flags&=-3}n&4096&&(r.flags&=-4097)}function LT(r,n,l){rt=r,Xw(r)}function Xw(r,n,l){for(var p=(r.mode&1)!==0;rt!==null;){var _=rt,T=_.child;if(_.tag===22&&p){var w=_.memoizedState!==null||Rd;if(!w){var d=_.alternate,j=d!==null&&d.memoizedState!==null||Si;d=Rd;var Y=Si;if(Rd=w,(Si=j)&&!Y)for(rt=_;rt!==null;)w=rt,j=w.child,w.tag===22&&w.memoizedState!==null?Ax(_):j!==null?(j.return=w,rt=j):Ax(_);for(;T!==null;)rt=T,Xw(T),T=T.sibling;rt=_,Rd=d,Si=Y}Cx(r)}else _.subtreeFlags&8772&&T!==null?(T.return=_,rt=T):Cx(r)}}function Cx(r){for(;rt!==null;){var n=rt;if(n.flags&8772){var l=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:Si||Up(5,n);break;case 1:var p=n.stateNode;if(n.flags&4&&!Si)if(l===null)p.componentDidMount();else{var _=n.elementType===n.type?l.memoizedProps:Xn(n.type,l.memoizedProps);p.componentDidUpdate(_,l.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var T=n.updateQueue;T!==null&&dx(n,T,p);break;case 3:var w=n.updateQueue;if(w!==null){if(l=null,n.child!==null)switch(n.child.tag){case 5:l=n.child.stateNode;break;case 1:l=n.child.stateNode}dx(n,w,l)}break;case 5:var d=n.stateNode;if(l===null&&n.flags&4){l=d;var j=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":j.autoFocus&&l.focus();break;case"img":j.src&&(l.src=j.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var Y=n.alternate;if(Y!==null){var me=Y.memoizedState;if(me!==null){var te=me.dehydrated;te!==null&&th(te)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ee(163))}Si||n.flags&512&&Pg(n)}catch($){Ir(n,n.return,$)}}if(n===r){rt=null;break}if(l=n.sibling,l!==null){l.return=n.return,rt=l;break}rt=n.return}}function Px(r){for(;rt!==null;){var n=rt;if(n===r){rt=null;break}var l=n.sibling;if(l!==null){l.return=n.return,rt=l;break}rt=n.return}}function Ax(r){for(;rt!==null;){var n=rt;try{switch(n.tag){case 0:case 11:case 15:var l=n.return;try{Up(4,n)}catch(j){Ir(n,l,j)}break;case 1:var p=n.stateNode;if(typeof p.componentDidMount=="function"){var _=n.return;try{p.componentDidMount()}catch(j){Ir(n,_,j)}}var T=n.return;try{Pg(n)}catch(j){Ir(n,T,j)}break;case 5:var w=n.return;try{Pg(n)}catch(j){Ir(n,w,j)}}}catch(j){Ir(n,n.return,j)}if(n===r){rt=null;break}var d=n.sibling;if(d!==null){d.return=n.return,rt=d;break}rt=n.return}}var BT=Math.ceil,Sp=Xs.ReactCurrentDispatcher,Iy=Xs.ReactCurrentOwner,Ln=Xs.ReactCurrentBatchConfig,jt=0,ti=null,Rr=null,ci=0,mn=0,Yl=Jo(0),$r=0,dh=null,Fa=0,$p=0,Cy=0,Hc=null,Wi=null,Py=0,du=1/0,Ns=null,Tp=!1,zg=null,qo=null,Ld=!1,Oo=null,kp=0,Wc=0,Dg=null,Kd=-1,Jd=0;function Li(){return jt&6?Pr():Kd!==-1?Kd:Kd=Pr()}function Zo(r){return r.mode&1?jt&2&&ci!==0?ci&-ci:vT.transition!==null?(Jd===0&&(Jd=D0()),Jd):(r=Jt,r!==0||(r=window.event,r=r===void 0?16:V0(r.type)),r):1}function es(r,n,l,p){if(50<Wc)throw Wc=0,Dg=null,Error(Ee(185));fh(r,l,p),(!(jt&2)||r!==ti)&&(r===ti&&(!(jt&2)&&($p|=l),$r===4&&Bo(r,ci)),Yi(r,p),l===1&&jt===0&&!(n.mode&1)&&(du=Pr()+500,Np&&Yo()))}function Yi(r,n){var l=r.callbackNode;vS(r,n);var p=lp(r,r===ti?ci:0);if(p===0)l!==null&&Nv(l),r.callbackNode=null,r.callbackPriority=0;else if(n=p&-p,r.callbackPriority!==n){if(l!=null&&Nv(l),n===1)r.tag===0?_T(Mx.bind(null,r)):sw(Mx.bind(null,r)),fT(function(){!(jt&6)&&Yo()}),l=null;else{switch(R0(p)){case 1:l=ty;break;case 4:l=M0;break;case 16:l=ap;break;case 536870912:l=z0;break;default:l=ap}l=i1(l,Kw.bind(null,r))}r.callbackPriority=n,r.callbackNode=l}}function Kw(r,n){if(Kd=-1,Jd=0,jt&6)throw Error(Ee(327));var l=r.callbackNode;if(nu()&&r.callbackNode!==l)return null;var p=lp(r,r===ti?ci:0);if(p===0)return null;if(p&30||p&r.expiredLanes||n)n=Ep(r,p);else{n=p;var _=jt;jt|=2;var T=Yw();(ti!==r||ci!==n)&&(Ns=null,du=Pr()+500,za(r,n));do try{NT();break}catch(d){Jw(r,d)}while(!0);fy(),Sp.current=T,jt=_,Rr!==null?n=0:(ti=null,ci=0,n=$r)}if(n!==0){if(n===2&&(_=og(r),_!==0&&(p=_,n=Rg(r,_))),n===1)throw l=dh,za(r,0),Bo(r,p),Yi(r,Pr()),l;if(n===6)Bo(r,p);else{if(_=r.current.alternate,!(p&30)&&!FT(_)&&(n=Ep(r,p),n===2&&(T=og(r),T!==0&&(p=T,n=Rg(r,T))),n===1))throw l=dh,za(r,0),Bo(r,p),Yi(r,Pr()),l;switch(r.finishedWork=_,r.finishedLanes=p,n){case 0:case 1:throw Error(Ee(345));case 2:Ia(r,Wi,Ns);break;case 3:if(Bo(r,p),(p&130023424)===p&&(n=Py+500-Pr(),10<n)){if(lp(r,0)!==0)break;if(_=r.suspendedLanes,(_&p)!==p){Li(),r.pingedLanes|=r.suspendedLanes&_;break}r.timeoutHandle=fg(Ia.bind(null,r,Wi,Ns),n);break}Ia(r,Wi,Ns);break;case 4:if(Bo(r,p),(p&4194240)===p)break;for(n=r.eventTimes,_=-1;0<p;){var w=31-Qn(p);T=1<<w,w=n[w],w>_&&(_=w),p&=~T}if(p=_,p=Pr()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*BT(p/1960))-p,10<p){r.timeoutHandle=fg(Ia.bind(null,r,Wi,Ns),p);break}Ia(r,Wi,Ns);break;case 5:Ia(r,Wi,Ns);break;default:throw Error(Ee(329))}}}return Yi(r,Pr()),r.callbackNode===l?Kw.bind(null,r):null}function Rg(r,n){var l=Hc;return r.current.memoizedState.isDehydrated&&(za(r,n).flags|=256),r=Ep(r,n),r!==2&&(n=Wi,Wi=l,n!==null&&Lg(n)),r}function Lg(r){Wi===null?Wi=r:Wi.push.apply(Wi,r)}function FT(r){for(var n=r;;){if(n.flags&16384){var l=n.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var p=0;p<l.length;p++){var _=l[p],T=_.getSnapshot;_=_.value;try{if(!ts(T(),_))return!1}catch{return!1}}}if(l=n.child,n.subtreeFlags&16384&&l!==null)l.return=n,n=l;else{if(n===r)break;for(;n.sibling===null;){if(n.return===null||n.return===r)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Bo(r,n){for(n&=~Cy,n&=~$p,r.suspendedLanes|=n,r.pingedLanes&=~n,r=r.expirationTimes;0<n;){var l=31-Qn(n),p=1<<l;r[l]=-1,n&=~p}}function Mx(r){if(jt&6)throw Error(Ee(327));nu();var n=lp(r,0);if(!(n&1))return Yi(r,Pr()),null;var l=Ep(r,n);if(r.tag!==0&&l===2){var p=og(r);p!==0&&(n=p,l=Rg(r,p))}if(l===1)throw l=dh,za(r,0),Bo(r,n),Yi(r,Pr()),l;if(l===6)throw Error(Ee(345));return r.finishedWork=r.current.alternate,r.finishedLanes=n,Ia(r,Wi,Ns),Yi(r,Pr()),null}function Ay(r,n){var l=jt;jt|=1;try{return r(n)}finally{jt=l,jt===0&&(du=Pr()+500,Np&&Yo())}}function Oa(r){Oo!==null&&Oo.tag===0&&!(jt&6)&&nu();var n=jt;jt|=1;var l=Ln.transition,p=Jt;try{if(Ln.transition=null,Jt=1,r)return r()}finally{Jt=p,Ln.transition=l,jt=n,!(jt&6)&&Yo()}}function My(){mn=Yl.current,hr(Yl)}function za(r,n){r.finishedWork=null,r.finishedLanes=0;var l=r.timeoutHandle;if(l!==-1&&(r.timeoutHandle=-1,pT(l)),Rr!==null)for(l=Rr.return;l!==null;){var p=l;switch(hy(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&pp();break;case 3:cu(),hr(Ki),hr(Ti),xy();break;case 5:vy(p);break;case 4:cu();break;case 13:hr(_r);break;case 19:hr(_r);break;case 10:my(p.type._context);break;case 22:case 23:My()}l=l.return}if(ti=r,Rr=r=Go(r.current,null),ci=mn=n,$r=0,dh=null,Cy=$p=Fa=0,Wi=Hc=null,Aa!==null){for(n=0;n<Aa.length;n++)if(l=Aa[n],p=l.interleaved,p!==null){l.interleaved=null;var _=p.next,T=l.pending;if(T!==null){var w=T.next;T.next=_,p.next=w}l.pending=p}Aa=null}return r}function Jw(r,n){do{var l=Rr;try{if(fy(),Hd.current=bp,wp){for(var p=vr.memoizedState;p!==null;){var _=p.queue;_!==null&&(_.pending=null),p=p.next}wp=!1}if(Ba=0,ei=Ur=vr=null,Zc=!1,uh=0,Iy.current=null,l===null||l.return===null){$r=1,dh=n,Rr=null;break}e:{var T=r,w=l.return,d=l,j=n;if(n=ci,d.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){var Y=j,me=d,te=me.tag;if(!(me.mode&1)&&(te===0||te===11||te===15)){var $=me.alternate;$?(me.updateQueue=$.updateQueue,me.memoizedState=$.memoizedState,me.lanes=$.lanes):(me.updateQueue=null,me.memoizedState=null)}var Ie=_x(w);if(Ie!==null){Ie.flags&=-257,vx(Ie,w,d,T,n),Ie.mode&1&&yx(T,Y,n),n=Ie,j=Y;var Me=n.updateQueue;if(Me===null){var Le=new Set;Le.add(j),n.updateQueue=Le}else Me.add(j);break e}else{if(!(n&1)){yx(T,Y,n),zy();break e}j=Error(Ee(426))}}else if(mr&&d.mode&1){var yt=_x(w);if(yt!==null){!(yt.flags&65536)&&(yt.flags|=256),vx(yt,w,d,T,n),dy(hu(j,d));break e}}T=j=hu(j,d),$r!==4&&($r=2),Hc===null?Hc=[T]:Hc.push(T),T=w;do{switch(T.tag){case 3:T.flags|=65536,n&=-n,T.lanes|=n;var ae=Rw(T,j,n);hx(T,ae);break e;case 1:d=j;var ne=T.type,ce=T.stateNode;if(!(T.flags&128)&&(typeof ne.getDerivedStateFromError=="function"||ce!==null&&typeof ce.componentDidCatch=="function"&&(qo===null||!qo.has(ce)))){T.flags|=65536,n&=-n,T.lanes|=n;var Se=Lw(T,d,n);hx(T,Se);break e}}T=T.return}while(T!==null)}e1(l)}catch(je){n=je,Rr===l&&l!==null&&(Rr=l=l.return);continue}break}while(!0)}function Yw(){var r=Sp.current;return Sp.current=bp,r===null?bp:r}function zy(){($r===0||$r===3||$r===2)&&($r=4),ti===null||!(Fa&268435455)&&!($p&268435455)||Bo(ti,ci)}function Ep(r,n){var l=jt;jt|=2;var p=Yw();(ti!==r||ci!==n)&&(Ns=null,za(r,n));do try{OT();break}catch(_){Jw(r,_)}while(!0);if(fy(),jt=l,Sp.current=p,Rr!==null)throw Error(Ee(261));return ti=null,ci=0,$r}function OT(){for(;Rr!==null;)Qw(Rr)}function NT(){for(;Rr!==null&&!cS();)Qw(Rr)}function Qw(r){var n=r1(r.alternate,r,mn);r.memoizedProps=r.pendingProps,n===null?e1(r):Rr=n,Iy.current=null}function e1(r){var n=r;do{var l=n.alternate;if(r=n.return,n.flags&32768){if(l=zT(l,n),l!==null){l.flags&=32767,Rr=l;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{$r=6,Rr=null;return}}else if(l=MT(l,n,mn),l!==null){Rr=l;return}if(n=n.sibling,n!==null){Rr=n;return}Rr=n=r}while(n!==null);$r===0&&($r=5)}function Ia(r,n,l){var p=Jt,_=Ln.transition;try{Ln.transition=null,Jt=1,VT(r,n,l,p)}finally{Ln.transition=_,Jt=p}return null}function VT(r,n,l,p){do nu();while(Oo!==null);if(jt&6)throw Error(Ee(327));l=r.finishedWork;var _=r.finishedLanes;if(l===null)return null;if(r.finishedWork=null,r.finishedLanes=0,l===r.current)throw Error(Ee(177));r.callbackNode=null,r.callbackPriority=0;var T=l.lanes|l.childLanes;if(xS(r,T),r===ti&&(Rr=ti=null,ci=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Ld||(Ld=!0,i1(ap,function(){return nu(),null})),T=(l.flags&15990)!==0,l.subtreeFlags&15990||T){T=Ln.transition,Ln.transition=null;var w=Jt;Jt=1;var d=jt;jt|=4,Iy.current=null,RT(r,l),Ww(l,r),oT(dg),up=!!hg,dg=hg=null,r.current=l,LT(l),hS(),jt=d,Jt=w,Ln.transition=T}else r.current=l;if(Ld&&(Ld=!1,Oo=r,kp=_),T=r.pendingLanes,T===0&&(qo=null),fS(l.stateNode),Yi(r,Pr()),n!==null)for(p=r.onRecoverableError,l=0;l<n.length;l++)_=n[l],p(_.value,{componentStack:_.stack,digest:_.digest});if(Tp)throw Tp=!1,r=zg,zg=null,r;return kp&1&&r.tag!==0&&nu(),T=r.pendingLanes,T&1?r===Dg?Wc++:(Wc=0,Dg=r):Wc=0,Yo(),null}function nu(){if(Oo!==null){var r=R0(kp),n=Ln.transition,l=Jt;try{if(Ln.transition=null,Jt=16>r?16:r,Oo===null)var p=!1;else{if(r=Oo,Oo=null,kp=0,jt&6)throw Error(Ee(331));var _=jt;for(jt|=4,rt=r.current;rt!==null;){var T=rt,w=T.child;if(rt.flags&16){var d=T.deletions;if(d!==null){for(var j=0;j<d.length;j++){var Y=d[j];for(rt=Y;rt!==null;){var me=rt;switch(me.tag){case 0:case 11:case 15:Gc(8,me,T)}var te=me.child;if(te!==null)te.return=me,rt=te;else for(;rt!==null;){me=rt;var $=me.sibling,Ie=me.return;if(Zw(me),me===Y){rt=null;break}if($!==null){$.return=Ie,rt=$;break}rt=Ie}}}var Me=T.alternate;if(Me!==null){var Le=Me.child;if(Le!==null){Me.child=null;do{var yt=Le.sibling;Le.sibling=null,Le=yt}while(Le!==null)}}rt=T}}if(T.subtreeFlags&2064&&w!==null)w.return=T,rt=w;else e:for(;rt!==null;){if(T=rt,T.flags&2048)switch(T.tag){case 0:case 11:case 15:Gc(9,T,T.return)}var ae=T.sibling;if(ae!==null){ae.return=T.return,rt=ae;break e}rt=T.return}}var ne=r.current;for(rt=ne;rt!==null;){w=rt;var ce=w.child;if(w.subtreeFlags&2064&&ce!==null)ce.return=w,rt=ce;else e:for(w=ne;rt!==null;){if(d=rt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:Up(9,d)}}catch(je){Ir(d,d.return,je)}if(d===w){rt=null;break e}var Se=d.sibling;if(Se!==null){Se.return=d.return,rt=Se;break e}rt=d.return}}if(jt=_,Yo(),ys&&typeof ys.onPostCommitFiberRoot=="function")try{ys.onPostCommitFiberRoot(Rp,r)}catch{}p=!0}return p}finally{Jt=l,Ln.transition=n}}return!1}function zx(r,n,l){n=hu(l,n),n=Rw(r,n,1),r=$o(r,n,1),n=Li(),r!==null&&(fh(r,1,n),Yi(r,n))}function Ir(r,n,l){if(r.tag===3)zx(r,r,l);else for(;n!==null;){if(n.tag===3){zx(n,r,l);break}else if(n.tag===1){var p=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(qo===null||!qo.has(p))){r=hu(l,r),r=Lw(n,r,1),n=$o(n,r,1),r=Li(),n!==null&&(fh(n,1,r),Yi(n,r));break}}n=n.return}}function jT(r,n,l){var p=r.pingCache;p!==null&&p.delete(n),n=Li(),r.pingedLanes|=r.suspendedLanes&l,ti===r&&(ci&l)===l&&($r===4||$r===3&&(ci&130023424)===ci&&500>Pr()-Py?za(r,0):Cy|=l),Yi(r,n)}function t1(r,n){n===0&&(r.mode&1?(n=kd,kd<<=1,!(kd&130023424)&&(kd=4194304)):n=1);var l=Li();r=Hs(r,n),r!==null&&(fh(r,n,l),Yi(r,l))}function UT(r){var n=r.memoizedState,l=0;n!==null&&(l=n.retryLane),t1(r,l)}function $T(r,n){var l=0;switch(r.tag){case 13:var p=r.stateNode,_=r.memoizedState;_!==null&&(l=_.retryLane);break;case 19:p=r.stateNode;break;default:throw Error(Ee(314))}p!==null&&p.delete(n),t1(r,l)}var r1;r1=function(r,n,l){if(r!==null)if(r.memoizedProps!==n.pendingProps||Ki.current)Xi=!0;else{if(!(r.lanes&l)&&!(n.flags&128))return Xi=!1,AT(r,n,l);Xi=!!(r.flags&131072)}else Xi=!1,mr&&n.flags&1048576&&ow(n,gp,n.index);switch(n.lanes=0,n.tag){case 2:var p=n.type;Xd(r,n),r=n.pendingProps;var _=au(n,Ti.current);iu(n,l),_=by(null,n,p,r,_,l);var T=Sy();return n.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Ji(p)?(T=!0,fp(n)):T=!1,n.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,yy(n),_.updater=jp,n.stateNode=_,_._reactInternals=n,wg(n,p,r,l),n=Tg(null,n,p,!0,T,l)):(n.tag=0,mr&&T&&cy(n),Ri(null,n,_,l),n=n.child),n;case 16:p=n.elementType;e:{switch(Xd(r,n),r=n.pendingProps,_=p._init,p=_(p._payload),n.type=p,_=n.tag=ZT(p),r=Xn(p,r),_){case 0:n=Sg(null,n,p,r,l);break e;case 1:n=bx(null,n,p,r,l);break e;case 11:n=xx(null,n,p,r,l);break e;case 14:n=wx(null,n,p,Xn(p.type,r),l);break e}throw Error(Ee(306,p,""))}return n;case 0:return p=n.type,_=n.pendingProps,_=n.elementType===p?_:Xn(p,_),Sg(r,n,p,_,l);case 1:return p=n.type,_=n.pendingProps,_=n.elementType===p?_:Xn(p,_),bx(r,n,p,_,l);case 3:e:{if(Nw(n),r===null)throw Error(Ee(387));p=n.pendingProps,T=n.memoizedState,_=T.element,dw(r,n),vp(n,p,null,l);var w=n.memoizedState;if(p=w.element,T.isDehydrated)if(T={element:p,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},n.updateQueue.baseState=T,n.memoizedState=T,n.flags&256){_=hu(Error(Ee(423)),n),n=Sx(r,n,p,l,_);break e}else if(p!==_){_=hu(Error(Ee(424)),n),n=Sx(r,n,p,l,_);break e}else for(gn=Uo(n.stateNode.containerInfo.firstChild),yn=n,mr=!0,Yn=null,l=cw(n,null,p,l),n.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(lu(),p===_){n=Ws(r,n,l);break e}Ri(r,n,p,l)}n=n.child}return n;case 5:return pw(n),r===null&&_g(n),p=n.type,_=n.pendingProps,T=r!==null?r.memoizedProps:null,w=_.children,pg(p,_)?w=null:T!==null&&pg(p,T)&&(n.flags|=32),Ow(r,n),Ri(r,n,w,l),n.child;case 6:return r===null&&_g(n),null;case 13:return Vw(r,n,l);case 4:return _y(n,n.stateNode.containerInfo),p=n.pendingProps,r===null?n.child=uu(n,null,p,l):Ri(r,n,p,l),n.child;case 11:return p=n.type,_=n.pendingProps,_=n.elementType===p?_:Xn(p,_),xx(r,n,p,_,l);case 7:return Ri(r,n,n.pendingProps,l),n.child;case 8:return Ri(r,n,n.pendingProps.children,l),n.child;case 12:return Ri(r,n,n.pendingProps.children,l),n.child;case 10:e:{if(p=n.type._context,_=n.pendingProps,T=n.memoizedProps,w=_.value,ar(yp,p._currentValue),p._currentValue=w,T!==null)if(ts(T.value,w)){if(T.children===_.children&&!Ki.current){n=Ws(r,n,l);break e}}else for(T=n.child,T!==null&&(T.return=n);T!==null;){var d=T.dependencies;if(d!==null){w=T.child;for(var j=d.firstContext;j!==null;){if(j.context===p){if(T.tag===1){j=qs(-1,l&-l),j.tag=2;var Y=T.updateQueue;if(Y!==null){Y=Y.shared;var me=Y.pending;me===null?j.next=j:(j.next=me.next,me.next=j),Y.pending=j}}T.lanes|=l,j=T.alternate,j!==null&&(j.lanes|=l),vg(T.return,l,n),d.lanes|=l;break}j=j.next}}else if(T.tag===10)w=T.type===n.type?null:T.child;else if(T.tag===18){if(w=T.return,w===null)throw Error(Ee(341));w.lanes|=l,d=w.alternate,d!==null&&(d.lanes|=l),vg(w,l,n),w=T.sibling}else w=T.child;if(w!==null)w.return=T;else for(w=T;w!==null;){if(w===n){w=null;break}if(T=w.sibling,T!==null){T.return=w.return,w=T;break}w=w.return}T=w}Ri(r,n,_.children,l),n=n.child}return n;case 9:return _=n.type,p=n.pendingProps.children,iu(n,l),_=Bn(_),p=p(_),n.flags|=1,Ri(r,n,p,l),n.child;case 14:return p=n.type,_=Xn(p,n.pendingProps),_=Xn(p.type,_),wx(r,n,p,_,l);case 15:return Bw(r,n,n.type,n.pendingProps,l);case 17:return p=n.type,_=n.pendingProps,_=n.elementType===p?_:Xn(p,_),Xd(r,n),n.tag=1,Ji(p)?(r=!0,fp(n)):r=!1,iu(n,l),Dw(n,p,_),wg(n,p,_,l),Tg(null,n,p,!0,r,l);case 19:return jw(r,n,l);case 22:return Fw(r,n,l)}throw Error(Ee(156,n.tag))};function i1(r,n){return A0(r,n)}function qT(r,n,l,p){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rn(r,n,l,p){return new qT(r,n,l,p)}function Dy(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ZT(r){if(typeof r=="function")return Dy(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Yg)return 11;if(r===Qg)return 14}return 2}function Go(r,n){var l=r.alternate;return l===null?(l=Rn(r.tag,n,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=n,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&14680064,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,n=r.dependencies,l.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l}function Yd(r,n,l,p,_,T){var w=2;if(p=r,typeof r=="function")Dy(r)&&(w=1);else if(typeof r=="string")w=5;else e:switch(r){case Ul:return Da(l.children,_,T,n);case Jg:w=8,_|=8;break;case Zm:return r=Rn(12,l,n,_|2),r.elementType=Zm,r.lanes=T,r;case Gm:return r=Rn(13,l,n,_),r.elementType=Gm,r.lanes=T,r;case Hm:return r=Rn(19,l,n,_),r.elementType=Hm,r.lanes=T,r;case p0:return qp(l,_,T,n);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case h0:w=10;break e;case d0:w=9;break e;case Yg:w=11;break e;case Qg:w=14;break e;case Do:w=16,p=null;break e}throw Error(Ee(130,r==null?r:typeof r,""))}return n=Rn(w,l,n,_),n.elementType=r,n.type=p,n.lanes=T,n}function Da(r,n,l,p){return r=Rn(7,r,p,n),r.lanes=l,r}function qp(r,n,l,p){return r=Rn(22,r,p,n),r.elementType=p0,r.lanes=l,r.stateNode={isHidden:!1},r}function Fm(r,n,l){return r=Rn(6,r,null,n),r.lanes=l,r}function Om(r,n,l){return n=Rn(4,r.children!==null?r.children:[],r.key,n),n.lanes=l,n.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},n}function GT(r,n,l,p,_){this.tag=n,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_m(0),this.expirationTimes=_m(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_m(0),this.identifierPrefix=p,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function Ry(r,n,l,p,_,T,w,d,j){return r=new GT(r,n,l,d,j),n===1?(n=1,T===!0&&(n|=8)):n=0,T=Rn(3,null,null,n),r.current=T,T.stateNode=r,T.memoizedState={element:p,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},yy(T),r}function HT(r,n,l){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:jl,key:p==null?null:""+p,children:r,containerInfo:n,implementation:l}}function n1(r){if(!r)return Xo;r=r._reactInternals;e:{if(ja(r)!==r||r.tag!==1)throw Error(Ee(170));var n=r;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Ji(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(Ee(171))}if(r.tag===1){var l=r.type;if(Ji(l))return nw(r,l,n)}return n}function s1(r,n,l,p,_,T,w,d,j){return r=Ry(l,p,!0,r,_,T,w,d,j),r.context=n1(null),l=r.current,p=Li(),_=Zo(l),T=qs(p,_),T.callback=n??null,$o(l,T,_),r.current.lanes=_,fh(r,_,p),Yi(r,p),r}function Zp(r,n,l,p){var _=n.current,T=Li(),w=Zo(_);return l=n1(l),n.context===null?n.context=l:n.pendingContext=l,n=qs(T,w),n.payload={element:r},p=p===void 0?null:p,p!==null&&(n.callback=p),r=$o(_,n,w),r!==null&&(es(r,_,w,T),Gd(r,_,w)),w}function Ip(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function Dx(r,n){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<n?l:n}}function Ly(r,n){Dx(r,n),(r=r.alternate)&&Dx(r,n)}function WT(){return null}var o1=typeof reportError=="function"?reportError:function(r){console.error(r)};function By(r){this._internalRoot=r}Gp.prototype.render=By.prototype.render=function(r){var n=this._internalRoot;if(n===null)throw Error(Ee(409));Zp(r,n,null,null)};Gp.prototype.unmount=By.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var n=r.containerInfo;Oa(function(){Zp(null,r,null,null)}),n[Gs]=null}};function Gp(r){this._internalRoot=r}Gp.prototype.unstable_scheduleHydration=function(r){if(r){var n=F0();r={blockedOn:null,target:r,priority:n};for(var l=0;l<Lo.length&&n!==0&&n<Lo[l].priority;l++);Lo.splice(l,0,r),l===0&&N0(r)}};function Fy(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Hp(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function Rx(){}function XT(r,n,l,p,_){if(_){if(typeof p=="function"){var T=p;p=function(){var Y=Ip(w);T.call(Y)}}var w=s1(n,p,r,0,null,!1,!1,"",Rx);return r._reactRootContainer=w,r[Gs]=w.current,nh(r.nodeType===8?r.parentNode:r),Oa(),w}for(;_=r.lastChild;)r.removeChild(_);if(typeof p=="function"){var d=p;p=function(){var Y=Ip(j);d.call(Y)}}var j=Ry(r,0,!1,null,null,!1,!1,"",Rx);return r._reactRootContainer=j,r[Gs]=j.current,nh(r.nodeType===8?r.parentNode:r),Oa(function(){Zp(n,j,l,p)}),j}function Wp(r,n,l,p,_){var T=l._reactRootContainer;if(T){var w=T;if(typeof _=="function"){var d=_;_=function(){var j=Ip(w);d.call(j)}}Zp(n,w,r,_)}else w=XT(l,n,r,_,p);return Ip(w)}L0=function(r){switch(r.tag){case 3:var n=r.stateNode;if(n.current.memoizedState.isDehydrated){var l=Fc(n.pendingLanes);l!==0&&(ry(n,l|1),Yi(n,Pr()),!(jt&6)&&(du=Pr()+500,Yo()))}break;case 13:Oa(function(){var p=Hs(r,1);if(p!==null){var _=Li();es(p,r,1,_)}}),Ly(r,1)}};iy=function(r){if(r.tag===13){var n=Hs(r,134217728);if(n!==null){var l=Li();es(n,r,134217728,l)}Ly(r,134217728)}};B0=function(r){if(r.tag===13){var n=Zo(r),l=Hs(r,n);if(l!==null){var p=Li();es(l,r,n,p)}Ly(r,n)}};F0=function(){return Jt};O0=function(r,n){var l=Jt;try{return Jt=r,n()}finally{Jt=l}};ig=function(r,n,l){switch(n){case"input":if(Km(r,l),n=l.name,l.type==="radio"&&n!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<l.length;n++){var p=l[n];if(p!==r&&p.form===r.form){var _=Op(p);if(!_)throw Error(Ee(90));m0(p),Km(p,_)}}}break;case"textarea":y0(r,l);break;case"select":n=l.value,n!=null&&Ql(r,!!l.multiple,n,!1)}};T0=Ay;k0=Oa;var KT={usingClientEntryPoint:!1,Events:[gh,Gl,Op,b0,S0,Ay]},zc={findFiberByHostInstance:Pa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},JT={bundleType:zc.bundleType,version:zc.version,rendererPackageName:zc.rendererPackageName,rendererConfig:zc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Xs.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=C0(r),r===null?null:r.stateNode},findFiberByHostInstance:zc.findFiberByHostInstance||WT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bd.isDisabled&&Bd.supportsFiber)try{Rp=Bd.inject(JT),ys=Bd}catch{}}vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KT;vn.createPortal=function(r,n){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fy(n))throw Error(Ee(200));return HT(r,n,null,l)};vn.createRoot=function(r,n){if(!Fy(r))throw Error(Ee(299));var l=!1,p="",_=o1;return n!=null&&(n.unstable_strictMode===!0&&(l=!0),n.identifierPrefix!==void 0&&(p=n.identifierPrefix),n.onRecoverableError!==void 0&&(_=n.onRecoverableError)),n=Ry(r,1,!1,null,null,l,!1,p,_),r[Gs]=n.current,nh(r.nodeType===8?r.parentNode:r),new By(n)};vn.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var n=r._reactInternals;if(n===void 0)throw typeof r.render=="function"?Error(Ee(188)):(r=Object.keys(r).join(","),Error(Ee(268,r)));return r=C0(n),r=r===null?null:r.stateNode,r};vn.flushSync=function(r){return Oa(r)};vn.hydrate=function(r,n,l){if(!Hp(n))throw Error(Ee(200));return Wp(null,r,n,!0,l)};vn.hydrateRoot=function(r,n,l){if(!Fy(r))throw Error(Ee(405));var p=l!=null&&l.hydratedSources||null,_=!1,T="",w=o1;if(l!=null&&(l.unstable_strictMode===!0&&(_=!0),l.identifierPrefix!==void 0&&(T=l.identifierPrefix),l.onRecoverableError!==void 0&&(w=l.onRecoverableError)),n=s1(n,null,r,1,l??null,_,!1,T,w),r[Gs]=n.current,nh(r),p)for(r=0;r<p.length;r++)l=p[r],_=l._getVersion,_=_(l._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[l,_]:n.mutableSourceEagerHydrationData.push(l,_);return new Gp(n)};vn.render=function(r,n,l){if(!Hp(n))throw Error(Ee(200));return Wp(null,r,n,!1,l)};vn.unmountComponentAtNode=function(r){if(!Hp(r))throw Error(Ee(40));return r._reactRootContainer?(Oa(function(){Wp(null,null,r,!1,function(){r._reactRootContainer=null,r[Gs]=null})}),!0):!1};vn.unstable_batchedUpdates=Ay;vn.unstable_renderSubtreeIntoContainer=function(r,n,l,p){if(!Hp(l))throw Error(Ee(200));if(r==null||r._reactInternals===void 0)throw Error(Ee(38));return Wp(r,n,l,!1,p)};vn.version="18.3.1-next-f1338f8080-20240426";function a1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a1)}catch(r){console.error(r)}}a1(),a0.exports=vn;var YT=a0.exports,Lx=YT;$m.createRoot=Lx.createRoot,$m.hydrateRoot=Lx.hydrateRoot;const zo=new WeakMap,Ca=new WeakMap,js=new WeakMap;var QT={};const Cp=Symbol("anyProducer"),Bx=Promise.resolve(),Pp=Symbol("listenerAdded"),Ap=Symbol("listenerRemoved");let Mp=!1,Nm=!1;const zp=r=>typeof r=="string"||typeof r=="symbol"||typeof r=="number";function Ol(r){if(!zp(r))throw new TypeError("`eventName` must be a string, symbol, or number")}function Fd(r){if(typeof r!="function")throw new TypeError("listener must be a function")}function Nl(r,n){const l=Ca.get(r);if(l.has(n))return l.get(n)}function Xc(r,n){const l=zp(n)?n:Cp,p=js.get(r);if(p.has(l))return p.get(l)}function ek(r,n,l){const p=js.get(r);if(p.has(n))for(const _ of p.get(n))_.enqueue(l);if(p.has(Cp)){const _=Promise.all([n,l]);for(const T of p.get(Cp))T.enqueue(_)}}function Fx(r,n){n=Array.isArray(n)?n:[n];let l=!1,p=()=>{},_=[];const T={enqueue(w){_.push(w),p()},finish(){l=!0,p()}};for(const w of n){let d=Xc(r,w);d||(d=new Set,js.get(r).set(w,d)),d.add(T)}return{async next(){return _?_.length===0?l?(_=void 0,this.next()):(await new Promise(w=>{p=w}),this.next()):{done:!1,value:await _.shift()}:{done:!0}},async return(w){_=void 0;for(const d of n){const j=Xc(r,d);j&&(j.delete(T),j.size===0&&js.get(r).delete(d))}return p(),arguments.length>0?{done:!0,value:await w}:{done:!0}},[Symbol.asyncIterator](){return this}}}function Ox(r){if(r===void 0)return Nx;if(!Array.isArray(r))throw new TypeError("`methodNames` must be an array of strings");for(const n of r)if(!Nx.includes(n))throw typeof n!="string"?new TypeError("`methodNames` element must be a string"):new Error(`${n} is not Emittery method`);return r}const Vl=r=>r===Pp||r===Ap;function Od(r,n,l){if(Vl(n))try{Mp=!0,r.emit(n,l)}finally{Mp=!1}}class Na{static mixin(n,l){return l=Ox(l),p=>{if(typeof p!="function")throw new TypeError("`target` must be function");for(const w of l)if(p.prototype[w]!==void 0)throw new Error(`The property \`${w}\` already exists on \`target\``);function _(){return Object.defineProperty(this,n,{enumerable:!1,value:new Na}),this[n]}Object.defineProperty(p.prototype,n,{enumerable:!1,get:_});const T=w=>function(...d){return this[n][w](...d)};for(const w of l)Object.defineProperty(p.prototype,w,{enumerable:!1,value:T(w)});return p}}static get isDebugEnabled(){if(typeof QT!="object")return Nm;const{env:n}=globalThis.process??{env:{}};return n.DEBUG==="emittery"||n.DEBUG==="*"||Nm}static set isDebugEnabled(n){Nm=n}constructor(n={}){zo.set(this,new Set),Ca.set(this,new Map),js.set(this,new Map),js.get(this).set(Cp,new Set),this.debug=n.debug??{},this.debug.enabled===void 0&&(this.debug.enabled=!1),this.debug.logger||(this.debug.logger=(l,p,_,T)=>{try{T=JSON.stringify(T)}catch{T=`Object with the following keys failed to stringify: ${Object.keys(T).join(",")}`}(typeof _=="symbol"||typeof _=="number")&&(_=_.toString());const w=new Date,d=`${w.getHours()}:${w.getMinutes()}:${w.getSeconds()}.${w.getMilliseconds()}`;console.log(`[${d}][emittery:${l}][${p}] Event Name: ${_}
	data: ${T}`)})}logIfDebugEnabled(n,l,p){(Na.isDebugEnabled||this.debug.enabled)&&this.debug.logger(n,this.debug.name,l,p)}on(n,l,{signal:p}={}){Fd(l),n=Array.isArray(n)?n:[n];for(const T of n){Ol(T);let w=Nl(this,T);w||(w=new Set,Ca.get(this).set(T,w)),w.add(l),this.logIfDebugEnabled("subscribe",T,void 0),Vl(T)||Od(this,Pp,{eventName:T,listener:l})}const _=()=>{this.off(n,l),p==null||p.removeEventListener("abort",_)};return p==null||p.addEventListener("abort",_,{once:!0}),p!=null&&p.aborted&&_(),_}off(n,l){Fd(l),n=Array.isArray(n)?n:[n];for(const p of n){Ol(p);const _=Nl(this,p);_&&(_.delete(l),_.size===0&&Ca.get(this).delete(p)),this.logIfDebugEnabled("unsubscribe",p,void 0),Vl(p)||Od(this,Ap,{eventName:p,listener:l})}}once(n,l){if(l!==void 0&&typeof l!="function")throw new TypeError("predicate must be a function");let p;const _=new Promise(T=>{p=this.on(n,w=>{l&&!l(w)||(p(),T(w))})});return _.off=p,_}events(n){n=Array.isArray(n)?n:[n];for(const l of n)Ol(l);return Fx(this,n)}async emit(n,l){if(Ol(n),Vl(n)&&!Mp)throw new TypeError("`eventName` cannot be meta event `listenerAdded` or `listenerRemoved`");this.logIfDebugEnabled("emit",n,l),ek(this,n,l);const p=Nl(this,n)??new Set,_=zo.get(this),T=[...p],w=Vl(n)?[]:[..._];await Bx,await Promise.all([...T.map(async d=>{if(p.has(d))return d(l)}),...w.map(async d=>{if(_.has(d))return d(n,l)})])}async emitSerial(n,l){if(Ol(n),Vl(n)&&!Mp)throw new TypeError("`eventName` cannot be meta event `listenerAdded` or `listenerRemoved`");this.logIfDebugEnabled("emitSerial",n,l);const p=Nl(this,n)??new Set,_=zo.get(this),T=[...p],w=[..._];await Bx;for(const d of T)p.has(d)&&await d(l);for(const d of w)_.has(d)&&await d(n,l)}onAny(n,{signal:l}={}){Fd(n),this.logIfDebugEnabled("subscribeAny",void 0,void 0),zo.get(this).add(n),Od(this,Pp,{listener:n});const p=()=>{this.offAny(n),l==null||l.removeEventListener("abort",p)};return l==null||l.addEventListener("abort",p,{once:!0}),l!=null&&l.aborted&&p(),p}anyEvent(){return Fx(this)}offAny(n){Fd(n),this.logIfDebugEnabled("unsubscribeAny",void 0,void 0),Od(this,Ap,{listener:n}),zo.get(this).delete(n)}clearListeners(n){n=Array.isArray(n)?n:[n];for(const l of n)if(this.logIfDebugEnabled("clear",l,void 0),zp(l)){const p=Nl(this,l);p&&p.clear();const _=Xc(this,l);if(_){for(const T of _)T.finish();_.clear()}}else{zo.get(this).clear();for(const[p,_]of Ca.get(this).entries())_.clear(),Ca.get(this).delete(p);for(const[p,_]of js.get(this).entries()){for(const T of _)T.finish();_.clear(),js.get(this).delete(p)}}}listenerCount(n){var p,_,T;n=Array.isArray(n)?n:[n];let l=0;for(const w of n){if(zp(w)){l+=zo.get(this).size+(((p=Nl(this,w))==null?void 0:p.size)??0)+(((_=Xc(this,w))==null?void 0:_.size)??0)+(((T=Xc(this))==null?void 0:T.size)??0);continue}w!==void 0&&Ol(w),l+=zo.get(this).size;for(const d of Ca.get(this).values())l+=d.size;for(const d of js.get(this).values())l+=d.size}return l}bindMethods(n,l){if(typeof n!="object"||n===null)throw new TypeError("`target` must be an object");l=Ox(l);for(const p of l){if(n[p]!==void 0)throw new Error(`The property \`${p}\` already exists on \`target\``);Object.defineProperty(n,p,{enumerable:!1,value:this[p].bind(this)})}}}const Nx=Object.getOwnPropertyNames(Na.prototype).filter(r=>r!=="constructor");Object.defineProperty(Na,"listenerAdded",{value:Pp,writable:!1,enumerable:!0,configurable:!1});Object.defineProperty(Na,"listenerRemoved",{value:Ap,writable:!1,enumerable:!0,configurable:!1});const tk=["ios","android"],Bg={"0.0.9":["app:ready"],"0.0.14":["miniapp:close.ack","host.back.button:toggle"],"0.1.1":["payment:request","clipboard:write","clipboard:read"],"0.1.3":["link:open"]};function Vx(r,n){const l=Bg[n];return l?l.some(p=>typeof p=="string"?p===r:p.method===r):!1}function rk(r){const n=Object.keys(Bg).sort((l,p)=>{const[_,T,w]=l.split(".").map(Number),[d,j,Y]=p.split(".").map(Number);return _!==d?(_??0)-(d??0):T!==j?(T??0)-(j??0):(w??0)-(Y??0)});for(const l of n){const p=Bg[l];if(p&&p.some(_=>typeof _=="string"?_===r:_.method===r))return l}}var Oy=class l1 extends Error{constructor(n){super(n),this.name="BridgeError",Error.captureStackTrace&&Error.captureStackTrace(this,l1)}},ik=class extends Oy{constructor(){super("Bridge is not available. This SDK requires Alien App environment."),this.name="BridgeUnavailableError"}},nk=class extends Oy{constructor(n,l){super(`Request timeout: ${n} (${l}ms)`);Bl(this,"method");Bl(this,"timeout");this.name="BridgeTimeoutError",this.method=n,this.timeout=l}};function u1(){if(typeof window>"u")return;const r=window.__miniAppsBridge__;if(!(!r||typeof r.postMessage!="function"))return r}function c1(r){const n=u1();if(!n)throw new ik;n.postMessage(JSON.stringify(r))}function sk(r){return r!==null&&typeof r=="object"&&"type"in r&&"name"in r&&"payload"in r&&(r.type==="event"||r.type==="method")}function ok(r){if(typeof window>"u")return()=>{};const n=l=>{let p=l.data;if(typeof p=="string")try{p=JSON.parse(p)}catch{return}sk(p)&&r(p)};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}}var ak=class extends Na{constructor(){super(),ok(r=>{r.type==="event"&&this.emit(r.name,r.payload)})}};const Fg=new ak;function lk(r,n){return Fg.on(r,n),()=>{Fg.off(r,n)}}function uk(r,n){Fg.off(r,n)}const h1="alien/launchParams";var ck=class extends Error{constructor(r){super(r),this.name="LaunchParamsError"}};function d1(r){if(r)return/^\d+\.\d+\.\d+$/.test(r)?r:void 0}function p1(r){if(r)return tk.includes(r)?r:void 0}function hk(){return typeof window>"u"||window.__ALIEN_AUTH_TOKEN__===void 0?null:{authToken:window.__ALIEN_AUTH_TOKEN__,contractVersion:d1(window.__ALIEN_CONTRACT_VERSION__),hostAppVersion:window.__ALIEN_HOST_VERSION__,platform:p1(window.__ALIEN_PLATFORM__),startParam:window.__ALIEN_START_PARAM__}}function dk(){if(typeof window>"u")return null;try{const r=sessionStorage.getItem(h1);return r?fk(r):null}catch{return null}}function pk(r){try{sessionStorage.setItem(h1,JSON.stringify(r))}catch{}}function fk(r){const n=JSON.parse(r);return{authToken:n.authToken,contractVersion:d1(n.contractVersion),hostAppVersion:n.hostAppVersion,platform:p1(n.platform),startParam:n.startParam}}function mk(){const r=hk();if(r)return pk(r),r;const n=dk();if(n)return n;throw new ck("Launch params not available. Running outside Alien App? Use mockLaunchParamsForDev() for development.")}function gk(){try{return mk()}catch{return}}const yk=3e4;function _k(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2)}async function vk(r,n,l,p={}){const _=p.reqId||_k(),T=p.timeout||yk,w={...n,reqId:_};return new Promise((d,j)=>{const Y=setTimeout(()=>{me(),j(new nk(String(r),T))},T),me=()=>{clearTimeout(Y),uk(l,te)},te=$=>{$.reqId===_&&(me(),d($))};lk(l,te),c1({type:"method",name:r,payload:w})})}function xk(r,n){c1({type:"method",name:r,payload:n})}function wk(){return u1()!==void 0}const f1=_t.createContext(null);function bk({children:r}){const n=_t.useMemo(()=>{const l=gk();return{authToken:l==null?void 0:l.authToken,contractVersion:l==null?void 0:l.contractVersion,isBridgeAvailable:wk()}},[]);return _t.useEffect(()=>{n.isBridgeAvailable||console.warn("[@alien_org/react] Bridge is not available. Running in dev mode? The SDK will handle errors gracefully, but bridge communication will not work.")},[n.isBridgeAvailable]),_t.useEffect(()=>{n.isBridgeAvailable&&xk("app:ready",{})},[n.isBridgeAvailable]),ze.jsx(f1.Provider,{value:n,children:r})}var Sk=class extends Error{constructor(r){super(r),this.name="ReactSDKError"}},Tk=class extends Sk{constructor(n,l,p){const _=p?`Method "${n}" requires version ${p}, but host provides ${l??"unknown"}`:`Method "${n}" is not supported`;super(_);Bl(this,"method");Bl(this,"contractVersion");Bl(this,"minVersion");this.name="MethodNotSupportedError",this.method=n,this.contractVersion=l,this.minVersion=p}};function m1(){const r=_t.useContext(f1);if(!r)throw new Error("useAlien must be used within an AlienProvider");return r}function kk(r={}){const{timeout:n=12e4,onPaid:l,onCancelled:p,onFailed:_,onStatusChange:T}=r,{contractVersion:w,isBridgeAvailable:d}=m1(),j=_t.useRef({onPaid:l,onCancelled:p,onFailed:_,onStatusChange:T});j.current={onPaid:l,onCancelled:p,onFailed:_,onStatusChange:T};const[Y,me]=_t.useState({status:"idle"}),te=w?Vx("payment:request",w):!0,$=_t.useCallback(Le=>{var yt,ae;me(Le),(ae=(yt=j.current).onStatusChange)==null||ae.call(yt,Le.status)},[]),Ie=_t.useCallback(async Le=>{var yt,ae,ne,ce,Se,je,Ne,Fe,Ye,kt,it,mt;if(!d){const Et=new Error("Bridge is not available. Running in dev mode?");console.warn("[@alien_org/react]",Et.message);const Mt={status:"failed",errorCode:"unknown",error:Et};return $(Mt),(ae=(yt=j.current).onFailed)==null||ae.call(yt,"unknown",Et),Mt}if(w&&!Vx("payment:request",w)){const Et=new Tk("payment:request",w,rk("payment:request")),Mt={status:"failed",errorCode:"unknown",error:Et};return $(Mt),(ce=(ne=j.current).onFailed)==null||ce.call(ne,"unknown",Et),Mt}$({status:"loading"});try{const Et=await vk("payment:request",Le,"payment:response",{timeout:n});if(Et.status==="paid"){const wr=Et.txHash??"",ri={status:"paid",txHash:wr};return $(ri),(je=(Se=j.current).onPaid)==null||je.call(Se,wr),ri}if(Et.status==="cancelled"){const wr={status:"cancelled"};return $(wr),(Fe=(Ne=j.current).onCancelled)==null||Fe.call(Ne),wr}const Mt=Et.errorCode??"unknown",Yt={status:"failed",errorCode:Mt};return $(Yt),(kt=(Ye=j.current).onFailed)==null||kt.call(Ye,Mt),Yt}catch(Et){const Mt=Et instanceof Error?Et:new Error(String(Et));Et instanceof Oy&&console.warn("[@alien_org/react] Bridge error:",Et.message);const Yt={status:"failed",errorCode:"unknown",error:Mt};return $(Yt),(mt=(it=j.current).onFailed)==null||mt.call(it,"unknown",Mt),Yt}},[d,w,n,$]),Me=_t.useCallback(()=>{$({status:"idle"})},[$]);return _t.useMemo(()=>({status:Y.status,isLoading:Y.status==="loading",isPaid:Y.status==="paid",isCancelled:Y.status==="cancelled",isFailed:Y.status==="failed",txHash:Y.txHash,errorCode:Y.errorCode,error:Y.error,pay:Ie,reset:Me,supported:te}),[Y,Ie,Me,te])}const vs=Object.create(null);vs.open="0";vs.close="1";vs.ping="2";vs.pong="3";vs.message="4";vs.upgrade="5";vs.noop="6";const Qd=Object.create(null);Object.keys(vs).forEach(r=>{Qd[vs[r]]=r});const Og={type:"error",data:"parser error"},g1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",y1=typeof ArrayBuffer=="function",_1=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Ny=({type:r,data:n},l,p)=>g1&&n instanceof Blob?l?p(n):jx(n,p):y1&&(n instanceof ArrayBuffer||_1(n))?l?p(n):jx(new Blob([n]),p):p(vs[r]+(n||"")),jx=(r,n)=>{const l=new FileReader;return l.onload=function(){const p=l.result.split(",")[1];n("b"+(p||""))},l.readAsDataURL(r)};function Ux(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let Vm;function Ek(r,n){if(g1&&r.data instanceof Blob)return r.data.arrayBuffer().then(Ux).then(n);if(y1&&(r.data instanceof ArrayBuffer||_1(r.data)))return n(Ux(r.data));Ny(r,!1,l=>{Vm||(Vm=new TextEncoder),n(Vm.encode(l))})}const $x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Nc=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<$x.length;r++)Nc[$x.charCodeAt(r)]=r;const Ik=r=>{let n=r.length*.75,l=r.length,p,_=0,T,w,d,j;r[r.length-1]==="="&&(n--,r[r.length-2]==="="&&n--);const Y=new ArrayBuffer(n),me=new Uint8Array(Y);for(p=0;p<l;p+=4)T=Nc[r.charCodeAt(p)],w=Nc[r.charCodeAt(p+1)],d=Nc[r.charCodeAt(p+2)],j=Nc[r.charCodeAt(p+3)],me[_++]=T<<2|w>>4,me[_++]=(w&15)<<4|d>>2,me[_++]=(d&3)<<6|j&63;return Y},Ck=typeof ArrayBuffer=="function",Vy=(r,n)=>{if(typeof r!="string")return{type:"message",data:v1(r,n)};const l=r.charAt(0);return l==="b"?{type:"message",data:Pk(r.substring(1),n)}:Qd[l]?r.length>1?{type:Qd[l],data:r.substring(1)}:{type:Qd[l]}:Og},Pk=(r,n)=>{if(Ck){const l=Ik(r);return v1(l,n)}else return{base64:!0,data:r}},v1=(r,n)=>{switch(n){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},x1="",Ak=(r,n)=>{const l=r.length,p=new Array(l);let _=0;r.forEach((T,w)=>{Ny(T,!1,d=>{p[w]=d,++_===l&&n(p.join(x1))})})},Mk=(r,n)=>{const l=r.split(x1),p=[];for(let _=0;_<l.length;_++){const T=Vy(l[_],n);if(p.push(T),T.type==="error")break}return p};function zk(){return new TransformStream({transform(r,n){Ek(r,l=>{const p=l.length;let _;if(p<126)_=new Uint8Array(1),new DataView(_.buffer).setUint8(0,p);else if(p<65536){_=new Uint8Array(3);const T=new DataView(_.buffer);T.setUint8(0,126),T.setUint16(1,p)}else{_=new Uint8Array(9);const T=new DataView(_.buffer);T.setUint8(0,127),T.setBigUint64(1,BigInt(p))}r.data&&typeof r.data!="string"&&(_[0]|=128),n.enqueue(_),n.enqueue(l)})}})}let jm;function Nd(r){return r.reduce((n,l)=>n+l.length,0)}function Vd(r,n){if(r[0].length===n)return r.shift();const l=new Uint8Array(n);let p=0;for(let _=0;_<n;_++)l[_]=r[0][p++],p===r[0].length&&(r.shift(),p=0);return r.length&&p<r[0].length&&(r[0]=r[0].slice(p)),l}function Dk(r,n){jm||(jm=new TextDecoder);const l=[];let p=0,_=-1,T=!1;return new TransformStream({transform(w,d){for(l.push(w);;){if(p===0){if(Nd(l)<1)break;const j=Vd(l,1);T=(j[0]&128)===128,_=j[0]&127,_<126?p=3:_===126?p=1:p=2}else if(p===1){if(Nd(l)<2)break;const j=Vd(l,2);_=new DataView(j.buffer,j.byteOffset,j.length).getUint16(0),p=3}else if(p===2){if(Nd(l)<8)break;const j=Vd(l,8),Y=new DataView(j.buffer,j.byteOffset,j.length),me=Y.getUint32(0);if(me>Math.pow(2,21)-1){d.enqueue(Og);break}_=me*Math.pow(2,32)+Y.getUint32(4),p=3}else{if(Nd(l)<_)break;const j=Vd(l,_);d.enqueue(Vy(T?j:jm.decode(j),n)),p=0}if(_===0||_>r){d.enqueue(Og);break}}}})}const w1=4;function Lr(r){if(r)return Rk(r)}function Rk(r){for(var n in Lr.prototype)r[n]=Lr.prototype[n];return r}Lr.prototype.on=Lr.prototype.addEventListener=function(r,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(n),this};Lr.prototype.once=function(r,n){function l(){this.off(r,l),n.apply(this,arguments)}return l.fn=n,this.on(r,l),this};Lr.prototype.off=Lr.prototype.removeListener=Lr.prototype.removeAllListeners=Lr.prototype.removeEventListener=function(r,n){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var l=this._callbacks["$"+r];if(!l)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var p,_=0;_<l.length;_++)if(p=l[_],p===n||p.fn===n){l.splice(_,1);break}return l.length===0&&delete this._callbacks["$"+r],this};Lr.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var n=new Array(arguments.length-1),l=this._callbacks["$"+r],p=1;p<arguments.length;p++)n[p-1]=arguments[p];if(l){l=l.slice(0);for(var p=0,_=l.length;p<_;++p)l[p].apply(this,n)}return this};Lr.prototype.emitReserved=Lr.prototype.emit;Lr.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};Lr.prototype.hasListeners=function(r){return!!this.listeners(r).length};const Xp=typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,l)=>l(n,0),Dn=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Lk="arraybuffer";function b1(r,...n){return n.reduce((l,p)=>(r.hasOwnProperty(p)&&(l[p]=r[p]),l),{})}const Bk=Dn.setTimeout,Fk=Dn.clearTimeout;function Kp(r,n){n.useNativeTimers?(r.setTimeoutFn=Bk.bind(Dn),r.clearTimeoutFn=Fk.bind(Dn)):(r.setTimeoutFn=Dn.setTimeout.bind(Dn),r.clearTimeoutFn=Dn.clearTimeout.bind(Dn))}const Ok=1.33;function Nk(r){return typeof r=="string"?Vk(r):Math.ceil((r.byteLength||r.size)*Ok)}function Vk(r){let n=0,l=0;for(let p=0,_=r.length;p<_;p++)n=r.charCodeAt(p),n<128?l+=1:n<2048?l+=2:n<55296||n>=57344?l+=3:(p++,l+=4);return l}function S1(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function jk(r){let n="";for(let l in r)r.hasOwnProperty(l)&&(n.length&&(n+="&"),n+=encodeURIComponent(l)+"="+encodeURIComponent(r[l]));return n}function Uk(r){let n={},l=r.split("&");for(let p=0,_=l.length;p<_;p++){let T=l[p].split("=");n[decodeURIComponent(T[0])]=decodeURIComponent(T[1])}return n}class $k extends Error{constructor(n,l,p){super(n),this.description=l,this.context=p,this.type="TransportError"}}class jy extends Lr{constructor(n){super(),this.writable=!1,Kp(this,n),this.opts=n,this.query=n.query,this.socket=n.socket,this.supportsBinary=!n.forceBase64}onError(n,l,p){return super.emitReserved("error",new $k(n,l,p)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(n){this.readyState==="open"&&this.write(n)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(n){const l=Vy(n,this.socket.binaryType);this.onPacket(l)}onPacket(n){super.emitReserved("packet",n)}onClose(n){this.readyState="closed",super.emitReserved("close",n)}pause(n){}createUri(n,l={}){return n+"://"+this._hostname()+this._port()+this.opts.path+this._query(l)}_hostname(){const n=this.opts.hostname;return n.indexOf(":")===-1?n:"["+n+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(n){const l=jk(n);return l.length?"?"+l:""}}class qk extends jy{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(n){this.readyState="pausing";const l=()=>{this.readyState="paused",n()};if(this._polling||!this.writable){let p=0;this._polling&&(p++,this.once("pollComplete",function(){--p||l()})),this.writable||(p++,this.once("drain",function(){--p||l()}))}else l()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(n){const l=p=>{if(this.readyState==="opening"&&p.type==="open"&&this.onOpen(),p.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(p)};Mk(n,this.socket.binaryType).forEach(l),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const n=()=>{this.write([{type:"close"}])};this.readyState==="open"?n():this.once("open",n)}write(n){this.writable=!1,Ak(n,l=>{this.doWrite(l,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const n=this.opts.secure?"https":"http",l=this.query||{};return this.opts.timestampRequests!==!1&&(l[this.opts.timestampParam]=S1()),!this.supportsBinary&&!l.sid&&(l.b64=1),this.createUri(n,l)}}let T1=!1;try{T1=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Zk=T1;function Gk(){}class Hk extends qk{constructor(n){if(super(n),typeof location<"u"){const l=location.protocol==="https:";let p=location.port;p||(p=l?"443":"80"),this.xd=typeof location<"u"&&n.hostname!==location.hostname||p!==n.port}}doWrite(n,l){const p=this.request({method:"POST",data:n});p.on("success",l),p.on("error",(_,T)=>{this.onError("xhr post error",_,T)})}doPoll(){const n=this.request();n.on("data",this.onData.bind(this)),n.on("error",(l,p)=>{this.onError("xhr poll error",l,p)}),this.pollXhr=n}}let su=class ep extends Lr{constructor(n,l,p){super(),this.createRequest=n,Kp(this,p),this._opts=p,this._method=p.method||"GET",this._uri=l,this._data=p.data!==void 0?p.data:null,this._create()}_create(){var n;const l=b1(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");l.xdomain=!!this._opts.xd;const p=this._xhr=this.createRequest(l);try{p.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){p.setDisableHeaderCheck&&p.setDisableHeaderCheck(!0);for(let _ in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(_)&&p.setRequestHeader(_,this._opts.extraHeaders[_])}}catch{}if(this._method==="POST")try{p.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{p.setRequestHeader("Accept","*/*")}catch{}(n=this._opts.cookieJar)===null||n===void 0||n.addCookies(p),"withCredentials"in p&&(p.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(p.timeout=this._opts.requestTimeout),p.onreadystatechange=()=>{var _;p.readyState===3&&((_=this._opts.cookieJar)===null||_===void 0||_.parseCookies(p.getResponseHeader("set-cookie"))),p.readyState===4&&(p.status===200||p.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof p.status=="number"?p.status:0)},0))},p.send(this._data)}catch(_){this.setTimeoutFn(()=>{this._onError(_)},0);return}typeof document<"u"&&(this._index=ep.requestsCount++,ep.requests[this._index]=this)}_onError(n){this.emitReserved("error",n,this._xhr),this._cleanup(!0)}_cleanup(n){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Gk,n)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ep.requests[this._index],this._xhr=null}}_onLoad(){const n=this._xhr.responseText;n!==null&&(this.emitReserved("data",n),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};su.requestsCount=0;su.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",qx);else if(typeof addEventListener=="function"){const r="onpagehide"in Dn?"pagehide":"unload";addEventListener(r,qx,!1)}}function qx(){for(let r in su.requests)su.requests.hasOwnProperty(r)&&su.requests[r].abort()}const Wk=function(){const r=k1({xdomain:!1});return r&&r.responseType!==null}();class Xk extends Hk{constructor(n){super(n);const l=n&&n.forceBase64;this.supportsBinary=Wk&&!l}request(n={}){return Object.assign(n,{xd:this.xd},this.opts),new su(k1,this.uri(),n)}}function k1(r){const n=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!n||Zk))return new XMLHttpRequest}catch{}if(!n)try{return new Dn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const E1=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Kk extends jy{get name(){return"websocket"}doOpen(){const n=this.uri(),l=this.opts.protocols,p=E1?{}:b1(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(p.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(n,l,p)}catch(_){return this.emitReserved("error",_)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=n=>this.onClose({description:"websocket connection closed",context:n}),this.ws.onmessage=n=>this.onData(n.data),this.ws.onerror=n=>this.onError("websocket error",n)}write(n){this.writable=!1;for(let l=0;l<n.length;l++){const p=n[l],_=l===n.length-1;Ny(p,this.supportsBinary,T=>{try{this.doWrite(p,T)}catch{}_&&Xp(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const n=this.opts.secure?"wss":"ws",l=this.query||{};return this.opts.timestampRequests&&(l[this.opts.timestampParam]=S1()),this.supportsBinary||(l.b64=1),this.createUri(n,l)}}const Um=Dn.WebSocket||Dn.MozWebSocket;class Jk extends Kk{createSocket(n,l,p){return E1?new Um(n,l,p):l?new Um(n,l):new Um(n)}doWrite(n,l){this.ws.send(l)}}class Yk extends jy{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(n){return this.emitReserved("error",n)}this._transport.closed.then(()=>{this.onClose()}).catch(n=>{this.onError("webtransport error",n)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(n=>{const l=Dk(Number.MAX_SAFE_INTEGER,this.socket.binaryType),p=n.readable.pipeThrough(l).getReader(),_=zk();_.readable.pipeTo(n.writable),this._writer=_.writable.getWriter();const T=()=>{p.read().then(({done:d,value:j})=>{d||(this.onPacket(j),T())}).catch(d=>{})};T();const w={type:"open"};this.query.sid&&(w.data=`{"sid":"${this.query.sid}"}`),this._writer.write(w).then(()=>this.onOpen())})})}write(n){this.writable=!1;for(let l=0;l<n.length;l++){const p=n[l],_=l===n.length-1;this._writer.write(p).then(()=>{_&&Xp(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var n;(n=this._transport)===null||n===void 0||n.close()}}const Qk={websocket:Jk,webtransport:Yk,polling:Xk},eE=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,tE=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ng(r){if(r.length>8e3)throw"URI too long";const n=r,l=r.indexOf("["),p=r.indexOf("]");l!=-1&&p!=-1&&(r=r.substring(0,l)+r.substring(l,p).replace(/:/g,";")+r.substring(p,r.length));let _=eE.exec(r||""),T={},w=14;for(;w--;)T[tE[w]]=_[w]||"";return l!=-1&&p!=-1&&(T.source=n,T.host=T.host.substring(1,T.host.length-1).replace(/;/g,":"),T.authority=T.authority.replace("[","").replace("]","").replace(/;/g,":"),T.ipv6uri=!0),T.pathNames=rE(T,T.path),T.queryKey=iE(T,T.query),T}function rE(r,n){const l=/\/{2,9}/g,p=n.replace(l,"/").split("/");return(n.slice(0,1)=="/"||n.length===0)&&p.splice(0,1),n.slice(-1)=="/"&&p.splice(p.length-1,1),p}function iE(r,n){const l={};return n.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(p,_,T){_&&(l[_]=T)}),l}const Vg=typeof addEventListener=="function"&&typeof removeEventListener=="function",tp=[];Vg&&addEventListener("offline",()=>{tp.forEach(r=>r())},!1);class Ho extends Lr{constructor(n,l){if(super(),this.binaryType=Lk,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,n&&typeof n=="object"&&(l=n,n=null),n){const p=Ng(n);l.hostname=p.host,l.secure=p.protocol==="https"||p.protocol==="wss",l.port=p.port,p.query&&(l.query=p.query)}else l.host&&(l.hostname=Ng(l.host).host);Kp(this,l),this.secure=l.secure!=null?l.secure:typeof location<"u"&&location.protocol==="https:",l.hostname&&!l.port&&(l.port=this.secure?"443":"80"),this.hostname=l.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=l.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},l.transports.forEach(p=>{const _=p.prototype.name;this.transports.push(_),this._transportsByName[_]=p}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},l),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Uk(this.opts.query)),Vg&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},tp.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(n){const l=Object.assign({},this.opts.query);l.EIO=w1,l.transport=n,this.id&&(l.sid=this.id);const p=Object.assign({},this.opts,{query:l,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[n]);return new this._transportsByName[n](p)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const n=this.opts.rememberUpgrade&&Ho.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const l=this.createTransport(n);l.open(),this.setTransport(l)}setTransport(n){this.transport&&this.transport.removeAllListeners(),this.transport=n,n.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",l=>this._onClose("transport close",l))}onOpen(){this.readyState="open",Ho.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",n),this.emitReserved("heartbeat"),n.type){case"open":this.onHandshake(JSON.parse(n.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const l=new Error("server error");l.code=n.data,this._onError(l);break;case"message":this.emitReserved("data",n.data),this.emitReserved("message",n.data);break}}onHandshake(n){this.emitReserved("handshake",n),this.id=n.sid,this.transport.query.sid=n.sid,this._pingInterval=n.pingInterval,this._pingTimeout=n.pingTimeout,this._maxPayload=n.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const n=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+n,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},n),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const n=this._getWritablePackets();this.transport.send(n),this._prevBufferLen=n.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let l=1;for(let p=0;p<this.writeBuffer.length;p++){const _=this.writeBuffer[p].data;if(_&&(l+=Nk(_)),p>0&&l>this._maxPayload)return this.writeBuffer.slice(0,p);l+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const n=Date.now()>this._pingTimeoutTime;return n&&(this._pingTimeoutTime=0,Xp(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),n}write(n,l,p){return this._sendPacket("message",n,l,p),this}send(n,l,p){return this._sendPacket("message",n,l,p),this}_sendPacket(n,l,p,_){if(typeof l=="function"&&(_=l,l=void 0),typeof p=="function"&&(_=p,p=null),this.readyState==="closing"||this.readyState==="closed")return;p=p||{},p.compress=p.compress!==!1;const T={type:n,data:l,options:p};this.emitReserved("packetCreate",T),this.writeBuffer.push(T),_&&this.once("flush",_),this.flush()}close(){const n=()=>{this._onClose("forced close"),this.transport.close()},l=()=>{this.off("upgrade",l),this.off("upgradeError",l),n()},p=()=>{this.once("upgrade",l),this.once("upgradeError",l)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?p():n()}):this.upgrading?p():n()),this}_onError(n){if(Ho.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",n),this._onClose("transport error",n)}_onClose(n,l){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Vg&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const p=tp.indexOf(this._offlineEventListener);p!==-1&&tp.splice(p,1)}this.readyState="closed",this.id=null,this.emitReserved("close",n,l),this.writeBuffer=[],this._prevBufferLen=0}}}Ho.protocol=w1;class nE extends Ho{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let n=0;n<this._upgrades.length;n++)this._probe(this._upgrades[n])}_probe(n){let l=this.createTransport(n),p=!1;Ho.priorWebsocketSuccess=!1;const _=()=>{p||(l.send([{type:"ping",data:"probe"}]),l.once("packet",te=>{if(!p)if(te.type==="pong"&&te.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",l),!l)return;Ho.priorWebsocketSuccess=l.name==="websocket",this.transport.pause(()=>{p||this.readyState!=="closed"&&(me(),this.setTransport(l),l.send([{type:"upgrade"}]),this.emitReserved("upgrade",l),l=null,this.upgrading=!1,this.flush())})}else{const $=new Error("probe error");$.transport=l.name,this.emitReserved("upgradeError",$)}}))};function T(){p||(p=!0,me(),l.close(),l=null)}const w=te=>{const $=new Error("probe error: "+te);$.transport=l.name,T(),this.emitReserved("upgradeError",$)};function d(){w("transport closed")}function j(){w("socket closed")}function Y(te){l&&te.name!==l.name&&T()}const me=()=>{l.removeListener("open",_),l.removeListener("error",w),l.removeListener("close",d),this.off("close",j),this.off("upgrading",Y)};l.once("open",_),l.once("error",w),l.once("close",d),this.once("close",j),this.once("upgrading",Y),this._upgrades.indexOf("webtransport")!==-1&&n!=="webtransport"?this.setTimeoutFn(()=>{p||l.open()},200):l.open()}onHandshake(n){this._upgrades=this._filterUpgrades(n.upgrades),super.onHandshake(n)}_filterUpgrades(n){const l=[];for(let p=0;p<n.length;p++)~this.transports.indexOf(n[p])&&l.push(n[p]);return l}}let sE=class extends nE{constructor(n,l={}){const p=typeof n=="object"?n:l;(!p.transports||p.transports&&typeof p.transports[0]=="string")&&(p.transports=(p.transports||["polling","websocket","webtransport"]).map(_=>Qk[_]).filter(_=>!!_)),super(n,p)}};function oE(r,n="",l){let p=r;l=l||typeof location<"u"&&location,r==null&&(r=l.protocol+"//"+l.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=l.protocol+r:r=l.host+r),/^(https?|wss?):\/\//.test(r)||(typeof l<"u"?r=l.protocol+"//"+r:r="https://"+r),p=Ng(r)),p.port||(/^(http|ws)$/.test(p.protocol)?p.port="80":/^(http|ws)s$/.test(p.protocol)&&(p.port="443")),p.path=p.path||"/";const T=p.host.indexOf(":")!==-1?"["+p.host+"]":p.host;return p.id=p.protocol+"://"+T+":"+p.port+n,p.href=p.protocol+"://"+T+(l&&l.port===p.port?"":":"+p.port),p}const aE=typeof ArrayBuffer=="function",lE=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,I1=Object.prototype.toString,uE=typeof Blob=="function"||typeof Blob<"u"&&I1.call(Blob)==="[object BlobConstructor]",cE=typeof File=="function"||typeof File<"u"&&I1.call(File)==="[object FileConstructor]";function Uy(r){return aE&&(r instanceof ArrayBuffer||lE(r))||uE&&r instanceof Blob||cE&&r instanceof File}function rp(r,n){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let l=0,p=r.length;l<p;l++)if(rp(r[l]))return!0;return!1}if(Uy(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return rp(r.toJSON(),!0);for(const l in r)if(Object.prototype.hasOwnProperty.call(r,l)&&rp(r[l]))return!0;return!1}function hE(r){const n=[],l=r.data,p=r;return p.data=jg(l,n),p.attachments=n.length,{packet:p,buffers:n}}function jg(r,n){if(!r)return r;if(Uy(r)){const l={_placeholder:!0,num:n.length};return n.push(r),l}else if(Array.isArray(r)){const l=new Array(r.length);for(let p=0;p<r.length;p++)l[p]=jg(r[p],n);return l}else if(typeof r=="object"&&!(r instanceof Date)){const l={};for(const p in r)Object.prototype.hasOwnProperty.call(r,p)&&(l[p]=jg(r[p],n));return l}return r}function dE(r,n){return r.data=Ug(r.data,n),delete r.attachments,r}function Ug(r,n){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<n.length)return n[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let l=0;l<r.length;l++)r[l]=Ug(r[l],n);else if(typeof r=="object")for(const l in r)Object.prototype.hasOwnProperty.call(r,l)&&(r[l]=Ug(r[l],n));return r}const pE=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var Nt;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(Nt||(Nt={}));class fE{constructor(n){this.replacer=n}encode(n){return(n.type===Nt.EVENT||n.type===Nt.ACK)&&rp(n)?this.encodeAsBinary({type:n.type===Nt.EVENT?Nt.BINARY_EVENT:Nt.BINARY_ACK,nsp:n.nsp,data:n.data,id:n.id}):[this.encodeAsString(n)]}encodeAsString(n){let l=""+n.type;return(n.type===Nt.BINARY_EVENT||n.type===Nt.BINARY_ACK)&&(l+=n.attachments+"-"),n.nsp&&n.nsp!=="/"&&(l+=n.nsp+","),n.id!=null&&(l+=n.id),n.data!=null&&(l+=JSON.stringify(n.data,this.replacer)),l}encodeAsBinary(n){const l=hE(n),p=this.encodeAsString(l.packet),_=l.buffers;return _.unshift(p),_}}class $y extends Lr{constructor(n){super(),this.reviver=n}add(n){let l;if(typeof n=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");l=this.decodeString(n);const p=l.type===Nt.BINARY_EVENT;p||l.type===Nt.BINARY_ACK?(l.type=p?Nt.EVENT:Nt.ACK,this.reconstructor=new mE(l),l.attachments===0&&super.emitReserved("decoded",l)):super.emitReserved("decoded",l)}else if(Uy(n)||n.base64)if(this.reconstructor)l=this.reconstructor.takeBinaryData(n),l&&(this.reconstructor=null,super.emitReserved("decoded",l));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+n)}decodeString(n){let l=0;const p={type:Number(n.charAt(0))};if(Nt[p.type]===void 0)throw new Error("unknown packet type "+p.type);if(p.type===Nt.BINARY_EVENT||p.type===Nt.BINARY_ACK){const T=l+1;for(;n.charAt(++l)!=="-"&&l!=n.length;);const w=n.substring(T,l);if(w!=Number(w)||n.charAt(l)!=="-")throw new Error("Illegal attachments");p.attachments=Number(w)}if(n.charAt(l+1)==="/"){const T=l+1;for(;++l&&!(n.charAt(l)===","||l===n.length););p.nsp=n.substring(T,l)}else p.nsp="/";const _=n.charAt(l+1);if(_!==""&&Number(_)==_){const T=l+1;for(;++l;){const w=n.charAt(l);if(w==null||Number(w)!=w){--l;break}if(l===n.length)break}p.id=Number(n.substring(T,l+1))}if(n.charAt(++l)){const T=this.tryParse(n.substr(l));if($y.isPayloadValid(p.type,T))p.data=T;else throw new Error("invalid payload")}return p}tryParse(n){try{return JSON.parse(n,this.reviver)}catch{return!1}}static isPayloadValid(n,l){switch(n){case Nt.CONNECT:return Zx(l);case Nt.DISCONNECT:return l===void 0;case Nt.CONNECT_ERROR:return typeof l=="string"||Zx(l);case Nt.EVENT:case Nt.BINARY_EVENT:return Array.isArray(l)&&(typeof l[0]=="number"||typeof l[0]=="string"&&pE.indexOf(l[0])===-1);case Nt.ACK:case Nt.BINARY_ACK:return Array.isArray(l)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class mE{constructor(n){this.packet=n,this.buffers=[],this.reconPack=n}takeBinaryData(n){if(this.buffers.push(n),this.buffers.length===this.reconPack.attachments){const l=dE(this.reconPack,this.buffers);return this.finishedReconstruction(),l}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Zx(r){return Object.prototype.toString.call(r)==="[object Object]"}const gE=Object.freeze(Object.defineProperty({__proto__:null,Decoder:$y,Encoder:fE,get PacketType(){return Nt}},Symbol.toStringTag,{value:"Module"}));function Jn(r,n,l){return r.on(n,l),function(){r.off(n,l)}}const yE=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class C1 extends Lr{constructor(n,l,p){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=n,this.nsp=l,p&&p.auth&&(this.auth=p.auth),this._opts=Object.assign({},p),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const n=this.io;this.subs=[Jn(n,"open",this.onopen.bind(this)),Jn(n,"packet",this.onpacket.bind(this)),Jn(n,"error",this.onerror.bind(this)),Jn(n,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...n){return n.unshift("message"),this.emit.apply(this,n),this}emit(n,...l){var p,_,T;if(yE.hasOwnProperty(n))throw new Error('"'+n.toString()+'" is a reserved event name');if(l.unshift(n),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(l),this;const w={type:Nt.EVENT,data:l};if(w.options={},w.options.compress=this.flags.compress!==!1,typeof l[l.length-1]=="function"){const me=this.ids++,te=l.pop();this._registerAckCallback(me,te),w.id=me}const d=(_=(p=this.io.engine)===null||p===void 0?void 0:p.transport)===null||_===void 0?void 0:_.writable,j=this.connected&&!(!((T=this.io.engine)===null||T===void 0)&&T._hasPingExpired());return this.flags.volatile&&!d||(j?(this.notifyOutgoingListeners(w),this.packet(w)):this.sendBuffer.push(w)),this.flags={},this}_registerAckCallback(n,l){var p;const _=(p=this.flags.timeout)!==null&&p!==void 0?p:this._opts.ackTimeout;if(_===void 0){this.acks[n]=l;return}const T=this.io.setTimeoutFn(()=>{delete this.acks[n];for(let d=0;d<this.sendBuffer.length;d++)this.sendBuffer[d].id===n&&this.sendBuffer.splice(d,1);l.call(this,new Error("operation has timed out"))},_),w=(...d)=>{this.io.clearTimeoutFn(T),l.apply(this,d)};w.withError=!0,this.acks[n]=w}emitWithAck(n,...l){return new Promise((p,_)=>{const T=(w,d)=>w?_(w):p(d);T.withError=!0,l.push(T),this.emit(n,...l)})}_addToQueue(n){let l;typeof n[n.length-1]=="function"&&(l=n.pop());const p={id:this._queueSeq++,tryCount:0,pending:!1,args:n,flags:Object.assign({fromQueue:!0},this.flags)};n.push((_,...T)=>(this._queue[0],_!==null?p.tryCount>this._opts.retries&&(this._queue.shift(),l&&l(_)):(this._queue.shift(),l&&l(null,...T)),p.pending=!1,this._drainQueue())),this._queue.push(p),this._drainQueue()}_drainQueue(n=!1){if(!this.connected||this._queue.length===0)return;const l=this._queue[0];l.pending&&!n||(l.pending=!0,l.tryCount++,this.flags=l.flags,this.emit.apply(this,l.args))}packet(n){n.nsp=this.nsp,this.io._packet(n)}onopen(){typeof this.auth=="function"?this.auth(n=>{this._sendConnectPacket(n)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(n){this.packet({type:Nt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},n):n})}onerror(n){this.connected||this.emitReserved("connect_error",n)}onclose(n,l){this.connected=!1,delete this.id,this.emitReserved("disconnect",n,l),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(n=>{if(!this.sendBuffer.some(p=>String(p.id)===n)){const p=this.acks[n];delete this.acks[n],p.withError&&p.call(this,new Error("socket has been disconnected"))}})}onpacket(n){if(n.nsp===this.nsp)switch(n.type){case Nt.CONNECT:n.data&&n.data.sid?this.onconnect(n.data.sid,n.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Nt.EVENT:case Nt.BINARY_EVENT:this.onevent(n);break;case Nt.ACK:case Nt.BINARY_ACK:this.onack(n);break;case Nt.DISCONNECT:this.ondisconnect();break;case Nt.CONNECT_ERROR:this.destroy();const p=new Error(n.data.message);p.data=n.data.data,this.emitReserved("connect_error",p);break}}onevent(n){const l=n.data||[];n.id!=null&&l.push(this.ack(n.id)),this.connected?this.emitEvent(l):this.receiveBuffer.push(Object.freeze(l))}emitEvent(n){if(this._anyListeners&&this._anyListeners.length){const l=this._anyListeners.slice();for(const p of l)p.apply(this,n)}super.emit.apply(this,n),this._pid&&n.length&&typeof n[n.length-1]=="string"&&(this._lastOffset=n[n.length-1])}ack(n){const l=this;let p=!1;return function(..._){p||(p=!0,l.packet({type:Nt.ACK,id:n,data:_}))}}onack(n){const l=this.acks[n.id];typeof l=="function"&&(delete this.acks[n.id],l.withError&&n.data.unshift(null),l.apply(this,n.data))}onconnect(n,l){this.id=n,this.recovered=l&&this._pid===l,this._pid=l,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(n=>this.emitEvent(n)),this.receiveBuffer=[],this.sendBuffer.forEach(n=>{this.notifyOutgoingListeners(n),this.packet(n)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(n=>n()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Nt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(n){return this.flags.compress=n,this}get volatile(){return this.flags.volatile=!0,this}timeout(n){return this.flags.timeout=n,this}onAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(n),this}prependAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(n),this}offAny(n){if(!this._anyListeners)return this;if(n){const l=this._anyListeners;for(let p=0;p<l.length;p++)if(n===l[p])return l.splice(p,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(n),this}prependAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(n),this}offAnyOutgoing(n){if(!this._anyOutgoingListeners)return this;if(n){const l=this._anyOutgoingListeners;for(let p=0;p<l.length;p++)if(n===l[p])return l.splice(p,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(n){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const l=this._anyOutgoingListeners.slice();for(const p of l)p.apply(this,n.data)}}}function gu(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}gu.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var n=Math.random(),l=Math.floor(n*this.jitter*r);r=Math.floor(n*10)&1?r+l:r-l}return Math.min(r,this.max)|0};gu.prototype.reset=function(){this.attempts=0};gu.prototype.setMin=function(r){this.ms=r};gu.prototype.setMax=function(r){this.max=r};gu.prototype.setJitter=function(r){this.jitter=r};class $g extends Lr{constructor(n,l){var p;super(),this.nsps={},this.subs=[],n&&typeof n=="object"&&(l=n,n=void 0),l=l||{},l.path=l.path||"/socket.io",this.opts=l,Kp(this,l),this.reconnection(l.reconnection!==!1),this.reconnectionAttempts(l.reconnectionAttempts||1/0),this.reconnectionDelay(l.reconnectionDelay||1e3),this.reconnectionDelayMax(l.reconnectionDelayMax||5e3),this.randomizationFactor((p=l.randomizationFactor)!==null&&p!==void 0?p:.5),this.backoff=new gu({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(l.timeout==null?2e4:l.timeout),this._readyState="closed",this.uri=n;const _=l.parser||gE;this.encoder=new _.Encoder,this.decoder=new _.Decoder,this._autoConnect=l.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(n){return arguments.length?(this._reconnection=!!n,n||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(n){return n===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=n,this)}reconnectionDelay(n){var l;return n===void 0?this._reconnectionDelay:(this._reconnectionDelay=n,(l=this.backoff)===null||l===void 0||l.setMin(n),this)}randomizationFactor(n){var l;return n===void 0?this._randomizationFactor:(this._randomizationFactor=n,(l=this.backoff)===null||l===void 0||l.setJitter(n),this)}reconnectionDelayMax(n){var l;return n===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=n,(l=this.backoff)===null||l===void 0||l.setMax(n),this)}timeout(n){return arguments.length?(this._timeout=n,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(n){if(~this._readyState.indexOf("open"))return this;this.engine=new sE(this.uri,this.opts);const l=this.engine,p=this;this._readyState="opening",this.skipReconnect=!1;const _=Jn(l,"open",function(){p.onopen(),n&&n()}),T=d=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",d),n?n(d):this.maybeReconnectOnOpen()},w=Jn(l,"error",T);if(this._timeout!==!1){const d=this._timeout,j=this.setTimeoutFn(()=>{_(),T(new Error("timeout")),l.close()},d);this.opts.autoUnref&&j.unref(),this.subs.push(()=>{this.clearTimeoutFn(j)})}return this.subs.push(_),this.subs.push(w),this}connect(n){return this.open(n)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const n=this.engine;this.subs.push(Jn(n,"ping",this.onping.bind(this)),Jn(n,"data",this.ondata.bind(this)),Jn(n,"error",this.onerror.bind(this)),Jn(n,"close",this.onclose.bind(this)),Jn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(n){try{this.decoder.add(n)}catch(l){this.onclose("parse error",l)}}ondecoded(n){Xp(()=>{this.emitReserved("packet",n)},this.setTimeoutFn)}onerror(n){this.emitReserved("error",n)}socket(n,l){let p=this.nsps[n];return p?this._autoConnect&&!p.active&&p.connect():(p=new C1(this,n,l),this.nsps[n]=p),p}_destroy(n){const l=Object.keys(this.nsps);for(const p of l)if(this.nsps[p].active)return;this._close()}_packet(n){const l=this.encoder.encode(n);for(let p=0;p<l.length;p++)this.engine.write(l[p],n.options)}cleanup(){this.subs.forEach(n=>n()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(n,l){var p;this.cleanup(),(p=this.engine)===null||p===void 0||p.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",n,l),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const n=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const l=this.backoff.duration();this._reconnecting=!0;const p=this.setTimeoutFn(()=>{n.skipReconnect||(this.emitReserved("reconnect_attempt",n.backoff.attempts),!n.skipReconnect&&n.open(_=>{_?(n._reconnecting=!1,n.reconnect(),this.emitReserved("reconnect_error",_)):n.onreconnect()}))},l);this.opts.autoUnref&&p.unref(),this.subs.push(()=>{this.clearTimeoutFn(p)})}}onreconnect(){const n=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",n)}}const Dc={};function ip(r,n){typeof r=="object"&&(n=r,r=void 0),n=n||{};const l=oE(r,n.path||"/socket.io"),p=l.source,_=l.id,T=l.path,w=Dc[_]&&T in Dc[_].nsps,d=n.forceNew||n["force new connection"]||n.multiplex===!1||w;let j;return d?j=new $g(p,n):(Dc[_]||(Dc[_]=new $g(p,n)),j=Dc[_]),l.query&&!n.query&&(n.query=l.queryKey),j.socket(l.path,n)}Object.assign(ip,{Manager:$g,Socket:C1,io:ip,connect:ip});const xs="http://localhost:4000";async function Gx(r){const n=await fetch(`${xs}/auth/alien`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.token}`},body:JSON.stringify({role:r.role})});if(!n.ok)throw new Error("Auth failed");return n.json()}async function _E(r){const n=await fetch(`${xs}/drivers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error("Create driver failed");return n.json()}async function vE(r){const n=await fetch(`${xs}/drivers/${r.driverId}/location`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({lat:r.lat,lng:r.lng})});if(!n.ok)throw new Error("Update location failed");return n.json()}async function xE(r,n){const l=await fetch(`${xs}/drivers/nearby?lat=${r}&lng=${n}`);if(!l.ok)throw new Error("Drivers fetch failed");return l.json()}async function wE(r){const n=await fetch(`${xs}/rides`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error("Ride request failed");return n.json()}async function bE(r,n){const l=await fetch(`${xs}/rides/${r}/accept`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({driverId:n})});if(!l.ok)throw new Error("Accept ride failed");return l.json()}async function SE(r){const n=await fetch(`${xs}/rides/${r}/start`,{method:"PATCH"});if(!n.ok)throw new Error("Start ride failed");return n.json()}async function TE(r){const n=await fetch(`${xs}/rides/${r}/complete`,{method:"PATCH"});if(!n.ok)throw new Error("Complete ride failed");return n.json()}async function kE(){const r=await fetch(`${xs}/rides/open`);if(!r.ok)throw new Error("Open rides fetch failed");return r.json()}async function EE(r){const n=await fetch(`${xs}/payments/invoice`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.token}`},body:JSON.stringify({amount:r.amount,rideId:r.rideId})});if(!n.ok)throw new Error("Invoice failed");return n.json()}function IE({userName:r,authToken:n}){return ze.jsxs("header",{className:"header",children:[ze.jsxs("div",{children:[ze.jsx("div",{className:"brand",children:"Alien Ride"}),ze.jsx("div",{className:"tagline",children:"Mini App  Real-time rides"})]}),ze.jsxs("div",{className:"user",children:[ze.jsx("div",{className:"user-name",children:r||"Connecting..."}),ze.jsx("div",{className:"user-token",children:n?"Alien auth verified":"Awaiting auth"})]})]})}var P1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,n){(function(l,p){r.exports=p()})(k2,function(){var l={},p={};function _(w,d,j){if(p[w]=j,w==="index"){var Y="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",me={};return p.shared(me),p.index(l,me),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([Y],{type:"text/javascript"}))),l}}_("shared",["exports"],function(w){function d(i,t,s,a){return new(s||(s=Promise))(function(h,g){function y(E){try{b(a.next(E))}catch(I){g(I)}}function v(E){try{b(a.throw(E))}catch(I){g(I)}}function b(E){var I;E.done?h(E.value):(I=E.value,I instanceof s?I:new s(function(P){P(I)})).then(y,v)}b((a=a.apply(i,t||[])).next())})}function j(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var Y=me;function me(i,t){this.x=i,this.y=t}me.prototype={clone:function(){return new me(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,s=i.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),s=Math.sin(i),a=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=a,this},_rotateAround:function(i,t){var s=Math.cos(i),a=Math.sin(i),h=t.y+a*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},me.convert=function(i){return i instanceof me?i:Array.isArray(i)?new me(i[0],i[1]):i};var te=j(Y),$=Ie;function Ie(i,t,s,a){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=s,this.p2y=a}Ie.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,a=0;a<8;a++){var h=this.sampleCurveX(s)-i;if(Math.abs(h)<t)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=h/g}var y=0,v=1;for(s=i,a=0;a<20&&(h=this.sampleCurveX(s),!(Math.abs(h-i)<t));a++)i>h?y=s:v=s,s=.5*(v-y)+y;return s},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Me=j($);let Le,yt;function ae(){return Le==null&&(Le=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Le}function ne(){if(yt==null&&(yt=!1,ae())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const h=4*a;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&s[a]!==a){yt=!0;break}}}return yt||!1}function ce(i,t,s,a){const h=new Me(i,t,s,a);return g=>h.solve(g)}const Se=ce(.25,.1,.25,1);function je(i,t,s){return Math.min(s,Math.max(t,i))}function Ne(i,t,s){const a=s-t,h=((i-t)%a+a)%a+t;return h===t?s:h}function Fe(i,...t){for(const s of t)for(const a in s)i[a]=s[a];return i}let Ye=1;function kt(i,t,s){const a={};for(const h in i)a[h]=t.call(this,i[h],h,i);return a}function it(i,t,s){const a={};for(const h in i)t.call(this,i[h],h,i)&&(a[h]=i[h]);return a}function mt(i){return Array.isArray(i)?i.map(mt):typeof i=="object"&&i?kt(i,mt):i}const Et={};function Mt(i){Et[i]||(typeof console<"u"&&console.warn(i),Et[i]=!0)}function Yt(i,t,s){return(s.y-i.y)*(t.x-i.x)>(t.y-i.y)*(s.x-i.x)}function wr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let ri=null;function Br(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const We="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function lt(i,t,s,a,h){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(i,{timestamp:0});try{const y=g==null?void 0:g.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const v=y.startsWith("BGR"),b=new Uint8ClampedArray(a*h*4);if(yield g.copyTo(b,function(E,I,P,z,L){const F=4*Math.max(-I,0),O=(Math.max(0,P)-P)*z*4+F,Z=4*z,X=Math.max(0,I),de=Math.max(0,P);return{rect:{x:X,y:de,width:Math.min(E.width,I+z)-X,height:Math.min(E.height,P+L)-de},layout:[{offset:O,stride:Z}]}}(i,t,s,a,h)),v)for(let E=0;E<b.length;E+=4){const I=b[E];b[E]=b[E+2],b[E+2]=I}return b}finally{g.close()}})}let pt,Tt;const Ft="AbortError";function nr(){return new Error(Ft)}const br={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Fr(i){return br.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const qr="global-dispatcher";class Sr extends Error{constructor(t,s,a,h){super(`AJAXError: ${s} (${t}): ${a}`),this.status=t,this.statusText=s,this.url=a,this.body=h}}const ki=()=>wr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,On=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const a=Fr(i.url);if(a)return a(i,t);if(wr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:qr},t)}if(!(/^file:/.test(s=i.url)||/^file:/.test(ki())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,h){return d(this,void 0,void 0,function*(){const g=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:ki(),signal:h.signal});a.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const y=yield fetch(g);if(!y.ok){const E=yield y.blob();throw new Sr(y.status,y.statusText,a.url,E)}let v;v=a.type==="arrayBuffer"||a.type==="image"?y.arrayBuffer():a.type==="json"?y.json():y.text();const b=yield v;if(h.signal.aborted)throw nr();return{data:b,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(i,t);if(wr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:qr},t)}var s;return function(a,h){return new Promise((g,y)=>{var v;const b=new XMLHttpRequest;b.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(b.responseType="arraybuffer");for(const E in a.headers)b.setRequestHeader(E,a.headers[E]);a.type==="json"&&(b.responseType="text",!((v=a.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=a.credentials==="include",b.onerror=()=>{y(new Error(b.statusText))},b.onload=()=>{if(!h.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let E=b.response;if(a.type==="json")try{E=JSON.parse(b.response)}catch(I){return void y(I)}g({data:E,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const E=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});y(new Sr(b.status,b.statusText,a.url,E))}},h.signal.addEventListener("abort",()=>{b.abort(),y(nr())}),b.send(a.body)})}(i,t)};function Nn(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function ws(i,t,s){s[i]&&s[i].indexOf(t)!==-1||(s[i]=s[i]||[],s[i].push(t))}function Qi(i,t,s){if(s&&s[i]){const a=s[i].indexOf(t);a!==-1&&s[i].splice(a,1)}}class wn{constructor(t,s={}){Fe(this,s),this.type=t}}class bn extends wn{constructor(t,s={}){super("error",Fe({error:t},s))}}class rs{on(t,s){return this._listeners=this._listeners||{},ws(t,s,this._listeners),this}off(t,s){return Qi(t,s,this._listeners),Qi(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},ws(t,s,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,s){typeof t=="string"&&(t=new wn(t,s||{}));const a=t.type;if(this.listens(a)){t.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of h)v.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of g)Qi(a,v,this._oneTimeListeners),v.call(this,t);const y=this._eventedParent;y&&(Fe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof bn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const at=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qt(i,t){const s={};for(const a in i)a!=="ref"&&(s[a]=i[a]);return at.forEach(a=>{a in t&&(s[a]=t[a])}),s}function wt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let s=0;s<i.length;s++)if(!wt(i[s],t[s]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const s in i)if(!wt(i[s],t[s]))return!1;return!0}return i===t}function sr(i,t){i.push(t)}function is(i,t,s){sr(s,{command:"addSource",args:[i,t[i]]})}function en(i,t,s){sr(t,{command:"removeSource",args:[i]}),s[i]=!0}function Oi(i,t,s,a){en(i,s,a),is(i,t,s)}function Vn(i,t,s){let a;for(a in i[s])if(Object.prototype.hasOwnProperty.call(i[s],a)&&a!=="data"&&!wt(i[s][a],t[s][a]))return!1;for(a in t[s])if(Object.prototype.hasOwnProperty.call(t[s],a)&&a!=="data"&&!wt(i[s][a],t[s][a]))return!1;return!0}function ii(i,t,s,a,h,g){i=i||{},t=t||{};for(const y in i)Object.prototype.hasOwnProperty.call(i,y)&&(wt(i[y],t[y])||s.push({command:g,args:[a,y,t[y],h]}));for(const y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(i,y)&&(wt(i[y],t[y])||s.push({command:g,args:[a,y,t[y],h]}))}function Ks(i){return i.id}function jn(i,t){return i[t.id]=t,i}class ke{constructor(t,s,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function Zr(i,...t){for(const s of t)for(const a in s)i[a]=s[a];return i}class Or extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Ni{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[a,h]of s)this.bindings[a]=h}concat(t){return new Ni(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ns={kind:"null"},De={kind:"number"},xt={kind:"string"},ut={kind:"boolean"},di={kind:"color"},tn={kind:"object"},ft={kind:"value"},Sn={kind:"collator"},Un={kind:"formatted"},ss={kind:"padding"},Tn={kind:"resolvedImage"},W={kind:"variableAnchorOffsetCollection"};function R(i,t){return{kind:"array",itemType:i,N:t}}function D(i){if(i.kind==="array"){const t=D(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const N=[ns,De,xt,ut,di,Un,tn,R(ft),ss,Tn,W];function G(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!G(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const s of N)if(!G(s,t))return null}}return`Expected ${D(i)} but found ${D(t)} instead.`}function ie(i,t){return t.some(s=>s.kind===i.kind)}function oe(i,t){return t.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}function he(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const Q=.96422,_e=.82521,we=4/29,fe=6/29,Ce=3*fe*fe,tt=fe*fe*fe,nt=Math.PI/180,zt=180/Math.PI;function gt(i){return(i%=360)<0&&(i+=360),i}function Dt([i,t,s,a]){let h,g;const y=Tr((.2225045*(i=It(i))+.7168786*(t=It(t))+.0606169*(s=It(s)))/1);i===t&&t===s?h=g=y:(h=Tr((.4360747*i+.3850649*t+.1430804*s)/Q),g=Tr((.0139322*i+.0971045*t+.7141733*s)/_e));const v=116*y-16;return[v<0?0:v,500*(h-y),200*(y-g),a]}function It(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Tr(i){return i>tt?Math.pow(i,1/3):i/Ce+we}function lr([i,t,s,a]){let h=(i+16)/116,g=isNaN(t)?h:h+t/500,y=isNaN(s)?h:h-s/200;return h=1*Ut(h),g=Q*Ut(g),y=_e*Ut(y),[bt(3.1338561*g-1.6168667*h-.4906146*y),bt(-.9787684*g+1.9161415*h+.033454*y),bt(.0719453*g-.2289914*h+1.4052427*y),a]}function bt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Ut(i){return i>fe?i*i*i:Ce*(i-we)}function or(i){return parseInt(i.padEnd(2,i),16)/255}function Ar(i,t){return Nr(t?i/100:i,0,1)}function Nr(i,t,s){return Math.min(Math.max(t,i),s)}function ni(i){return!i.some(Number.isNaN)}const Js={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class $t{constructor(t,s,a,h=1,g=!0){this.r=t,this.g=s,this.b=a,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,s,a,h]))}static parse(t){if(t instanceof $t)return t;if(typeof t!="string")return;const s=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Js[a];if(h){const[y,v,b]=h;return[y/255,v/255,b/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let v=1;return[or(a.slice(v,v+=y)),or(a.slice(v,v+=y)),or(a.slice(v,v+=y)),or(a.slice(v,v+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,b,E,I,P,z,L,F,O,Z,X,de]=y,re=[I||" ",L||" ",Z].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const ue=[E,z,O].join(""),ye=ue==="%%%"?100:ue===""?255:0;if(ye){const be=[Nr(+b/ye,0,1),Nr(+P/ye,0,1),Nr(+F/ye,0,1),X?Ar(+X,de):1];if(ni(be))return be}}return}}const g=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,v,b,E,I,P,z,L,F]=g,O=[b||" ",I||" ",z].join("");if(O==="  "||O==="  /"||O===",,"||O===",,,"){const Z=[+v,Nr(+E,0,100),Nr(+P,0,100),L?Ar(+L,F):1];if(ni(Z))return function([X,de,re,ue]){function ye(be){const $e=(be+X/30)%12,st=de*Math.min(re,1-re);return re-st*Math.max(-1,Math.min($e-3,9-$e,1))}return X=gt(X),de/=100,re/=100,[ye(0),ye(8),ye(4),ue]}(Z)}}}(t);return s?new $t(...s,!1):void 0}get rgb(){const{r:t,g:s,b:a,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,s/g,a/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,a,h,g]=Dt(t),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?gt(Math.atan2(h,a)*zt):NaN,y,s,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Dt(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,a,h]=this.rgb;return`rgba(${[t,s,a].map(g=>Math.round(255*g)).join(",")},${h})`}}$t.black=new $t(0,0,0,1),$t.white=new $t(1,1,1,1),$t.transparent=new $t(0,0,0,0),$t.red=new $t(1,0,0,1);class yu{constructor(t,s,a){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _u{constructor(t,s,a,h,g){this.text=t,this.image=s,this.scale=a,this.fontStack=h,this.textColor=g}}class Ei{constructor(t){this.sections=t}static fromString(t){return new Ei([new _u(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Ei?t:Ei.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Ii{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ii)return t;if(typeof t=="number")return new Ii([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Ii(t)}}toString(){return JSON.stringify(this.values)}}const Jp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Vi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Vi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const a=t[s],h=t[s+1];if(typeof a!="string"||!Jp.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Vi(t)}}toString(){return JSON.stringify(this.values)}}class Ci{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ci({name:t,available:!1}):null}}function Ys(i,t,s,a){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,t,s,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,t,s,a]:[i,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof $t||i instanceof yu||i instanceof Ei||i instanceof Ii||i instanceof Vi||i instanceof Ci)return!0;if(Array.isArray(i)){for(const t of i)if(!bs(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!bs(i[t]))return!1;return!0}return!1}function kr(i){if(i===null)return ns;if(typeof i=="string")return xt;if(typeof i=="boolean")return ut;if(typeof i=="number")return De;if(i instanceof $t)return di;if(i instanceof yu)return Sn;if(i instanceof Ei)return Un;if(i instanceof Ii)return ss;if(i instanceof Vi)return W;if(i instanceof Ci)return Tn;if(Array.isArray(i)){const t=i.length;let s;for(const a of i){const h=kr(a);if(s){if(s===h)continue;s=ft;break}s=h}return R(s||ft,t)}return tn}function Qo(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof $t||i instanceof Ei||i instanceof Ii||i instanceof Vi||i instanceof Ci?i.toString():JSON.stringify(i)}class rn{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!bs(t[1]))return s.error("invalid value");const a=t[1];let h=kr(a);const g=s.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new rn(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class gr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ua={string:xt,number:De,boolean:ut,object:tn};class nn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let a,h=1;const g=t[0];if(g==="array"){let v,b;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in Ua)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=Ua[E],h++}else v=ft;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}a=R(v,b)}else{if(!Ua[g])throw new Error(`Types doesn't contain name = ${g}`);a=Ua[g]}const y=[];for(;h<t.length;h++){const v=s.parse(t[h],h,ft);if(!v)return null;y.push(v)}return new nn(a,y)}evaluate(t){for(let s=0;s<this.args.length;s++){const a=this.args[s].evaluate(t);if(!G(this.type,kr(a)))return a;if(s===this.args.length-1)throw new gr(`Expected value to be of type ${D(this.type)}, but found ${D(kr(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const vu={"to-boolean":ut,"to-color":di,"to-number":De,"to-string":xt};class sn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const a=t[0];if(!vu[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return s.error("Expected one argument.");const h=vu[a],g=[];for(let y=1;y<t.length;y++){const v=s.parse(t[y],y,ft);if(!v)return null;g.push(v)}return new sn(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,a;for(const h of this.args){if(s=h.evaluate(t),a=null,s instanceof $t)return s;if(typeof s=="string"){const g=t.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(a=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Ys(s[0],s[1],s[2],s[3]),!a))return new $t(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new gr(a||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const a of this.args){s=a.evaluate(t);const h=Ii.parse(s);if(h)return h}throw new gr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const a of this.args){s=a.evaluate(t);const h=Vi.parse(s);if(h)return h}throw new gr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const a of this.args){if(s=a.evaluate(t),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new gr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Ei.fromString(Qo(this.args[0].evaluate(t)));case"resolvedImage":return Ci.fromString(Qo(this.args[0].evaluate(t)));default:return Qo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Yp=["Unknown","Point","LineString","Polygon"];class $a{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Yp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=$t.parse(t)),s}}class Ss{constructor(t,s,a=[],h,g=new Ni,y=[]){this.registry=t,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h,this._isConstant=s}parse(t,s,a,h,g={}){return s?this.concat(s,a,h)._parse(t,g):this._parse(t,g)}_parse(t,s){function a(h,g,y){return y==="assert"?new nn(g,[h]):y==="coerce"?new sn(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let y=g.parse(t,this);if(!y)return null;if(this.expectedType){const v=this.expectedType,b=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(v.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(v,b))return null}else y=a(y,v,s.typeAnnotation||"coerce");else y=a(y,v,s.typeAnnotation||"coerce");else y=a(y,v,s.typeAnnotation||"coerce");else y=a(y,v,s.typeAnnotation||"assert")}if(!(y instanceof rn)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const v=new $a;try{y=new rn(y.type,y.evaluate(v))}catch(b){return this.error(b.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,a){const h=typeof t=="number"?this.path.concat(t):this.path,g=a?this.scope.concat(a):this.scope;return new Ss(this.registry,this._isConstant,h,s||null,g,this.errors)}error(t,...s){const a=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new Or(a,t))}checkSubtype(t,s){const a=G(t,s);return a&&this.error(a),a}}class os{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let g=1;g<t.length-1;g+=2){const y=t[g];if(typeof y!="string")return s.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=s.parse(t[g+1],g+1);if(!v)return null;a.push([y,v])}const h=s.parse(t[t.length-1],t.length-1,s.expectedType,a);return h?new os(a,h):null}outputDefined(){return this.result.outputDefined()}}class Ot{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const a=t[1];return s.scope.has(a)?new Ot(a,s.scope.get(a)):s.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class xu{constructor(t,s,a){this.type=t,this.index=s,this.input=a}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,De),h=s.parse(t[2],2,R(s.expectedType||ft));return a&&h?new xu(h.type.itemType,a,h):null}evaluate(t){const s=this.index.evaluate(t),a=this.input.evaluate(t);if(s<0)throw new gr(`Array index out of bounds: ${s} < 0.`);if(s>=a.length)throw new gr(`Array index out of bounds: ${s} > ${a.length-1}.`);if(s!==Math.floor(s))throw new gr(`Array index must be an integer, but found ${s} instead.`);return a[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class wu{constructor(t,s){this.type=ut,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,ft),h=s.parse(t[2],2,ft);return a&&h?ie(a.type,[ut,xt,De,ns,ft])?new wu(a,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!oe(s,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${D(kr(s))} instead.`);if(!oe(a,["string","array"]))throw new gr(`Expected second argument to be of type array or string, but found ${D(kr(a))} instead.`);return a.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Qs{constructor(t,s,a){this.type=De,this.needle=t,this.haystack=s,this.fromIndex=a}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,ft),h=s.parse(t[2],2,ft);if(!a||!h)return null;if(!ie(a.type,[ut,xt,De,ns,ft]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`);if(t.length===4){const g=s.parse(t[3],3,De);return g?new Qs(a,h,g):null}return new Qs(a,h)}evaluate(t){const s=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!oe(s,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${D(kr(s))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),oe(a,["string"])){const g=a.indexOf(s,h);return g===-1?-1:[...a.slice(0,g)].length}if(oe(a,["array"]))return a.indexOf(s,h);throw new gr(`Expected second argument to be of type array or string, but found ${D(kr(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class bu{constructor(t,s,a,h,g,y){this.inputType=t,this.type=s,this.input=a,this.cases=h,this.outputs=g,this.otherwise=y}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let a,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const g={},y=[];for(let E=2;E<t.length-1;E+=2){let I=t[E];const P=t[E+1];Array.isArray(I)||(I=[I]);const z=s.concat(E);if(I.length===0)return z.error("Expected at least one branch label.");for(const F of I){if(typeof F!="number"&&typeof F!="string")return z.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,kr(F)))return null}else a=kr(F);if(g[String(F)]!==void 0)return z.error("Branch labels must be unique.");g[String(F)]=y.length}const L=s.parse(P,E,h);if(!L)return null;h=h||L.type,y.push(L)}const v=s.parse(t[1],1,ft);if(!v)return null;const b=s.parse(t[t.length-1],t.length-1,h);return b?v.type.kind!=="value"&&s.concat(1).checkSubtype(a,v.type)?null:new bu(a,h,v,g,y,b):null}evaluate(t){const s=this.input.evaluate(t);return(kr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class qa{constructor(t,s,a){this.type=t,this.branches=s,this.otherwise=a}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let a;s.expectedType&&s.expectedType.kind!=="value"&&(a=s.expectedType);const h=[];for(let y=1;y<t.length-1;y+=2){const v=s.parse(t[y],y,ut);if(!v)return null;const b=s.parse(t[y+1],y+1,a);if(!b)return null;h.push([v,b]),a=a||b.type}const g=s.parse(t[t.length-1],t.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new qa(a,h,g)}evaluate(t){for(const[s,a]of this.branches)if(s.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,a]of this.branches)t(s),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class ea{constructor(t,s,a,h){this.type=t,this.input=s,this.beginIndex=a,this.endIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,ft),h=s.parse(t[2],2,De);if(!a||!h)return null;if(!ie(a.type,[R(ft),xt,ft]))return s.error(`Expected first argument to be of type array or string, but found ${D(a.type)} instead`);if(t.length===4){const g=s.parse(t[3],3,De);return g?new ea(a.type,a,h,g):null}return new ea(a.type,a,h)}evaluate(t){const s=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),oe(s,["string"]))return[...s].slice(a,h).join("");if(oe(s,["array"]))return s.slice(a,h);throw new gr(`Expected first argument to be of type array or string, but found ${D(kr(s))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Za(i,t){const s=i.length-1;let a,h,g=0,y=s,v=0;for(;g<=y;)if(v=Math.floor((g+y)/2),a=i[v],h=i[v+1],a<=t){if(v===s||t<h)return v;g=v+1}else{if(!(a>t))throw new gr("Input is not a number.");y=v-1}return 0}class eo{constructor(t,s,a){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const a=s.parse(t[1],1,De);if(!a)return null;const h=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let y=1;y<t.length;y+=2){const v=y===1?-1/0:t[y],b=t[y+1],E=y,I=y+1;if(typeof v!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=s.parse(b,I,g);if(!P)return null;g=g||P.type,h.push([v,P])}return new eo(g,a,h)}evaluate(t){const s=this.labels,a=this.outputs;if(s.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return a[0].evaluate(t);const g=s.length;return h>=s[g-1]?a[g-1].evaluate(t):a[Za(s,h)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function _h(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Qp=vh;function vh(i,t,s,a){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=s,this.p2y=a}vh.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,a=0;a<8;a++){var h=this.sampleCurveX(s)-i;if(Math.abs(h)<t)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=h/g}var y=0,v=1;for(s=i,a=0;a<20&&(h=this.sampleCurveX(s),!(Math.abs(h-i)<t));a++)i>h?y=s:v=s,s=.5*(v-y)+y;return s},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var ef=_h(Qp);function Ts(i,t,s){return i+s*(t-i)}function ta(i,t,s){return i.map((a,h)=>Ts(a,t[h],s))}const pi={number:Ts,color:function(i,t,s,a="rgb"){switch(a){case"rgb":{const[h,g,y,v]=ta(i.rgb,t.rgb,s);return new $t(h,g,y,v,!1)}case"hcl":{const[h,g,y,v]=i.hcl,[b,E,I,P]=t.hcl;let z,L;if(isNaN(h)||isNaN(b))isNaN(h)?isNaN(b)?z=NaN:(z=b,y!==1&&y!==0||(L=E)):(z=h,I!==1&&I!==0||(L=g));else{let de=b-h;b>h&&de>180?de-=360:b<h&&h-b>180&&(de+=360),z=h+s*de}const[F,O,Z,X]=function([de,re,ue,ye]){return de=isNaN(de)?0:de*nt,lr([ue,Math.cos(de)*re,Math.sin(de)*re,ye])}([z,L??Ts(g,E,s),Ts(y,I,s),Ts(v,P,s)]);return new $t(F,O,Z,X,!1)}case"lab":{const[h,g,y,v]=lr(ta(i.lab,t.lab,s));return new $t(h,g,y,v,!1)}}},array:ta,padding:function(i,t,s){return new Ii(ta(i.values,t.values,s))},variableAnchorOffsetCollection:function(i,t,s){const a=i.values,h=t.values;if(a.length!==h.length)throw new gr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const g=[];for(let y=0;y<a.length;y+=2){if(a[y]!==h[y])throw new gr(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${h[y]}`);g.push(a[y]);const[v,b]=a[y+1],[E,I]=h[y+1];g.push([Ts(v,E,s),Ts(b,I,s)])}return new Vi(g)}};class fi{constructor(t,s,a,h,g){this.type=t,this.operator=s,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[y,v]of g)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(t,s,a,h){let g=0;if(t.name==="exponential")g=Ga(s,t.base,a,h);else if(t.name==="linear")g=Ga(s,1,a,h);else if(t.name==="cubic-bezier"){const y=t.controlPoints;g=new ef(y[0],y[1],y[2],y[3]).solve(Ga(s,1,a,h))}return g}static parse(t,s){let[a,h,g,...y]=t;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(I=>typeof I!="number"||I<0||I>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,De),!g)return null;const v=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=di:s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let E=0;E<y.length;E+=2){const I=y[E],P=y[E+1],z=E+3,L=E+4;if(typeof I!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(v.length&&v[v.length-1][0]>=I)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const F=s.parse(P,L,b);if(!F)return null;b=b||F.type,v.push([I,F])}return he(b,De)||he(b,di)||he(b,ss)||he(b,W)||he(b,R(De))?new fi(b,a,h,g,v):s.error(`Type ${D(b)} is not interpolatable.`)}evaluate(t){const s=this.labels,a=this.outputs;if(s.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return a[0].evaluate(t);const g=s.length;if(h>=s[g-1])return a[g-1].evaluate(t);const y=Za(s,h),v=fi.interpolationFactor(this.interpolation,h,s[y],s[y+1]),b=a[y].evaluate(t),E=a[y+1].evaluate(t);switch(this.operator){case"interpolate":return pi[this.type.kind](b,E,v);case"interpolate-hcl":return pi.color(b,E,v,"hcl");case"interpolate-lab":return pi.color(b,E,v,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ga(i,t,s,a){const h=a-s,g=i-s;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class Ha{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let a=null;const h=s.expectedType;h&&h.kind!=="value"&&(a=h);const g=[];for(const v of t.slice(1)){const b=s.parse(v,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,g.push(b)}if(!a)throw new Error("No output type");const y=h&&g.some(v=>G(h,v.type));return new Ha(y?ft:a,g)}evaluate(t){let s,a=null,h=0;for(const g of this.args)if(h++,a=g.evaluate(t),a&&a instanceof Ci&&!a.available&&(s||(s=a.name),a=null,h===this.args.length&&(a=s)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Wa(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function xh(i,t,s,a){return a.compare(t,s)===0}function to(i,t,s){const a=i!=="=="&&i!=="!=";return class A1{constructor(g,y,v){this.type=ut,this.lhs=g,this.rhs=y,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const v=g[0];let b=y.parse(g[1],1,ft);if(!b)return null;if(!Wa(v,b.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${D(b.type)}'.`);let E=y.parse(g[2],2,ft);if(!E)return null;if(!Wa(v,E.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${D(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return y.error(`Cannot compare types '${D(b.type)}' and '${D(E.type)}'.`);a&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new nn(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new nn(b.type,[E])));let I=null;if(g.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(I=y.parse(g[3],3,Sn),!I)return null}return new A1(b,E,I)}evaluate(g){const y=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){const b=kr(y),E=kr(v);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new gr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=kr(y),E=kr(v);if(b.kind!=="string"||E.kind!=="string")return t(g,y,v)}return this.collator?s(g,y,v,this.collator.evaluate(g)):t(g,y,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const tf=to("==",function(i,t,s){return t===s},xh),wh=to("!=",function(i,t,s){return t!==s},function(i,t,s,a){return!xh(0,t,s,a)}),bh=to("<",function(i,t,s){return t<s},function(i,t,s,a){return a.compare(t,s)<0}),rf=to(">",function(i,t,s){return t>s},function(i,t,s,a){return a.compare(t,s)>0}),nf=to("<=",function(i,t,s){return t<=s},function(i,t,s,a){return a.compare(t,s)<=0}),Sh=to(">=",function(i,t,s){return t>=s},function(i,t,s,a){return a.compare(t,s)>=0});class ra{constructor(t,s,a){this.type=Sn,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return s.error("Collator options argument must be an object.");const h=s.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ut);if(!h)return null;const g=s.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ut);if(!g)return null;let y=null;return a.locale&&(y=s.parse(a.locale,1,xt),!y)?null:new ra(h,g,y)}evaluate(t){return new yu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Su{constructor(t,s,a,h,g){this.type=xt,this.number=t,this.locale=s,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const a=s.parse(t[1],1,De);if(!a)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=s.parse(h.locale,1,xt),!g))return null;let y=null;if(h.currency&&(y=s.parse(h.currency,1,xt),!y))return null;let v=null;if(h["min-fraction-digits"]&&(v=s.parse(h["min-fraction-digits"],1,De),!v))return null;let b=null;return h["max-fraction-digits"]&&(b=s.parse(h["max-fraction-digits"],1,De),!b)?null:new Su(a,g,y,v,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Xa{constructor(t){this.type=Un,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return s.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=t.length-1;++y){const v=t[y];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let b=null;if(v["font-scale"]&&(b=s.parse(v["font-scale"],1,De),!b))return null;let E=null;if(v["text-font"]&&(E=s.parse(v["text-font"],1,R(xt)),!E))return null;let I=null;if(v["text-color"]&&(I=s.parse(v["text-color"],1,di),!I))return null;const P=h[h.length-1];P.scale=b,P.font=E,P.textColor=I}else{const b=s.parse(t[y],1,ft);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Xa(h)}evaluate(t){return new Ei(this.sections.map(s=>{const a=s.content.evaluate(t);return kr(a)===Tn?new _u("",a,null,null,null):new _u(Qo(a),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class Tu{constructor(t){this.type=Tn,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const a=s.parse(t[1],1,xt);return a?new Tu(a):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),a=Ci.fromString(s);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(s)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class ku{constructor(t){this.type=De,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=s.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${D(a.type)} instead.`):new ku(a):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new gr(`Expected value to be of type string or array, but found ${D(kr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const kn=8192;function sf(i,t){const s=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(s*h*kn),Math.round(a*h*kn)]}function Eu(i,t){const s=Math.pow(2,t.z);return[(h=(i[0]/kn+t.x)/s,360*h-180),(a=(i[1]/kn+t.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,h}function ks(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function as(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Vt(i,t,s){const a=i[0]-t[0],h=i[1]-t[1],g=i[0]-s[0],y=i[1]-s[1];return a*y-g*h==0&&a*g<=0&&h*y<=0}function Ka(i,t,s,a){return(h=[a[0]-s[0],a[1]-s[1]])[0]*(g=[t[0]-i[0],t[1]-i[1]])[1]-h[1]*g[0]!=0&&!(!kh(i,t,s,a)||!kh(s,a,i,t));var h,g}function of(i,t,s){for(const a of s)for(let h=0;h<a.length-1;++h)if(Ka(i,t,a[h],a[h+1]))return!0;return!1}function ro(i,t,s=!1){let a=!1;for(const v of t)for(let b=0;b<v.length-1;b++){if(Vt(i,v[b],v[b+1]))return s;(g=v[b])[1]>(h=i)[1]!=(y=v[b+1])[1]>h[1]&&h[0]<(y[0]-g[0])*(h[1]-g[1])/(y[1]-g[1])+g[0]&&(a=!a)}var h,g,y;return a}function af(i,t){for(const s of t)if(ro(i,s))return!0;return!1}function Th(i,t){for(const s of i)if(!ro(s,t))return!1;for(let s=0;s<i.length-1;++s)if(of(i[s],i[s+1],t))return!1;return!0}function lf(i,t){for(const s of t)if(Th(i,s))return!0;return!1}function kh(i,t,s,a){const h=a[0]-s[0],g=a[1]-s[1],y=(i[0]-s[0])*g-h*(i[1]-s[1]),v=(t[0]-s[0])*g-h*(t[1]-s[1]);return y>0&&v<0||y<0&&v>0}function Iu(i,t,s){const a=[];for(let h=0;h<i.length;h++){const g=[];for(let y=0;y<i[h].length;y++){const v=sf(i[h][y],s);ks(t,v),g.push(v)}a.push(g)}return a}function Eh(i,t,s){const a=[];for(let h=0;h<i.length;h++){const g=Iu(i[h],t,s);a.push(g)}return a}function Ih(i,t,s,a){if(i[0]<s[0]||i[0]>s[2]){const h=.5*a;let g=i[0]-s[0]>h?-a:s[0]-i[0]>h?a:0;g===0&&(g=i[0]-s[2]>h?-a:s[2]-i[0]>h?a:0),i[0]+=g}ks(t,i)}function Ch(i,t,s,a){const h=Math.pow(2,a.z)*kn,g=[a.x*kn,a.y*kn],y=[];for(const v of i)for(const b of v){const E=[b.x+g[0],b.y+g[1]];Ih(E,t,s,h),y.push(E)}return y}function Ph(i,t,s,a){const h=Math.pow(2,a.z)*kn,g=[a.x*kn,a.y*kn],y=[];for(const b of i){const E=[];for(const I of b){const P=[I.x+g[0],I.y+g[1]];ks(t,P),E.push(P)}y.push(E)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of y)for(const E of b)Ih(E,t,s,h)}var v;return y}class Es{constructor(t,s){this.type=ut,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(bs(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const h=[];for(const g of a.features){const{type:y,coordinates:v}=g.geometry;y==="Polygon"&&h.push(v),y==="MultiPolygon"&&h.push(...v)}if(h.length)return new Es(a,{type:"MultiPolygon",coordinates:h})}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Es(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Es(a,a)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(a.type==="Polygon"){const v=Iu(a.coordinates,g,y),b=Ch(s.geometry(),h,g,y);if(!as(h,g))return!1;for(const E of b)if(!ro(E,v))return!1}if(a.type==="MultiPolygon"){const v=Eh(a.coordinates,g,y),b=Ch(s.geometry(),h,g,y);if(!as(h,g))return!1;for(const E of b)if(!af(E,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(a.type==="Polygon"){const v=Iu(a.coordinates,g,y),b=Ph(s.geometry(),h,g,y);if(!as(h,g))return!1;for(const E of b)if(!Th(E,v))return!1}if(a.type==="MultiPolygon"){const v=Eh(a.coordinates,g,y),b=Ph(s.geometry(),h,g,y);if(!as(h,g))return!1;for(const E of b)if(!lf(E,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ah=class{constructor(i=[],t=(s,a)=>s<a?-1:s>a?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:s}=this,a=t[i];for(;i>0;){const h=i-1>>1,g=t[h];if(s(a,g)>=0)break;t[i]=g,i=h}t[i]=a}_down(i){const{data:t,compare:s}=this,a=this.length>>1,h=t[i];for(;i<a;){let g=1+(i<<1);const y=g+1;if(y<this.length&&s(t[y],t[g])<0&&(g=y),s(t[g],h)>=0)break;t[i]=t[g],i=g}t[i]=h}};function uf(i,t,s,a,h){Mh(i,t,s,a||i.length-1,h||cf)}function Mh(i,t,s,a,h){for(;a>s;){if(a-s>600){var g=a-s+1,y=t-s+1,v=Math.log(g),b=.5*Math.exp(2*v/3),E=.5*Math.sqrt(v*b*(g-b)/g)*(y-g/2<0?-1:1);Mh(i,t,Math.max(s,Math.floor(t-y*b/g+E)),Math.min(a,Math.floor(t+(g-y)*b/g+E)),h)}var I=i[t],P=s,z=a;for(ia(i,s,t),h(i[a],I)>0&&ia(i,s,a);P<z;){for(ia(i,P,z),P++,z--;h(i[P],I)<0;)P++;for(;h(i[z],I)>0;)z--}h(i[s],I)===0?ia(i,s,z):ia(i,++z,a),z<=t&&(s=z+1),t<=z&&(a=z-1)}}function ia(i,t,s){var a=i[t];i[t]=i[s],i[s]=a}function cf(i,t){return i<t?-1:i>t?1:0}function Ja(i,t){if(i.length<=1)return[i];const s=[];let a,h;for(const g of i){const y=df(g);y!==0&&(g.area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(a&&s.push(a),a=[g]):a.push(g))}if(a&&s.push(a),t>1)for(let g=0;g<s.length;g++)s[g].length<=t||(uf(s[g],t,1,s[g].length-1,hf),s[g]=s[g].slice(0,t));return s}function hf(i,t){return t.area-i.area}function df(i){let t=0;for(let s,a,h=0,g=i.length,y=g-1;h<g;y=h++)s=i[h],a=i[y],t+=(a.x-s.x)*(s.y+a.y);return t}const zh=1/298.257223563,Dh=zh*(2-zh),Rh=Math.PI/180;class Cu{constructor(t){const s=6378.137*Rh*1e3,a=Math.cos(t*Rh),h=1/(1-Dh*(1-a*a)),g=Math.sqrt(h);this.kx=s*g*a,this.ky=s*g*h*(1-Dh)}distance(t,s){const a=this.wrap(t[0]-s[0])*this.kx,h=(t[1]-s[1])*this.ky;return Math.sqrt(a*a+h*h)}pointOnLine(t,s){let a,h,g,y,v=1/0;for(let b=0;b<t.length-1;b++){let E=t[b][0],I=t[b][1],P=this.wrap(t[b+1][0]-E)*this.kx,z=(t[b+1][1]-I)*this.ky,L=0;P===0&&z===0||(L=(this.wrap(s[0]-E)*this.kx*P+(s[1]-I)*this.ky*z)/(P*P+z*z),L>1?(E=t[b+1][0],I=t[b+1][1]):L>0&&(E+=P/this.kx*L,I+=z/this.ky*L)),P=this.wrap(s[0]-E)*this.kx,z=(s[1]-I)*this.ky;const F=P*P+z*z;F<v&&(v=F,a=E,h=I,g=b,y=L)}return{point:[a,h],index:g,t:Math.max(0,Math.min(1,y))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Lh(i,t){return t[0]-i[0]}function Ya(i){return i[1]-i[0]+1}function $n(i,t){return i[1]>=i[0]&&i[1]<t}function Pu(i,t){if(i[0]>i[1])return[null,null];const s=Ya(i);if(t){if(s===2)return[i,null];const h=Math.floor(s/2);return[[i[0],i[0]+h],[i[0]+h,i[1]]]}if(s===1)return[i,null];const a=Math.floor(s/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}function Au(i,t){if(!$n(t,i.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)ks(s,i[a]);return s}function Mu(i){const t=[1/0,1/0,-1/0,-1/0];for(const s of i)for(const a of s)ks(t,a);return t}function Qa(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function zu(i,t,s){if(!Qa(i)||!Qa(t))return NaN;let a=0,h=0;return i[2]<t[0]&&(a=t[0]-i[2]),i[0]>t[2]&&(a=i[0]-t[2]),i[1]>t[3]&&(h=i[1]-t[3]),i[3]<t[1]&&(h=t[1]-i[3]),s.distance([0,0],[a,h])}function Is(i,t,s){const a=s.pointOnLine(t,i);return s.distance(i,a.point)}function Du(i,t,s,a,h){const g=Math.min(Is(i,[s,a],h),Is(t,[s,a],h)),y=Math.min(Is(s,[i,t],h),Is(a,[i,t],h));return Math.min(g,y)}function pf(i,t,s,a,h){if(!$n(t,i.length)||!$n(a,s.length))return 1/0;let g=1/0;for(let y=t[0];y<t[1];++y){const v=i[y],b=i[y+1];for(let E=a[0];E<a[1];++E){const I=s[E],P=s[E+1];if(Ka(v,b,I,P))return 0;g=Math.min(g,Du(v,b,I,P,h))}}return g}function dr(i,t,s,a,h){if(!$n(t,i.length)||!$n(a,s.length))return NaN;let g=1/0;for(let y=t[0];y<=t[1];++y)for(let v=a[0];v<=a[1];++v)if(g=Math.min(g,h.distance(i[y],s[v])),g===0)return g;return g}function ff(i,t,s){if(ro(i,t,!0))return 0;let a=1/0;for(const h of t){const g=h[0],y=h[h.length-1];if(g!==y&&(a=Math.min(a,Is(i,[y,g],s)),a===0))return a;const v=s.pointOnLine(h,i);if(a=Math.min(a,s.distance(i,v.point)),a===0)return a}return a}function St(i,t,s,a){if(!$n(t,i.length))return NaN;for(let g=t[0];g<=t[1];++g)if(ro(i[g],s,!0))return 0;let h=1/0;for(let g=t[0];g<t[1];++g){const y=i[g],v=i[g+1];for(const b of s)for(let E=0,I=b.length,P=I-1;E<I;P=E++){const z=b[P],L=b[E];if(Ka(y,v,z,L))return 0;h=Math.min(h,Du(y,v,z,L,a))}}return h}function el(i,t){for(const s of i)for(const a of s)if(ro(a,t,!0))return!0;return!1}function Xt(i,t,s,a=1/0){const h=Mu(i),g=Mu(t);if(a!==1/0&&zu(h,g,s)>=a)return a;if(as(h,g)){if(el(i,t))return 0}else if(el(t,i))return 0;let y=1/0;for(const v of i)for(let b=0,E=v.length,I=E-1;b<E;I=b++){const P=v[I],z=v[b];for(const L of t)for(let F=0,O=L.length,Z=O-1;F<O;Z=F++){const X=L[Z],de=L[F];if(Ka(P,z,X,de))return 0;y=Math.min(y,Du(P,z,X,de,s))}}return y}function Zt(i,t,s,a,h,g){if(!g)return;const y=zu(Au(a,g),h,s);y<t&&i.push([y,g,[0,0]])}function Cs(i,t,s,a,h,g,y){if(!g||!y)return;const v=zu(Au(a,g),Au(h,y),s);v<t&&i.push([v,g,y])}function na(i,t,s,a,h=1/0){let g=Math.min(a.distance(i[0],s[0][0]),h);if(g===0)return g;const y=new Ah([[0,[0,i.length-1],[0,0]]],Lh),v=Mu(s);for(;y.length>0;){const b=y.pop();if(b[0]>=g)continue;const E=b[1],I=t?50:100;if(Ya(E)<=I){if(!$n(E,i.length))return NaN;if(t){const P=St(i,E,s,a);if(isNaN(P)||P===0)return P;g=Math.min(g,P)}else for(let P=E[0];P<=E[1];++P){const z=ff(i[P],s,a);if(g=Math.min(g,z),g===0)return 0}}else{const P=Pu(E,t);Zt(y,g,a,i,v,P[0]),Zt(y,g,a,i,v,P[1])}}return g}function sa(i,t,s,a,h,g=1/0){let y=Math.min(g,h.distance(i[0],s[0]));if(y===0)return y;const v=new Ah([[0,[0,i.length-1],[0,s.length-1]]],Lh);for(;v.length>0;){const b=v.pop();if(b[0]>=y)continue;const E=b[1],I=b[2],P=t?50:100,z=a?50:100;if(Ya(E)<=P&&Ya(I)<=z){if(!$n(E,i.length)&&$n(I,s.length))return NaN;let L;if(t&&a)L=pf(i,E,s,I,h),y=Math.min(y,L);else if(t&&!a){const F=i.slice(E[0],E[1]+1);for(let O=I[0];O<=I[1];++O)if(L=Is(s[O],F,h),y=Math.min(y,L),y===0)return y}else if(!t&&a){const F=s.slice(I[0],I[1]+1);for(let O=E[0];O<=E[1];++O)if(L=Is(i[O],F,h),y=Math.min(y,L),y===0)return y}else L=dr(i,E,s,I,h),y=Math.min(y,L)}else{const L=Pu(E,t),F=Pu(I,a);Cs(v,y,h,i,s,L[0],F[0]),Cs(v,y,h,i,s,L[0],F[1]),Cs(v,y,h,i,s,L[1],F[0]),Cs(v,y,h,i,s,L[1],F[1])}}return y}function Ru(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Ps{constructor(t,s){this.type=De,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(bs(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new Ps(a,a.features.map(h=>Ru(h.geometry)).flat());if(a.type==="Feature")return new Ps(a,Ru(a.geometry));if("type"in a&&"coordinates"in a)return new Ps(a,Ru(a))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,a){const h=s.geometry(),g=h.flat().map(b=>Eu([b.x,b.y],s.canonical));if(h.length===0)return NaN;const y=new Cu(g[0][1]);let v=1/0;for(const b of a){switch(b.type){case"Point":v=Math.min(v,sa(g,!1,[b.coordinates],!1,y,v));break;case"LineString":v=Math.min(v,sa(g,!1,b.coordinates,!0,y,v));break;case"Polygon":v=Math.min(v,na(g,!1,b.coordinates,y,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,a){const h=s.geometry(),g=h.flat().map(b=>Eu([b.x,b.y],s.canonical));if(h.length===0)return NaN;const y=new Cu(g[0][1]);let v=1/0;for(const b of a){switch(b.type){case"Point":v=Math.min(v,sa(g,!0,[b.coordinates],!1,y,v));break;case"LineString":v=Math.min(v,sa(g,!0,b.coordinates,!0,y,v));break;case"Polygon":v=Math.min(v,na(g,!0,b.coordinates,y,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="Polygon")return function(s,a){const h=s.geometry();if(h.length===0||h[0].length===0)return NaN;const g=Ja(h,0).map(b=>b.map(E=>E.map(I=>Eu([I.x,I.y],s.canonical)))),y=new Cu(g[0][0][0][1]);let v=1/0;for(const b of a)for(const E of g){switch(b.type){case"Point":v=Math.min(v,na([b.coordinates],!1,E,y,v));break;case"LineString":v=Math.min(v,na(b.coordinates,!0,E,y,v));break;case"Polygon":v=Math.min(v,Xt(E,b.coordinates,y,v))}if(v===0)return v}return v}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const io={"==":tf,"!=":wh,">":rf,"<":bh,">=":Sh,"<=":nf,array:nn,at:xu,boolean:nn,case:qa,coalesce:Ha,collator:ra,format:Xa,image:Tu,in:wu,"index-of":Qs,interpolate:fi,"interpolate-hcl":fi,"interpolate-lab":fi,length:ku,let:os,literal:rn,match:bu,number:nn,"number-format":Su,object:nn,slice:ea,step:eo,string:nn,"to-boolean":sn,"to-color":sn,"to-number":sn,"to-string":sn,var:Ot,within:Es,distance:Ps};class ji{constructor(t,s,a,h){this.name=t,this.type=s,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const a=t[0],h=ji.definitions[a];if(!h)return s.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=y.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let b=null;for(const[E,I]of v){b=new Ss(s.registry,oa,s.path,null,s.scope);const P=[];let z=!1;for(let L=1;L<t.length;L++){const F=t[L],O=Array.isArray(E)?E[L-1]:E.type,Z=b.parse(F,1+P.length,O);if(!Z){z=!0;break}P.push(Z)}if(!z)if(Array.isArray(E)&&E.length!==P.length)b.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let L=0;L<P.length;L++){const F=Array.isArray(E)?E[L]:E.type,O=P[L];b.concat(L+1).checkSubtype(F,O.type)}if(b.errors.length===0)return new ji(a,g,I,P)}}if(v.length===1)s.errors.push(...b.errors);else{const E=(v.length?v:y).map(([P])=>{return z=P,Array.isArray(z)?`(${z.map(D).join(", ")})`:`(${D(z.type)}...)`;var z}).join(" | "),I=[];for(let P=1;P<t.length;P++){const z=s.parse(t[P],1+I.length);if(!z)return null;I.push(D(z.type))}s.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(t,s){ji.definitions=s;for(const a in s)t[a]=ji}}function Lu(i,[t,s,a,h]){t=t.evaluate(i),s=s.evaluate(i),a=a.evaluate(i);const g=h?h.evaluate(i):1,y=Ys(t,s,a,g);if(y)throw new gr(y);return new $t(t/255,s/255,a/255,g,!1)}function Bu(i,t){return i in t}function Fu(i,t){const s=t[i];return s===void 0?null:s}function As(i){return{type:i}}function oa(i){if(i instanceof Ot)return oa(i.boundExpression);if(i instanceof ji&&i.name==="error"||i instanceof ra||i instanceof Es||i instanceof Ps)return!1;const t=i instanceof sn||i instanceof nn;let s=!0;return i.eachChild(a=>{s=t?s&&oa(a):s&&a instanceof rn}),!!s&&aa(i)&&la(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function aa(i){if(i instanceof ji&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Es||i instanceof Ps)return!1;let t=!0;return i.eachChild(s=>{t&&!aa(s)&&(t=!1)}),t}function no(i){if(i instanceof ji&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(s=>{t&&!no(s)&&(t=!1)}),t}function la(i,t){if(i instanceof ji&&t.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(a=>{s&&!la(a,t)&&(s=!1)}),s}function tl(i){return{result:"success",value:i}}function so(i){return{result:"error",value:i}}function oo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Bh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Ou(i){return!!i.expression&&i.expression.interpolated}function Lt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function rl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function mf(i){return i}function Fh(i,t){const s=t.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",h=a||!(a||i.property!==void 0),g=i.type||(Ou(t)?"exponential":"interval");if(s||t.type==="padding"){const I=s?$t.parse:Ii.parse;(i=Zr({},i)).stops&&(i.stops=i.stops.map(P=>[P[0],I(P[1])])),i.default=I(i.default?i.default:t.default)}if(i.colorSpace&&(y=i.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var y;let v,b,E;if(g==="exponential")v=Nh;else if(g==="interval")v=il;else if(g==="categorical"){v=Oh,b=Object.create(null);for(const I of i.stops)b[I[0]]=I[1];E=typeof i.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=Vh}if(a){const I={},P=[];for(let F=0;F<i.stops.length;F++){const O=i.stops[F],Z=O[0].zoom;I[Z]===void 0&&(I[Z]={zoom:Z,type:i.type,property:i.property,default:i.default,stops:[]},P.push(Z)),I[Z].stops.push([O[0].value,O[1]])}const z=[];for(const F of P)z.push([I[F].zoom,Fh(I[F],t)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:fi.interpolationFactor.bind(void 0,L),zoomStops:z.map(F=>F[0]),evaluate:({zoom:F},O)=>Nh({stops:z,base:i.base},t,F).evaluate(F,O)}}if(h){const I=g==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:fi.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map(P=>P[0]),evaluate:({zoom:P})=>v(i,t,P,b,E)}}return{kind:"source",evaluate(I,P){const z=P&&P.properties?P.properties[i.property]:void 0;return z===void 0?ao(i.default,t.default):v(i,t,z,b,E)}}}function ao(i,t,s){return i!==void 0?i:t!==void 0?t:s!==void 0?s:void 0}function Oh(i,t,s,a,h){return ao(typeof s===h?a[s]:void 0,i.default,t.default)}function il(i,t,s){if(Lt(s)!=="number")return ao(i.default,t.default);const a=i.stops.length;if(a===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[a-1][0])return i.stops[a-1][1];const h=Za(i.stops.map(g=>g[0]),s);return i.stops[h][1]}function Nh(i,t,s){const a=i.base!==void 0?i.base:1;if(Lt(s)!=="number")return ao(i.default,t.default);const h=i.stops.length;if(h===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[h-1][0])return i.stops[h-1][1];const g=Za(i.stops.map(I=>I[0]),s),y=function(I,P,z,L){const F=L-z,O=I-z;return F===0?0:P===1?O/F:(Math.pow(P,O)-1)/(Math.pow(P,F)-1)}(s,a,i.stops[g][0],i.stops[g+1][0]),v=i.stops[g][1],b=i.stops[g+1][1],E=pi[t.type]||mf;return typeof v.evaluate=="function"?{evaluate(...I){const P=v.evaluate.apply(void 0,I),z=b.evaluate.apply(void 0,I);if(P!==void 0&&z!==void 0)return E(P,z,y,i.colorSpace)}}:E(v,b,y,i.colorSpace)}function Vh(i,t,s){switch(t.type){case"color":s=$t.parse(s);break;case"formatted":s=Ei.fromString(s.toString());break;case"resolvedImage":s=Ci.fromString(s.toString());break;case"padding":s=Ii.parse(s);break;default:Lt(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return ao(s,i.default,t.default)}ji.register(io,{error:[{kind:"error"},[xt],(i,[t])=>{throw new gr(t.evaluate(i))}],typeof:[xt,[ft],(i,[t])=>D(kr(t.evaluate(i)))],"to-rgba":[R(De,4),[di],(i,[t])=>{const[s,a,h,g]=t.evaluate(i).rgb;return[255*s,255*a,255*h,g]}],rgb:[di,[De,De,De],Lu],rgba:[di,[De,De,De,De],Lu],has:{type:ut,overloads:[[[xt],(i,[t])=>Bu(t.evaluate(i),i.properties())],[[xt,tn],(i,[t,s])=>Bu(t.evaluate(i),s.evaluate(i))]]},get:{type:ft,overloads:[[[xt],(i,[t])=>Fu(t.evaluate(i),i.properties())],[[xt,tn],(i,[t,s])=>Fu(t.evaluate(i),s.evaluate(i))]]},"feature-state":[ft,[xt],(i,[t])=>Fu(t.evaluate(i),i.featureState||{})],properties:[tn,[],i=>i.properties()],"geometry-type":[xt,[],i=>i.geometryType()],id:[ft,[],i=>i.id()],zoom:[De,[],i=>i.globals.zoom],"heatmap-density":[De,[],i=>i.globals.heatmapDensity||0],"line-progress":[De,[],i=>i.globals.lineProgress||0],accumulated:[ft,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[De,As(De),(i,t)=>{let s=0;for(const a of t)s+=a.evaluate(i);return s}],"*":[De,As(De),(i,t)=>{let s=1;for(const a of t)s*=a.evaluate(i);return s}],"-":{type:De,overloads:[[[De,De],(i,[t,s])=>t.evaluate(i)-s.evaluate(i)],[[De],(i,[t])=>-t.evaluate(i)]]},"/":[De,[De,De],(i,[t,s])=>t.evaluate(i)/s.evaluate(i)],"%":[De,[De,De],(i,[t,s])=>t.evaluate(i)%s.evaluate(i)],ln2:[De,[],()=>Math.LN2],pi:[De,[],()=>Math.PI],e:[De,[],()=>Math.E],"^":[De,[De,De],(i,[t,s])=>Math.pow(t.evaluate(i),s.evaluate(i))],sqrt:[De,[De],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[De,[De],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[De,[De],(i,[t])=>Math.log(t.evaluate(i))],log2:[De,[De],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[De,[De],(i,[t])=>Math.sin(t.evaluate(i))],cos:[De,[De],(i,[t])=>Math.cos(t.evaluate(i))],tan:[De,[De],(i,[t])=>Math.tan(t.evaluate(i))],asin:[De,[De],(i,[t])=>Math.asin(t.evaluate(i))],acos:[De,[De],(i,[t])=>Math.acos(t.evaluate(i))],atan:[De,[De],(i,[t])=>Math.atan(t.evaluate(i))],min:[De,As(De),(i,t)=>Math.min(...t.map(s=>s.evaluate(i)))],max:[De,As(De),(i,t)=>Math.max(...t.map(s=>s.evaluate(i)))],abs:[De,[De],(i,[t])=>Math.abs(t.evaluate(i))],round:[De,[De],(i,[t])=>{const s=t.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[De,[De],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[De,[De],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[ut,[xt,ft],(i,[t,s])=>i.properties()[t.value]===s.value],"filter-id-==":[ut,[ft],(i,[t])=>i.id()===t.value],"filter-type-==":[ut,[xt],(i,[t])=>i.geometryType()===t.value],"filter-<":[ut,[xt,ft],(i,[t,s])=>{const a=i.properties()[t.value],h=s.value;return typeof a==typeof h&&a<h}],"filter-id-<":[ut,[ft],(i,[t])=>{const s=i.id(),a=t.value;return typeof s==typeof a&&s<a}],"filter->":[ut,[xt,ft],(i,[t,s])=>{const a=i.properties()[t.value],h=s.value;return typeof a==typeof h&&a>h}],"filter-id->":[ut,[ft],(i,[t])=>{const s=i.id(),a=t.value;return typeof s==typeof a&&s>a}],"filter-<=":[ut,[xt,ft],(i,[t,s])=>{const a=i.properties()[t.value],h=s.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[ut,[ft],(i,[t])=>{const s=i.id(),a=t.value;return typeof s==typeof a&&s<=a}],"filter->=":[ut,[xt,ft],(i,[t,s])=>{const a=i.properties()[t.value],h=s.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[ut,[ft],(i,[t])=>{const s=i.id(),a=t.value;return typeof s==typeof a&&s>=a}],"filter-has":[ut,[ft],(i,[t])=>t.value in i.properties()],"filter-has-id":[ut,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ut,[R(xt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[ut,[R(ft)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[ut,[xt,R(ft)],(i,[t,s])=>s.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[ut,[xt,R(ft)],(i,[t,s])=>function(a,h,g,y){for(;g<=y;){const v=g+y>>1;if(h[v]===a)return!0;h[v]>a?y=v-1:g=v+1}return!1}(i.properties()[t.value],s.value,0,s.value.length-1)],all:{type:ut,overloads:[[[ut,ut],(i,[t,s])=>t.evaluate(i)&&s.evaluate(i)],[As(ut),(i,t)=>{for(const s of t)if(!s.evaluate(i))return!1;return!0}]]},any:{type:ut,overloads:[[[ut,ut],(i,[t,s])=>t.evaluate(i)||s.evaluate(i)],[As(ut),(i,t)=>{for(const s of t)if(s.evaluate(i))return!0;return!1}]]},"!":[ut,[ut],(i,[t])=>!t.evaluate(i)],"is-supported-script":[ut,[xt],(i,[t])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(t.evaluate(i))}],upcase:[xt,[xt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[xt,[xt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[xt,As(ft),(i,t)=>t.map(s=>Qo(s.evaluate(i))).join("")],"resolved-locale":[xt,[Sn],(i,[t])=>t.evaluate(i).resolvedLocale()]});class nl{constructor(t,s){var a;this.expression=t,this._warningHistory={},this._evaluator=new $a,this._defaultValue=s?(a=s).type==="color"&&rl(a.default)?new $t(0,0,0,0):a.type==="color"?$t.parse(a.default)||null:a.type==="padding"?Ii.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?Vi.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,a,h,g,y){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,s,a,h,g,y){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new gr(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function sl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in io}function lo(i,t){const s=new Ss(io,oa,[],t?function(h){const g={color:di,string:xt,number:De,enum:xt,boolean:ut,formatted:Un,padding:ss,resolvedImage:Tn,variableAnchorOffsetCollection:W};return h.type==="array"?R(g[h.value]||ft,h.length):g[h.type]}(t):void 0),a=s.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?tl(new nl(a,t)):so(s.errors)}class uo{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!no(s.expression)}evaluateWithoutErrorHandling(t,s,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,s,a,h,g,y)}evaluate(t,s,a,h,g,y){return this._styleExpression.evaluate(t,s,a,h,g,y)}}class co{constructor(t,s,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!no(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,s,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,s,a,h,g,y)}evaluate(t,s,a,h,g,y){return this._styleExpression.evaluate(t,s,a,h,g,y)}interpolationFactor(t,s,a){return this.interpolationType?fi.interpolationFactor(this.interpolationType,t,s,a):0}}function Nu(i,t){const s=lo(i,t);if(s.result==="error")return s;const a=s.value.expression,h=aa(a);if(!h&&!oo(t))return so([new Or("","data expressions not supported")]);const g=la(a,["zoom"]);if(!g&&!Bh(t))return so([new Or("","zoom expressions not supported")]);const y=ua(a);return y||g?y instanceof Or?so([y]):y instanceof fi&&!Ou(t)?so([new Or("",'"interpolate" expressions cannot be used with this property')]):tl(y?new co(h?"camera":"composite",s.value,y.labels,y instanceof fi?y.interpolation:void 0):new uo(h?"constant":"source",s.value)):so([new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ho{constructor(t,s){this._parameters=t,this._specification=s,Zr(this,Fh(this._parameters,this._specification))}static deserialize(t){return new ho(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ua(i){let t=null;if(i instanceof os)t=ua(i.result);else if(i instanceof Ha){for(const s of i.args)if(t=ua(s),t)break}else(i instanceof eo||i instanceof fi)&&i.input instanceof ji&&i.input.name==="zoom"&&(t=i);return t instanceof Or||i.eachChild(s=>{const a=ua(s);a instanceof Or?t=a:!t&&a?t=new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ol(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!ol(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const al={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vu(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ol(i)||(i=ll(i));const t=lo(i,al);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,a,h)=>t.value.evaluate(s,a,{},h),needGeometry:jh(i)}}function gf(i,t){return i<t?-1:i>t?1:0}function jh(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(jh(i[t]))return!0;return!1}function ll(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?ju(i[1],i[2],"=="):t==="!="?Gr(ju(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ju(i[1],i[2],t):t==="any"?(s=i.slice(1),["any"].concat(s.map(ll))):t==="all"?["all"].concat(i.slice(1).map(ll)):t==="none"?["all"].concat(i.slice(1).map(ll).map(Gr)):t==="in"?ca(i[1],i.slice(2)):t==="!in"?Gr(ca(i[1],i.slice(2))):t==="has"?ha(i[1]):t!=="!has"||Gr(ha(i[1]));var s}function ju(i,t,s){switch(i){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,i,t]}}function ca(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",i,["literal",t.sort(gf)]]:["filter-in-small",i,["literal",t]]}}function ha(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Gr(i){return["!",i]}function Ms(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let h="[";for(const g of i)h+=`${Ms(g)},`;return`${h}]`}const s=Object.keys(i).sort();let a="{";for(let h=0;h<s.length;h++)a+=`${JSON.stringify(s[h])}:${Ms(i[s[h]])},`;return`${a}}`}function Uh(i){let t="";for(const s of at)t+=`/${Ms(i[s])}`;return t}function $h(i){const t=i.value;return t?[new ke(i.key,t,"constants have been deprecated as of v8")]:[]}function pr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function on(i){if(Array.isArray(i))return i.map(on);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const s in i)t[s]=on(i[s]);return t}return pr(i)}function Pi(i){const t=i.key,s=i.value,a=i.valueSpec||{},h=i.objectElementValidators||{},g=i.style,y=i.styleSpec,v=i.validateSpec;let b=[];const E=Lt(s);if(E!=="object")return[new ke(t,s,`object expected, ${E} found`)];for(const I in s){const P=I.split(".")[0],z=a[P]||a["*"];let L;if(h[P])L=h[P];else if(a[P])L=v;else if(h["*"])L=h["*"];else{if(!a["*"]){b.push(new ke(t,s[I],`unknown property "${I}"`));continue}L=v}b=b.concat(L({key:(t&&`${t}.`)+I,value:s[I],valueSpec:z,style:g,styleSpec:y,object:s,objectKey:I,validateSpec:v},s))}for(const I in a)h[I]||a[I].required&&a[I].default===void 0&&s[I]===void 0&&b.push(new ke(t,s,`missing required property "${I}"`));return b}function da(i){const t=i.value,s=i.valueSpec,a=i.style,h=i.styleSpec,g=i.key,y=i.arrayElementValidator||i.validateSpec;if(Lt(t)!=="array")return[new ke(g,t,`array expected, ${Lt(t)} found`)];if(s.length&&t.length!==s.length)return[new ke(g,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new ke(g,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let v={type:s.value,values:s.values};h.$version<7&&(v.function=s.function),Lt(s.value)==="object"&&(v=s.value);let b=[];for(let E=0;E<t.length;E++)b=b.concat(y({array:t,arrayIndex:E,value:t[E],valueSpec:v,validateSpec:i.validateSpec,style:a,styleSpec:h,key:`${g}[${E}]`}));return b}function Uu(i){const t=i.key,s=i.value,a=i.valueSpec;let h=Lt(s);return h==="number"&&s!=s&&(h="NaN"),h!=="number"?[new ke(t,s,`number expected, ${h} found`)]:"minimum"in a&&s<a.minimum?[new ke(t,s,`${s} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&s>a.maximum?[new ke(t,s,`${s} is greater than the maximum value ${a.maximum}`)]:[]}function ul(i){const t=i.valueSpec,s=pr(i.value.type);let a,h,g,y={};const v=s!=="categorical"&&i.value.property===void 0,b=!v,E=Lt(i.value.stops)==="array"&&Lt(i.value.stops[0])==="array"&&Lt(i.value.stops[0][0])==="object",I=Pi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(L){if(s==="identity")return[new ke(L.key,L.value,'identity function may not have a "stops" property')];let F=[];const O=L.value;return F=F.concat(da({key:L.key,value:O,valueSpec:L.valueSpec,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:P})),Lt(O)==="array"&&O.length===0&&F.push(new ke(L.key,O,"array must have at least one stop")),F},default:function(L){return L.validateSpec({key:L.key,value:L.value,valueSpec:t,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec})}}});return s==="identity"&&v&&I.push(new ke(i.key,i.value,'missing required property "property"')),s==="identity"||i.value.stops||I.push(new ke(i.key,i.value,'missing required property "stops"')),s==="exponential"&&i.valueSpec.expression&&!Ou(i.valueSpec)&&I.push(new ke(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!oo(i.valueSpec)?I.push(new ke(i.key,i.value,"property functions not supported")):v&&!Bh(i.valueSpec)&&I.push(new ke(i.key,i.value,"zoom functions not supported"))),s!=="categorical"&&!E||i.value.property!==void 0||I.push(new ke(i.key,i.value,'"property" property is required')),I;function P(L){let F=[];const O=L.value,Z=L.key;if(Lt(O)!=="array")return[new ke(Z,O,`array expected, ${Lt(O)} found`)];if(O.length!==2)return[new ke(Z,O,`array length 2 expected, length ${O.length} found`)];if(E){if(Lt(O[0])!=="object")return[new ke(Z,O,`object expected, ${Lt(O[0])} found`)];if(O[0].zoom===void 0)return[new ke(Z,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new ke(Z,O,"object stop key must have value")];if(g&&g>pr(O[0].zoom))return[new ke(Z,O[0].zoom,"stop zoom values must appear in ascending order")];pr(O[0].zoom)!==g&&(g=pr(O[0].zoom),h=void 0,y={}),F=F.concat(Pi({key:`${Z}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Uu,value:z}}))}else F=F.concat(z({key:`${Z}[0]`,value:O[0],validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec},O));return sl(on(O[1]))?F.concat([new ke(`${Z}[1]`,O[1],"expressions are not allowed in function stops.")]):F.concat(L.validateSpec({key:`${Z}[1]`,value:O[1],valueSpec:t,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec}))}function z(L,F){const O=Lt(L.value),Z=pr(L.value),X=L.value!==null?L.value:F;if(a){if(O!==a)return[new ke(L.key,X,`${O} stop domain type must match previous stop domain type ${a}`)]}else a=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new ke(L.key,X,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&s!=="categorical"){let de=`number expected, ${O} found`;return oo(t)&&s===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(L.key,X,de)]}return s!=="categorical"||O!=="number"||isFinite(Z)&&Math.floor(Z)===Z?s!=="categorical"&&O==="number"&&h!==void 0&&Z<h?[new ke(L.key,X,"stop domain values must appear in ascending order")]:(h=Z,s==="categorical"&&Z in y?[new ke(L.key,X,"stop domain values must be unique")]:(y[Z]=!0,[])):[new ke(L.key,X,`integer expected, found ${Z}`)]}}function po(i){const t=(i.expressionContext==="property"?Nu:lo)(on(i.value),i.valueSpec);if(t.result==="error")return t.value.map(a=>new ke(`${i.key}${a.key}`,i.value,a.message));const s=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!s.outputDefined())return[new ke(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!no(s))return[new ke(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!no(s))return[new ke(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!la(s,["zoom","feature-state"]))return[new ke(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!aa(s))return[new ke(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qn(i){const t=i.key,s=i.value,a=i.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(pr(s))===-1&&h.push(new ke(t,s,`expected one of [${a.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(a.values).indexOf(pr(s))===-1&&h.push(new ke(t,s,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(s)} found`)),h}function $u(i){return ol(on(i.value))?po(Zr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):cl(i)}function cl(i){const t=i.value,s=i.key;if(Lt(t)!=="array")return[new ke(s,t,`array expected, ${Lt(t)} found`)];const a=i.styleSpec;let h,g=[];if(t.length<1)return[new ke(s,t,"filter array must have at least 1 element")];switch(g=g.concat(qn({key:`${s}[0]`,value:t[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),pr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&pr(t[1])==="$type"&&g.push(new ke(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new ke(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Lt(t[1]),h!=="string"&&g.push(new ke(`${s}[1]`,t[1],`string expected, ${h} found`)));for(let y=2;y<t.length;y++)h=Lt(t[y]),pr(t[1])==="$type"?g=g.concat(qn({key:`${s}[${y}]`,value:t[y],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new ke(`${s}[${y}]`,t[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)g=g.concat(cl({key:`${s}[${y}]`,value:t[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Lt(t[1]),t.length!==2?g.push(new ke(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new ke(`${s}[1]`,t[1],`string expected, ${h} found`))}return g}function qu(i,t){const s=i.key,a=i.validateSpec,h=i.style,g=i.styleSpec,y=i.value,v=i.objectKey,b=g[`${t}_${i.layerType}`];if(!b)return[];const E=v.match(/^(.*)-transition$/);if(t==="paint"&&E&&b[E[1]]&&b[E[1]].transition)return a({key:s,value:y,valueSpec:g.transition,style:h,styleSpec:g});const I=i.valueSpec||b[v];if(!I)return[new ke(s,y,`unknown property "${v}"`)];let P;if(Lt(y)==="string"&&oo(I)&&!I.tokens&&(P=/^{([^}]+)}$/.exec(y)))return[new ke(s,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const z=[];return i.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&z.push(new ke(s,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&rl(on(y))&&pr(y.type)==="identity"&&z.push(new ke(s,y,'"text-font" does not support identity functions'))),z.concat(a({key:i.key,value:y,valueSpec:I,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function hl(i){return qu(i,"paint")}function Zu(i){return qu(i,"layout")}function Gu(i){let t=[];const s=i.value,a=i.key,h=i.style,g=i.styleSpec;s.type||s.ref||t.push(new ke(a,s,'either "type" or "ref" is required'));let y=pr(s.type);const v=pr(s.ref);if(s.id){const b=pr(s.id);for(let E=0;E<i.arrayIndex;E++){const I=h.layers[E];pr(I.id)===b&&t.push(new ke(a,s.id,`duplicate layer id "${s.id}", previously used at line ${I.id.__line__}`))}}if("ref"in s){let b;["type","source","source-layer","filter","layout"].forEach(E=>{E in s&&t.push(new ke(a,s[E],`"${E}" is prohibited for ref layers`))}),h.layers.forEach(E=>{pr(E.id)===v&&(b=E)}),b?b.ref?t.push(new ke(a,s.ref,"ref cannot reference another ref layer")):y=pr(b.type):t.push(new ke(a,s.ref,`ref layer "${v}" not found`))}else if(y!=="background")if(s.source){const b=h.sources&&h.sources[s.source],E=b&&pr(b.type);b?E==="vector"&&y==="raster"?t.push(new ke(a,s.source,`layer "${s.id}" requires a raster source`)):E!=="raster-dem"&&y==="hillshade"?t.push(new ke(a,s.source,`layer "${s.id}" requires a raster-dem source`)):E==="raster"&&y!=="raster"?t.push(new ke(a,s.source,`layer "${s.id}" requires a vector source`)):E!=="vector"||s["source-layer"]?E==="raster-dem"&&y!=="hillshade"?t.push(new ke(a,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!s.paint||!s.paint["line-gradient"]||E==="geojson"&&b.lineMetrics||t.push(new ke(a,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ke(a,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new ke(a,s.source,`source "${s.source}" not found`))}else t.push(new ke(a,s,'missing required property "source"'));return t=t.concat(Pi({key:a,value:s,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:s.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:s,objectKey:"type"}),filter:$u,layout:b=>Pi({layer:s,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":E=>Zu(Zr({layerType:y},E))}}),paint:b=>Pi({layer:s,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":E=>hl(Zr({layerType:y},E))}})}})),t}function zs(i){const t=i.value,s=i.key,a=Lt(t);return a!=="string"?[new ke(s,t,`string expected, ${a} found`)]:[]}const dl={promoteId:function({key:i,value:t}){if(Lt(t)==="string")return zs({key:i,value:t});{const s=[];for(const a in t)s.push(...zs({key:`${i}.${a}`,value:t[a]}));return s}}};function pa(i){const t=i.value,s=i.key,a=i.styleSpec,h=i.style,g=i.validateSpec;if(!t.type)return[new ke(s,t,'"type" is required')];const y=pr(t.type);let v;switch(y){case"vector":case"raster":return v=Pi({key:s,value:t,valueSpec:a[`source_${y.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:dl,validateSpec:g}),v;case"raster-dem":return v=function(b){var E;const I=(E=b.sourceName)!==null&&E!==void 0?E:"",P=b.value,z=b.styleSpec,L=z.source_raster_dem,F=b.style;let O=[];const Z=Lt(P);if(P===void 0)return O;if(Z!=="object")return O.push(new ke("source_raster_dem",P,`object expected, ${Z} found`)),O;const X=pr(P.encoding)==="custom",de=["redFactor","greenFactor","blueFactor","baseShift"],re=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const ue in P)!X&&de.includes(ue)?O.push(new ke(ue,P[ue],`In "${I}": "${ue}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):L[ue]?O=O.concat(b.validateSpec({key:ue,value:P[ue],valueSpec:L[ue],validateSpec:b.validateSpec,style:F,styleSpec:z})):O.push(new ke(ue,P[ue],`unknown property "${ue}"`));return O}({sourceName:s,value:t,style:i.style,styleSpec:a,validateSpec:g}),v;case"geojson":if(v=Pi({key:s,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:g,objectElementValidators:dl}),t.cluster)for(const b in t.clusterProperties){const[E,I]=t.clusterProperties[b],P=typeof E=="string"?[E,["accumulated"],["get",b]]:E;v.push(...po({key:`${s}.${b}.map`,value:I,expressionContext:"cluster-map"})),v.push(...po({key:`${s}.${b}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return v;case"video":return Pi({key:s,value:t,valueSpec:a.source_video,style:h,validateSpec:g,styleSpec:a});case"image":return Pi({key:s,value:t,valueSpec:a.source_image,style:h,validateSpec:g,styleSpec:a});case"canvas":return[new ke(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qn({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Hu(i){const t=i.value,s=i.styleSpec,a=s.light,h=i.style;let g=[];const y=Lt(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new ke("light",t,`object expected, ${y} found`)]),g;for(const v in t){const b=v.match(/^(.*)-transition$/);g=g.concat(b&&a[b[1]]&&a[b[1]].transition?i.validateSpec({key:v,value:t[v],valueSpec:s.transition,validateSpec:i.validateSpec,style:h,styleSpec:s}):a[v]?i.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:i.validateSpec,style:h,styleSpec:s}):[new ke(v,t[v],`unknown property "${v}"`)])}return g}function Wu(i){const t=i.value,s=i.styleSpec,a=s.sky,h=i.style,g=Lt(t);if(t===void 0)return[];if(g!=="object")return[new ke("sky",t,`object expected, ${g} found`)];let y=[];for(const v in t)y=y.concat(a[v]?i.validateSpec({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:s}):[new ke(v,t[v],`unknown property "${v}"`)]);return y}function Xu(i){const t=i.value,s=i.styleSpec,a=s.terrain,h=i.style;let g=[];const y=Lt(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new ke("terrain",t,`object expected, ${y} found`)]),g;for(const v in t)g=g.concat(a[v]?i.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:i.validateSpec,style:h,styleSpec:s}):[new ke(v,t[v],`unknown property "${v}"`)]);return g}function Ku(i){let t=[];const s=i.value,a=i.key;if(Array.isArray(s)){const h=[],g=[];for(const y in s)s[y].id&&h.includes(s[y].id)&&t.push(new ke(a,s,`all the sprites' ids must be unique, but ${s[y].id} is duplicated`)),h.push(s[y].id),s[y].url&&g.includes(s[y].url)&&t.push(new ke(a,s,`all the sprites' URLs must be unique, but ${s[y].url} is duplicated`)),g.push(s[y].url),t=t.concat(Pi({key:`${a}[${y}]`,value:s[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return zs({key:a,value:s})}const pl={"*":()=>[],array:da,boolean:function(i){const t=i.value,s=i.key,a=Lt(t);return a!=="boolean"?[new ke(s,t,`boolean expected, ${a} found`)]:[]},number:Uu,color:function(i){const t=i.key,s=i.value,a=Lt(s);return a!=="string"?[new ke(t,s,`color expected, ${a} found`)]:$t.parse(String(s))?[]:[new ke(t,s,`color expected, "${s}" found`)]},constants:$h,enum:qn,filter:$u,function:ul,layer:Gu,object:Pi,source:pa,light:Hu,sky:Wu,terrain:Xu,projection:function(i){const t=i.value,s=i.styleSpec,a=s.projection,h=i.style,g=Lt(t);if(t===void 0)return[];if(g!=="object")return[new ke("projection",t,`object expected, ${g} found`)];let y=[];for(const v in t)y=y.concat(a[v]?i.validateSpec({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:s}):[new ke(v,t[v],`unknown property "${v}"`)]);return y},string:zs,formatted:function(i){return zs(i).length===0?[]:po(i)},resolvedImage:function(i){return zs(i).length===0?[]:po(i)},padding:function(i){const t=i.key,s=i.value;if(Lt(s)==="array"){if(s.length<1||s.length>4)return[new ke(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const a={type:"number"};let h=[];for(let g=0;g<s.length;g++)h=h.concat(i.validateSpec({key:`${t}[${g}]`,value:s[g],validateSpec:i.validateSpec,valueSpec:a}));return h}return Uu({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,s=i.value,a=Lt(s),h=i.styleSpec;if(a!=="array"||s.length<1||s.length%2!=0)return[new ke(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<s.length;y+=2)g=g.concat(qn({key:`${t}[${y}]`,value:s[y],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(da({key:`${t}[${y+1}]`,value:s[y+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:h}));return g},sprite:Ku};function fa(i){const t=i.value,s=i.valueSpec,a=i.styleSpec;return i.validateSpec=fa,s.expression&&rl(pr(t))?ul(i):s.expression&&sl(on(t))?po(i):s.type&&pl[s.type]?pl[s.type](i):Pi(Zr({},i,{valueSpec:s.type?a[s.type]:s}))}function qh(i){const t=i.value,s=i.key,a=zs(i);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new ke(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new ke(s,t,'"glyphs" url must include a "{range}" token'))),a}function Ui(i,t=ge){let s=[];return s=s.concat(fa({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:fa,objectElementValidators:{glyphs:qh,"*":()=>[]}})),i.constants&&(s=s.concat($h({key:"constants",value:i.constants}))),Ju(s)}function En(i){return function(t){return i({...t,validateSpec:fa})}}function Ju(i){return[].concat(i).sort((t,s)=>t.line-s.line)}function an(i){return function(...t){return Ju(i.apply(this,t))}}Ui.source=an(En(pa)),Ui.sprite=an(En(Ku)),Ui.glyphs=an(En(qh)),Ui.light=an(En(Hu)),Ui.sky=an(En(Wu)),Ui.terrain=an(En(Xu)),Ui.layer=an(En(Gu)),Ui.filter=an(En($u)),Ui.paintProperty=an(En(hl)),Ui.layoutProperty=an(En(Zu));const Ds=Ui,yf=Ds.light,_f=Ds.sky,Zh=Ds.paintProperty,Gh=Ds.layoutProperty;function Yu(i,t){let s=!1;if(t&&t.length)for(const a of t)i.fire(new bn(new Error(a.message))),s=!0;return s}class fo{constructor(t,s,a){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(s=y[1])+2*(a=y[2]);for(let b=0;b<this.d*this.d;b++){const E=y[3+b],I=y[3+b+1];h.push(E===I?null:y.subarray(E,I))}const v=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],v),this.bboxes=y.subarray(v),this.insert=this._insertReadonly}else{this.d=s+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=a,this.scale=s/t,this.uid=0;const g=a/s*t;this.min=-g,this.max=t+g}insert(t,s,a,h,g){this._forEachCell(s,a,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,a,h,g,y){this.cells[g].push(y)}query(t,s,a,h,g){const y=this.min,v=this.max;if(t<=y&&s<=y&&v<=a&&v<=h&&!g)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,s,a,h,this._queryCell,b,{},g),b}}_queryCell(t,s,a,h,g,y,v,b){const E=this.cells[g];if(E!==null){const I=this.keys,P=this.bboxes;for(let z=0;z<E.length;z++){const L=E[z];if(v[L]===void 0){const F=4*L;(b?b(P[F+0],P[F+1],P[F+2],P[F+3]):t<=P[F+2]&&s<=P[F+3]&&a>=P[F+0]&&h>=P[F+1])?(v[L]=!0,y.push(I[L])):v[L]=!1}}}}_forEachCell(t,s,a,h,g,y,v,b){const E=this._convertToCellCoord(t),I=this._convertToCellCoord(s),P=this._convertToCellCoord(a),z=this._convertToCellCoord(h);for(let L=E;L<=P;L++)for(let F=I;F<=z;F++){const O=this.d*F+L;if((!b||b(this._convertFromCellCoord(L),this._convertFromCellCoord(F),this._convertFromCellCoord(L+1),this._convertFromCellCoord(F+1)))&&g.call(this,t,s,a,h,O,y,v,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const h=new Int32Array(s+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=s;for(let y=0;y<t.length;y++){const v=t[y];h[3+y]=g,h.set(v,g),g+=v.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,s){const a=t.toArrayBuffer();return s&&s.push(a),{buffer:a}}static deserialize(t){return new fo(t.buffer)}}const $i={};function Ge(i,t,s={}){if($i[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),$i[i]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}Ge("Object",Object),Ge("TransferableGridIndex",fo),Ge("Color",$t),Ge("Error",Error),Ge("AJAXError",Sr),Ge("ResolvedImage",Ci),Ge("StylePropertyFunction",ho),Ge("StyleExpression",nl,{omit:["_evaluator"]}),Ge("ZoomDependentExpression",co),Ge("ZoomConstantExpression",uo),Ge("CompoundExpression",ji,{omit:["_evaluate"]});for(const i in io)io[i]._classRegistryKey||Ge(`Expression_${i}`,io[i]);function fl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Qu(i){return i.$name||i.constructor._classRegistryKey}function Hh(i){return!function(t){if(t===null||typeof t!="object")return!1;const s=Qu(t);return!(!s||s==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||fl(i)||Br(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function mo(i,t){if(Hh(i))return(fl(i)||Br(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const g=[];for(const y of i)g.push(mo(y,t));return g}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const s=Qu(i);if(!s)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!$i[s])throw new Error(`${s} is not registered.`);const{klass:a}=$i[s],h=a.serialize?a.serialize(i,t):{};if(a.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||$i[s].omit.indexOf(g)>=0)continue;const y=i[g];h[g]=$i[s].shallow.indexOf(g)>=0?y:mo(y,t)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(h.$name=s),h}function go(i){if(Hh(i))return i;if(Array.isArray(i))return i.map(go);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Qu(i)||"Object";if(!$i[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=$i[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(i);const a=Object.create(s.prototype);for(const h of Object.keys(i)){if(h==="$name")continue;const g=i[h];a[h]=$i[t].shallow.indexOf(h)>=0?g:go(g)}return a}class ec{constructor(){this.first=!0}update(t,s){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const Pt={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function tc(i){for(const t of i)if(ic(t.charCodeAt(0)))return!0;return!1}function vf(i){for(const t of i)if(!yo(t.charCodeAt(0)))return!1;return!0}function rc(i){const t=i.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(t.join("|"),"u")}const xf=rc(["Arab","Dupl","Mong","Ougr","Syrc"]);function yo(i){return!xf.test(String.fromCodePoint(i))}const Wh=rc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ic(i){return!(i!==746&&i!==747&&(i<4352||!(Pt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Pt["CJK Compatibility"](i)||Pt["CJK Strokes"](i)||!(!Pt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Pt["Enclosed CJK Letters and Months"](i)||Pt["Ideographic Description Characters"](i)||Pt.Kanbun(i)||Pt.Katakana(i)&&i!==12540||!(!Pt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Pt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Pt["Vertical Forms"](i)||Pt["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||Wh.test(String.fromCodePoint(i)))))}function Xh(i){return!(ic(i)||function(t){return!!(Pt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Pt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Pt["Letterlike Symbols"](t)||Pt["Number Forms"](t)||Pt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Pt["Control Pictures"](t)&&t!==9251||Pt["Optical Character Recognition"](t)||Pt["Enclosed Alphanumerics"](t)||Pt["Geometric Shapes"](t)||Pt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Pt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Pt["CJK Symbols and Punctuation"](t)||Pt.Katakana(t)||Pt["Private Use Area"](t)||Pt["CJK Compatibility Forms"](t)||Pt["Small Form Variants"](t)||Pt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const wf=rc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function nc(i){return wf.test(String.fromCodePoint(i))}function bf(i,t){return!(!t&&nc(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Pt.Khmer(i))}function Sf(i){for(const t of i)if(nc(t.charCodeAt(0)))return!0;return!1}const Ai=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Qt{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ec,this.transition={})}isSupportedScript(t){return function(s,a){for(const h of s)if(!bf(h.charCodeAt(0),a))return!1;return!0}(t,Ai.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*s}}}class _o{constructor(t,s){this.property=t,this.value=s,this.expression=function(a,h){if(rl(a))return new ho(a,h);if(sl(a)){const g=Nu(a,h);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=a;return h.type==="color"&&typeof a=="string"?g=$t.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(g=Vi.parse(a)):g=Ii.parse(a),{kind:"constant",evaluate:()=>g}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,a){return this.property.possiblyEvaluate(this,t,s,a)}}class ml{constructor(t){this.property=t,this.value=new _o(t,void 0)}transitioned(t,s){return new Kh(this.property,this.value,s,Fe({},t.transition,this.transition),t.now)}untransitioned(){return new Kh(this.property,this.value,null,{},0)}}class gl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return mt(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ml(this._values[t].property)),this._values[t].value=new _o(this._values[t].property,s===null?void 0:mt(s))}getTransition(t){return mt(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ml(this._values[t].property)),this._values[t].transition=mt(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const a=this.getValue(s);a!==void 0&&(t[s]=a);const h=this.getTransition(s);h!==void 0&&(t[`${s}-transition`]=h)}return t}transitioned(t,s){const a=new ma(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,s._values[h]);return a}untransitioned(){const t=new ma(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class Kh{constructor(t,s,a,h,g){this.property=t,this.value=s,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,s,a){const h=t.now||0,g=this.value.possiblyEvaluate(t,s,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(t,s,a);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,s,a),g,function(b){if(b<=0)return 0;if(b>=1)return 1;const E=b*b,I=E*b;return 4*(b<.5?I:3*(b-E)+I-.75)}(v))}}return g}}class ma{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,a){const h=new ya(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,s,a);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ga{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return mt(this._values[t].value)}setValue(t,s){this._values[t]=new _o(this._values[t].property,s===null?void 0:mt(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const a=this.getValue(s);a!==void 0&&(t[s]=a)}return t}possiblyEvaluate(t,s,a){const h=new ya(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,s,a);return h}}class In{constructor(t,s,a){this.property=t,this.value=s,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,a,h){return this.property.evaluate(this.value,this.parameters,t,s,a,h)}}class ya{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Xe{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,a){const h=pi[this.specification.type];return h?h(t,s,a):t}}class ot{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,a,h){return new In(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},a,h)}:t.expression,s)}interpolate(t,s,a){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new In(this,{kind:"constant",value:void 0},t.parameters);const h=pi[this.specification.type];if(h){const g=h(t.value.value,s.value.value,a);return new In(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,s,a,h,g,y){return t.kind==="constant"?t.value:t.evaluate(s,a,h,g,y)}}class yl extends ot{possiblyEvaluate(t,s,a,h){if(t.value===void 0)return new In(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const g=t.expression.evaluate(s,null,{},a,h),y=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(y,y,y,s);return new In(this,{kind:"constant",value:v},s)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new In(this,{kind:"constant",value:g},s)}return new In(this,t.expression,s)}evaluate(t,s,a,h,g,y){if(t.kind==="source"){const v=t.evaluate(s,a,h,g,y);return this._calculate(v,v,v,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},a,h),t.evaluate({zoom:Math.floor(s.zoom)},a,h),t.evaluate({zoom:Math.floor(s.zoom)+1},a,h),s):t.value}_calculate(t,s,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:a,to:s}}interpolate(t){return t}}class _l{constructor(t){this.specification=t}possiblyEvaluate(t,s,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(s,null,{},a,h);return this._calculate(g,g,g,s)}return this._calculate(t.expression.evaluate(new Qt(Math.floor(s.zoom-1),s)),t.expression.evaluate(new Qt(Math.floor(s.zoom),s)),t.expression.evaluate(new Qt(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:a,to:s}}interpolate(t){return t}}class sc{constructor(t){this.specification=t}possiblyEvaluate(t,s,a,h){return!!t.expression.evaluate(s,null,{},a,h)}interpolate(){return!1}}class m{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const a=t[s];a.specification.overridable&&this.overridableProperties.push(s);const h=this.defaultPropertyValues[s]=new _o(a,void 0),g=this.defaultTransitionablePropertyValues[s]=new ml(a);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate({})}}}Ge("DataDrivenProperty",ot),Ge("DataConstantProperty",Xe),Ge("CrossFadedDataDrivenProperty",yl),Ge("CrossFadedProperty",_l),Ge("ColorRampProperty",sc);const e="-transition";class o extends rs{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new ga(s.layout)),s.paint)){this._transitionablePaint=new gl(s.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ya(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,a={}){s!=null&&this._validate(Gh,`layers.${this.id}.layout.${t}`,t,s,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,a={}){if(s!=null&&this._validate(Zh,`layers.${this.id}.paint.${t}`,t,s,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(t,v,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),it(t,(s,a)=>!(s===void 0||a==="layout"&&!Object.keys(s).length||a==="paint"&&!Object.keys(s).length))}_validate(t,s,a,h,g={}){return(!g||g.validate!==!1)&&Yu(this,t.call(Ds,{key:s,layerType:this.type,objectKey:a,value:h,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof In&&oo(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class c{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class f{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function x(i,t=1){let s=0,a=0;return{members:i.map(h=>{const g=u[h.type].BYTES_PER_ELEMENT,y=s=S(s,Math.max(t,g)),v=h.components||1;return a=Math.max(a,g),s+=g*v,{name:h.name,type:h.type,components:v,offset:y}}),size:S(s,Math.max(a,t)),alignment:t}}function S(i,t){return Math.ceil(i/t)*t}class k extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,s)}emplace(t,s,a){const h=2*t;return this.int16[h+0]=s,this.int16[h+1]=a,t}}k.prototype.bytesPerElement=4,Ge("StructArrayLayout2i4",k);class C extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.int16[g+0]=s,this.int16[g+1]=a,this.int16[g+2]=h,t}}C.prototype.bytesPerElement=6,Ge("StructArrayLayout3i6",C);class A extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,a,h)}emplace(t,s,a,h,g){const y=4*t;return this.int16[y+0]=s,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=g,t}}A.prototype.bytesPerElement=8,Ge("StructArrayLayout4i8",A);class M extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,v){const b=6*t;return this.int16[b+0]=s,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=y,this.int16[b+5]=v,t}}M.prototype.bytesPerElement=12,Ge("StructArrayLayout2i4i12",M);class B extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,v){const b=4*t,E=8*t;return this.int16[b+0]=s,this.int16[b+1]=a,this.uint8[E+4]=h,this.uint8[E+5]=g,this.uint8[E+6]=y,this.uint8[E+7]=v,t}}B.prototype.bytesPerElement=8,Ge("StructArrayLayout2i4ub8",B);class V extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,s)}emplace(t,s,a){const h=2*t;return this.float32[h+0]=s,this.float32[h+1]=a,t}}V.prototype.bytesPerElement=8,Ge("StructArrayLayout2f8",V);class U extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,v,b,E,I){const P=this.length;return this.resize(P+1),this.emplace(P,t,s,a,h,g,y,v,b,E,I)}emplace(t,s,a,h,g,y,v,b,E,I,P){const z=10*t;return this.uint16[z+0]=s,this.uint16[z+1]=a,this.uint16[z+2]=h,this.uint16[z+3]=g,this.uint16[z+4]=y,this.uint16[z+5]=v,this.uint16[z+6]=b,this.uint16[z+7]=E,this.uint16[z+8]=I,this.uint16[z+9]=P,t}}U.prototype.bytesPerElement=20,Ge("StructArrayLayout10ui20",U);class H extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,v,b,E,I,P,z){const L=this.length;return this.resize(L+1),this.emplace(L,t,s,a,h,g,y,v,b,E,I,P,z)}emplace(t,s,a,h,g,y,v,b,E,I,P,z,L){const F=12*t;return this.int16[F+0]=s,this.int16[F+1]=a,this.int16[F+2]=h,this.int16[F+3]=g,this.uint16[F+4]=y,this.uint16[F+5]=v,this.uint16[F+6]=b,this.uint16[F+7]=E,this.int16[F+8]=I,this.int16[F+9]=P,this.int16[F+10]=z,this.int16[F+11]=L,t}}H.prototype.bytesPerElement=24,Ge("StructArrayLayout4i4ui4i24",H);class K extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.float32[g+0]=s,this.float32[g+1]=a,this.float32[g+2]=h,t}}K.prototype.bytesPerElement=12,Ge("StructArrayLayout3f12",K);class J extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}J.prototype.bytesPerElement=4,Ge("StructArrayLayout1ul4",J);class ee extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,v,b,E){const I=this.length;return this.resize(I+1),this.emplace(I,t,s,a,h,g,y,v,b,E)}emplace(t,s,a,h,g,y,v,b,E,I){const P=10*t,z=5*t;return this.int16[P+0]=s,this.int16[P+1]=a,this.int16[P+2]=h,this.int16[P+3]=g,this.int16[P+4]=y,this.int16[P+5]=v,this.uint32[z+3]=b,this.uint16[P+8]=E,this.uint16[P+9]=I,t}}ee.prototype.bytesPerElement=20,Ge("StructArrayLayout6i1ul2ui20",ee);class q extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,v){const b=6*t;return this.int16[b+0]=s,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=y,this.int16[b+5]=v,t}}q.prototype.bytesPerElement=12,Ge("StructArrayLayout2i2i2i12",q);class se extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,a,h,g)}emplace(t,s,a,h,g,y){const v=4*t,b=8*t;return this.float32[v+0]=s,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[b+6]=g,this.int16[b+7]=y,t}}se.prototype.bytesPerElement=16,Ge("StructArrayLayout2f1f2i16",se);class le extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,v){const b=16*t,E=4*t,I=8*t;return this.uint8[b+0]=s,this.uint8[b+1]=a,this.float32[E+1]=h,this.float32[E+2]=g,this.int16[I+6]=y,this.int16[I+7]=v,t}}le.prototype.bytesPerElement=16,Ge("StructArrayLayout2ub2f2i16",le);class pe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.uint16[g+0]=s,this.uint16[g+1]=a,this.uint16[g+2]=h,t}}pe.prototype.bytesPerElement=6,Ge("StructArrayLayout3ui6",pe);class xe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,v,b,E,I,P,z,L,F,O,Z,X){const de=this.length;return this.resize(de+1),this.emplace(de,t,s,a,h,g,y,v,b,E,I,P,z,L,F,O,Z,X)}emplace(t,s,a,h,g,y,v,b,E,I,P,z,L,F,O,Z,X,de){const re=24*t,ue=12*t,ye=48*t;return this.int16[re+0]=s,this.int16[re+1]=a,this.uint16[re+2]=h,this.uint16[re+3]=g,this.uint32[ue+2]=y,this.uint32[ue+3]=v,this.uint32[ue+4]=b,this.uint16[re+10]=E,this.uint16[re+11]=I,this.uint16[re+12]=P,this.float32[ue+7]=z,this.float32[ue+8]=L,this.uint8[ye+36]=F,this.uint8[ye+37]=O,this.uint8[ye+38]=Z,this.uint32[ue+10]=X,this.int16[re+22]=de,t}}xe.prototype.bytesPerElement=48,Ge("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xe);class Te extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,v,b,E,I,P,z,L,F,O,Z,X,de,re,ue,ye,be,$e,st,Ve,Be,Qe,He){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,t,s,a,h,g,y,v,b,E,I,P,z,L,F,O,Z,X,de,re,ue,ye,be,$e,st,Ve,Be,Qe,He)}emplace(t,s,a,h,g,y,v,b,E,I,P,z,L,F,O,Z,X,de,re,ue,ye,be,$e,st,Ve,Be,Qe,He,Ze){const ve=32*t,et=16*t;return this.int16[ve+0]=s,this.int16[ve+1]=a,this.int16[ve+2]=h,this.int16[ve+3]=g,this.int16[ve+4]=y,this.int16[ve+5]=v,this.int16[ve+6]=b,this.int16[ve+7]=E,this.uint16[ve+8]=I,this.uint16[ve+9]=P,this.uint16[ve+10]=z,this.uint16[ve+11]=L,this.uint16[ve+12]=F,this.uint16[ve+13]=O,this.uint16[ve+14]=Z,this.uint16[ve+15]=X,this.uint16[ve+16]=de,this.uint16[ve+17]=re,this.uint16[ve+18]=ue,this.uint16[ve+19]=ye,this.uint16[ve+20]=be,this.uint16[ve+21]=$e,this.uint16[ve+22]=st,this.uint32[et+12]=Ve,this.float32[et+13]=Be,this.float32[et+14]=Qe,this.uint16[ve+30]=He,this.uint16[ve+31]=Ze,t}}Te.prototype.bytesPerElement=64,Ge("StructArrayLayout8i15ui1ul2f2ui64",Te);class Oe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}Oe.prototype.bytesPerElement=4,Ge("StructArrayLayout1f4",Oe);class qe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.uint16[6*t+0]=s,this.float32[g+1]=a,this.float32[g+2]=h,t}}qe.prototype.bytesPerElement=12,Ge("StructArrayLayout1ui2f12",qe);class Ae extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=4*t;return this.uint32[2*t+0]=s,this.uint16[g+2]=a,this.uint16[g+3]=h,t}}Ae.prototype.bytesPerElement=8,Ge("StructArrayLayout1ul2ui8",Ae);class Pe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,s)}emplace(t,s,a){const h=2*t;return this.uint16[h+0]=s,this.uint16[h+1]=a,t}}Pe.prototype.bytesPerElement=4,Ge("StructArrayLayout2ui4",Pe);class Ke extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Ke.prototype.bytesPerElement=2,Ge("StructArrayLayout1ui2",Ke);class dt extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,a,h)}emplace(t,s,a,h,g){const y=4*t;return this.float32[y+0]=s,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=g,t}}dt.prototype.bytesPerElement=16,Ge("StructArrayLayout4f16",dt);class Re extends c{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new te(this.anchorPointX,this.anchorPointY)}}Re.prototype.size=20;class Ue extends ee{get(t){return new Re(this,t)}}Ge("CollisionBoxArray",Ue);class ct extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ct.prototype.size=48;class er extends xe{get(t){return new ct(this,t)}}Ge("PlacedSymbolArray",er);class vt extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}vt.prototype.size=64;class Ct extends Te{get(t){return new vt(this,t)}}Ge("SymbolInstanceArray",Ct);class tr extends Oe{getoffsetX(t){return this.float32[1*t+0]}}Ge("GlyphOffsetArray",tr);class Hr extends C{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ge("SymbolLineVertexArray",Hr);class ln extends c{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ln.prototype.size=12;class rr extends qe{get(t){return new ln(this,t)}}Ge("TextAnchorOffsetArray",rr);class mi extends c{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}mi.prototype.size=8;class si extends Ae{get(t){return new mi(this,t)}}Ge("FeatureIndexArray",si);class Wr extends k{}class oi extends k{}class Cn extends k{}class vo extends M{}class vl extends B{}class xo extends V{}class qi extends U{}class xl extends H{}class oc extends K{}class Zi extends J{}class Gi extends q{}class ls extends le{}class un extends pe{}class Vr extends Pe{}const Xr=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mi}=Xr;class At{constructor(t=[]){this.segments=t}prepareSegment(t,s,a,h){let g=this.segments[this.segments.length-1];return t>At.MAX_VERTEX_ARRAY_LENGTH&&Mt(`Max vertices per segment is ${At.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>At.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:s.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,a,h){return new At([{vertexOffset:t,primitiveOffset:s,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function Rs(i,t){return 256*(i=je(Math.floor(i),0,255))+je(Math.floor(t),0,255)}At.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ge("SegmentVector",At);const wo=x([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var bo={exports:{}},Jh={exports:{}};Jh.exports=function(i,t){var s,a,h,g,y,v,b,E;for(a=i.length-(s=3&i.length),h=t,y=3432918353,v=461845907,E=0;E<a;)b=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,h=27492+(65535&(g=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(b=0,s){case 3:b^=(255&i.charCodeAt(E+2))<<16;case 2:b^=(255&i.charCodeAt(E+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&i.charCodeAt(E)))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var Tf=Jh.exports,Yh={exports:{}};Yh.exports=function(i,t){for(var s,a=i.length,h=t^a,g=0;a>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&i.charCodeAt(g+2))<<16;case 2:h^=(255&i.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var us=Tf,Qh=Yh.exports;bo.exports=us,bo.exports.murmur3=us,bo.exports.murmur2=Qh;var wl=j(bo.exports);class _a{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,a,h){this.ids.push(bl(t)),this.positions.push(s,a,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=bl(t);let a=0,h=this.ids.length-1;for(;a<h;){const y=a+h>>1;this.ids[y]>=s?h=y:a=y+1}const g=[];for(;this.ids[a]===s;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(t,s){const a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Sl(a,h,0,a.length-1),s&&s.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){const s=new _a;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function bl(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:wl(String(i))}function Sl(i,t,s,a){for(;s<a;){const h=i[s+a>>1];let g=s-1,y=a+1;for(;;){do g++;while(i[g]<h);do y--;while(i[y]>h);if(g>=y)break;So(i,g,y),So(t,3*g,3*y),So(t,3*g+1,3*y+1),So(t,3*g+2,3*y+2)}y-s<a-y?(Sl(i,t,s,y),s=y+1):(Sl(i,t,y+1,a),a=y)}}function So(i,t,s){const a=i[t];i[t]=i[s],i[s]=a}Ge("FeaturePositionMap",_a);class va{constructor(t,s){this.gl=t.gl,this.location=s}}class ed extends va{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class qy extends va{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Zy extends va{constructor(t,s){super(t,s),this.current=$t.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const M1=new Float32Array(16);function kf(i){return[Rs(255*i.r,255*i.g),Rs(255*i.b,255*i.a)]}class ac{constructor(t,s,a){this.value=t,this.uniformNames=s.map(h=>`u_${h}`),this.type=a}setUniform(t,s,a){t.set(a.constantOr(this.value))}getBinding(t,s,a){return this.type==="color"?new Zy(t,s):new ed(t,s)}}class Tl{constructor(t,s){this.uniformNames=s.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,a,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,s,a){return a.substr(0,9)==="u_pattern"?new qy(t,s):new ed(t,s)}}class Ls{constructor(t,s,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,s,a,h,g){const y=this.paintVertexArray.length,v=this.expression.evaluate(new Qt(0),s,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,v)}updatePaintArray(t,s,a,h){const g=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(t,s,g)}_setPaintValue(t,s,a){if(this.type==="color"){const h=kf(a);for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<s;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zn{constructor(t,s,a,h,g,y){this.expression=t,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,s,a,h,g){const y=this.expression.evaluate(new Qt(this.zoom),s,{},h,[],g),v=this.expression.evaluate(new Qt(this.zoom+1),s,{},h,[],g),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,y,v)}updatePaintArray(t,s,a,h){const g=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(t,s,g,y)}_setPaintValue(t,s,a,h){if(this.type==="color"){const g=kf(a),y=kf(h);for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,g[0],g[1],y[0],y[1])}else{for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const a=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=je(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,s,a){return new ed(t,s)}}class To{constructor(t,s,a,h,g,y){this.expression=t,this.type=s,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,s,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,s.patterns&&s.patterns[this.layerId],a)}updatePaintArray(t,s,a,h,g){this._setPaintValues(t,s,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,s,a,h){if(!h||!a)return;const{min:g,mid:y,max:v}=a,b=h[g],E=h[y],I=h[v];if(b&&E&&I)for(let P=t;P<s;P++)this.zoomInPaintVertexArray.emplace(P,E.tl[0],E.tl[1],E.br[0],E.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],E.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,E.tl[0],E.tl[1],E.br[0],E.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],E.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,wo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,wo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Gy{constructor(t,s,a){this.binders={},this._buffers=[];const h=[];for(const g in t.paint._values){if(!a(g))continue;const y=t.paint.get(g);if(!(y instanceof In&&oo(y.property.specification)))continue;const v=z1(g,t.type),b=y.value,E=y.property.specification.type,I=y.property.useIntegerZoom,P=y.property.specification["property-type"],z=P==="cross-faded"||P==="cross-faded-data-driven";if(b.kind==="constant")this.binders[g]=z?new Tl(b.value,v):new ac(b.value,v,E),h.push(`/u_${g}`);else if(b.kind==="source"||z){const L=Hy(g,E,"source");this.binders[g]=z?new To(b,E,I,s,L,t.id):new Ls(b,v,E,L),h.push(`/a_${g}`)}else{const L=Hy(g,E,"composite");this.binders[g]=new Zn(b,v,E,I,s,L),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Ls||s instanceof Zn?s.maxValue:0}populatePaintArrays(t,s,a,h,g){for(const y in this.binders){const v=this.binders[y];(v instanceof Ls||v instanceof Zn||v instanceof To)&&v.populatePaintArray(t,s,a,h,g)}}setConstantPatternPositions(t,s){for(const a in this.binders){const h=this.binders[a];h instanceof Tl&&h.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,a,h,g){let y=!1;for(const v in t){const b=s.getPositions(v);for(const E of b){const I=a.feature(E.index);for(const P in this.binders){const z=this.binders[P];if((z instanceof Ls||z instanceof Zn||z instanceof To)&&z.expression.isStateDependent===!0){const L=h.paint.get(P);z.expression=L.value,z.updatePaintArray(E.start,E.end,I,t[v],g),y=!0}}}}return y}defines(){const t=[];for(const s in this.binders){const a=this.binders[s];(a instanceof ac||a instanceof Tl)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof Ls||a instanceof Zn)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name);else if(a instanceof To)for(let h=0;h<wo.members.length;h++)t.push(wo.members[h].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof ac||a instanceof Tl||a instanceof Zn)for(const h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const a=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof ac||g instanceof Tl||g instanceof Zn){for(const y of g.uniformNames)if(s[y]){const v=g.getBinding(t,s[y],y);a.push({name:y,property:h,binding:v})}}}return a}setUniforms(t,s,a,h){for(const{name:g,property:y,binding:v}of s)this.binders[y].setUniform(v,h,a.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const a=this.binders[s];if(t&&a instanceof To){const h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof Ls||a instanceof Zn)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const s in this.binders){const a=this.binders[s];(a instanceof Ls||a instanceof Zn||a instanceof To)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Ls||s instanceof Zn||s instanceof To)&&s.destroy()}}}class xa{constructor(t,s,a=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Gy(h,s,a);this.needsUpload=!1,this._featureMap=new _a,this._bufferOffset=0}populatePaintArrays(t,s,a,h,g,y){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,s,h,g,y);s.id!==void 0&&this._featureMap.add(s.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,a,h){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,s,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function z1(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Hy(i,t,s){const a={color:{source:V,composite:dt},number:{source:Oe,composite:V}},h=function(g){return{"line-pattern":{source:qi,composite:qi},"fill-pattern":{source:qi,composite:qi},"fill-extrusion-pattern":{source:qi,composite:qi}}[g]}(i);return h&&h[s]||a[t][s]}Ge("ConstantBinder",ac),Ge("CrossFadedConstantBinder",Tl),Ge("SourceExpressionBinder",Ls),Ge("CrossFadedCompositeBinder",To),Ge("CompositeExpressionBinder",Zn),Ge("ProgramConfiguration",Gy,{omit:["_buffers"]}),Ge("ProgramConfigurationSet",xa);const Er=8192,Ef=Math.pow(2,14)-1,Wy=-Ef-1;function wa(i){const t=Er/i.extent,s=i.loadGeometry();for(let a=0;a<s.length;a++){const h=s[a];for(let g=0;g<h.length;g++){const y=h[g],v=Math.round(y.x*t),b=Math.round(y.y*t);y.x=je(v,Wy,Ef),y.y=je(b,Wy,Ef),(v<y.x||v>y.x+1||b<y.y||b>y.y+1)&&Mt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function ba(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?wa(i):[]}}function td(i,t,s,a,h){i.emplaceBack(2*t+(a+1)/2,2*s+(h+1)/2)}class If{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new oi,this.indexArray=new un,this.segments=new At,this.programConfigurations=new xa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){const h=this.layers[0],g=[];let y=null,v=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),v=!y.isConstant());for(const{feature:b,id:E,index:I,sourceLayerIndex:P}of t){const z=this.layers[0]._featureFilter.needGeometry,L=ba(b,z);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),L,a))continue;const F=v?y.evaluate(L,{},a):void 0,O={id:E,properties:b.properties,type:b.type,sourceLayerIndex:P,index:I,geometry:z?L.geometry:wa(b),patterns:{},sortKey:F};g.push(O)}v&&g.sort((b,E)=>b.sortKey-E.sortKey);for(const b of g){const{geometry:E,index:I,sourceLayerIndex:P}=b,z=t[I].feature;this.addFeature(b,E,I,a),s.featureIndex.insert(z,E,I,P,this.index)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Mi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,a,h){for(const g of s)for(const y of g){const v=y.x,b=y.y;if(v<0||v>=Er||b<0||b>=Er)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),I=E.vertexLength;td(this.layoutVertexArray,v,b,-1,-1),td(this.layoutVertexArray,v,b,1,-1),td(this.layoutVertexArray,v,b,1,1),td(this.layoutVertexArray,v,b,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h)}}function Xy(i,t){for(let s=0;s<i.length;s++)if(kl(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(kl(i,t[s]))return!0;return!!Cf(i,t)}function D1(i,t,s){return!!kl(i,t)||!!Pf(t,i,s)}function Ky(i,t){if(i.length===1)return Yy(t,i[0]);for(let s=0;s<t.length;s++){const a=t[s];for(let h=0;h<a.length;h++)if(kl(i,a[h]))return!0}for(let s=0;s<i.length;s++)if(Yy(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(Cf(i,t[s]))return!0;return!1}function R1(i,t,s){if(i.length>1){if(Cf(i,t))return!0;for(let a=0;a<t.length;a++)if(Pf(t[a],i,s))return!0}for(let a=0;a<i.length;a++)if(Pf(i[a],t,s))return!0;return!1}function Cf(i,t){if(i.length===0||t.length===0)return!1;for(let s=0;s<i.length-1;s++){const a=i[s],h=i[s+1];for(let g=0;g<t.length-1;g++)if(L1(a,h,t[g],t[g+1]))return!0}return!1}function L1(i,t,s,a){return Yt(i,s,a)!==Yt(t,s,a)&&Yt(i,t,s)!==Yt(i,t,a)}function Pf(i,t,s){const a=s*s;if(t.length===1)return i.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(Jy(i,t[h-1],t[h])<a)return!0;return!1}function Jy(i,t,s){const a=t.distSqr(s);if(a===0)return i.distSqr(t);const h=((i.x-t.x)*(s.x-t.x)+(i.y-t.y)*(s.y-t.y))/a;return i.distSqr(h<0?t:h>1?s:s.sub(t)._mult(h)._add(t))}function Yy(i,t){let s,a,h,g=!1;for(let y=0;y<i.length;y++){s=i[y];for(let v=0,b=s.length-1;v<s.length;b=v++)a=s[v],h=s[b],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function kl(i,t){let s=!1;for(let a=0,h=i.length-1;a<i.length;h=a++){const g=i[a],y=i[h];g.y>t.y!=y.y>t.y&&t.x<(y.x-g.x)*(t.y-g.y)/(y.y-g.y)+g.x&&(s=!s)}return s}function B1(i,t,s){const a=s[0],h=s[2];if(i.x<a.x&&t.x<a.x||i.x>h.x&&t.x>h.x||i.y<a.y&&t.y<a.y||i.y>h.y&&t.y>h.y)return!1;const g=Yt(i,t,s[0]);return g!==Yt(i,t,s[1])||g!==Yt(i,t,s[2])||g!==Yt(i,t,s[3])}function lc(i,t,s){const a=t.paint.get(i).value;return a.kind==="constant"?a.value:s.programConfigurations.get(t.id).getMaxValue(i)}function rd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function id(i,t,s,a,h){if(!t[0]&&!t[1])return i;const g=te.convert(t)._mult(h);s==="viewport"&&g._rotate(-a);const y=[];for(let v=0;v<i.length;v++)y.push(i[v].sub(g));return y}let Qy,e_;Ge("CircleBucket",If,{omit:["layers"]});var F1={get paint(){return e_=e_||new m({"circle-radius":new ot(ge.paint_circle["circle-radius"]),"circle-color":new ot(ge.paint_circle["circle-color"]),"circle-blur":new ot(ge.paint_circle["circle-blur"]),"circle-opacity":new ot(ge.paint_circle["circle-opacity"]),"circle-translate":new Xe(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Xe(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xe(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xe(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ot(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ot(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ot(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return Qy=Qy||new m({"circle-sort-key":new ot(ge.layout_circle["circle-sort-key"])})}},gi=1e-6,El=typeof Float32Array<"u"?Float32Array:Array;function Af(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function t_(i,t,s){var a=t[0],h=t[1],g=t[2],y=t[3],v=t[4],b=t[5],E=t[6],I=t[7],P=t[8],z=t[9],L=t[10],F=t[11],O=t[12],Z=t[13],X=t[14],de=t[15],re=s[0],ue=s[1],ye=s[2],be=s[3];return i[0]=re*a+ue*v+ye*P+be*O,i[1]=re*h+ue*b+ye*z+be*Z,i[2]=re*g+ue*E+ye*L+be*X,i[3]=re*y+ue*I+ye*F+be*de,i[4]=(re=s[4])*a+(ue=s[5])*v+(ye=s[6])*P+(be=s[7])*O,i[5]=re*h+ue*b+ye*z+be*Z,i[6]=re*g+ue*E+ye*L+be*X,i[7]=re*y+ue*I+ye*F+be*de,i[8]=(re=s[8])*a+(ue=s[9])*v+(ye=s[10])*P+(be=s[11])*O,i[9]=re*h+ue*b+ye*z+be*Z,i[10]=re*g+ue*E+ye*L+be*X,i[11]=re*y+ue*I+ye*F+be*de,i[12]=(re=s[12])*a+(ue=s[13])*v+(ye=s[14])*P+(be=s[15])*O,i[13]=re*h+ue*b+ye*z+be*Z,i[14]=re*g+ue*E+ye*L+be*X,i[15]=re*y+ue*I+ye*F+be*de,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var uc,O1=t_;function nd(i,t,s){var a=t[0],h=t[1],g=t[2],y=t[3];return i[0]=s[0]*a+s[4]*h+s[8]*g+s[12]*y,i[1]=s[1]*a+s[5]*h+s[9]*g+s[13]*y,i[2]=s[2]*a+s[6]*h+s[10]*g+s[14]*y,i[3]=s[3]*a+s[7]*h+s[11]*g+s[15]*y,i}uc=new El(4),El!=Float32Array&&(uc[0]=0,uc[1]=0,uc[2]=0,uc[3]=0);class N1 extends o{constructor(t){super(t,F1)}createBucket(t){return new If(t)}queryRadius(t){const s=t;return lc("circle-radius",this,s)+lc("circle-stroke-width",this,s)+rd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,a,h,g,y,v,b){const E=id(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),I=this.paint.get("circle-radius").evaluate(s,a)+this.paint.get("circle-stroke-width").evaluate(s,a),P=this.paint.get("circle-pitch-alignment")==="map",z=P?E:function(F,O){return F.map(Z=>r_(Z,O))}(E,b),L=P?I*v:I;for(const F of h)for(const O of F){const Z=P?O:r_(O,b);let X=L;const de=nd([],[O.x,O.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=de[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=y.cameraToCenterDistance/de[3]),D1(z,Z,X))return!0}return!1}}function r_(i,t){const s=nd([],[i.x,i.y,0,1],t);return new te(s[0]/s[3],s[1]/s[3])}class i_ extends If{}let n_;Ge("HeatmapBucket",i_,{omit:["layers"]});var V1={get paint(){return n_=n_||new m({"heatmap-radius":new ot(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ot(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xe(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new sc(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xe(ge.paint_heatmap["heatmap-opacity"])})}};function Mf(i,{width:t,height:s},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*s*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*s*a}`)}else h=new Uint8Array(t*s*a);return i.width=t,i.height=s,i.data=h,i}function s_(i,{width:t,height:s},a){if(t===i.width&&s===i.height)return;const h=Mf({},{width:t,height:s},a);zf(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,s)},a),i.width=t,i.height=s,i.data=h.data}function zf(i,t,s,a,h,g){if(h.width===0||h.height===0)return t;if(h.width>i.width||h.height>i.height||s.x>i.width-h.width||s.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,v=t.data;if(y===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<h.height;b++){const E=((s.y+b)*i.width+s.x)*g,I=((a.y+b)*t.width+a.x)*g;for(let P=0;P<h.width*g;P++)v[I+P]=y[E+P]}return t}class cc{constructor(t,s){Mf(this,t,1,s)}resize(t){s_(this,t,1)}clone(){return new cc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,a,h,g){zf(t,s,a,h,g,1)}}class cn{constructor(t,s){Mf(this,t,4,s)}resize(t){s_(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new cn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,a,h,g){zf(t,s,a,h,g,4)}}function o_(i){const t={},s=i.resolution||256,a=i.clips?i.clips.length:1,h=i.image||new cn({width:s,height:a});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const g=(y,v,b)=>{t[i.evaluationKey]=b;const E=i.expression.evaluate(t);h.data[y+v+0]=Math.floor(255*E.r/E.a),h.data[y+v+1]=Math.floor(255*E.g/E.a),h.data[y+v+2]=Math.floor(255*E.b/E.a),h.data[y+v+3]=Math.floor(255*E.a)};if(i.clips)for(let y=0,v=0;y<a;++y,v+=4*s)for(let b=0,E=0;b<s;b++,E+=4){const I=b/(s-1),{start:P,end:z}=i.clips[y];g(v,E,P*(1-I)+z*I)}else for(let y=0,v=0;y<s;y++,v+=4)g(0,v,y/(s-1));return h}Ge("AlphaImage",cc),Ge("RGBAImage",cn);const Df="big-fb";class j1 extends o{createBucket(t){return new i_(t)}constructor(t){super(t,V1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=o_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Df)&&this.heatmapFbos.delete(Df)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let a_;var U1={get paint(){return a_=a_||new m({"hillshade-illumination-direction":new Xe(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xe(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xe(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xe(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xe(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xe(ge.paint_hillshade["hillshade-accent-color"])})}};class $1 extends o{constructor(t){super(t,U1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const q1=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:Z1}=q1;function l_(i,t,s=2){const a=t&&t.length,h=a?t[0]*s:i.length;let g=u_(i,0,h,s,!0);const y=[];if(!g||g.next===g.prev)return y;let v,b,E;if(a&&(g=function(I,P,z,L){const F=[];for(let O=0,Z=P.length;O<Z;O++){const X=u_(I,P[O]*L,O<Z-1?P[O+1]*L:I.length,L,!1);X===X.next&&(X.steiner=!0),F.push(Q1(X))}F.sort(K1);for(let O=0;O<F.length;O++)z=J1(F[O],z);return z}(i,t,g,s)),i.length>80*s){v=1/0,b=1/0;let I=-1/0,P=-1/0;for(let z=s;z<h;z+=s){const L=i[z],F=i[z+1];L<v&&(v=L),F<b&&(b=F),L>I&&(I=L),F>P&&(P=F)}E=Math.max(I-v,P-b),E=E!==0?32767/E:0}return hc(g,y,s,v,b,E,0),y}function u_(i,t,s,a,h){let g;if(h===function(y,v,b,E){let I=0;for(let P=v,z=b-E;P<b;P+=E)I+=(y[z]-y[P])*(y[P+1]+y[z+1]),z=P;return I}(i,t,s,a)>0)for(let y=t;y<s;y+=a)g=d_(y/a|0,i[y],i[y+1],g);else for(let y=s-a;y>=t;y-=a)g=d_(y/a|0,i[y],i[y+1],g);return g&&sd(g,g.next)&&(pc(g),g=g.next),g}function Sa(i,t){if(!i)return i;t||(t=i);let s,a=i;do if(s=!1,a.steiner||!sd(a,a.next)&&yr(a.prev,a,a.next)!==0)a=a.next;else{if(pc(a),a=t=a.prev,a===a.next)break;s=!0}while(s||a!==t);return t}function hc(i,t,s,a,h,g,y){if(!i)return;!y&&g&&function(b,E,I,P){let z=b;do z.z===0&&(z.z=Rf(z.x,z.y,E,I,P)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==b);z.prevZ.nextZ=null,z.prevZ=null,function(L){let F,O=1;do{let Z,X=L;L=null;let de=null;for(F=0;X;){F++;let re=X,ue=0;for(let be=0;be<O&&(ue++,re=re.nextZ,re);be++);let ye=O;for(;ue>0||ye>0&&re;)ue!==0&&(ye===0||!re||X.z<=re.z)?(Z=X,X=X.nextZ,ue--):(Z=re,re=re.nextZ,ye--),de?de.nextZ=Z:L=Z,Z.prevZ=de,de=Z;X=re}de.nextZ=null,O*=2}while(F>1)}(z)}(i,a,h,g);let v=i;for(;i.prev!==i.next;){const b=i.prev,E=i.next;if(g?H1(i,a,h,g):G1(i))t.push(b.i,i.i,E.i),pc(i),i=E.next,v=E.next;else if((i=E)===v){y?y===1?hc(i=W1(Sa(i),t),t,s,a,h,g,2):y===2&&X1(i,t,s,a,h,g):hc(Sa(i),t,s,a,h,g,1);break}}}function G1(i){const t=i.prev,s=i,a=i.next;if(yr(t,s,a)>=0)return!1;const h=t.x,g=s.x,y=a.x,v=t.y,b=s.y,E=a.y,I=h<g?h<y?h:y:g<y?g:y,P=v<b?v<E?v:E:b<E?b:E,z=h>g?h>y?h:y:g>y?g:y,L=v>b?v>E?v:E:b>E?b:E;let F=a.next;for(;F!==t;){if(F.x>=I&&F.x<=z&&F.y>=P&&F.y<=L&&Il(h,v,g,b,y,E,F.x,F.y)&&yr(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function H1(i,t,s,a){const h=i.prev,g=i,y=i.next;if(yr(h,g,y)>=0)return!1;const v=h.x,b=g.x,E=y.x,I=h.y,P=g.y,z=y.y,L=v<b?v<E?v:E:b<E?b:E,F=I<P?I<z?I:z:P<z?P:z,O=v>b?v>E?v:E:b>E?b:E,Z=I>P?I>z?I:z:P>z?P:z,X=Rf(L,F,t,s,a),de=Rf(O,Z,t,s,a);let re=i.prevZ,ue=i.nextZ;for(;re&&re.z>=X&&ue&&ue.z<=de;){if(re.x>=L&&re.x<=O&&re.y>=F&&re.y<=Z&&re!==h&&re!==y&&Il(v,I,b,P,E,z,re.x,re.y)&&yr(re.prev,re,re.next)>=0||(re=re.prevZ,ue.x>=L&&ue.x<=O&&ue.y>=F&&ue.y<=Z&&ue!==h&&ue!==y&&Il(v,I,b,P,E,z,ue.x,ue.y)&&yr(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;re&&re.z>=X;){if(re.x>=L&&re.x<=O&&re.y>=F&&re.y<=Z&&re!==h&&re!==y&&Il(v,I,b,P,E,z,re.x,re.y)&&yr(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ue&&ue.z<=de;){if(ue.x>=L&&ue.x<=O&&ue.y>=F&&ue.y<=Z&&ue!==h&&ue!==y&&Il(v,I,b,P,E,z,ue.x,ue.y)&&yr(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function W1(i,t){let s=i;do{const a=s.prev,h=s.next.next;!sd(a,h)&&c_(a,s,s.next,h)&&dc(a,h)&&dc(h,a)&&(t.push(a.i,s.i,h.i),pc(s),pc(s.next),s=i=h),s=s.next}while(s!==i);return Sa(s)}function X1(i,t,s,a,h,g){let y=i;do{let v=y.next.next;for(;v!==y.prev;){if(y.i!==v.i&&eb(y,v)){let b=h_(y,v);return y=Sa(y,y.next),b=Sa(b,b.next),hc(y,t,s,a,h,g,0),void hc(b,t,s,a,h,g,0)}v=v.next}y=y.next}while(y!==i)}function K1(i,t){return i.x-t.x}function J1(i,t){const s=function(h,g){let y=g;const v=h.x,b=h.y;let E,I=-1/0;do{if(b<=y.y&&b>=y.next.y&&y.next.y!==y.y){const O=y.x+(b-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(O<=v&&O>I&&(I=O,E=y.x<y.next.x?y:y.next,O===v))return E}y=y.next}while(y!==g);if(!E)return null;const P=E,z=E.x,L=E.y;let F=1/0;y=E;do{if(v>=y.x&&y.x>=z&&v!==y.x&&Il(b<L?v:I,b,z,L,b<L?I:v,b,y.x,y.y)){const O=Math.abs(b-y.y)/(v-y.x);dc(y,h)&&(O<F||O===F&&(y.x>E.x||y.x===E.x&&Y1(E,y)))&&(E=y,F=O)}y=y.next}while(y!==P);return E}(i,t);if(!s)return t;const a=h_(s,i);return Sa(a,a.next),Sa(s,s.next)}function Y1(i,t){return yr(i.prev,i,t.prev)<0&&yr(t.next,i,i.next)<0}function Rf(i,t,s,a,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Q1(i){let t=i,s=i;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==i);return s}function Il(i,t,s,a,h,g,y,v){return(h-y)*(t-v)>=(i-y)*(g-v)&&(i-y)*(a-v)>=(s-y)*(t-v)&&(s-y)*(g-v)>=(h-y)*(a-v)}function eb(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(s,a){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==a.i&&h.next.i!==a.i&&c_(h,h.next,s,a))return!0;h=h.next}while(h!==s);return!1}(i,t)&&(dc(i,t)&&dc(t,i)&&function(s,a){let h=s,g=!1;const y=(s.x+a.x)/2,v=(s.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&y<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==s);return g}(i,t)&&(yr(i.prev,i,t.prev)||yr(i,t.prev,t))||sd(i,t)&&yr(i.prev,i,i.next)>0&&yr(t.prev,t,t.next)>0)}function yr(i,t,s){return(t.y-i.y)*(s.x-t.x)-(t.x-i.x)*(s.y-t.y)}function sd(i,t){return i.x===t.x&&i.y===t.y}function c_(i,t,s,a){const h=ad(yr(i,t,s)),g=ad(yr(i,t,a)),y=ad(yr(s,a,i)),v=ad(yr(s,a,t));return h!==g&&y!==v||!(h!==0||!od(i,s,t))||!(g!==0||!od(i,a,t))||!(y!==0||!od(s,i,a))||!(v!==0||!od(s,t,a))}function od(i,t,s){return t.x<=Math.max(i.x,s.x)&&t.x>=Math.min(i.x,s.x)&&t.y<=Math.max(i.y,s.y)&&t.y>=Math.min(i.y,s.y)}function ad(i){return i>0?1:i<0?-1:0}function dc(i,t){return yr(i.prev,i,i.next)<0?yr(i,t,i.next)>=0&&yr(i,i.prev,t)>=0:yr(i,t,i.prev)<0||yr(i,i.next,t)<0}function h_(i,t){const s=Lf(i.i,i.x,i.y),a=Lf(t.i,t.x,t.y),h=i.next,g=t.prev;return i.next=t,t.prev=i,s.next=h,h.prev=s,a.next=s,s.prev=a,g.next=a,a.prev=g,a}function d_(i,t,s,a){const h=Lf(i,t,s);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function pc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Lf(i,t,s){return{i,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Bf(i,t,s){const a=s.patternDependencies;let h=!1;for(const g of t){const y=g.paint.get(`${i}-pattern`);y.isConstant()||(h=!0);const v=y.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function Ff(i,t,s,a,h){const g=h.patternDependencies;for(const y of t){const v=y.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:a-1},s,{},h.availableImages),E=v.evaluate({zoom:a},s,{},h.availableImages),I=v.evaluate({zoom:a+1},s,{},h.availableImages);b=b&&b.name?b.name:b,E=E&&E.name?E.name:E,I=I&&I.name?I.name:I,g[b]=!0,g[E]=!0,g[I]=!0,s.patterns[y.id]={min:b,mid:E,max:I}}}return s}class Of{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Cn,this.indexArray=new un,this.indexArray2=new Vr,this.programConfigurations=new xa(t.layers,t.zoom),this.segments=new At,this.segments2=new At,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){this.hasPattern=Bf("fill",this.layers,s);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),y=[];for(const{feature:v,id:b,index:E,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,z=ba(v,P);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),z,a))continue;const L=g?h.evaluate(z,{},a,s.availableImages):void 0,F={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:E,geometry:P?z.geometry:wa(v),patterns:{},sortKey:L};y.push(F)}g&&y.sort((v,b)=>v.sortKey-b.sortKey);for(const v of y){const{geometry:b,index:E,sourceLayerIndex:I}=v;if(this.hasPattern){const P=Ff("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(v,b,E,a,{});s.featureIndex.insert(t[E].feature,b,E,I,this.index)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}addFeatures(t,s,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Z1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,a,h,g){for(const y of Ja(s,500)){let v=0;for(const L of y)v+=L.length;const b=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),E=b.vertexLength,I=[],P=[];for(const L of y){if(L.length===0)continue;L!==y[0]&&P.push(I.length/2);const F=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),O=F.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(O+L.length-1,O),I.push(L[0].x),I.push(L[0].y);for(let Z=1;Z<L.length;Z++)this.layoutVertexArray.emplaceBack(L[Z].x,L[Z].y),this.indexArray2.emplaceBack(O+Z-1,O+Z),I.push(L[Z].x),I.push(L[Z].y);F.vertexLength+=L.length,F.primitiveLength+=L.length}const z=l_(I,P);for(let L=0;L<z.length;L+=3)this.indexArray.emplaceBack(E+z[L],E+z[L+1],E+z[L+2]);b.vertexLength+=v,b.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}let p_,f_;Ge("FillBucket",Of,{omit:["layers","patternFeatures"]});var tb={get paint(){return f_=f_||new m({"fill-antialias":new Xe(ge.paint_fill["fill-antialias"]),"fill-opacity":new ot(ge.paint_fill["fill-opacity"]),"fill-color":new ot(ge.paint_fill["fill-color"]),"fill-outline-color":new ot(ge.paint_fill["fill-outline-color"]),"fill-translate":new Xe(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Xe(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new yl(ge.paint_fill["fill-pattern"])})},get layout(){return p_=p_||new m({"fill-sort-key":new ot(ge.layout_fill["fill-sort-key"])})}};class rb extends o{constructor(t){super(t,tb)}recalculate(t,s){super.recalculate(t,s);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Of(t)}queryRadius(){return rd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,a,h,g,y,v){return Ky(id(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),h)}isTileClipped(){return!0}}const ib=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),nb=x([{name:"a_centroid",components:2,type:"Int16"}],4),{members:sb}=ib;var ko={},ob=Y,m_=Cl;function Cl(i,t,s,a,h){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=h,i.readFields(ab,this,t)}function ab(i,t,s){i==1?t.id=s.readVarint():i==2?function(a,h){for(var g=a.readVarint()+a.pos;a.pos<g;){var y=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[y]=v}}(s,t):i==3?t.type=s.readVarint():i==4&&(t._geometry=s.pos)}function lb(i){for(var t,s,a=0,h=0,g=i.length,y=g-1;h<g;y=h++)a+=((s=i[y]).x-(t=i[h]).x)*(t.y+s.y);return a}Cl.types=["Unknown","Point","LineString","Polygon"],Cl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,s=i.readVarint()+i.pos,a=1,h=0,g=0,y=0,v=[];i.pos<s;){if(h<=0){var b=i.readVarint();a=7&b,h=b>>3}if(h--,a===1||a===2)g+=i.readSVarint(),y+=i.readSVarint(),a===1&&(t&&v.push(t),t=[]),t.push(new ob(g,y));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&v.push(t),v},Cl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,s=1,a=0,h=0,g=0,y=1/0,v=-1/0,b=1/0,E=-1/0;i.pos<t;){if(a<=0){var I=i.readVarint();s=7&I,a=I>>3}if(a--,s===1||s===2)(h+=i.readSVarint())<y&&(y=h),h>v&&(v=h),(g+=i.readSVarint())<b&&(b=g),g>E&&(E=g);else if(s!==7)throw new Error("unknown command "+s)}return[y,b,v,E]},Cl.prototype.toGeoJSON=function(i,t,s){var a,h,g=this.extent*Math.pow(2,s),y=this.extent*i,v=this.extent*t,b=this.loadGeometry(),E=Cl.types[this.type];function I(L){for(var F=0;F<L.length;F++){var O=L[F];L[F]=[360*(O.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+v)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<b.length;a++)P[a]=b[a][0];I(b=P);break;case 2:for(a=0;a<b.length;a++)I(b[a]);break;case 3:for(b=function(L){var F=L.length;if(F<=1)return[L];for(var O,Z,X=[],de=0;de<F;de++){var re=lb(L[de]);re!==0&&(Z===void 0&&(Z=re<0),Z===re<0?(O&&X.push(O),O=[L[de]]):O.push(L[de]))}return O&&X.push(O),X}(b),a=0;a<b.length;a++)for(h=0;h<b[a].length;h++)I(b[a][h])}b.length===1?b=b[0]:E="Multi"+E;var z={type:"Feature",geometry:{type:E,coordinates:b},properties:this.properties};return"id"in this&&(z.id=this.id),z};var ub=m_,g_=y_;function y_(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(cb,this,t),this.length=this._features.length}function cb(i,t,s){i===15?t.version=s.readVarint():i===1?t.name=s.readString():i===5?t.extent=s.readVarint():i===2?t._features.push(s.pos):i===3?t._keys.push(s.readString()):i===4&&t._values.push(function(a){for(var h=null,g=a.readVarint()+a.pos;a.pos<g;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(s))}y_.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new ub(this._pbf,t,this.extent,this._keys,this._values)};var hb=g_;function db(i,t,s){if(i===3){var a=new hb(s,s.readVarint()+s.pos);a.length&&(t[a.name]=a)}}ko.VectorTile=function(i,t){this.layers=i.readFields(db,{},t)},ko.VectorTileFeature=m_,ko.VectorTileLayer=g_;const pb=ko.VectorTileFeature.types,Nf=Math.pow(2,13);function fc(i,t,s,a,h,g,y,v){i.emplaceBack(t,s,2*Math.floor(a*Nf)+y,h*Nf*2,g*Nf*2,Math.round(v))}class Vf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new vo,this.centroidVertexArray=new Wr,this.indexArray=new un,this.programConfigurations=new xa(t.layers,t.zoom),this.segments=new At,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){this.features=[],this.hasPattern=Bf("fill-extrusion",this.layers,s);for(const{feature:h,id:g,index:y,sourceLayerIndex:v}of t){const b=this.layers[0]._featureFilter.needGeometry,E=ba(h,b);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),E,a))continue;const I={id:g,sourceLayerIndex:v,index:y,geometry:b?E.geometry:wa(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Ff("fill-extrusion",this.layers,I,this.zoom,s)):this.addFeature(I,I.geometry,y,a,{}),s.featureIndex.insert(h,I.geometry,y,v,this.index,!0)}}addFeatures(t,s,a){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,s,a)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sb),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,nb.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,a,h,g){for(const y of Ja(s,500)){const v={x:0,y:0,vertexCount:0};let b=0;for(const F of y)b+=F.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const F of y){if(F.length===0||mb(F))continue;let O=0;for(let Z=0;Z<F.length;Z++){const X=F[Z];if(Z>=1){const de=F[Z-1];if(!fb(X,de)){E.vertexLength+4>At.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const re=X.sub(de)._perp()._unit(),ue=de.dist(X);O+ue>32768&&(O=0),fc(this.layoutVertexArray,X.x,X.y,re.x,re.y,0,0,O),fc(this.layoutVertexArray,X.x,X.y,re.x,re.y,0,1,O),v.x+=2*X.x,v.y+=2*X.y,v.vertexCount+=2,O+=ue,fc(this.layoutVertexArray,de.x,de.y,re.x,re.y,0,0,O),fc(this.layoutVertexArray,de.x,de.y,re.x,re.y,0,1,O),v.x+=2*de.x,v.y+=2*de.y,v.vertexCount+=2;const ye=E.vertexLength;this.indexArray.emplaceBack(ye,ye+2,ye+1),this.indexArray.emplaceBack(ye+1,ye+2,ye+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+b>At.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),pb[t.type]!=="Polygon")continue;const I=[],P=[],z=E.vertexLength;for(const F of y)if(F.length!==0){F!==y[0]&&P.push(I.length/2);for(let O=0;O<F.length;O++){const Z=F[O];fc(this.layoutVertexArray,Z.x,Z.y,0,0,1,1,0),v.x+=Z.x,v.y+=Z.y,v.vertexCount+=1,I.push(Z.x),I.push(Z.y)}}const L=l_(I,P);for(let F=0;F<L.length;F+=3)this.indexArray.emplaceBack(z+L[F],z+L[F+2],z+L[F+1]);E.primitiveLength+=L.length/3,E.vertexLength+=b;for(let F=0;F<v.vertexCount;F++){const O=Math.floor(v.x/v.vertexCount),Z=Math.floor(v.y/v.vertexCount);this.centroidVertexArray.emplaceBack(O,Z)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}function fb(i,t){return i.x===t.x&&(i.x<0||i.x>Er)||i.y===t.y&&(i.y<0||i.y>Er)}function mb(i){return i.every(t=>t.x<0)||i.every(t=>t.x>Er)||i.every(t=>t.y<0)||i.every(t=>t.y>Er)}let __;Ge("FillExtrusionBucket",Vf,{omit:["layers","features"]});var gb={get paint(){return __=__||new m({"fill-extrusion-opacity":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ot(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yl(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ot(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ot(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class yb extends o{constructor(t){super(t,gb)}createBucket(t){return new Vf(t)}queryRadius(){return rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,a,h,g,y,v,b){const E=id(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),I=this.paint.get("fill-extrusion-height").evaluate(s,a),P=this.paint.get("fill-extrusion-base").evaluate(s,a),z=function(F,O,Z,X){const de=[];for(const re of F){const ue=[re.x,re.y,0,1];nd(ue,ue,O),de.push(new te(ue[0]/ue[3],ue[1]/ue[3]))}return de}(E,b),L=function(F,O,Z,X){const de=[],re=[],ue=X[8]*O,ye=X[9]*O,be=X[10]*O,$e=X[11]*O,st=X[8]*Z,Ve=X[9]*Z,Be=X[10]*Z,Qe=X[11]*Z;for(const He of F){const Ze=[],ve=[];for(const et of He){const Je=et.x,ht=et.y,Wt=X[0]*Je+X[4]*ht+X[12],Ht=X[1]*Je+X[5]*ht+X[13],Mr=X[2]*Je+X[6]*ht+X[14],Pn=X[3]*Je+X[7]*ht+X[15],Jr=Mr+be,zr=Pn+$e,yi=Wt+st,_i=Ht+Ve,vi=Mr+Be,fr=Pn+Qe,Dr=new te((Wt+ue)/zr,(Ht+ye)/zr);Dr.z=Jr/zr,Ze.push(Dr);const ai=new te(yi/fr,_i/fr);ai.z=vi/fr,ve.push(ai)}de.push(Ze),re.push(ve)}return[de,re]}(h,P,I,b);return function(F,O,Z){let X=1/0;Ky(Z,O)&&(X=v_(Z,O[0]));for(let de=0;de<O.length;de++){const re=O[de],ue=F[de];for(let ye=0;ye<re.length-1;ye++){const be=re[ye],$e=[be,re[ye+1],ue[ye+1],ue[ye],be];Xy(Z,$e)&&(X=Math.min(X,v_(Z,$e)))}}return X!==1/0&&X}(L[0],L[1],z)}}function mc(i,t){return i.x*t.x+i.y*t.y}function v_(i,t){if(i.length===1){let s=0;const a=t[s++];let h;for(;!h||a.equals(h);)if(h=t[s++],!h)return 1/0;for(;s<t.length;s++){const g=t[s],y=i[0],v=h.sub(a),b=g.sub(a),E=y.sub(a),I=mc(v,v),P=mc(v,b),z=mc(b,b),L=mc(E,v),F=mc(E,b),O=I*z-P*P,Z=(z*L-P*F)/O,X=(I*F-P*L)/O,de=a.z*(1-Z-X)+h.z*Z+g.z*X;if(isFinite(de))return de}return 1/0}{let s=1/0;for(const a of t)s=Math.min(s,a.z);return s}}const _b=x([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:vb}=_b,xb=x([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:wb}=xb,bb=ko.VectorTileFeature.types,Sb=Math.cos(Math.PI/180*37.5),x_=Math.pow(2,14)/.5;class jf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new vl,this.layoutVertexArray2=new xo,this.indexArray=new un,this.programConfigurations=new xa(t.layers,t.zoom),this.segments=new At,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){this.hasPattern=Bf("line",this.layers,s);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),y=[];for(const{feature:v,id:b,index:E,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,z=ba(v,P);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),z,a))continue;const L=g?h.evaluate(z,{},a):void 0,F={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:E,geometry:P?z.geometry:wa(v),patterns:{},sortKey:L};y.push(F)}g&&y.sort((v,b)=>v.sortKey-b.sortKey);for(const v of y){const{geometry:b,index:E,sourceLayerIndex:I}=v;if(this.hasPattern){const P=Ff("line",this.layers,v,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(v,b,E,a,{});s.featureIndex.insert(t[E].feature,b,E,I,this.index)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}addFeatures(t,s,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,wb)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vb),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,a,h,g){const y=this.layers[0].layout,v=y.get("line-join").evaluate(t,{}),b=y.get("line-cap"),E=y.get("line-miter-limit"),I=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of s)this.addLine(P,t,v,b,E,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}addLine(t,s,a,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=bb[s.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let E=0;for(;E<b-1&&t[E].equals(t[E+1]);)E++;if(b<(v?3:2))return;a==="bevel"&&(g=1.05);const I=this.overscaling<=16?15*Er/(512*this.overscaling):0,P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let z,L,F,O,Z;this.e1=this.e2=-1,v&&(z=t[b-2],Z=t[E].sub(z)._unit()._perp());for(let X=E;X<b;X++){if(F=X===b-1?v?t[E+1]:void 0:t[X+1],F&&t[X].equals(F))continue;Z&&(O=Z),z&&(L=z),z=t[X],Z=F?F.sub(z)._unit()._perp():O,O=O||Z;let de=O.add(Z);de.x===0&&de.y===0||de._unit();const re=O.x*Z.x+O.y*Z.y,ue=de.x*Z.x+de.y*Z.y,ye=ue!==0?1/ue:1/0,be=2*Math.sqrt(2-2*ue),$e=ue<Sb&&L&&F,st=O.x*Z.y-O.y*Z.x>0;if($e&&X>E){const Qe=z.dist(L);if(Qe>2*I){const He=z.sub(z.sub(L)._mult(I/Qe)._round());this.updateDistance(L,He),this.addCurrentVertex(He,O,0,0,P),L=He}}const Ve=L&&F;let Be=Ve?a:v?"butt":h;if(Ve&&Be==="round"&&(ye<y?Be="miter":ye<=2&&(Be="fakeround")),Be==="miter"&&ye>g&&(Be="bevel"),Be==="bevel"&&(ye>2&&(Be="flipbevel"),ye<g&&(Be="miter")),L&&this.updateDistance(L,z),Be==="miter")de._mult(ye),this.addCurrentVertex(z,de,0,0,P);else if(Be==="flipbevel"){if(ye>100)de=Z.mult(-1);else{const Qe=ye*O.add(Z).mag()/O.sub(Z).mag();de._perp()._mult(Qe*(st?-1:1))}this.addCurrentVertex(z,de,0,0,P),this.addCurrentVertex(z,de.mult(-1),0,0,P)}else if(Be==="bevel"||Be==="fakeround"){const Qe=-Math.sqrt(ye*ye-1),He=st?Qe:0,Ze=st?0:Qe;if(L&&this.addCurrentVertex(z,O,He,Ze,P),Be==="fakeround"){const ve=Math.round(180*be/Math.PI/20);for(let et=1;et<ve;et++){let Je=et/ve;if(Je!==.5){const Wt=Je-.5;Je+=Je*Wt*(Je-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*Wt*Wt+(.848013+re*(.215638*re-1.06021)))}const ht=Z.sub(O)._mult(Je)._add(O)._unit()._mult(st?-1:1);this.addHalfVertex(z,ht.x,ht.y,!1,st,0,P)}}F&&this.addCurrentVertex(z,Z,-He,-Ze,P)}else if(Be==="butt")this.addCurrentVertex(z,de,0,0,P);else if(Be==="square"){const Qe=L?1:-1;this.addCurrentVertex(z,de,Qe,Qe,P)}else Be==="round"&&(L&&(this.addCurrentVertex(z,O,0,0,P),this.addCurrentVertex(z,O,1,1,P,!0)),F&&(this.addCurrentVertex(z,Z,-1,-1,P,!0),this.addCurrentVertex(z,Z,0,0,P)));if($e&&X<b-1){const Qe=z.dist(F);if(Qe>2*I){const He=z.add(F.sub(z)._mult(I/Qe)._round());this.updateDistance(z,He),this.addCurrentVertex(He,Z,0,0,P),z=He}}}}addCurrentVertex(t,s,a,h,g,y=!1){const v=s.y*h-s.x,b=-s.y-s.x*h;this.addHalfVertex(t,s.x+s.y*a,s.y-s.x*a,y,!1,a,g),this.addHalfVertex(t,v,b,y,!0,-h,g),this.distance>x_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,a,h,g,y))}addHalfVertex({x:t,y:s},a,h,g,y,v,b){const E=.5*(this.lineClips?this.scaledDistance*(x_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(s<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),y?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let w_,b_;Ge("LineBucket",jf,{omit:["layers","patternFeatures"]});var S_={get paint(){return b_=b_||new m({"line-opacity":new ot(ge.paint_line["line-opacity"]),"line-color":new ot(ge.paint_line["line-color"]),"line-translate":new Xe(ge.paint_line["line-translate"]),"line-translate-anchor":new Xe(ge.paint_line["line-translate-anchor"]),"line-width":new ot(ge.paint_line["line-width"]),"line-gap-width":new ot(ge.paint_line["line-gap-width"]),"line-offset":new ot(ge.paint_line["line-offset"]),"line-blur":new ot(ge.paint_line["line-blur"]),"line-dasharray":new _l(ge.paint_line["line-dasharray"]),"line-pattern":new yl(ge.paint_line["line-pattern"]),"line-gradient":new sc(ge.paint_line["line-gradient"])})},get layout(){return w_=w_||new m({"line-cap":new Xe(ge.layout_line["line-cap"]),"line-join":new ot(ge.layout_line["line-join"]),"line-miter-limit":new Xe(ge.layout_line["line-miter-limit"]),"line-round-limit":new Xe(ge.layout_line["line-round-limit"]),"line-sort-key":new ot(ge.layout_line["line-sort-key"])})}};class Tb extends ot{possiblyEvaluate(t,s){return s=new Qt(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,a,h){return s=Fe({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,a,h)}}let ld;class kb extends o{constructor(t){super(t,S_),this.gradientVersion=0,ld||(ld=new Tb(S_.paint.properties["line-width"].specification),ld.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof eo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=ld.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new jf(t)}queryRadius(t){const s=t,a=T_(lc("line-width",this,s),lc("line-gap-width",this,s)),h=lc("line-offset",this,s);return a/2+Math.abs(h)+rd(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,a,h,g,y,v){const b=id(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),E=v/2*T_(this.paint.get("line-width").evaluate(s,a),this.paint.get("line-gap-width").evaluate(s,a)),I=this.paint.get("line-offset").evaluate(s,a);return I&&(h=function(P,z){const L=[];for(let F=0;F<P.length;F++){const O=P[F],Z=[];for(let X=0;X<O.length;X++){const de=O[X-1],re=O[X],ue=O[X+1],ye=X===0?new te(0,0):re.sub(de)._unit()._perp(),be=X===O.length-1?new te(0,0):ue.sub(re)._unit()._perp(),$e=ye._add(be)._unit(),st=$e.x*be.x+$e.y*be.y;st!==0&&$e._mult(1/st),Z.push($e._mult(z)._add(re))}L.push(Z)}return L}(h,I*v)),function(P,z,L){for(let F=0;F<z.length;F++){const O=z[F];if(P.length>=3){for(let Z=0;Z<O.length;Z++)if(kl(P,O[Z]))return!0}if(R1(P,O,L))return!0}return!1}(b,h,E)}isTileClipped(){return!0}}function T_(i,t){return t>0?t+2*i:i}const Eb=x([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ib=x([{name:"a_projected_pos",components:3,type:"Float32"}],4);x([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cb=x([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);x([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const k_=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Pb=x([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ab(i,t,s){return i.sections.forEach(a=>{a.text=function(h,g,y){const v=g.layout.get("text-transform").evaluate(y,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),Ai.applyArabicShaping&&(h=Ai.applyArabicShaping(h)),h}(a.text,t,s)}),i}x([{name:"triangle",components:3,type:"Uint16"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),x([{type:"Float32",name:"offsetX"}]),x([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),x([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const gc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Cr=24,E_=Gt,I_=function(i,t,s,a,h){var g,y,v=8*h-a-1,b=(1<<v)-1,E=b>>1,I=-7,P=h-1,z=-1,L=i[t+P];for(P+=z,g=L&(1<<-I)-1,L>>=-I,I+=v;I>0;g=256*g+i[t+P],P+=z,I-=8);for(y=g&(1<<-I)-1,g>>=-I,I+=a;I>0;y=256*y+i[t+P],P+=z,I-=8);if(g===0)g=1-E;else{if(g===b)return y?NaN:1/0*(L?-1:1);y+=Math.pow(2,a),g-=E}return(L?-1:1)*y*Math.pow(2,g-a)},C_=function(i,t,s,a,h,g){var y,v,b,E=8*g-h-1,I=(1<<E)-1,P=I>>1,z=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=0,F=1,O=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,y=I):(y=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-y))<1&&(y--,b*=2),(t+=y+P>=1?z/b:z*Math.pow(2,1-P))*b>=2&&(y++,b/=2),y+P>=I?(v=0,y=I):y+P>=1?(v=(t*b-1)*Math.pow(2,h),y+=P):(v=t*Math.pow(2,P-1)*Math.pow(2,h),y=0));h>=8;i[s+L]=255&v,L+=F,v/=256,h-=8);for(y=y<<h|v,E+=h;E>0;i[s+L]=255&y,L+=F,y/=256,E-=8);i[s+L-F]|=128*O};function Gt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Gt.Varint=0,Gt.Fixed64=1,Gt.Bytes=2,Gt.Fixed32=5;var Uf=4294967296,P_=1/Uf,A_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Bs(i){return i.type===Gt.Bytes?i.readVarint()+i.pos:i.pos+1}function Pl(i,t,s){return s?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function M_(i,t,s){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(a);for(var h=s.pos-1;h>=i;h--)s.buf[h+a]=s.buf[h]}function Mb(i,t){for(var s=0;s<i.length;s++)t.writeVarint(i[s])}function zb(i,t){for(var s=0;s<i.length;s++)t.writeSVarint(i[s])}function Db(i,t){for(var s=0;s<i.length;s++)t.writeFloat(i[s])}function Rb(i,t){for(var s=0;s<i.length;s++)t.writeDouble(i[s])}function Lb(i,t){for(var s=0;s<i.length;s++)t.writeBoolean(i[s])}function Bb(i,t){for(var s=0;s<i.length;s++)t.writeFixed32(i[s])}function Fb(i,t){for(var s=0;s<i.length;s++)t.writeSFixed32(i[s])}function Ob(i,t){for(var s=0;s<i.length;s++)t.writeFixed64(i[s])}function Nb(i,t){for(var s=0;s<i.length;s++)t.writeSFixed64(i[s])}function ud(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Al(i,t,s){i[s]=t,i[s+1]=t>>>8,i[s+2]=t>>>16,i[s+3]=t>>>24}function z_(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Gt.prototype={destroy:function(){this.buf=null},readFields:function(i,t,s){for(s=s||this.length;this.pos<s;){var a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,i(h,t,this),this.pos===g&&this.skip(a)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=ud(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=z_(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ud(this.buf,this.pos)+ud(this.buf,this.pos+4)*Uf;return this.pos+=8,i},readSFixed64:function(){var i=ud(this.buf,this.pos)+z_(this.buf,this.pos+4)*Uf;return this.pos+=8,i},readFloat:function(){var i=I_(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=I_(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,s,a=this.buf;return t=127&(s=a[this.pos++]),s<128?t:(t|=(127&(s=a[this.pos++]))<<7,s<128?t:(t|=(127&(s=a[this.pos++]))<<14,s<128?t:(t|=(127&(s=a[this.pos++]))<<21,s<128?t:function(h,g,y){var v,b,E=y.buf;if(v=(112&(b=E[y.pos++]))>>4,b<128||(v|=(127&(b=E[y.pos++]))<<3,b<128)||(v|=(127&(b=E[y.pos++]))<<10,b<128)||(v|=(127&(b=E[y.pos++]))<<17,b<128)||(v|=(127&(b=E[y.pos++]))<<24,b<128)||(v|=(1&(b=E[y.pos++]))<<31,b<128))return Pl(h,v,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&A_?function(s,a,h){return A_.decode(s.subarray(a,h))}(this.buf,t,i):function(s,a,h){for(var g="",y=a;y<h;){var v,b,E,I=s[y],P=null,z=I>239?4:I>223?3:I>191?2:1;if(y+z>h)break;z===1?I<128&&(P=I):z===2?(192&(v=s[y+1]))==128&&(P=(31&I)<<6|63&v)<=127&&(P=null):z===3?(b=s[y+2],(192&(v=s[y+1]))==128&&(192&b)==128&&((P=(15&I)<<12|(63&v)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):z===4&&(b=s[y+2],E=s[y+3],(192&(v=s[y+1]))==128&&(192&b)==128&&(192&E)==128&&((P=(15&I)<<18|(63&v)<<12|(63&b)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,z=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),y+=z}return g}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Gt.Bytes)return i.push(this.readVarint(t));var s=Bs(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Gt.Bytes)return i.push(this.readSVarint());var t=Bs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Gt.Bytes)return i.push(this.readBoolean());var t=Bs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Gt.Bytes)return i.push(this.readFloat());var t=Bs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Gt.Bytes)return i.push(this.readDouble());var t=Bs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Gt.Bytes)return i.push(this.readFixed32());var t=Bs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Gt.Bytes)return i.push(this.readSFixed32());var t=Bs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Gt.Bytes)return i.push(this.readFixed64());var t=Bs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Gt.Bytes)return i.push(this.readSFixed64());var t=Bs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Gt.Varint)for(;this.buf[this.pos++]>127;);else if(t===Gt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Gt.Fixed32)this.pos+=4;else{if(t!==Gt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Al(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Al(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Al(this.buf,-1&i,this.pos),Al(this.buf,Math.floor(i*P_),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Al(this.buf,-1&i,this.pos),Al(this.buf,Math.floor(i*P_),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,s){var a,h;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,y,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)}(a,0,s),function(g,y){var v=(7&g)<<4;y.buf[y.pos++]|=v|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(a,h,g){for(var y,v,b=0;b<h.length;b++){if((y=h.charCodeAt(b))>55295&&y<57344){if(!v){y>56319||b+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):v=y;continue}if(y<56320){a[g++]=239,a[g++]=191,a[g++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(a[g++]=239,a[g++]=191,a[g++]=189,v=null);y<128?a[g++]=y:(y<2048?a[g++]=y>>6|192:(y<65536?a[g++]=y>>12|224:(a[g++]=y>>18|240,a[g++]=y>>12&63|128),a[g++]=y>>6&63|128),a[g++]=63&y|128)}return g}(this.buf,i,this.pos);var s=this.pos-t;s>=128&&M_(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),C_(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),C_(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,t){this.pos++;var s=this.pos;i(t,this);var a=this.pos-s;a>=128&&M_(s,a,this),this.pos=s-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,t,s){this.writeTag(i,Gt.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Mb,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,zb,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Lb,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,Db,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,Rb,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Bb,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,Fb,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Ob,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,Nb,t)},writeBytesField:function(i,t){this.writeTag(i,Gt.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Gt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Gt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Gt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Gt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Gt.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Gt.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Gt.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Gt.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Gt.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var $f=j(E_);const qf=3;function Vb(i,t,s){i===1&&s.readMessage(jb,t)}function jb(i,t,s){if(i===3){const{id:a,bitmap:h,width:g,height:y,left:v,top:b,advance:E}=s.readMessage(Ub,{});t.push({id:a,bitmap:new cc({width:g+2*qf,height:y+2*qf},h),metrics:{width:g,height:y,left:v,top:b,advance:E}})}}function Ub(i,t,s){i===1?t.id=s.readVarint():i===2?t.bitmap=s.readBytes():i===3?t.width=s.readVarint():i===4?t.height=s.readVarint():i===5?t.left=s.readSVarint():i===6?t.top=s.readSVarint():i===7&&(t.advance=s.readVarint())}const D_=qf;function R_(i){let t=0,s=0;for(const y of i)t+=y.w*y.h,s=Math.max(s,y.w);i.sort((y,v)=>v.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let h=0,g=0;for(const y of i)for(let v=a.length-1;v>=0;v--){const b=a[v];if(!(y.w>b.w||y.h>b.h)){if(y.x=b.x,y.y=b.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===b.w&&y.h===b.h){const E=a.pop();v<a.length&&(a[v]=E)}else y.h===b.h?(b.x+=y.w,b.w-=y.w):y.w===b.w?(b.y+=y.h,b.h-=y.h):(a.push({x:b.x+y.w,y:b.y,w:b.w-y.w,h:y.h}),b.y+=y.h,b.h-=y.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}const zi=1;class Zf{constructor(t,{pixelRatio:s,version:a,stretchX:h,stretchY:g,content:y,textFitWidth:v,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=h,this.stretchY=g,this.content=y,this.version=a,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+zi,this.paddedRect.y+zi]}get br(){return[this.paddedRect.x+this.paddedRect.w-zi,this.paddedRect.y+this.paddedRect.h-zi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*zi)/this.pixelRatio,(this.paddedRect.h-2*zi)/this.pixelRatio]}}class L_{constructor(t,s){const a={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,a,g),this.addImages(s,h,g);const{w:y,h:v}=R_(g),b=new cn({width:y||1,height:v||1});for(const E in t){const I=t[E],P=a[E].paddedRect;cn.copy(I.data,b,{x:0,y:0},{x:P.x+zi,y:P.y+zi},I.data)}for(const E in s){const I=s[E],P=h[E].paddedRect,z=P.x+zi,L=P.y+zi,F=I.data.width,O=I.data.height;cn.copy(I.data,b,{x:0,y:0},{x:z,y:L},I.data),cn.copy(I.data,b,{x:0,y:O-1},{x:z,y:L-1},{width:F,height:1}),cn.copy(I.data,b,{x:0,y:0},{x:z,y:L+O},{width:F,height:1}),cn.copy(I.data,b,{x:F-1,y:0},{x:z-1,y:L},{width:1,height:O}),cn.copy(I.data,b,{x:0,y:0},{x:z+F,y:L},{width:1,height:O})}this.image=b,this.iconPositions=a,this.patternPositions=h}addImages(t,s,a){for(const h in t){const g=t[h],y={x:0,y:0,w:g.data.width+2*zi,h:g.data.height+2*zi};a.push(y),s[h]=new Zf(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),s),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),s)}patchUpdatedImage(t,s,a){if(!t||!s||t.version===s.version)return;t.version=s.version;const[h,g]=t.tl;a.update(s.data,void 0,{x:h,y:g})}}var Eo;Ge("ImagePosition",Zf),Ge("ImageAtlas",L_),w.ah=void 0,(Eo=w.ah||(w.ah={}))[Eo.none=0]="none",Eo[Eo.horizontal=1]="horizontal",Eo[Eo.vertical=2]="vertical",Eo[Eo.horizontalOnly=3]="horizontalOnly";const yc=-17;class _c{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const a=new _c;return a.scale=t||1,a.fontStack=s,a}static forImage(t){const s=new _c;return s.imageName=t,s}}class Ml{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const a=new Ml;for(let h=0;h<t.sections.length;h++){const g=t.sections[h];g.image?a.addImageSection(g):a.addTextSection(g,s)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let a=0;a<t.length;a++){const h=t.charCodeAt(a+1)||null,g=t.charCodeAt(a-1)||null;s+=h&&Xh(h)&&!gc[t[a+1]]||g&&Xh(g)&&!gc[t[a-1]]||!gc[t[a]]?t[a]:gc[t[a]]}return s}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&hd[this.text.charCodeAt(a)];a++)t++;let s=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&hd[this.text.charCodeAt(a)];a--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const a=new Ml;return a.text=this.text.substring(t,s),a.sectionIndex=this.sectionIndex.slice(t,s),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(_c.forText(t.scale,t.fontStack||s));const a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void Mt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(_c.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Mt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function cd(i,t,s,a,h,g,y,v,b,E,I,P,z,L,F){const O=Ml.fromFeature(i,h);let Z;P===w.ah.vertical&&O.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:de}=Ai;if(X&&O.sections.length===1){Z=[];const ye=X(O.toString(),Gf(O,E,g,t,a,L));for(const be of ye){const $e=new Ml;$e.text=be,$e.sections=O.sections;for(let st=0;st<be.length;st++)$e.sectionIndex.push(0);Z.push($e)}}else if(de){Z=[];const ye=de(O.text,O.sectionIndex,Gf(O,E,g,t,a,L));for(const be of ye){const $e=new Ml;$e.text=be[0],$e.sectionIndex=be[1],$e.sections=O.sections,Z.push($e)}}else Z=function(ye,be){const $e=[],st=ye.text;let Ve=0;for(const Be of be)$e.push(ye.substring(Ve,Be)),Ve=Be;return Ve<st.length&&$e.push(ye.substring(Ve,st.length)),$e}(O,Gf(O,E,g,t,a,L));const re=[],ue={positionedLines:re,text:O.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(ye,be,$e,st,Ve,Be,Qe,He,Ze,ve,et,Je){let ht=0,Wt=yc,Ht=0,Mr=0;const Pn=He==="right"?1:He==="left"?0:.5;let Jr=0;for(const fr of Ve){fr.trim();const Dr=fr.getMaxScale(),ai=(Dr-1)*Cr,Yr={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Jr]=Yr;const xi=Yr.positionedGlyphs;let Qr=0;if(!fr.length()){Wt+=Be,++Jr;continue}for(let Di=0;Di<fr.length();Di++){const Bt=fr.getSection(Di),Kt=fr.getSectionIndex(Di),ir=fr.getCharCode(Di);let Hi=0,ur=null,Ll=null,hs=null,ds=Cr;const An=!(Ze===w.ah.horizontal||!et&&!ic(ir)||et&&(hd[ir]||(zr=ir,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(zr)))));if(Bt.imageName){const pn=st[Bt.imageName];if(!pn)continue;hs=Bt.imageName,ye.iconsInText=ye.iconsInText||!0,Ll=pn.paddedRect;const jr=pn.displaySize;Bt.scale=Bt.scale*Cr/Je,ur={width:jr[0],height:jr[1],left:zi,top:-D_,advance:An?jr[1]:jr[0]},Hi=ai+(Cr-jr[1]*Bt.scale),ds=ur.advance;const Fs=An?jr[0]*Bt.scale-Cr*Dr:jr[1]*Bt.scale-Cr*Dr;Fs>0&&Fs>Qr&&(Qr=Fs)}else{const pn=$e[Bt.fontStack],jr=pn&&pn[ir];if(jr&&jr.rect)Ll=jr.rect,ur=jr.metrics;else{const Fs=be[Bt.fontStack],Tc=Fs&&Fs[ir];if(!Tc)continue;ur=Tc.metrics}Hi=(Dr-Bt.scale)*Cr}An?(ye.verticalizable=!0,xi.push({glyph:ir,imageName:hs,x:ht,y:Wt+Hi,vertical:An,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Kt,metrics:ur,rect:Ll}),ht+=ds*Bt.scale+ve):(xi.push({glyph:ir,imageName:hs,x:ht,y:Wt+Hi,vertical:An,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Kt,metrics:ur,rect:Ll}),ht+=ur.advance*Bt.scale+ve)}xi.length!==0&&(Ht=Math.max(ht-ve,Ht),Gb(xi,0,xi.length-1,Pn,Qr)),ht=0;const dn=Be*Dr+Qr;Yr.lineOffset=Math.max(Qr,ai),Wt+=dn,Mr=Math.max(dn,Mr),++Jr}var zr;const yi=Wt-yc,{horizontalAlign:_i,verticalAlign:vi}=Hf(Qe);(function(fr,Dr,ai,Yr,xi,Qr,dn,Di,Bt){const Kt=(Dr-ai)*xi;let ir=0;ir=Qr!==dn?-Di*Yr-yc:(-Yr*Bt+.5)*dn;for(const Hi of fr)for(const ur of Hi.positionedGlyphs)ur.x+=Kt,ur.y+=ir})(ye.positionedLines,Pn,_i,vi,Ht,Mr,Be,yi,Ve.length),ye.top+=-vi*yi,ye.bottom=ye.top+yi,ye.left+=-_i*Ht,ye.right=ye.left+Ht}(ue,t,s,a,Z,y,v,b,P,E,z,F),!function(ye){for(const be of ye)if(be.positionedGlyphs.length!==0)return!1;return!0}(re)&&ue}const hd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$b={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},qb={40:!0};function B_(i,t,s,a,h,g){if(t.imageName){const y=a[t.imageName];return y?y.displaySize[0]*t.scale*Cr/g+h:0}{const y=s[t.fontStack],v=y&&y[i];return v?v.metrics.advance*t.scale+h:0}}function F_(i,t,s,a){const h=Math.pow(i-t,2);return a?i<t?h/2:2*h:h+Math.abs(s)*s}function Zb(i,t,s){let a=0;return i===10&&(a-=1e4),s&&(a+=150),i!==40&&i!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function O_(i,t,s,a,h,g){let y=null,v=F_(t,s,h,g);for(const b of a){const E=F_(t-b.x,s,h,g)+b.badness;E<=v&&(y=b,v=E)}return{index:i,x:t,priorBreak:y,badness:v}}function N_(i){return i?N_(i.priorBreak).concat(i.index):[]}function Gf(i,t,s,a,h,g){if(!i)return[];const y=[],v=function(P,z,L,F,O,Z){let X=0;for(let de=0;de<P.length();de++){const re=P.getSection(de);X+=B_(P.getCharCode(de),re,F,O,z,Z)}return X/Math.max(1,Math.ceil(X/L))}(i,t,s,a,h,g),b=i.text.indexOf("")>=0;let E=0;for(let P=0;P<i.length();P++){const z=i.getSection(P),L=i.getCharCode(P);if(hd[L]||(E+=B_(L,z,a,h,t,g)),P<i.length()-1){const F=!((I=L)<11904)&&(!!Pt["CJK Compatibility Forms"](I)||!!Pt["CJK Compatibility"](I)||!!Pt["CJK Strokes"](I)||!!Pt["CJK Symbols and Punctuation"](I)||!!Pt["Enclosed CJK Letters and Months"](I)||!!Pt["Halfwidth and Fullwidth Forms"](I)||!!Pt["Ideographic Description Characters"](I)||!!Pt["Vertical Forms"](I)||Wh.test(String.fromCodePoint(I)));($b[L]||F||z.imageName||P!==i.length()-2&&qb[i.getCharCode(P+1)])&&y.push(O_(P+1,E,v,y,Zb(L,i.getCharCode(P+1),F&&b),!1))}}var I;return N_(O_(i.length(),E,v,y,0,!0))}function Hf(i){let t=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function Gb(i,t,s,a,h){if(!a&&!h)return;const g=i[s],y=(i[s].x+g.metrics.advance*g.scale)*a;for(let v=t;v<=s;v++)i[v].x-=y,i[v].y+=h}function Hb(i,t,s){const{horizontalAlign:a,verticalAlign:h}=Hf(s),g=t[0]-i.displaySize[0]*a,y=t[1]-i.displaySize[1]*h;return{image:i,top:y,bottom:y+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function V_(i){var t,s;let a=i.left,h=i.top,g=i.right-a,y=i.bottom-h;const v=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(s=i.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",E=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&g/y<E||v==="proportional"){const I=Math.ceil(y*E);a*=I/g,g=I}}else if(v==="proportional"&&b==="stretchOnly"&&E!==0&&g/y>E){const I=Math.ceil(g/E);h*=I/y,y=I}return{x1:a,y1:h,x2:a+g,y2:h+y}}function j_(i,t,s,a,h,g){const y=i.image;let v;if(y.content){const Z=y.content,X=y.pixelRatio||1;v=[Z[0]/X,Z[1]/X,y.displaySize[0]-Z[2]/X,y.displaySize[1]-Z[3]/X]}const b=t.left*g,E=t.right*g;let I,P,z,L;s==="width"||s==="both"?(L=h[0]+b-a[3],P=h[0]+E+a[1]):(L=h[0]+(b+E-y.displaySize[0])/2,P=L+y.displaySize[0]);const F=t.top*g,O=t.bottom*g;return s==="height"||s==="both"?(I=h[1]+F-a[0],z=h[1]+O+a[2]):(I=h[1]+(F+O-y.displaySize[1])/2,z=I+y.displaySize[1]),{image:y,top:I,right:P,bottom:z,left:L,collisionPadding:v}}const vc=255,cs=128,Io=vc*cs;function U_(i,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Qt(i+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=s;let g=0;for(;g<a.length&&a[g]<=i;)g++;g=Math.max(0,g-1);let y=g;for(;y<a.length&&a[y]<i+1;)y++;y=Math.min(a.length-1,y);const v=a[g],b=a[y];return s.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:b,minSize:s.evaluate(new Qt(v)),maxSize:s.evaluate(new Qt(b)),interpolationType:h}}}function Wf(i,t,s){let a="never";const h=i.get(t);return h?a=h:i.get(s)&&(a="always"),a}const Wb=ko.VectorTileFeature.types,Xb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dd(i,t,s,a,h,g,y,v,b,E,I,P,z){const L=v?Math.min(Io,Math.round(v[0])):0,F=v?Math.min(Io,Math.round(v[1])):0;i.emplaceBack(t,s,Math.round(32*a),Math.round(32*h),g,y,(L<<1)+(b?1:0),F,16*E,16*I,256*P,256*z)}function Xf(i,t,s){i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s)}function Kb(i){for(const t of i.sections)if(Sf(t.text))return!0;return!1}class Kf{constructor(t){this.layoutVertexArray=new xl,this.indexArray=new un,this.programConfigurations=t,this.segments=new At,this.dynamicLayoutVertexArray=new oc,this.opacityVertexArray=new Zi,this.hasVisibleVertices=!1,this.placedSymbolArray=new er}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Eb.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Ib.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Xb,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ge("SymbolBuffers",Kf);class Jf{constructor(t,s,a){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new a,this.segments=new At,this.collisionVertexArray=new ls}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Cb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ge("CollisionBuffers",Jf);class zl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Af([]),this.placementViewportMatrix=Af([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=U_(this.zoom,s["text-size"]),this.iconSizeData=U_(this.zoom,s["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=Wf(a,"text-overlap","text-allow-overlap")!=="never"||Wf(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>w.ah[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID}createArrays(){this.text=new Kf(new xa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Kf(new xa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new tr,this.lineVertexArray=new Hr,this.symbolInstances=new Ct,this.textAnchorOffsets=new rr}calculateGlyphDependencies(t,s,a,h,g){for(let y=0;y<t.length;y++)if(s[t.charCodeAt(y)]=!0,(a||h)&&g){const v=gc[t.charAt(y)];v&&(s[v.charCodeAt(0)]=!0)}}populate(t,s,a){const h=this.layers[0],g=h.layout,y=g.get("text-font"),v=g.get("text-field"),b=g.get("icon-image"),E=(v.value.kind!=="constant"||v.value.value instanceof Ei&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),I=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!E&&!I)return;const z=s.iconDependencies,L=s.glyphDependencies,F=s.availableImages,O=new Qt(this.zoom);for(const{feature:Z,id:X,index:de,sourceLayerIndex:re}of t){const ue=h._featureFilter.needGeometry,ye=ba(Z,ue);if(!h._featureFilter.filter(O,ye,a))continue;let be,$e;if(ue||(ye.geometry=wa(Z)),E){const Ve=h.getValueAndResolveTokens("text-field",ye,a,F),Be=Ei.factory(Ve),Qe=this.hasRTLText=this.hasRTLText||Kb(Be);(!Qe||Ai.getRTLTextPluginStatus()==="unavailable"||Qe&&Ai.isParsed())&&(be=Ab(Be,h,ye))}if(I){const Ve=h.getValueAndResolveTokens("icon-image",ye,a,F);$e=Ve instanceof Ci?Ve:Ci.fromString(Ve)}if(!be&&!$e)continue;const st=this.sortFeaturesByKey?P.evaluate(ye,{},a):void 0;if(this.features.push({id:X,text:be,icon:$e,index:de,sourceLayerIndex:re,geometry:ye.geometry,properties:Z.properties,type:Wb[Z.type],sortKey:st}),$e&&(z[$e.name]=!0),be){const Ve=y.evaluate(ye,{},a).join(","),Be=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ah.vertical)>=0;for(const Qe of be.sections)if(Qe.image)z[Qe.image.name]=!0;else{const He=tc(be.toString()),Ze=Qe.fontStack||Ve,ve=L[Ze]=L[Ze]||{};this.calculateGlyphDependencies(Qe.text,ve,Be,this.allowVerticalPlacement,He)}}}g.get("symbol-placement")==="line"&&(this.features=function(Z){const X={},de={},re=[];let ue=0;function ye(Ve){re.push(Z[Ve]),ue++}function be(Ve,Be,Qe){const He=de[Ve];return delete de[Ve],de[Be]=He,re[He].geometry[0].pop(),re[He].geometry[0]=re[He].geometry[0].concat(Qe[0]),He}function $e(Ve,Be,Qe){const He=X[Be];return delete X[Be],X[Ve]=He,re[He].geometry[0].shift(),re[He].geometry[0]=Qe[0].concat(re[He].geometry[0]),He}function st(Ve,Be,Qe){const He=Qe?Be[0][Be[0].length-1]:Be[0][0];return`${Ve}:${He.x}:${He.y}`}for(let Ve=0;Ve<Z.length;Ve++){const Be=Z[Ve],Qe=Be.geometry,He=Be.text?Be.text.toString():null;if(!He){ye(Ve);continue}const Ze=st(He,Qe),ve=st(He,Qe,!0);if(Ze in de&&ve in X&&de[Ze]!==X[ve]){const et=$e(Ze,ve,Qe),Je=be(Ze,ve,re[et].geometry);delete X[Ze],delete de[ve],de[st(He,re[Je].geometry,!0)]=Je,re[et].geometry=null}else Ze in de?be(Ze,ve,Qe):ve in X?$e(Ze,ve,Qe):(ye(Ve),X[Ze]=ue-1,de[ve]=ue-1)}return re.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,X)=>Z.sortKey-X.sortKey)}update(t,s,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const a=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(s[t.segment+1]),g=t.dist(s[t.segment]);const y={};for(let v=t.segment+1;v<s.length;v++)y[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:h},v<s.length-1&&(h+=s[v+1].dist(s[v]));for(let v=t.segment||0;v>=0;v--)y[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=s[v-1].dist(s[v]));for(let v=0;v<s.length;v++){const b=y[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,s,a,h,g,y,v,b,E,I,P,z){const L=t.indexArray,F=t.layoutVertexArray,O=t.segments.prepareSegment(4*s.length,F,L,this.canOverlap?y.sortKey:void 0),Z=this.glyphOffsetArray.length,X=O.vertexLength,de=this.allowVerticalPlacement&&v===w.ah.vertical?Math.PI/2:0,re=y.text&&y.text.sections;for(let ue=0;ue<s.length;ue++){const{tl:ye,tr:be,bl:$e,br:st,tex:Ve,pixelOffsetTL:Be,pixelOffsetBR:Qe,minFontScaleX:He,minFontScaleY:Ze,glyphOffset:ve,isSDF:et,sectionIndex:Je}=s[ue],ht=O.vertexLength,Wt=ve[1];dd(F,b.x,b.y,ye.x,Wt+ye.y,Ve.x,Ve.y,a,et,Be.x,Be.y,He,Ze),dd(F,b.x,b.y,be.x,Wt+be.y,Ve.x+Ve.w,Ve.y,a,et,Qe.x,Be.y,He,Ze),dd(F,b.x,b.y,$e.x,Wt+$e.y,Ve.x,Ve.y+Ve.h,a,et,Be.x,Qe.y,He,Ze),dd(F,b.x,b.y,st.x,Wt+st.y,Ve.x+Ve.w,Ve.y+Ve.h,a,et,Qe.x,Qe.y,He,Ze),Xf(t.dynamicLayoutVertexArray,b,de),L.emplaceBack(ht,ht+1,ht+2),L.emplaceBack(ht+1,ht+2,ht+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ve[0]),ue!==s.length-1&&Je===s[ue+1].sectionIndex||t.programConfigurations.populatePaintArrays(F.length,y,y.index,{},z,re&&re[Je])}t.placedSymbolArray.emplaceBack(b.x,b.y,Z,this.glyphOffsetArray.length-Z,X,E,I,b.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,P)}_addCollisionDebugVertex(t,s,a,h,g,y){return s.emplaceBack(0,0),t.emplaceBack(a.x,a.y,h,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,s,a,h,g,y,v){const b=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),E=b.vertexLength,I=g.layoutVertexArray,P=g.collisionVertexArray,z=v.anchorX,L=v.anchorY;this._addCollisionDebugVertex(I,P,y,z,L,new te(t,s)),this._addCollisionDebugVertex(I,P,y,z,L,new te(a,s)),this._addCollisionDebugVertex(I,P,y,z,L,new te(a,h)),this._addCollisionDebugVertex(I,P,y,z,L,new te(t,h)),b.vertexLength+=4;const F=g.indexArray;F.emplaceBack(E,E+1),F.emplaceBack(E+1,E+2),F.emplaceBack(E+2,E+3),F.emplaceBack(E+3,E),b.primitiveLength+=4}addDebugCollisionBoxes(t,s,a,h){for(let g=t;g<s;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jf(Gi,k_.members,Vr),this.iconCollisionBox=new Jf(Gi,k_.members,Vr);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,a,h,g,y,v,b,E){const I={};for(let P=s;P<a;P++){const z=t.get(P);I.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.textFeatureIndex=z.featureIndex;break}for(let P=h;P<g;P++){const z=t.get(P);I.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.verticalTextFeatureIndex=z.featureIndex;break}for(let P=y;P<v;P++){const z=t.get(P);I.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.iconFeatureIndex=z.featureIndex;break}for(let P=b;P<E;P++){const z=t.get(P);I.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.verticalIconFeatureIndex=z.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const a=t.placedSymbolArray.get(s),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),a=Math.cos(t),h=[],g=[],y=[];for(let v=0;v<this.symbolInstances.length;++v){y.push(v);const b=this.symbolInstances.get(v);h.push(0|Math.round(s*b.anchorX+a*b.anchorY)),g.push(b.featureIndex)}return y.sort((v,b)=>h[v]-h[b]||g[b]-g[v]),y}addToSortKeyRanges(t,s){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===s?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const a=this.symbolInstances.get(s);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let $_,q_;Ge("SymbolBucket",zl,{omit:["layers","collisionBoxArray","features","compareText"]}),zl.MAX_GLYPHS=65535,zl.addDynamicAttributes=Xf;var Yf={get paint(){return q_=q_||new m({"icon-opacity":new ot(ge.paint_symbol["icon-opacity"]),"icon-color":new ot(ge.paint_symbol["icon-color"]),"icon-halo-color":new ot(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new ot(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ot(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Xe(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xe(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new ot(ge.paint_symbol["text-opacity"]),"text-color":new ot(ge.paint_symbol["text-color"],{runtimeType:di,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ot(ge.paint_symbol["text-halo-color"]),"text-halo-width":new ot(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new ot(ge.paint_symbol["text-halo-blur"]),"text-translate":new Xe(ge.paint_symbol["text-translate"]),"text-translate-anchor":new Xe(ge.paint_symbol["text-translate-anchor"])})},get layout(){return $_=$_||new m({"symbol-placement":new Xe(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Xe(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xe(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ot(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xe(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xe(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xe(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xe(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xe(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xe(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new ot(ge.layout_symbol["icon-size"]),"icon-text-fit":new Xe(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xe(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new ot(ge.layout_symbol["icon-image"]),"icon-rotate":new ot(ge.layout_symbol["icon-rotate"]),"icon-padding":new ot(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Xe(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new ot(ge.layout_symbol["icon-offset"]),"icon-anchor":new ot(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xe(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xe(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xe(ge.layout_symbol["text-rotation-alignment"]),"text-field":new ot(ge.layout_symbol["text-field"]),"text-font":new ot(ge.layout_symbol["text-font"]),"text-size":new ot(ge.layout_symbol["text-size"]),"text-max-width":new ot(ge.layout_symbol["text-max-width"]),"text-line-height":new Xe(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new ot(ge.layout_symbol["text-letter-spacing"]),"text-justify":new ot(ge.layout_symbol["text-justify"]),"text-radial-offset":new ot(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xe(ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ot(ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ot(ge.layout_symbol["text-anchor"]),"text-max-angle":new Xe(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Xe(ge.layout_symbol["text-writing-mode"]),"text-rotate":new ot(ge.layout_symbol["text-rotate"]),"text-padding":new Xe(ge.layout_symbol["text-padding"]),"text-keep-upright":new Xe(ge.layout_symbol["text-keep-upright"]),"text-transform":new ot(ge.layout_symbol["text-transform"]),"text-offset":new ot(ge.layout_symbol["text-offset"]),"text-allow-overlap":new Xe(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new Xe(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new Xe(ge.layout_symbol["text-ignore-placement"]),"text-optional":new Xe(ge.layout_symbol["text-optional"])})}};class Z_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ns,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ge("FormatSectionOverride",Z_,{omit:["defaultValue"]});class pd extends o{constructor(t){super(t,Yf)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,a,h){const g=this.layout.get(t).evaluate(s,{},a,h),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||sl(y.value)||!g?g:function(v,b){return b.replace(/{([^{}]+)}/g,(E,I)=>v&&I in v?String(v[I]):"")}(s.properties,g)}createBucket(t){return new zl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Yf.paint.overridableProperties){if(!pd.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),a=new Z_(s),h=new nl(a,s.property.specification);let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new uo("source",h):new co("composite",h,s.value.zoomStops),this.paint._values[t]=new In(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,a){return!(!this.layout||s.isDataDriven()||a.isDataDriven())&&pd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const a=t.get("text-field"),h=Yf.paint.properties[s];let g=!1;const y=v=>{for(const b of v)if(h.overrides&&h.overrides.hasOverride(b))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Ei)y(a.value.value.sections);else if(a.value.kind==="source"){const v=E=>{g||(E instanceof rn&&kr(E.value)===Un?y(E.value.sections):E instanceof Xa?y(E.sections):E.eachChild(v))},b=a.value;b._styleExpression&&v(b._styleExpression.expression)}return g}}let G_;var Jb={get paint(){return G_=G_||new m({"background-color":new Xe(ge.paint_background["background-color"]),"background-pattern":new _l(ge.paint_background["background-pattern"]),"background-opacity":new Xe(ge.paint_background["background-opacity"])})}};class Yb extends o{constructor(t){super(t,Jb)}}let H_;var Qb={get paint(){return H_=H_||new m({"raster-opacity":new Xe(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xe(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xe(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xe(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Xe(ge.paint_raster["raster-saturation"]),"raster-contrast":new Xe(ge.paint_raster["raster-contrast"]),"raster-resampling":new Xe(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Xe(ge.paint_raster["raster-fade-duration"])})}};class e2 extends o{constructor(t){super(t,Qb)}}class t2 extends o{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class r2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Qf=63710088e-1;class Co{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Co(Ne(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,a=this.lat*s,h=t.lat*s,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*s);return Qf*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof Co)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Co(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Co(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const W_=2*Math.PI*Qf;function X_(i){return W_*Math.cos(i*Math.PI/180)}function K_(i){return(180+i)/360}function J_(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Y_(i,t){return i/X_(t)}function em(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class xc{constructor(t,s,a=0){this.x=+t,this.y=+s,this.z=+a}static fromLngLat(t,s=0){const a=Co.convert(t);return new xc(K_(a.lng),J_(a.lat),Y_(s,a.lat))}toLngLat(){return new Co(360*this.x-180,em(this.y))}toAltitude(){return this.z*X_(em(this.y))}meterInMercatorCoordinateUnits(){return 1/W_*(t=em(this.y),1/Math.cos(t*Math.PI/180));var t}}function Q_(i,t,s){var a=2*Math.PI*6378137/256/Math.pow(2,s);return[i*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class tm{constructor(t,s,a){if(!function(h,g,y){return!(h<0||h>25||y<0||y>=Math.pow(2,h)||g<0||g>=Math.pow(2,h))}(t,s,a))throw new Error(`x=${s}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=a,this.key=wc(0,t,t,s,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,a){const h=(y=this.y,v=this.z,b=Q_(256*(g=this.x),256*(y=Math.pow(2,v)-y-1),v),E=Q_(256*(g+1),256*(y+1),v),b[0]+","+b[1]+","+E[0]+","+E[1]);var g,y,v,b,E;const I=function(P,z,L){let F,O="";for(let Z=P;Z>0;Z--)F=1<<Z-1,O+=(z&F?1:0)+(L&F?2:0);return O}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new te((t.x*s-this.x)*Er,(t.y*s-this.y)*Er)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ev{constructor(t,s){this.wrap=t,this.canonical=s,this.key=wc(t,s.z,s.z,s.x,s.y)}}class hn{constructor(t,s,a,h,g){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=s,this.canonical=new tm(a,+h,+g),this.key=wc(s,t,a,h,g)}clone(){return new hn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new hn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hn(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?wc(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):wc(this.wrap*+s,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new hn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new hn(s,this.wrap,s,a,h),new hn(s,this.wrap,s,a+1,h),new hn(s,this.wrap,s,a,h+1),new hn(s,this.wrap,s,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new hn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new hn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ev(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new xc(t.x-this.wrap,t.y))}}function wc(i,t,s,a,h){(i*=2)<0&&(i=-1*i-1);const g=1<<s;return(g*g*i+g*h+a).toString(36)+s.toString(36)+t.toString(36)}Ge("CanonicalTileID",tm),Ge("OverscaledTileID",hn,{omit:["posMatrix"]});class tv{constructor(t,s,a,h=1,g=1,y=1,v=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Mt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const b=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=y,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<b;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(b,E)]=this.data[this._idx(b-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,b)]=this.data[this._idx(E,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<b;E++)for(let I=0;I<b;I++){const P=this.get(E,I);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,s){const a=new Uint8Array(this.data.buffer),h=4*this._idx(t,s);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,a){return t*this.redFactor+s*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new cn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,g=s*this.dim+this.dim,y=a*this.dim,v=a*this.dim+this.dim;switch(s){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:y=v-1;break;case 1:v=y+1}const b=-s*this.dim,E=-a*this.dim;for(let I=y;I<v;I++)for(let P=h;P<g;P++)this.data[this._idx(P,I)]=t.data[this._idx(P+b,I+E)]}}Ge("DEMData",tv);class rv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const a=t[s];this._stringToNumber[a]=s,this._numberToString[s]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class iv{constructor(t,s,a,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=a,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class nv{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new fo(Er,16,0),this.grid3D=new fo(Er,16,0),this.featureIndexArray=new si,this.promoteId=s}insert(t,s,a,h,g,y){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g);const b=y?this.grid3D:this.grid;for(let E=0;E<s.length;E++){const I=s[E],P=[1/0,1/0,-1/0,-1/0];for(let z=0;z<I.length;z++){const L=I[z];P[0]=Math.min(P[0],L.x),P[1]=Math.min(P[1],L.y),P[2]=Math.max(P[2],L.x),P[3]=Math.max(P[3],L.y)}P[0]<Er&&P[1]<Er&&P[2]>=0&&P[3]>=0&&b.insert(v,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ko.VectorTile(new $f(this.rawTileData)).layers,this.sourceLayerCoder=new rv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,a,h){this.loadVTLayers();const g=t.params||{},y=Er/t.tileSize/t.scale,v=Vu(g.filter),b=t.queryGeometry,E=t.queryPadding*y,I=ov(b),P=this.grid.query(I.minX-E,I.minY-E,I.maxX+E,I.maxY+E),z=ov(t.cameraQueryGeometry),L=this.grid3D.query(z.minX-E,z.minY-E,z.maxX+E,z.maxY+E,(Z,X,de,re)=>function(ue,ye,be,$e,st){for(const Be of ue)if(ye<=Be.x&&be<=Be.y&&$e>=Be.x&&st>=Be.y)return!0;const Ve=[new te(ye,be),new te(ye,st),new te($e,st),new te($e,be)];if(ue.length>2){for(const Be of Ve)if(kl(ue,Be))return!0}for(let Be=0;Be<ue.length-1;Be++)if(B1(ue[Be],ue[Be+1],Ve))return!0;return!1}(t.cameraQueryGeometry,Z-E,X-E,de+E,re+E));for(const Z of L)P.push(Z);P.sort(i2);const F={};let O;for(let Z=0;Z<P.length;Z++){const X=P[Z];if(X===O)continue;O=X;const de=this.featureIndexArray.get(X);let re=null;this.loadMatchingFeature(F,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,v,g.layers,g.availableImages,s,a,h,(ue,ye,be)=>(re||(re=wa(ue)),ye.queryIntersectsFeature(b,ue,be,re,this.z,t.transform,y,t.pixelPosMatrix)))}return F}loadMatchingFeature(t,s,a,h,g,y,v,b,E,I,P){const z=this.bucketLayerIDs[s];if(y&&!function(Z,X){for(let de=0;de<Z.length;de++)if(X.indexOf(Z[de])>=0)return!0;return!1}(y,z))return;const L=this.sourceLayerCoder.decode(a),F=this.vtLayers[L].feature(h);if(g.needGeometry){const Z=ba(F,!0);if(!g.filter(new Qt(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!g.filter(new Qt(this.tileID.overscaledZ),F))return;const O=this.getId(F,L);for(let Z=0;Z<z.length;Z++){const X=z[Z];if(y&&y.indexOf(X)<0)continue;const de=b[X];if(!de)continue;let re={};O&&I&&(re=I.getState(de.sourceLayer||"_geojsonTileLayer",O));const ue=Fe({},E[X]);ue.paint=sv(ue.paint,de.paint,F,re,v),ue.layout=sv(ue.layout,de.layout,F,re,v);const ye=!P||P(F,de,re);if(!ye)continue;const be=new iv(F,this.z,this.x,this.y,O);be.layer=ue;let $e=t[X];$e===void 0&&($e=t[X]=[]),$e.push({featureIndex:h,feature:be,intersectionZ:ye})}}lookupSymbolFeatures(t,s,a,h,g,y,v,b){const E={};this.loadVTLayers();const I=Vu(g);for(const P of t)this.loadMatchingFeature(E,a,h,P,I,y,v,b,s);return E}hasLayer(t){for(const s of this.bucketLayerIDs)for(const a of s)if(t===a)return!0;return!1}getId(t,s){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof a=="boolean"&&(a=Number(a))),a}}function sv(i,t,s,a,h){return kt(i,(g,y)=>{const v=t instanceof ya?t.get(y):null;return v&&v.evaluate?v.evaluate(s,a,h):v})}function ov(i){let t=1/0,s=1/0,a=-1/0,h=-1/0;for(const g of i)t=Math.min(t,g.x),s=Math.min(s,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{minX:t,minY:s,maxX:a,maxY:h}}function i2(i,t){return t-i}function av(i,t,s,a,h){const g=[];for(let y=0;y<i.length;y++){const v=i[y];let b;for(let E=0;E<v.length-1;E++){let I=v[E],P=v[E+1];I.x<t&&P.x<t||(I.x<t?I=new te(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<t&&(P=new te(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<s&&P.y<s||(I.y<s?I=new te(I.x+(s-I.y)/(P.y-I.y)*(P.x-I.x),s)._round():P.y<s&&(P=new te(I.x+(s-I.y)/(P.y-I.y)*(P.x-I.x),s)._round()),I.x>=a&&P.x>=a||(I.x>=a?I=new te(a,I.y+(a-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=a&&(P=new te(a,I.y+(a-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=h&&P.y>=h||(I.y>=h?I=new te(I.x+(h-I.y)/(P.y-I.y)*(P.x-I.x),h)._round():P.y>=h&&(P=new te(I.x+(h-I.y)/(P.y-I.y)*(P.x-I.x),h)._round()),b&&I.equals(b[b.length-1])||(b=[I],g.push(b)),b.push(P)))))}}return g}Ge("FeatureIndex",nv,{omit:["rawTileData","sourceLayerCoder"]});class Po extends te{constructor(t,s,a,h){super(t,s),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new Po(this.x,this.y,this.angle,this.segment)}}function lv(i,t,s,a,h){if(t.segment===void 0||s===0)return!0;let g=t,y=t.segment+1,v=0;for(;v>-s/2;){if(y--,y<0)return!1;v-=i[y].dist(g),g=i[y]}v+=i[y].dist(i[y+1]),y++;const b=[];let E=0;for(;v<s/2;){const I=i[y],P=i[y+1];if(!P)return!1;let z=i[y-1].angleTo(I)-I.angleTo(P);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:z}),E+=z;v-b[0].distance>a;)E-=b.shift().angleDelta;if(E>h)return!1;y++,v+=I.dist(P)}return!0}function uv(i){let t=0;for(let s=0;s<i.length-1;s++)t+=i[s].dist(i[s+1]);return t}function cv(i,t,s){return i?.6*t*s:0}function hv(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function n2(i,t,s,a,h,g){const y=cv(s,h,g),v=hv(s,a)*g;let b=0;const E=uv(i)/2;for(let I=0;I<i.length-1;I++){const P=i[I],z=i[I+1],L=P.dist(z);if(b+L>E){const F=(E-b)/L,O=pi.number(P.x,z.x,F),Z=pi.number(P.y,z.y,F),X=new Po(O,Z,z.angleTo(P),I);return X._round(),!y||lv(i,X,v,y,t)?X:void 0}b+=L}}function s2(i,t,s,a,h,g,y,v,b){const E=cv(a,g,y),I=hv(a,h),P=I*y,z=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return t-P<t/4&&(t=P+t/4),dv(i,z?t/2*v%t:(I/2+2*g)*y*v%t,t,E,s,P,z,!1,b)}function dv(i,t,s,a,h,g,y,v,b){const E=g/2,I=uv(i);let P=0,z=t-s,L=[];for(let F=0;F<i.length-1;F++){const O=i[F],Z=i[F+1],X=O.dist(Z),de=Z.angleTo(O);for(;z+s<P+X;){z+=s;const re=(z-P)/X,ue=pi.number(O.x,Z.x,re),ye=pi.number(O.y,Z.y,re);if(ue>=0&&ue<b&&ye>=0&&ye<b&&z-E>=0&&z+E<=I){const be=new Po(ue,ye,de,F);be._round(),a&&!lv(i,be,g,a,h)||L.push(be)}}P+=X}return v||L.length||y||(L=dv(i,P/2,s,a,h,g,y,!0,b)),L}Ge("Anchor",Po);const Dl=zi;function pv(i,t,s,a){const h=[],g=i.image,y=g.pixelRatio,v=g.paddedRect.w-2*Dl,b=g.paddedRect.h-2*Dl;let E={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const I=g.stretchX||[[0,v]],P=g.stretchY||[[0,b]],z=(ve,et)=>ve+et[1]-et[0],L=I.reduce(z,0),F=P.reduce(z,0),O=v-L,Z=b-F;let X=0,de=L,re=0,ue=F,ye=0,be=O,$e=0,st=Z;if(g.content&&a){const ve=g.content,et=ve[2]-ve[0],Je=ve[3]-ve[1];(g.textFitWidth||g.textFitHeight)&&(E=V_(i)),X=fd(I,0,ve[0]),re=fd(P,0,ve[1]),de=fd(I,ve[0],ve[2]),ue=fd(P,ve[1],ve[3]),ye=ve[0]-X,$e=ve[1]-re,be=et-de,st=Je-ue}const Ve=E.x1,Be=E.y1,Qe=E.x2-Ve,He=E.y2-Be,Ze=(ve,et,Je,ht)=>{const Wt=md(ve.stretch-X,de,Qe,Ve),Ht=gd(ve.fixed-ye,be,ve.stretch,L),Mr=md(et.stretch-re,ue,He,Be),Pn=gd(et.fixed-$e,st,et.stretch,F),Jr=md(Je.stretch-X,de,Qe,Ve),zr=gd(Je.fixed-ye,be,Je.stretch,L),yi=md(ht.stretch-re,ue,He,Be),_i=gd(ht.fixed-$e,st,ht.stretch,F),vi=new te(Wt,Mr),fr=new te(Jr,Mr),Dr=new te(Jr,yi),ai=new te(Wt,yi),Yr=new te(Ht/y,Pn/y),xi=new te(zr/y,_i/y),Qr=t*Math.PI/180;if(Qr){const Bt=Math.sin(Qr),Kt=Math.cos(Qr),ir=[Kt,-Bt,Bt,Kt];vi._matMult(ir),fr._matMult(ir),ai._matMult(ir),Dr._matMult(ir)}const dn=ve.stretch+ve.fixed,Di=et.stretch+et.fixed;return{tl:vi,tr:fr,bl:ai,br:Dr,tex:{x:g.paddedRect.x+Dl+dn,y:g.paddedRect.y+Dl+Di,w:Je.stretch+Je.fixed-dn,h:ht.stretch+ht.fixed-Di},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yr,pixelOffsetBR:xi,minFontScaleX:be/y/Qe,minFontScaleY:st/y/He,isSDF:s}};if(a&&(g.stretchX||g.stretchY)){const ve=fv(I,O,L),et=fv(P,Z,F);for(let Je=0;Je<ve.length-1;Je++){const ht=ve[Je],Wt=ve[Je+1];for(let Ht=0;Ht<et.length-1;Ht++)h.push(Ze(ht,et[Ht],Wt,et[Ht+1]))}}else h.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return h}function fd(i,t,s){let a=0;for(const h of i)a+=Math.max(t,Math.min(s,h[1]))-Math.max(t,Math.min(s,h[0]));return a}function fv(i,t,s){const a=[{fixed:-Dl,stretch:0}];for(const[h,g]of i){const y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return a.push({fixed:t+Dl,stretch:s}),a}function md(i,t,s,a){return i/t*s+a}function gd(i,t,s,a){return i-t*s/a}class yd{constructor(t,s,a,h,g,y,v,b,E,I){var P;if(this.boxStartIndex=t.length,E){let z=y.top,L=y.bottom;const F=y.collisionPadding;F&&(z-=F[1],L+=F[3]);let O=L-z;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{const z=!((P=y.image)===null||P===void 0)&&P.content&&(y.image.textFitWidth||y.image.textFitHeight)?V_(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};z.y1=z.y1*v-b[0],z.y2=z.y2*v+b[2],z.x1=z.x1*v-b[3],z.x2=z.x2*v+b[1];const L=y.collisionPadding;if(L&&(z.x1-=L[0]*v,z.y1-=L[1]*v,z.x2+=L[2]*v,z.y2+=L[3]*v),I){const F=new te(z.x1,z.y1),O=new te(z.x2,z.y1),Z=new te(z.x1,z.y2),X=new te(z.x2,z.y2),de=I*Math.PI/180;F._rotate(de),O._rotate(de),Z._rotate(de),X._rotate(de),z.x1=Math.min(F.x,O.x,Z.x,X.x),z.x2=Math.max(F.x,O.x,Z.x,X.x),z.y1=Math.min(F.y,O.y,Z.y,X.y),z.y2=Math.max(F.y,O.y,Z.y,X.y)}t.emplaceBack(s.x,s.y,z.x1,z.y1,z.x2,z.y2,a,h,g)}this.boxEndIndex=t.length}}class o2{constructor(t=[],s=(a,h)=>a<h?-1:a>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:a}=this,h=s[t];for(;t>0;){const g=t-1>>1,y=s[g];if(a(h,y)>=0)break;s[t]=y,t=g}s[t]=h}_down(t){const{data:s,compare:a}=this,h=this.length>>1,g=s[t];for(;t<h;){let y=1+(t<<1);const v=y+1;if(v<this.length&&a(s[v],s[y])<0&&(y=v),a(s[y],g)>=0)break;s[t]=s[y],t=y}s[t]=g}}function a2(i,t=1,s=!1){let a=1/0,h=1/0,g=-1/0,y=-1/0;const v=i[0];for(let L=0;L<v.length;L++){const F=v[L];(!L||F.x<a)&&(a=F.x),(!L||F.y<h)&&(h=F.y),(!L||F.x>g)&&(g=F.x),(!L||F.y>y)&&(y=F.y)}const b=Math.min(g-a,y-h);let E=b/2;const I=new o2([],l2);if(b===0)return new te(a,h);for(let L=a;L<g;L+=b)for(let F=h;F<y;F+=b)I.push(new Rl(L+E,F+E,E,i));let P=function(L){let F=0,O=0,Z=0;const X=L[0];for(let de=0,re=X.length,ue=re-1;de<re;ue=de++){const ye=X[de],be=X[ue],$e=ye.x*be.y-be.x*ye.y;O+=(ye.x+be.x)*$e,Z+=(ye.y+be.y)*$e,F+=3*$e}return new Rl(O/F,Z/F,0,L)}(i),z=I.length;for(;I.length;){const L=I.pop();(L.d>P.d||!P.d)&&(P=L,s&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,z)),L.max-P.d<=t||(E=L.h/2,I.push(new Rl(L.p.x-E,L.p.y-E,E,i)),I.push(new Rl(L.p.x+E,L.p.y-E,E,i)),I.push(new Rl(L.p.x-E,L.p.y+E,E,i)),I.push(new Rl(L.p.x+E,L.p.y+E,E,i)),z+=4)}return s&&(console.log(`num probes: ${z}`),console.log(`best distance: ${P.d}`)),P.p}function l2(i,t){return t.max-i.max}function Rl(i,t,s,a){this.p=new te(i,t),this.h=s,this.d=function(h,g){let y=!1,v=1/0;for(let b=0;b<g.length;b++){const E=g[b];for(let I=0,P=E.length,z=P-1;I<P;z=I++){const L=E[I],F=E[z];L.y>h.y!=F.y>h.y&&h.x<(F.x-L.x)*(h.y-L.y)/(F.y-L.y)+L.x&&(y=!y),v=Math.min(v,Jy(h,L,F))}}return(y?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Kr;w.aq=void 0,(Kr=w.aq||(w.aq={}))[Kr.center=1]="center",Kr[Kr.left=2]="left",Kr[Kr.right=3]="right",Kr[Kr.top=4]="top",Kr[Kr.bottom=5]="bottom",Kr[Kr["top-left"]=6]="top-left",Kr[Kr["top-right"]=7]="top-right",Kr[Kr["bottom-left"]=8]="bottom-left",Kr[Kr["bottom-right"]=9]="bottom-right";const Ao=7,rm=Number.POSITIVE_INFINITY;function mv(i,t){return t[1]!==rm?function(s,a,h){let g=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),s){case"top-right":case"top-left":case"top":y=h-Ao;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+Ao}switch(s){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,y]}(i,t[0],t[1]):function(s,a){let h=0,g=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(s){case"top-right":case"top-left":g=y-Ao;break;case"bottom-right":case"bottom-left":g=-y+Ao;break;case"bottom":g=-a+Ao;break;case"top":g=a-Ao}switch(s){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,g]}(i,t[0])}function gv(i,t,s){var a;const h=i.layout,g=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},s);if(g){const v=g.values,b=[];for(let E=0;E<v.length;E+=2){const I=b[E]=v[E],P=v[E+1].map(z=>z*Cr);I.startsWith("top")?P[1]-=Ao:I.startsWith("bottom")&&(P[1]+=Ao),b[E+1]=P}return new Vi(b)}const y=h.get("text-variable-anchor");if(y){let v;v=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},s)*Cr,rm]:h.get("text-offset").evaluate(t,{},s).map(E=>E*Cr);const b=[];for(const E of y)b.push(E,mv(E,v));return new Vi(b)}return null}function im(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function u2(i,t,s,a,h,g,y,v,b,E,I){let P=g.textMaxSize.evaluate(t,{});P===void 0&&(P=y);const z=i.layers[0].layout,L=z.get("icon-offset").evaluate(t,{},I),F=_v(s.horizontal),O=y/24,Z=i.tilePixelRatio*O,X=i.tilePixelRatio*P/24,de=i.tilePixelRatio*v,re=i.tilePixelRatio*z.get("symbol-spacing"),ue=z.get("text-padding")*i.tilePixelRatio,ye=function(ve,et,Je,ht=1){const Wt=ve.get("icon-padding").evaluate(et,{},Je),Ht=Wt&&Wt.values;return[Ht[0]*ht,Ht[1]*ht,Ht[2]*ht,Ht[3]*ht]}(z,t,I,i.tilePixelRatio),be=z.get("text-max-angle")/180*Math.PI,$e=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",st=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ve=z.get("symbol-placement"),Be=re/2,Qe=z.get("icon-text-fit");let He;a&&Qe!=="none"&&(i.allowVerticalPlacement&&s.vertical&&(He=j_(a,s.vertical,Qe,z.get("icon-text-fit-padding"),L,O)),F&&(a=j_(a,F,Qe,z.get("icon-text-fit-padding"),L,O)));const Ze=(ve,et)=>{et.x<0||et.x>=Er||et.y<0||et.y>=Er||function(Je,ht,Wt,Ht,Mr,Pn,Jr,zr,yi,_i,vi,fr,Dr,ai,Yr,xi,Qr,dn,Di,Bt,Kt,ir,Hi,ur,Ll){const hs=Je.addToLineVertexArray(ht,Wt);let ds,An,pn,jr,Fs=0,Tc=0,bv=0,Sv=0,hm=-1,dm=-1;const Os={};let Tv=wl("");if(Je.allowVerticalPlacement&&Ht.vertical){const li=zr.layout.get("text-rotate").evaluate(Kt,{},ur)+90;pn=new yd(yi,ht,_i,vi,fr,Ht.vertical,Dr,ai,Yr,li),Jr&&(jr=new yd(yi,ht,_i,vi,fr,Jr,Qr,dn,Yr,li))}if(Mr){const li=zr.layout.get("icon-rotate").evaluate(Kt,{}),fn=zr.layout.get("icon-text-fit")!=="none",Ta=pv(Mr,li,Hi,fn),Hn=Jr?pv(Jr,li,Hi,fn):void 0;An=new yd(yi,ht,_i,vi,fr,Mr,Qr,dn,!1,li),Fs=4*Ta.length;const ka=Je.iconSizeData;let ps=null;ka.kind==="source"?(ps=[cs*zr.layout.get("icon-size").evaluate(Kt,{})],ps[0]>Io&&Mt(`${Je.layerIds[0]}: Value for "icon-size" is >= ${vc}. Reduce your "icon-size".`)):ka.kind==="composite"&&(ps=[cs*ir.compositeIconSizes[0].evaluate(Kt,{},ur),cs*ir.compositeIconSizes[1].evaluate(Kt,{},ur)],(ps[0]>Io||ps[1]>Io)&&Mt(`${Je.layerIds[0]}: Value for "icon-size" is >= ${vc}. Reduce your "icon-size".`)),Je.addSymbols(Je.icon,Ta,ps,Bt,Di,Kt,w.ah.none,ht,hs.lineStartIndex,hs.lineLength,-1,ur),hm=Je.icon.placedSymbolArray.length-1,Hn&&(Tc=4*Hn.length,Je.addSymbols(Je.icon,Hn,ps,Bt,Di,Kt,w.ah.vertical,ht,hs.lineStartIndex,hs.lineLength,-1,ur),dm=Je.icon.placedSymbolArray.length-1)}const kv=Object.keys(Ht.horizontal);for(const li of kv){const fn=Ht.horizontal[li];if(!ds){Tv=wl(fn.text);const Hn=zr.layout.get("text-rotate").evaluate(Kt,{},ur);ds=new yd(yi,ht,_i,vi,fr,fn,Dr,ai,Yr,Hn)}const Ta=fn.positionedLines.length===1;if(bv+=yv(Je,ht,fn,Pn,zr,Yr,Kt,xi,hs,Ht.vertical?w.ah.horizontal:w.ah.horizontalOnly,Ta?kv:[li],Os,hm,ir,ur),Ta)break}Ht.vertical&&(Sv+=yv(Je,ht,Ht.vertical,Pn,zr,Yr,Kt,xi,hs,w.ah.vertical,["vertical"],Os,dm,ir,ur));const d2=ds?ds.boxStartIndex:Je.collisionBoxArray.length,p2=ds?ds.boxEndIndex:Je.collisionBoxArray.length,f2=pn?pn.boxStartIndex:Je.collisionBoxArray.length,m2=pn?pn.boxEndIndex:Je.collisionBoxArray.length,g2=An?An.boxStartIndex:Je.collisionBoxArray.length,y2=An?An.boxEndIndex:Je.collisionBoxArray.length,_2=jr?jr.boxStartIndex:Je.collisionBoxArray.length,v2=jr?jr.boxEndIndex:Je.collisionBoxArray.length;let Gn=-1;const vd=(li,fn)=>li&&li.circleDiameter?Math.max(li.circleDiameter,fn):fn;Gn=vd(ds,Gn),Gn=vd(pn,Gn),Gn=vd(An,Gn),Gn=vd(jr,Gn);const Ev=Gn>-1?1:0;Ev&&(Gn*=Ll/Cr),Je.glyphOffsetArray.length>=zl.MAX_GLYPHS&&Mt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Kt.sortKey!==void 0&&Je.addToSortKeyRanges(Je.symbolInstances.length,Kt.sortKey);const x2=gv(zr,Kt,ur),[w2,b2]=function(li,fn){const Ta=li.length,Hn=fn==null?void 0:fn.values;if((Hn==null?void 0:Hn.length)>0)for(let ka=0;ka<Hn.length;ka+=2){const ps=Hn[ka+1];li.emplaceBack(w.aq[Hn[ka]],ps[0],ps[1])}return[Ta,li.length]}(Je.textAnchorOffsets,x2);Je.symbolInstances.emplaceBack(ht.x,ht.y,Os.right>=0?Os.right:-1,Os.center>=0?Os.center:-1,Os.left>=0?Os.left:-1,Os.vertical||-1,hm,dm,Tv,d2,p2,f2,m2,g2,y2,_2,v2,_i,bv,Sv,Fs,Tc,Ev,0,Dr,Gn,w2,b2)}(i,et,ve,s,a,h,He,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,Z,[ue,ue,ue,ue],$e,b,de,ye,st,L,t,g,E,I,y)};if(Ve==="line")for(const ve of av(t.geometry,0,0,Er,Er)){const et=s2(ve,re,be,s.vertical||F,a,24,X,i.overscaling,Er);for(const Je of et)F&&c2(i,F.text,Be,Je)||Ze(ve,Je)}else if(Ve==="line-center"){for(const ve of t.geometry)if(ve.length>1){const et=n2(ve,be,s.vertical||F,a,24,X);et&&Ze(ve,et)}}else if(t.type==="Polygon")for(const ve of Ja(t.geometry,0)){const et=a2(ve,16);Ze(ve[0],new Po(et.x,et.y,0))}else if(t.type==="LineString")for(const ve of t.geometry)Ze(ve,new Po(ve[0].x,ve[0].y,0));else if(t.type==="Point")for(const ve of t.geometry)for(const et of ve)Ze([et],new Po(et.x,et.y,0))}function yv(i,t,s,a,h,g,y,v,b,E,I,P,z,L,F){const O=function(de,re,ue,ye,be,$e,st,Ve){const Be=ye.layout.get("text-rotate").evaluate($e,{})*Math.PI/180,Qe=[];for(const He of re.positionedLines)for(const Ze of He.positionedGlyphs){if(!Ze.rect)continue;const ve=Ze.rect||{};let et=D_+1,Je=!0,ht=1,Wt=0;const Ht=(be||Ve)&&Ze.vertical,Mr=Ze.metrics.advance*Ze.scale/2;if(Ve&&re.verticalizable&&(Wt=He.lineOffset/2-(Ze.imageName?-(Cr-Ze.metrics.width*Ze.scale)/2:(Ze.scale-1)*Cr)),Ze.imageName){const Bt=st[Ze.imageName];Je=Bt.sdf,ht=Bt.pixelRatio,et=zi/ht}const Pn=be?[Ze.x+Mr,Ze.y]:[0,0];let Jr=be?[0,0]:[Ze.x+Mr+ue[0],Ze.y+ue[1]-Wt],zr=[0,0];Ht&&(zr=Jr,Jr=[0,0]);const yi=Ze.metrics.isDoubleResolution?2:1,_i=(Ze.metrics.left-et)*Ze.scale-Mr+Jr[0],vi=(-Ze.metrics.top-et)*Ze.scale+Jr[1],fr=_i+ve.w/yi*Ze.scale/ht,Dr=vi+ve.h/yi*Ze.scale/ht,ai=new te(_i,vi),Yr=new te(fr,vi),xi=new te(_i,Dr),Qr=new te(fr,Dr);if(Ht){const Bt=new te(-Mr,Mr-yc),Kt=-Math.PI/2,ir=Cr/2-Mr,Hi=new te(5-yc-ir,-(Ze.imageName?ir:0)),ur=new te(...zr);ai._rotateAround(Kt,Bt)._add(Hi)._add(ur),Yr._rotateAround(Kt,Bt)._add(Hi)._add(ur),xi._rotateAround(Kt,Bt)._add(Hi)._add(ur),Qr._rotateAround(Kt,Bt)._add(Hi)._add(ur)}if(Be){const Bt=Math.sin(Be),Kt=Math.cos(Be),ir=[Kt,-Bt,Bt,Kt];ai._matMult(ir),Yr._matMult(ir),xi._matMult(ir),Qr._matMult(ir)}const dn=new te(0,0),Di=new te(0,0);Qe.push({tl:ai,tr:Yr,bl:xi,br:Qr,tex:ve,writingMode:re.writingMode,glyphOffset:Pn,sectionIndex:Ze.sectionIndex,isSDF:Je,pixelOffsetTL:dn,pixelOffsetBR:Di,minFontScaleX:0,minFontScaleY:0})}return Qe}(0,s,v,h,g,y,a,i.allowVerticalPlacement),Z=i.textSizeData;let X=null;Z.kind==="source"?(X=[cs*h.layout.get("text-size").evaluate(y,{})],X[0]>Io&&Mt(`${i.layerIds[0]}: Value for "text-size" is >= ${vc}. Reduce your "text-size".`)):Z.kind==="composite"&&(X=[cs*L.compositeTextSizes[0].evaluate(y,{},F),cs*L.compositeTextSizes[1].evaluate(y,{},F)],(X[0]>Io||X[1]>Io)&&Mt(`${i.layerIds[0]}: Value for "text-size" is >= ${vc}. Reduce your "text-size".`)),i.addSymbols(i.text,O,X,v,g,y,E,t,b.lineStartIndex,b.lineLength,z,F);for(const de of I)P[de]=i.text.placedSymbolArray.length-1;return 4*O.length}function _v(i){for(const t in i)return i[t];return null}function c2(i,t,s,a){const h=i.compareText;if(t in h){const g=h[t];for(let y=g.length-1;y>=0;y--)if(a.dist(g[y])<s)return!0}else h[t]=[];return h[t].push(a),!1}const vv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class nm{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,a]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=vv[15&a];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new nm(v,y,g,t)}constructor(t,s=64,a=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=vv.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=s,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return sm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:v}=this,b=[0,g.length-1,0],E=[];for(;b.length;){const I=b.pop()||0,P=b.pop()||0,z=b.pop()||0;if(P-z<=v){for(let Z=z;Z<=P;Z++){const X=y[2*Z],de=y[2*Z+1];X>=t&&X<=a&&de>=s&&de<=h&&E.push(g[Z])}continue}const L=z+P>>1,F=y[2*L],O=y[2*L+1];F>=t&&F<=a&&O>=s&&O<=h&&E.push(g[L]),(I===0?t<=F:s<=O)&&(b.push(z),b.push(L-1),b.push(1-I)),(I===0?a>=F:h>=O)&&(b.push(L+1),b.push(P),b.push(1-I))}return E}within(t,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:y}=this,v=[0,h.length-1,0],b=[],E=a*a;for(;v.length;){const I=v.pop()||0,P=v.pop()||0,z=v.pop()||0;if(P-z<=y){for(let Z=z;Z<=P;Z++)wv(g[2*Z],g[2*Z+1],t,s)<=E&&b.push(h[Z]);continue}const L=z+P>>1,F=g[2*L],O=g[2*L+1];wv(F,O,t,s)<=E&&b.push(h[L]),(I===0?t-a<=F:s-a<=O)&&(v.push(z),v.push(L-1),v.push(1-I)),(I===0?t+a>=F:s+a>=O)&&(v.push(L+1),v.push(P),v.push(1-I))}return b}}function sm(i,t,s,a,h,g){if(h-a<=s)return;const y=a+h>>1;xv(i,t,y,a,h,g),sm(i,t,s,a,y-1,1-g),sm(i,t,s,y+1,h,1-g)}function xv(i,t,s,a,h,g){for(;h>a;){if(h-a>600){const E=h-a+1,I=s-a+1,P=Math.log(E),z=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*z*(E-z)/E)*(I-E/2<0?-1:1);xv(i,t,s,Math.max(a,Math.floor(s-I*z/E+L)),Math.min(h,Math.floor(s+(E-I)*z/E+L)),g)}const y=t[2*s+g];let v=a,b=h;for(bc(i,t,a,s),t[2*h+g]>y&&bc(i,t,a,h);v<b;){for(bc(i,t,v,b),v++,b--;t[2*v+g]<y;)v++;for(;t[2*b+g]>y;)b--}t[2*a+g]===y?bc(i,t,a,b):(b++,bc(i,t,b,h)),b<=s&&(a=b+1),s<=b&&(h=b-1)}}function bc(i,t,s,a){om(i,s,a),om(t,2*s,2*a),om(t,2*s+1,2*a+1)}function om(i,t,s){const a=i[t];i[t]=i[s],i[s]=a}function wv(i,t,s,a){const h=i-s,g=t-a;return h*h+g*g}var am;w.bg=void 0,(am=w.bg||(w.bg={})).create="create",am.load="load",am.fullLoad="fullLoad";let _d=null,Sc=[];const lm=1e3/60,um="loadTime",cm="fullLoadTime",h2={mark(i){performance.mark(i)},frame(i){const t=i;_d!=null&&Sc.push(t-_d),_d=t},clearMetrics(){_d=null,Sc=[],performance.clearMeasures(um),performance.clearMeasures(cm);for(const i in w.bg)performance.clearMarks(w.bg[i])},getPerformanceMetrics(){performance.measure(um,w.bg.create,w.bg.load),performance.measure(cm,w.bg.create,w.bg.fullLoad);const i=performance.getEntriesByName(um)[0].duration,t=performance.getEntriesByName(cm)[0].duration,s=Sc.length,a=1/(Sc.reduce((g,y)=>g+y,0)/s/1e3),h=Sc.filter(g=>g>lm).reduce((g,y)=>g+(y-lm)/lm,0);return{loadTime:i,fullLoadTime:t,fps:a,percentDroppedFrames:h/(s+h)*100,totalFrames:s}}};w.$=class extends A{},w.A=El,w.B=_f,w.C=function(i){if(ri==null){const t=i.navigator?i.navigator.userAgent:null;ri=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ri},w.D=Xe,w.E=rs,w.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new r2(()=>this.process()),this.subscription=function(s,a,h,g){return s.addEventListener(a,h,!1),{unsubscribe:()=>{s.removeEventListener(a,h,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=wr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((s,a)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:s,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const v={id:h,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)},{once:!0});const g=[],y=Object.assign(Object.assign({},i),{id:h,sourceMapId:this.mapId,origin:location.origin,data:mo(i.data,g)});this.target.postMessage(y,{transfer:g})})}receive(i){const t=i.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const a=this.abortControllers[s];return delete this.abortControllers[s],void(a&&a.abort())}if(wr(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[i];return delete this.resolveRejects[i],h?void(t.error?h.reject(go(t.error)):h.resolve(go(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=go(t.data),a=new AbortController;this.abortControllers[i]=a;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,s,a);this.completeTask(i,null,h)}catch(h){this.completeTask(i,h)}})}completeTask(i,t,s){const a=[];delete this.abortControllers[i];const h={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?mo(t):null,data:mo(s,a)};this.target.postMessage(h,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.G=qr,w.H=function(){var i=new El(16);return El!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},w.I=Zf,w.J=function(i,t,s){var a,h,g,y,v,b,E,I,P,z,L,F,O=s[0],Z=s[1],X=s[2];return t===i?(i[12]=t[0]*O+t[4]*Z+t[8]*X+t[12],i[13]=t[1]*O+t[5]*Z+t[9]*X+t[13],i[14]=t[2]*O+t[6]*Z+t[10]*X+t[14],i[15]=t[3]*O+t[7]*Z+t[11]*X+t[15]):(h=t[1],g=t[2],y=t[3],v=t[4],b=t[5],E=t[6],I=t[7],P=t[8],z=t[9],L=t[10],F=t[11],i[0]=a=t[0],i[1]=h,i[2]=g,i[3]=y,i[4]=v,i[5]=b,i[6]=E,i[7]=I,i[8]=P,i[9]=z,i[10]=L,i[11]=F,i[12]=a*O+v*Z+P*X+t[12],i[13]=h*O+b*Z+z*X+t[13],i[14]=g*O+E*Z+L*X+t[14],i[15]=y*O+I*Z+F*X+t[15]),i},w.K=function(i,t,s){var a=s[0],h=s[1],g=s[2];return i[0]=t[0]*a,i[1]=t[1]*a,i[2]=t[2]*a,i[3]=t[3]*a,i[4]=t[4]*h,i[5]=t[5]*h,i[6]=t[6]*h,i[7]=t[7]*h,i[8]=t[8]*g,i[9]=t[9]*g,i[10]=t[10]*g,i[11]=t[11]*g,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.L=t_,w.M=function(i,t){const s={};for(let a=0;a<t.length;a++){const h=t[a];h in i&&(s[h]=i[h])}return s},w.N=Co,w.O=K_,w.P=te,w.Q=J_,w.R=cn,w.S=hn,w.T=gl,w.U=ae,w.V=ne,w.W=lt,w.X=Er,w.Y=x,w.Z=xc,w._=d,w.a=br,w.a$=function(i,t){var s=i[0],a=i[1],h=i[2],g=i[3],y=i[4],v=i[5],b=i[6],E=i[7],I=i[8],P=i[9],z=i[10],L=i[11],F=i[12],O=i[13],Z=i[14],X=i[15],de=t[0],re=t[1],ue=t[2],ye=t[3],be=t[4],$e=t[5],st=t[6],Ve=t[7],Be=t[8],Qe=t[9],He=t[10],Ze=t[11],ve=t[12],et=t[13],Je=t[14],ht=t[15];return Math.abs(s-de)<=gi*Math.max(1,Math.abs(s),Math.abs(de))&&Math.abs(a-re)<=gi*Math.max(1,Math.abs(a),Math.abs(re))&&Math.abs(h-ue)<=gi*Math.max(1,Math.abs(h),Math.abs(ue))&&Math.abs(g-ye)<=gi*Math.max(1,Math.abs(g),Math.abs(ye))&&Math.abs(y-be)<=gi*Math.max(1,Math.abs(y),Math.abs(be))&&Math.abs(v-$e)<=gi*Math.max(1,Math.abs(v),Math.abs($e))&&Math.abs(b-st)<=gi*Math.max(1,Math.abs(b),Math.abs(st))&&Math.abs(E-Ve)<=gi*Math.max(1,Math.abs(E),Math.abs(Ve))&&Math.abs(I-Be)<=gi*Math.max(1,Math.abs(I),Math.abs(Be))&&Math.abs(P-Qe)<=gi*Math.max(1,Math.abs(P),Math.abs(Qe))&&Math.abs(z-He)<=gi*Math.max(1,Math.abs(z),Math.abs(He))&&Math.abs(L-Ze)<=gi*Math.max(1,Math.abs(L),Math.abs(Ze))&&Math.abs(F-ve)<=gi*Math.max(1,Math.abs(F),Math.abs(ve))&&Math.abs(O-et)<=gi*Math.max(1,Math.abs(O),Math.abs(et))&&Math.abs(Z-Je)<=gi*Math.max(1,Math.abs(Z),Math.abs(Je))&&Math.abs(X-ht)<=gi*Math.max(1,Math.abs(X),Math.abs(ht))},w.a0=At,w.a1=tm,w.a2=ke,w.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const a of i){const h=window.document.createElement("source");Nn(a)||(t.crossOrigin="Anonymous"),h.src=a,t.appendChild(h)}})},w.a4=function(){return Ye++},w.a5=Ue,w.a6=zl,w.a7=Vu,w.a8=ba,w.a9=iv,w.aA=function(i){if(i.type==="custom")return new t2(i);switch(i.type){case"background":return new Yb(i);case"circle":return new N1(i);case"fill":return new rb(i);case"fill-extrusion":return new yb(i);case"heatmap":return new j1(i);case"hillshade":return new $1(i);case"line":return new kb(i);case"raster":return new e2(i);case"symbol":return new pd(i)}},w.aB=mt,w.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let s=[];try{if(!wt(i.version,t.version))return[{command:"setStyle",args:[t]}];wt(i.center,t.center)||s.push({command:"setCenter",args:[t.center]}),wt(i.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),wt(i.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),wt(i.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),wt(i.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),wt(i.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),wt(i.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),wt(i.light,t.light)||s.push({command:"setLight",args:[t.light]}),wt(i.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),wt(i.sky,t.sky)||s.push({command:"setSky",args:[t.sky]}),wt(i.projection,t.projection)||s.push({command:"setProjection",args:[t.projection]});const a={},h=[];(function(y,v,b,E){let I;for(I in v=v||{},y=y||{})Object.prototype.hasOwnProperty.call(y,I)&&(Object.prototype.hasOwnProperty.call(v,I)||en(I,b,E));for(I in v)Object.prototype.hasOwnProperty.call(v,I)&&(Object.prototype.hasOwnProperty.call(y,I)?wt(y[I],v[I])||(y[I].type==="geojson"&&v[I].type==="geojson"&&Vn(y,v,I)?sr(b,{command:"setGeoJSONSourceData",args:[I,v[I].data]}):Oi(I,v,b,E)):is(I,v,b))})(i.sources,t.sources,h,a);const g=[];i.layers&&i.layers.forEach(y=>{"source"in y&&a[y.source]?s.push({command:"removeLayer",args:[y.id]}):g.push(y)}),s=s.concat(h),function(y,v,b){v=v||[];const E=(y=y||[]).map(Ks),I=v.map(Ks),P=y.reduce(jn,{}),z=v.reduce(jn,{}),L=E.slice(),F=Object.create(null);let O,Z,X,de,re;for(let ue=0,ye=0;ue<E.length;ue++)O=E[ue],Object.prototype.hasOwnProperty.call(z,O)?ye++:(sr(b,{command:"removeLayer",args:[O]}),L.splice(L.indexOf(O,ye),1));for(let ue=0,ye=0;ue<I.length;ue++)O=I[I.length-1-ue],L[L.length-1-ue]!==O&&(Object.prototype.hasOwnProperty.call(P,O)?(sr(b,{command:"removeLayer",args:[O]}),L.splice(L.lastIndexOf(O,L.length-ye),1)):ye++,de=L[L.length-ue],sr(b,{command:"addLayer",args:[z[O],de]}),L.splice(L.length-ue,0,O),F[O]=!0);for(let ue=0;ue<I.length;ue++)if(O=I[ue],Z=P[O],X=z[O],!F[O]&&!wt(Z,X))if(wt(Z.source,X.source)&&wt(Z["source-layer"],X["source-layer"])&&wt(Z.type,X.type)){for(re in ii(Z.layout,X.layout,b,O,null,"setLayoutProperty"),ii(Z.paint,X.paint,b,O,null,"setPaintProperty"),wt(Z.filter,X.filter)||sr(b,{command:"setFilter",args:[O,X.filter]}),wt(Z.minzoom,X.minzoom)&&wt(Z.maxzoom,X.maxzoom)||sr(b,{command:"setLayerZoomRange",args:[O,X.minzoom,X.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?ii(Z[re],X[re],b,O,re.slice(6),"setPaintProperty"):wt(Z[re],X[re])||sr(b,{command:"setLayerProperty",args:[O,re,X[re]]}));for(re in X)Object.prototype.hasOwnProperty.call(X,re)&&!Object.prototype.hasOwnProperty.call(Z,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?ii(Z[re],X[re],b,O,re.slice(6),"setPaintProperty"):wt(Z[re],X[re])||sr(b,{command:"setLayerProperty",args:[O,re,X[re]]}))}else sr(b,{command:"removeLayer",args:[O]}),de=L[L.lastIndexOf(O)+1],sr(b,{command:"addLayer",args:[X,de]})}(g,t.layers,s)}catch(a){console.warn("Unable to compute style diff:",a),s=[{command:"setStyle",args:[t]}]}return s},w.aD=function(i){const t=[],s=i.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},w.aE=function i(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let a=0;a<t.length;a++)if(!i(t[a],s[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const a in t)if(!i(t[a],s[a]))return!1;return!0}return t===s},w.aF=kt,w.aG=it,w.aH=class extends va{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},w.aI=ed,w.aJ=class extends va{constructor(i,t){super(i,t),this.current=M1}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},w.aK=qy,w.aL=Zy,w.aM=$t,w.aN=class extends va{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},w.aO=class extends va{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},w.aP=function(i,t,s,a,h,g,y){var v=1/(t-s),b=1/(a-h),E=1/(g-y);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(t+s)*v,i[13]=(h+a)*b,i[14]=(y+g)*E,i[15]=1,i},w.aQ=O1,w.aR=class extends se{},w.aS=Pb,w.aT=class extends pe{},w.aU=Df,w.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},w.aW=o_,w.aX=Wr,w.aY=un,w.aZ=class extends Ke{},w.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},w.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,a,h,g)=>{const y=h||g;return t[a]=!y||y.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},w.ab=function(i,t){const s=[];for(const a in i)a in t||s.push(a);return s},w.ac=je,w.ad=function(i,t,s){var a=Math.sin(s),h=Math.cos(s),g=t[0],y=t[1],v=t[2],b=t[3],E=t[4],I=t[5],P=t[6],z=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=g*h+E*a,i[1]=y*h+I*a,i[2]=v*h+P*a,i[3]=b*h+z*a,i[4]=E*h-g*a,i[5]=I*h-y*a,i[6]=P*h-v*a,i[7]=z*h-b*a,i},w.ae=function(i){var t=new El(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},w.af=nd,w.ag=function(i,t){let s=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:y}=i,v=h?je(fi.interpolationFactor(h,t,g,y),0,1):0;i.kind==="camera"?a=pi.number(i.minSize,i.maxSize,v):s=v}return{uSizeT:s,uSize:a}},w.ai=function(i,{uSize:t,uSizeT:s},{lowerSize:a,upperSize:h}){return i.kind==="source"?a/cs:i.kind==="composite"?pi.number(a/cs,h/cs,s):t},w.aj=Xf,w.ak=function(i,t,s,a){const h=t.y-i.y,g=t.x-i.x,y=a.y-s.y,v=a.x-s.x,b=y*g-v*h;if(b===0)return null;const E=(v*(i.y-s.y)-y*(i.x-s.x))/b;return new te(i.x+E*g,i.y+E*h)},w.al=av,w.am=Xy,w.an=Af,w.ao=function(i){let t=1/0,s=1/0,a=-1/0,h=-1/0;for(const g of i)t=Math.min(t,g.x),s=Math.min(s,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return[t,s,a,h]},w.ap=Cr,w.ar=Wf,w.as=function(i,t){var s=t[0],a=t[1],h=t[2],g=t[3],y=t[4],v=t[5],b=t[6],E=t[7],I=t[8],P=t[9],z=t[10],L=t[11],F=t[12],O=t[13],Z=t[14],X=t[15],de=s*v-a*y,re=s*b-h*y,ue=s*E-g*y,ye=a*b-h*v,be=a*E-g*v,$e=h*E-g*b,st=I*O-P*F,Ve=I*Z-z*F,Be=I*X-L*F,Qe=P*Z-z*O,He=P*X-L*O,Ze=z*X-L*Z,ve=de*Ze-re*He+ue*Qe+ye*Be-be*Ve+$e*st;return ve?(i[0]=(v*Ze-b*He+E*Qe)*(ve=1/ve),i[1]=(h*He-a*Ze-g*Qe)*ve,i[2]=(O*$e-Z*be+X*ye)*ve,i[3]=(z*be-P*$e-L*ye)*ve,i[4]=(b*Be-y*Ze-E*Ve)*ve,i[5]=(s*Ze-h*Be+g*Ve)*ve,i[6]=(Z*ue-F*$e-X*re)*ve,i[7]=(I*$e-z*ue+L*re)*ve,i[8]=(y*He-v*Be+E*st)*ve,i[9]=(a*Be-s*He-g*st)*ve,i[10]=(F*be-O*ue+X*de)*ve,i[11]=(P*ue-I*be-L*de)*ve,i[12]=(v*Ve-y*Qe-b*st)*ve,i[13]=(s*Qe-a*Ve+h*st)*ve,i[14]=(O*re-F*ye-Z*de)*ve,i[15]=(I*ye-P*re+z*de)*ve,i):null},w.at=im,w.au=Hf,w.av=nm,w.aw=function(){const i={},t=ge.$version;for(const s in ge.$root){const a=ge.$root[s];if(a.required){let h=null;h=s==="version"?t:a.type==="array"?[]:{},h!=null&&(i[s]=h)}}return i},w.ax=ec,w.ay=ki,w.az=function(i){i=i.slice();const t=Object.create(null);for(let s=0;s<i.length;s++)t[i[s].id]=i[s];for(let s=0;s<i.length;s++)"ref"in i[s]&&(i[s]=qt(i[s],t[i[s].ref]));return i},w.b=Br,w.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.b1=function(i,t,s){return i[0]=t[0]*s[0],i[1]=t[1]*s[1],i[2]=t[2]*s[2],i[3]=t[3]*s[3],i},w.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},w.b3=Ne,w.b4=ev,w.b5=Y_,w.b6=function(i,t,s,a,h){var g,y=1/Math.tan(t/2);return i[0]=y/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+a)*(g=1/(a-h)),i[14]=2*h*a*g):(i[10]=-1,i[14]=-2*a),i},w.b7=function(i,t,s){var a=Math.sin(s),h=Math.cos(s),g=t[4],y=t[5],v=t[6],b=t[7],E=t[8],I=t[9],P=t[10],z=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=g*h+E*a,i[5]=y*h+I*a,i[6]=v*h+P*a,i[7]=b*h+z*a,i[8]=E*h-g*a,i[9]=I*h-y*a,i[10]=P*h-v*a,i[11]=z*h-b*a,i},w.b8=ce,w.b9=Se,w.bA=E_,w.bB=function(i){return i.message===Ft},w.bC=lo,w.bD=Ai,w.ba=function(i){return i*Math.PI/180},w.bb=function(i,t){const{x:s,y:a}=xc.fromLngLat(t);return!(i<0||i>25||a<0||a>=1||s<0||s>=1)},w.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},w.bd=class extends C{},w.be=Qf,w.bf=h2,w.bh=Sr,w.bi=function(i,t){br.REGISTERED_PROTOCOLS[i]=t},w.bj=function(i){delete br.REGISTERED_PROTOCOLS[i]},w.bk=function(i,t){const s={};for(let h=0;h<i.length;h++){const g=t&&t[i[h].id]||Uh(i[h]);t&&(t[i[h].id]=g);let y=s[g];y||(y=s[g]=[]),y.push(i[h])}const a=[];for(const h in s)a.push(s[h]);return a},w.bl=Ge,w.bm=rv,w.bn=nv,w.bo=L_,w.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Er/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],s=t.layout,a=t._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new Qt(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Qt(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Qt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:I}=i.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Qt(E),i.canonical),a["text-size"].possiblyEvaluate(new Qt(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:I}=i.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Qt(E),i.canonical),a["icon-size"].possiblyEvaluate(new Qt(I),i.canonical)]}const g=s.get("text-line-height")*Cr,y=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",v=s.get("text-keep-upright"),b=s.get("text-size");for(const E of i.bucket.features){const I=s.get("text-font").evaluate(E,{},i.canonical).join(","),P=b.evaluate(E,{},i.canonical),z=h.layoutTextSize.evaluate(E,{},i.canonical),L=h.layoutIconSize.evaluate(E,{},i.canonical),F={horizontal:{},vertical:void 0},O=E.text;let Z,X=[0,0];if(O){const ue=O.toString(),ye=s.get("text-letter-spacing").evaluate(E,{},i.canonical)*Cr,be=vf(ue)?ye:0,$e=s.get("text-anchor").evaluate(E,{},i.canonical),st=gv(t,E,i.canonical);if(!st){const He=s.get("text-radial-offset").evaluate(E,{},i.canonical);X=He?mv($e,[He*Cr,rm]):s.get("text-offset").evaluate(E,{},i.canonical).map(Ze=>Ze*Cr)}let Ve=y?"center":s.get("text-justify").evaluate(E,{},i.canonical);const Be=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(E,{},i.canonical)*Cr:1/0,Qe=()=>{i.bucket.allowVerticalPlacement&&tc(ue)&&(F.vertical=cd(O,i.glyphMap,i.glyphPositions,i.imagePositions,I,Be,g,$e,"left",be,X,w.ah.vertical,!0,z,P))};if(!y&&st){const He=new Set;if(Ve==="auto")for(let ve=0;ve<st.values.length;ve+=2)He.add(im(st.values[ve]));else He.add(Ve);let Ze=!1;for(const ve of He)if(!F.horizontal[ve])if(Ze)F.horizontal[ve]=F.horizontal[0];else{const et=cd(O,i.glyphMap,i.glyphPositions,i.imagePositions,I,Be,g,"center",ve,be,X,w.ah.horizontal,!1,z,P);et&&(F.horizontal[ve]=et,Ze=et.positionedLines.length===1)}Qe()}else{Ve==="auto"&&(Ve=im($e));const He=cd(O,i.glyphMap,i.glyphPositions,i.imagePositions,I,Be,g,$e,Ve,be,X,w.ah.horizontal,!1,z,P);He&&(F.horizontal[Ve]=He),Qe(),tc(ue)&&y&&v&&(F.vertical=cd(O,i.glyphMap,i.glyphPositions,i.imagePositions,I,Be,g,$e,Ve,be,X,w.ah.vertical,!1,z,P))}}let de=!1;if(E.icon&&E.icon.name){const ue=i.imageMap[E.icon.name];ue&&(Z=Hb(i.imagePositions[E.icon.name],s.get("icon-offset").evaluate(E,{},i.canonical),s.get("icon-anchor").evaluate(E,{},i.canonical)),de=!!ue.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=de:i.bucket.sdfIcons!==de&&Mt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==i.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const re=_v(F.horizontal)||F.vertical;i.bucket.iconsInText=!!re&&re.iconsInText,(re||Z)&&u2(i.bucket,E,F,Z,i.imageMap,h,z,L,X,de,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},w.bq=jf,w.br=Of,w.bs=Vf,w.bt=ko,w.bu=$f,w.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},w.bw=function(i,t,s,a,h){return d(this,void 0,void 0,function*(){if(ne())try{return yield lt(i,t,s,a,h)}catch{}return function(g,y,v,b,E){const I=g.width,P=g.height;pt&&Tt||(pt=new OffscreenCanvas(I,P),Tt=pt.getContext("2d",{willReadFrequently:!0})),pt.width=I,pt.height=P,Tt.drawImage(g,0,0,I,P);const z=Tt.getImageData(y,v,b,E);return Tt.clearRect(0,0,I,P),z.data}(i,t,s,a,h)})},w.bx=tv,w.by=j,w.bz=Y,w.c=nr,w.d=i=>d(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.e=Fe,w.f=i=>new Promise((t,s)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=We})},a.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(i)],{type:"image/png"});a.src=i.byteLength?URL.createObjectURL(h):We}),w.g=Fr,w.h=(i,t)=>On(Fe(i,{type:"json"}),t),w.i=wr,w.j=bn,w.k=wn,w.l=(i,t)=>On(Fe(i,{type:"arrayBuffer"}),t),w.m=On,w.n=function(i){return new $f(i).readFields(Vb,[])},w.o=cc,w.p=R_,w.q=m,w.r=yf,w.s=Nn,w.t=Yu,w.u=Ds,w.v=ge,w.w=Mt,w.x=function([i,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(s),y:i*Math.sin(t)*Math.sin(s),z:i*Math.cos(s)}},w.y=pi,w.z=Qt}),_("worker",["./shared"],function(w){class d{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,D){for(const G of R){this._layerConfigs[G.id]=G;const ie=this._layers[G.id]=w.aA(G);ie._featureFilter=w.a7(ie.filter),this.keyCache[G.id]&&delete this.keyCache[G.id]}for(const G of D)delete this.keyCache[G],delete this._layerConfigs[G],delete this._layers[G];this.familiesBySource={};const N=w.bk(Object.values(this._layerConfigs),this.keyCache);for(const G of N){const ie=G.map(fe=>this._layers[fe.id]),oe=ie[0];if(oe.visibility==="none")continue;const he=oe.source||"";let Q=this.familiesBySource[he];Q||(Q=this.familiesBySource[he]={});const _e=oe.sourceLayer||"_geojsonTileLayer";let we=Q[_e];we||(we=Q[_e]=[]),we.push(ie)}}}class j{constructor(R){const D={},N=[];for(const he in R){const Q=R[he],_e=D[he]={};for(const we in Q){const fe=Q[+we];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const Ce={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};N.push(Ce),_e[we]={rect:Ce,metrics:fe.metrics}}}const{w:G,h:ie}=w.p(N),oe=new w.o({width:G||1,height:ie||1});for(const he in R){const Q=R[he];for(const _e in Q){const we=Q[+_e];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const fe=D[he][_e].rect;w.o.copy(we.bitmap,oe,{x:0,y:0},{x:fe.x+1,y:fe.y+1},we.bitmap)}}this.image=oe,this.positions=D}}w.bl("GlyphAtlas",j);class Y{constructor(R){this.tileID=new w.S(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId,this.inFlightDependencies=[]}parse(R,D,N,G){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=R,this.collisionBoxArray=new w.a5;const ie=new w.bm(Object.keys(R.layers).sort()),oe=new w.bn(this.tileID,this.promoteId);oe.bucketLayerIDs=[];const he={},Q={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},_e=D.familiesBySource[this.source];for(const bt in _e){const Ut=R.layers[bt];if(!Ut)continue;Ut.version===1&&w.w(`Vector tile source "${this.source}" layer "${bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const or=ie.encode(bt),Ar=[];for(let Nr=0;Nr<Ut.length;Nr++){const ni=Ut.feature(Nr),Js=oe.getId(ni,bt);Ar.push({feature:ni,id:Js,index:Nr,sourceLayerIndex:or})}for(const Nr of _e[bt]){const ni=Nr[0];ni.source!==this.source&&w.w(`layer.source = ${ni.source} does not equal this.source = ${this.source}`),ni.minzoom&&this.zoom<Math.floor(ni.minzoom)||ni.maxzoom&&this.zoom>=ni.maxzoom||ni.visibility!=="none"&&(me(Nr,this.zoom,N),(he[ni.id]=ni.createBucket({index:oe.bucketLayerIDs.length,layers:Nr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:or,sourceID:this.source})).populate(Ar,Q,this.tileID.canonical),oe.bucketLayerIDs.push(Nr.map(Js=>Js.id)))}}const we=w.aF(Q.glyphDependencies,bt=>Object.keys(bt).map(Number));this.inFlightDependencies.forEach(bt=>bt==null?void 0:bt.abort()),this.inFlightDependencies=[];let fe=Promise.resolve({});if(Object.keys(we).length){const bt=new AbortController;this.inFlightDependencies.push(bt),fe=G.sendAsync({type:"GG",data:{stacks:we,source:this.source,tileID:this.tileID,type:"glyphs"}},bt)}const Ce=Object.keys(Q.iconDependencies);let tt=Promise.resolve({});if(Ce.length){const bt=new AbortController;this.inFlightDependencies.push(bt),tt=G.sendAsync({type:"GI",data:{icons:Ce,source:this.source,tileID:this.tileID,type:"icons"}},bt)}const nt=Object.keys(Q.patternDependencies);let zt=Promise.resolve({});if(nt.length){const bt=new AbortController;this.inFlightDependencies.push(bt),zt=G.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"patterns"}},bt)}const[gt,Dt,It]=yield Promise.all([fe,tt,zt]),Tr=new j(gt),lr=new w.bo(Dt,It);for(const bt in he){const Ut=he[bt];Ut instanceof w.a6?(me(Ut.layers,this.zoom,N),w.bp({bucket:Ut,glyphMap:gt,glyphPositions:Tr.positions,imageMap:Dt,imagePositions:lr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ut.hasPattern&&(Ut instanceof w.bq||Ut instanceof w.br||Ut instanceof w.bs)&&(me(Ut.layers,this.zoom,N),Ut.addFeatures(Q,this.tileID.canonical,lr.patternPositions))}return this.status="done",{buckets:Object.values(he).filter(bt=>!bt.isEmpty()),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Tr.image,imageAtlas:lr,glyphMap:this.returnDependencies?gt:null,iconMap:this.returnDependencies?Dt:null,glyphPositions:this.returnDependencies?Tr.positions:null}})}}function me(W,R,D){const N=new w.z(R);for(const G of W)G.recalculate(N,D)}class te{constructor(R,D,N){this.actor=R,this.layerIndex=D,this.availableImages=N,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(R,D){return w._(this,void 0,void 0,function*(){const N=yield w.l(R.request,D);try{return{vectorTile:new w.bt.VectorTile(new w.bu(N.data)),rawData:N.data,cacheControl:N.cacheControl,expires:N.expires}}catch(G){const ie=new Uint8Array(N.data);let oe=`Unable to parse the tile at ${R.request.url}, `;throw oe+=ie[0]===31&&ie[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${G.message}`,new Error(oe)}})}loadTile(R){return w._(this,void 0,void 0,function*(){const D=R.uid,N=!!(R&&R.request&&R.request.collectResourceTiming)&&new w.bv(R.request),G=new Y(R);this.loading[D]=G;const ie=new AbortController;G.abort=ie;try{const oe=yield this.loadVectorTile(R,ie);if(delete this.loading[D],!oe)return null;const he=oe.rawData,Q={};oe.expires&&(Q.expires=oe.expires),oe.cacheControl&&(Q.cacheControl=oe.cacheControl);const _e={};if(N){const fe=N.finish();fe&&(_e.resourceTiming=JSON.parse(JSON.stringify(fe)))}G.vectorTile=oe.vectorTile;const we=G.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=G,this.fetching[D]={rawTileData:he,cacheControl:Q,resourceTiming:_e};try{const fe=yield we;return w.e({rawTileData:he.slice(0)},fe,Q,_e)}finally{delete this.fetching[D]}}catch(oe){throw delete this.loading[D],G.status="done",this.loaded[D]=G,oe}})}reloadTile(R){return w._(this,void 0,void 0,function*(){const D=R.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const N=this.loaded[D];if(N.showCollisionBoxes=R.showCollisionBoxes,N.status==="parsing"){const G=yield N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor);let ie;if(this.fetching[D]){const{rawTileData:oe,cacheControl:he,resourceTiming:Q}=this.fetching[D];delete this.fetching[D],ie=w.e({rawTileData:oe.slice(0)},G,he,Q)}else ie=G;return ie}if(N.status==="done"&&N.vectorTile)return N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(R){return w._(this,void 0,void 0,function*(){const D=this.loading,N=R.uid;D&&D[N]&&D[N].abort&&(D[N].abort.abort(),delete D[N])})}removeTile(R){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[R.uid]&&delete this.loaded[R.uid]})}}class ${constructor(){this.loaded={}}loadTile(R){return w._(this,void 0,void 0,function*(){const{uid:D,encoding:N,rawImageData:G,redFactor:ie,greenFactor:oe,blueFactor:he,baseShift:Q}=R,_e=G.width+2,we=G.height+2,fe=w.b(G)?new w.R({width:_e,height:we},yield w.bw(G,-1,-1,_e,we)):G,Ce=new w.bx(D,fe,N,ie,oe,he,Q);return this.loaded=this.loaded||{},this.loaded[D]=Ce,Ce})}removeTile(R){const D=this.loaded,N=R.uid;D&&D[N]&&delete D[N]}}function Ie(W,R){if(W.length!==0){Me(W[0],R);for(var D=1;D<W.length;D++)Me(W[D],!R)}}function Me(W,R){for(var D=0,N=0,G=0,ie=W.length,oe=ie-1;G<ie;oe=G++){var he=(W[G][0]-W[oe][0])*(W[oe][1]+W[G][1]),Q=D+he;N+=Math.abs(D)>=Math.abs(he)?D-Q+he:he-Q+D,D=Q}D+N>=0!=!!R&&W.reverse()}var Le=w.by(function W(R,D){var N,G=R&&R.type;if(G==="FeatureCollection")for(N=0;N<R.features.length;N++)W(R.features[N],D);else if(G==="GeometryCollection")for(N=0;N<R.geometries.length;N++)W(R.geometries[N],D);else if(G==="Feature")W(R.geometry,D);else if(G==="Polygon")Ie(R.coordinates,D);else if(G==="MultiPolygon")for(N=0;N<R.coordinates.length;N++)Ie(R.coordinates[N],D);return R});const yt=w.bt.VectorTileFeature.prototype.toGeoJSON;var ae={exports:{}},ne=w.bz,ce=w.bt.VectorTileFeature,Se=je;function je(W,R){this.options=R||{},this.features=W,this.length=W.length}function Ne(W,R){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=R||4096}je.prototype.feature=function(W){return new Ne(this.features[W],this.options.extent)},Ne.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var R=0;R<W.length;R++){for(var D=W[R],N=[],G=0;G<D.length;G++)N.push(new ne(D[G][0],D[G][1]));this.geometry.push(N)}return this.geometry},Ne.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,R=1/0,D=-1/0,N=1/0,G=-1/0,ie=0;ie<W.length;ie++)for(var oe=W[ie],he=0;he<oe.length;he++){var Q=oe[he];R=Math.min(R,Q.x),D=Math.max(D,Q.x),N=Math.min(N,Q.y),G=Math.max(G,Q.y)}return[R,N,D,G]},Ne.prototype.toGeoJSON=ce.prototype.toGeoJSON;var Fe=w.bA,Ye=Se;function kt(W){var R=new Fe;return function(D,N){for(var G in D.layers)N.writeMessage(3,it,D.layers[G])}(W,R),R.finish()}function it(W,R){var D;R.writeVarintField(15,W.version||1),R.writeStringField(1,W.name||""),R.writeVarintField(5,W.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<W.length;D++)N.feature=W.feature(D),R.writeMessage(2,mt,N);var G=N.keys;for(D=0;D<G.length;D++)R.writeStringField(3,G[D]);var ie=N.values;for(D=0;D<ie.length;D++)R.writeMessage(4,ri,ie[D])}function mt(W,R){var D=W.feature;D.id!==void 0&&R.writeVarintField(1,D.id),R.writeMessage(2,Et,W),R.writeVarintField(3,D.type),R.writeMessage(4,wr,D)}function Et(W,R){var D=W.feature,N=W.keys,G=W.values,ie=W.keycache,oe=W.valuecache;for(var he in D.properties){var Q=D.properties[he],_e=ie[he];if(Q!==null){_e===void 0&&(N.push(he),ie[he]=_e=N.length-1),R.writeVarint(_e);var we=typeof Q;we!=="string"&&we!=="boolean"&&we!=="number"&&(Q=JSON.stringify(Q));var fe=we+":"+Q,Ce=oe[fe];Ce===void 0&&(G.push(Q),oe[fe]=Ce=G.length-1),R.writeVarint(Ce)}}}function Mt(W,R){return(R<<3)+(7&W)}function Yt(W){return W<<1^W>>31}function wr(W,R){for(var D=W.loadGeometry(),N=W.type,G=0,ie=0,oe=D.length,he=0;he<oe;he++){var Q=D[he],_e=1;N===1&&(_e=Q.length),R.writeVarint(Mt(1,_e));for(var we=N===3?Q.length-1:Q.length,fe=0;fe<we;fe++){fe===1&&N!==1&&R.writeVarint(Mt(2,we-1));var Ce=Q[fe].x-G,tt=Q[fe].y-ie;R.writeVarint(Yt(Ce)),R.writeVarint(Yt(tt)),G+=Ce,ie+=tt}N===3&&R.writeVarint(Mt(7,1))}}function ri(W,R){var D=typeof W;D==="string"?R.writeStringField(1,W):D==="boolean"?R.writeBooleanField(7,W):D==="number"&&(W%1!=0?R.writeDoubleField(3,W):W<0?R.writeSVarintField(6,W):R.writeVarintField(5,W))}ae.exports=kt,ae.exports.fromVectorTileJs=kt,ae.exports.fromGeojsonVt=function(W,R){R=R||{};var D={};for(var N in W)D[N]=new Ye(W[N].features,R),D[N].name=N,D[N].version=R.version,D[N].extent=R.extent;return kt({layers:D})},ae.exports.GeoJSONWrapper=Ye;var Br=w.by(ae.exports);const We={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},lt=Math.fround||(pt=new Float32Array(1),W=>(pt[0]=+W,pt[0]));var pt;const Tt=3,Ft=5,nr=6;class br{constructor(R){this.options=Object.assign(Object.create(We),R),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(R){const{log:D,minZoom:N,maxZoom:G}=this.options;D&&console.time("total time");const ie=`prepare ${R.length} points`;D&&console.time(ie),this.points=R;const oe=[];for(let Q=0;Q<R.length;Q++){const _e=R[Q];if(!_e.geometry)continue;const[we,fe]=_e.geometry.coordinates,Ce=lt(Sr(we)),tt=lt(ki(fe));oe.push(Ce,tt,1/0,Q,-1,1),this.options.reduce&&oe.push(0)}let he=this.trees[G+1]=this._createTree(oe);D&&console.timeEnd(ie);for(let Q=G;Q>=N;Q--){const _e=+Date.now();he=this.trees[Q]=this._createTree(this._cluster(he,Q)),D&&console.log("z%d: %d clusters in %dms",Q,he.numItems,+Date.now()-_e)}return D&&console.timeEnd("total time"),this}getClusters(R,D){let N=((R[0]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,R[1]));let ie=R[2]===180?180:((R[2]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)N=-180,ie=180;else if(N>ie){const fe=this.getClusters([N,G,180,oe],D),Ce=this.getClusters([-180,G,ie,oe],D);return fe.concat(Ce)}const he=this.trees[this._limitZoom(D)],Q=he.range(Sr(N),ki(oe),Sr(ie),ki(G)),_e=he.data,we=[];for(const fe of Q){const Ce=this.stride*fe;we.push(_e[Ce+Ft]>1?Fr(_e,Ce,this.clusterProps):this.points[_e[Ce+Tt]])}return we}getChildren(R){const D=this._getOriginId(R),N=this._getOriginZoom(R),G="No cluster with the specified id.",ie=this.trees[N];if(!ie)throw new Error(G);const oe=ie.data;if(D*this.stride>=oe.length)throw new Error(G);const he=this.options.radius/(this.options.extent*Math.pow(2,N-1)),Q=ie.within(oe[D*this.stride],oe[D*this.stride+1],he),_e=[];for(const we of Q){const fe=we*this.stride;oe[fe+4]===R&&_e.push(oe[fe+Ft]>1?Fr(oe,fe,this.clusterProps):this.points[oe[fe+Tt]])}if(_e.length===0)throw new Error(G);return _e}getLeaves(R,D,N){const G=[];return this._appendLeaves(G,R,D=D||10,N=N||0,0),G}getTile(R,D,N){const G=this.trees[this._limitZoom(R)],ie=Math.pow(2,R),{extent:oe,radius:he}=this.options,Q=he/oe,_e=(N-Q)/ie,we=(N+1+Q)/ie,fe={features:[]};return this._addTileFeatures(G.range((D-Q)/ie,_e,(D+1+Q)/ie,we),G.data,D,N,ie,fe),D===0&&this._addTileFeatures(G.range(1-Q/ie,_e,1,we),G.data,ie,N,ie,fe),D===ie-1&&this._addTileFeatures(G.range(0,_e,Q/ie,we),G.data,-1,N,ie,fe),fe.features.length?fe:null}getClusterExpansionZoom(R){let D=this._getOriginZoom(R)-1;for(;D<=this.options.maxZoom;){const N=this.getChildren(R);if(D++,N.length!==1)break;R=N[0].properties.cluster_id}return D}_appendLeaves(R,D,N,G,ie){const oe=this.getChildren(D);for(const he of oe){const Q=he.properties;if(Q&&Q.cluster?ie+Q.point_count<=G?ie+=Q.point_count:ie=this._appendLeaves(R,Q.cluster_id,N,G,ie):ie<G?ie++:R.push(he),R.length===N)break}return ie}_createTree(R){const D=new w.av(R.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<R.length;N+=this.stride)D.add(R[N],R[N+1]);return D.finish(),D.data=R,D}_addTileFeatures(R,D,N,G,ie,oe){for(const he of R){const Q=he*this.stride,_e=D[Q+Ft]>1;let we,fe,Ce;if(_e)we=qr(D,Q,this.clusterProps),fe=D[Q],Ce=D[Q+1];else{const zt=this.points[D[Q+Tt]];we=zt.properties;const[gt,Dt]=zt.geometry.coordinates;fe=Sr(gt),Ce=ki(Dt)}const tt={type:1,geometry:[[Math.round(this.options.extent*(fe*ie-N)),Math.round(this.options.extent*(Ce*ie-G))]],tags:we};let nt;nt=_e||this.options.generateId?D[Q+Tt]:this.points[D[Q+Tt]].id,nt!==void 0&&(tt.id=nt),oe.features.push(tt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,D){const{radius:N,extent:G,reduce:ie,minPoints:oe}=this.options,he=N/(G*Math.pow(2,D)),Q=R.data,_e=[],we=this.stride;for(let fe=0;fe<Q.length;fe+=we){if(Q[fe+2]<=D)continue;Q[fe+2]=D;const Ce=Q[fe],tt=Q[fe+1],nt=R.within(Q[fe],Q[fe+1],he),zt=Q[fe+Ft];let gt=zt;for(const Dt of nt){const It=Dt*we;Q[It+2]>D&&(gt+=Q[It+Ft])}if(gt>zt&&gt>=oe){let Dt,It=Ce*zt,Tr=tt*zt,lr=-1;const bt=((fe/we|0)<<5)+(D+1)+this.points.length;for(const Ut of nt){const or=Ut*we;if(Q[or+2]<=D)continue;Q[or+2]=D;const Ar=Q[or+Ft];It+=Q[or]*Ar,Tr+=Q[or+1]*Ar,Q[or+4]=bt,ie&&(Dt||(Dt=this._map(Q,fe,!0),lr=this.clusterProps.length,this.clusterProps.push(Dt)),ie(Dt,this._map(Q,or)))}Q[fe+4]=bt,_e.push(It/gt,Tr/gt,1/0,bt,-1,gt),ie&&_e.push(lr)}else{for(let Dt=0;Dt<we;Dt++)_e.push(Q[fe+Dt]);if(gt>1)for(const Dt of nt){const It=Dt*we;if(!(Q[It+2]<=D)){Q[It+2]=D;for(let Tr=0;Tr<we;Tr++)_e.push(Q[It+Tr])}}}}return _e}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,D,N){if(R[D+Ft]>1){const oe=this.clusterProps[R[D+nr]];return N?Object.assign({},oe):oe}const G=this.points[R[D+Tt]].properties,ie=this.options.map(G);return N&&ie===G?Object.assign({},ie):ie}}function Fr(W,R,D){return{type:"Feature",id:W[R+Tt],properties:qr(W,R,D),geometry:{type:"Point",coordinates:[(N=W[R],360*(N-.5)),On(W[R+1])]}};var N}function qr(W,R,D){const N=W[R+Ft],G=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,ie=W[R+nr],oe=ie===-1?{}:Object.assign({},D[ie]);return Object.assign(oe,{cluster:!0,cluster_id:W[R+Tt],point_count:N,point_count_abbreviated:G})}function Sr(W){return W/360+.5}function ki(W){const R=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return D<0?0:D>1?1:D}function On(W){const R=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function Nn(W,R,D,N){let G=N;const ie=R+(D-R>>1);let oe,he=D-R;const Q=W[R],_e=W[R+1],we=W[D],fe=W[D+1];for(let Ce=R+3;Ce<D;Ce+=3){const tt=ws(W[Ce],W[Ce+1],Q,_e,we,fe);if(tt>G)oe=Ce,G=tt;else if(tt===G){const nt=Math.abs(Ce-ie);nt<he&&(oe=Ce,he=nt)}}G>N&&(oe-R>3&&Nn(W,R,oe,N),W[oe+2]=G,D-oe>3&&Nn(W,oe,D,N))}function ws(W,R,D,N,G,ie){let oe=G-D,he=ie-N;if(oe!==0||he!==0){const Q=((W-D)*oe+(R-N)*he)/(oe*oe+he*he);Q>1?(D=G,N=ie):Q>0&&(D+=oe*Q,N+=he*Q)}return oe=W-D,he=R-N,oe*oe+he*he}function Qi(W,R,D,N){const G={id:W??null,type:R,geometry:D,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(R==="Point"||R==="MultiPoint"||R==="LineString")wn(G,D);else if(R==="Polygon")wn(G,D[0]);else if(R==="MultiLineString")for(const ie of D)wn(G,ie);else if(R==="MultiPolygon")for(const ie of D)wn(G,ie[0]);return G}function wn(W,R){for(let D=0;D<R.length;D+=3)W.minX=Math.min(W.minX,R[D]),W.minY=Math.min(W.minY,R[D+1]),W.maxX=Math.max(W.maxX,R[D]),W.maxY=Math.max(W.maxY,R[D+1])}function bn(W,R,D,N){if(!R.geometry)return;const G=R.geometry.coordinates;if(G&&G.length===0)return;const ie=R.geometry.type,oe=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let he=[],Q=R.id;if(D.promoteId?Q=R.properties[D.promoteId]:D.generateId&&(Q=N||0),ie==="Point")rs(G,he);else if(ie==="MultiPoint")for(const _e of G)rs(_e,he);else if(ie==="LineString")ge(G,he,oe,!1);else if(ie==="MultiLineString"){if(D.lineMetrics){for(const _e of G)he=[],ge(_e,he,oe,!1),W.push(Qi(Q,"LineString",he,R.properties));return}at(G,he,oe,!1)}else if(ie==="Polygon")at(G,he,oe,!0);else{if(ie!=="MultiPolygon"){if(ie==="GeometryCollection"){for(const _e of R.geometry.geometries)bn(W,{id:Q,geometry:_e,properties:R.properties},D,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _e of G){const we=[];at(_e,we,oe,!0),he.push(we)}}W.push(Qi(Q,ie,he,R.properties))}function rs(W,R){R.push(qt(W[0]),wt(W[1]),0)}function ge(W,R,D,N){let G,ie,oe=0;for(let Q=0;Q<W.length;Q++){const _e=qt(W[Q][0]),we=wt(W[Q][1]);R.push(_e,we,0),Q>0&&(oe+=N?(G*we-_e*ie)/2:Math.sqrt(Math.pow(_e-G,2)+Math.pow(we-ie,2))),G=_e,ie=we}const he=R.length-3;R[2]=1,Nn(R,0,he,D),R[he+2]=1,R.size=Math.abs(oe),R.start=0,R.end=R.size}function at(W,R,D,N){for(let G=0;G<W.length;G++){const ie=[];ge(W[G],ie,D,N),R.push(ie)}}function qt(W){return W/360+.5}function wt(W){const R=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return D<0?0:D>1?1:D}function sr(W,R,D,N,G,ie,oe,he){if(N/=R,ie>=(D/=R)&&oe<N)return W;if(oe<D||ie>=N)return null;const Q=[];for(const _e of W){const we=_e.geometry;let fe=_e.type;const Ce=G===0?_e.minX:_e.minY,tt=G===0?_e.maxX:_e.maxY;if(Ce>=D&&tt<N){Q.push(_e);continue}if(tt<D||Ce>=N)continue;let nt=[];if(fe==="Point"||fe==="MultiPoint")is(we,nt,D,N,G);else if(fe==="LineString")en(we,nt,D,N,G,!1,he.lineMetrics);else if(fe==="MultiLineString")Vn(we,nt,D,N,G,!1);else if(fe==="Polygon")Vn(we,nt,D,N,G,!0);else if(fe==="MultiPolygon")for(const zt of we){const gt=[];Vn(zt,gt,D,N,G,!0),gt.length&&nt.push(gt)}if(nt.length){if(he.lineMetrics&&fe==="LineString"){for(const zt of nt)Q.push(Qi(_e.id,fe,zt,_e.tags));continue}fe!=="LineString"&&fe!=="MultiLineString"||(nt.length===1?(fe="LineString",nt=nt[0]):fe="MultiLineString"),fe!=="Point"&&fe!=="MultiPoint"||(fe=nt.length===3?"Point":"MultiPoint"),Q.push(Qi(_e.id,fe,nt,_e.tags))}}return Q.length?Q:null}function is(W,R,D,N,G){for(let ie=0;ie<W.length;ie+=3){const oe=W[ie+G];oe>=D&&oe<=N&&ii(R,W[ie],W[ie+1],W[ie+2])}}function en(W,R,D,N,G,ie,oe){let he=Oi(W);const Q=G===0?Ks:jn;let _e,we,fe=W.start;for(let gt=0;gt<W.length-3;gt+=3){const Dt=W[gt],It=W[gt+1],Tr=W[gt+2],lr=W[gt+3],bt=W[gt+4],Ut=G===0?Dt:It,or=G===0?lr:bt;let Ar=!1;oe&&(_e=Math.sqrt(Math.pow(Dt-lr,2)+Math.pow(It-bt,2))),Ut<D?or>D&&(we=Q(he,Dt,It,lr,bt,D),oe&&(he.start=fe+_e*we)):Ut>N?or<N&&(we=Q(he,Dt,It,lr,bt,N),oe&&(he.start=fe+_e*we)):ii(he,Dt,It,Tr),or<D&&Ut>=D&&(we=Q(he,Dt,It,lr,bt,D),Ar=!0),or>N&&Ut<=N&&(we=Q(he,Dt,It,lr,bt,N),Ar=!0),!ie&&Ar&&(oe&&(he.end=fe+_e*we),R.push(he),he=Oi(W)),oe&&(fe+=_e)}let Ce=W.length-3;const tt=W[Ce],nt=W[Ce+1],zt=G===0?tt:nt;zt>=D&&zt<=N&&ii(he,tt,nt,W[Ce+2]),Ce=he.length-3,ie&&Ce>=3&&(he[Ce]!==he[0]||he[Ce+1]!==he[1])&&ii(he,he[0],he[1],he[2]),he.length&&R.push(he)}function Oi(W){const R=[];return R.size=W.size,R.start=W.start,R.end=W.end,R}function Vn(W,R,D,N,G,ie){for(const oe of W)en(oe,R,D,N,G,ie,!1)}function ii(W,R,D,N){W.push(R,D,N)}function Ks(W,R,D,N,G,ie){const oe=(ie-R)/(N-R);return ii(W,ie,D+(G-D)*oe,1),oe}function jn(W,R,D,N,G,ie){const oe=(ie-D)/(G-D);return ii(W,R+(N-R)*oe,ie,1),oe}function ke(W,R){const D=[];for(let N=0;N<W.length;N++){const G=W[N],ie=G.type;let oe;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")oe=Zr(G.geometry,R);else if(ie==="MultiLineString"||ie==="Polygon"){oe=[];for(const he of G.geometry)oe.push(Zr(he,R))}else if(ie==="MultiPolygon"){oe=[];for(const he of G.geometry){const Q=[];for(const _e of he)Q.push(Zr(_e,R));oe.push(Q)}}D.push(Qi(G.id,ie,oe,G.tags))}return D}function Zr(W,R){const D=[];D.size=W.size,W.start!==void 0&&(D.start=W.start,D.end=W.end);for(let N=0;N<W.length;N+=3)D.push(W[N]+R,W[N+1],W[N+2]);return D}function Or(W,R){if(W.transformed)return W;const D=1<<W.z,N=W.x,G=W.y;for(const ie of W.features){const oe=ie.geometry,he=ie.type;if(ie.geometry=[],he===1)for(let Q=0;Q<oe.length;Q+=2)ie.geometry.push(Ni(oe[Q],oe[Q+1],R,D,N,G));else for(let Q=0;Q<oe.length;Q++){const _e=[];for(let we=0;we<oe[Q].length;we+=2)_e.push(Ni(oe[Q][we],oe[Q][we+1],R,D,N,G));ie.geometry.push(_e)}}return W.transformed=!0,W}function Ni(W,R,D,N,G,ie){return[Math.round(D*(W*N-G)),Math.round(D*(R*N-ie))]}function ns(W,R,D,N,G){const ie=R===G.maxZoom?0:G.tolerance/((1<<R)*G.extent),oe={features:[],numPoints:0,numSimplified:0,numFeatures:W.length,source:null,x:D,y:N,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const he of W)De(oe,he,ie,G);return oe}function De(W,R,D,N){const G=R.geometry,ie=R.type,oe=[];if(W.minX=Math.min(W.minX,R.minX),W.minY=Math.min(W.minY,R.minY),W.maxX=Math.max(W.maxX,R.maxX),W.maxY=Math.max(W.maxY,R.maxY),ie==="Point"||ie==="MultiPoint")for(let he=0;he<G.length;he+=3)oe.push(G[he],G[he+1]),W.numPoints++,W.numSimplified++;else if(ie==="LineString")xt(oe,G,W,D,!1,!1);else if(ie==="MultiLineString"||ie==="Polygon")for(let he=0;he<G.length;he++)xt(oe,G[he],W,D,ie==="Polygon",he===0);else if(ie==="MultiPolygon")for(let he=0;he<G.length;he++){const Q=G[he];for(let _e=0;_e<Q.length;_e++)xt(oe,Q[_e],W,D,!0,_e===0)}if(oe.length){let he=R.tags||null;if(ie==="LineString"&&N.lineMetrics){he={};for(const _e in R.tags)he[_e]=R.tags[_e];he.mapbox_clip_start=G.start/G.size,he.mapbox_clip_end=G.end/G.size}const Q={geometry:oe,type:ie==="Polygon"||ie==="MultiPolygon"?3:ie==="LineString"||ie==="MultiLineString"?2:1,tags:he};R.id!==null&&(Q.id=R.id),W.features.push(Q)}}function xt(W,R,D,N,G,ie){const oe=N*N;if(N>0&&R.size<(G?oe:N))return void(D.numPoints+=R.length/3);const he=[];for(let Q=0;Q<R.length;Q+=3)(N===0||R[Q+2]>oe)&&(D.numSimplified++,he.push(R[Q],R[Q+1])),D.numPoints++;G&&function(Q,_e){let we=0;for(let fe=0,Ce=Q.length,tt=Ce-2;fe<Ce;tt=fe,fe+=2)we+=(Q[fe]-Q[tt])*(Q[fe+1]+Q[tt+1]);if(we>0===_e)for(let fe=0,Ce=Q.length;fe<Ce/2;fe+=2){const tt=Q[fe],nt=Q[fe+1];Q[fe]=Q[Ce-2-fe],Q[fe+1]=Q[Ce-1-fe],Q[Ce-2-fe]=tt,Q[Ce-1-fe]=nt}}(he,ie),W.push(he)}const ut={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class di{constructor(R,D){const N=(D=this.options=function(ie,oe){for(const he in oe)ie[he]=oe[he];return ie}(Object.create(ut),D)).debug;if(N&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let G=function(ie,oe){const he=[];if(ie.type==="FeatureCollection")for(let Q=0;Q<ie.features.length;Q++)bn(he,ie.features[Q],oe,Q);else bn(he,ie.type==="Feature"?ie:{geometry:ie},oe);return he}(R,D);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),G=function(ie,oe){const he=oe.buffer/oe.extent;let Q=ie;const _e=sr(ie,1,-1-he,he,0,-1,2,oe),we=sr(ie,1,1-he,2+he,0,-1,2,oe);return(_e||we)&&(Q=sr(ie,1,-he,1+he,0,-1,2,oe)||[],_e&&(Q=ke(_e,1).concat(Q)),we&&(Q=Q.concat(ke(we,-1)))),Q}(G,D),G.length&&this.splitTile(G,0,0,0),N&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(R,D,N,G,ie,oe,he){const Q=[R,D,N,G],_e=this.options,we=_e.debug;for(;Q.length;){G=Q.pop(),N=Q.pop(),D=Q.pop(),R=Q.pop();const fe=1<<D,Ce=tn(D,N,G);let tt=this.tiles[Ce];if(!tt&&(we>1&&console.time("creation"),tt=this.tiles[Ce]=ns(R,D,N,G,_e),this.tileCoords.push({z:D,x:N,y:G}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,N,G,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));const Ar=`z${D}`;this.stats[Ar]=(this.stats[Ar]||0)+1,this.total++}if(tt.source=R,ie==null){if(D===_e.indexMaxZoom||tt.numPoints<=_e.indexMaxPoints)continue}else{if(D===_e.maxZoom||D===ie)continue;if(ie!=null){const Ar=ie-D;if(N!==oe>>Ar||G!==he>>Ar)continue}}if(tt.source=null,R.length===0)continue;we>1&&console.time("clipping");const nt=.5*_e.buffer/_e.extent,zt=.5-nt,gt=.5+nt,Dt=1+nt;let It=null,Tr=null,lr=null,bt=null,Ut=sr(R,fe,N-nt,N+gt,0,tt.minX,tt.maxX,_e),or=sr(R,fe,N+zt,N+Dt,0,tt.minX,tt.maxX,_e);R=null,Ut&&(It=sr(Ut,fe,G-nt,G+gt,1,tt.minY,tt.maxY,_e),Tr=sr(Ut,fe,G+zt,G+Dt,1,tt.minY,tt.maxY,_e),Ut=null),or&&(lr=sr(or,fe,G-nt,G+gt,1,tt.minY,tt.maxY,_e),bt=sr(or,fe,G+zt,G+Dt,1,tt.minY,tt.maxY,_e),or=null),we>1&&console.timeEnd("clipping"),Q.push(It||[],D+1,2*N,2*G),Q.push(Tr||[],D+1,2*N,2*G+1),Q.push(lr||[],D+1,2*N+1,2*G),Q.push(bt||[],D+1,2*N+1,2*G+1)}}getTile(R,D,N){R=+R,D=+D,N=+N;const G=this.options,{extent:ie,debug:oe}=G;if(R<0||R>24)return null;const he=1<<R,Q=tn(R,D=D+he&he-1,N);if(this.tiles[Q])return Or(this.tiles[Q],ie);oe>1&&console.log("drilling down to z%d-%d-%d",R,D,N);let _e,we=R,fe=D,Ce=N;for(;!_e&&we>0;)we--,fe>>=1,Ce>>=1,_e=this.tiles[tn(we,fe,Ce)];return _e&&_e.source?(oe>1&&(console.log("found parent tile z%d-%d-%d",we,fe,Ce),console.time("drilling down")),this.splitTile(_e.source,we,fe,Ce,R,D,N),oe>1&&console.timeEnd("drilling down"),this.tiles[Q]?Or(this.tiles[Q],ie):null):null}}function tn(W,R,D){return 32*((1<<W)*D+R)+W}function ft(W,R){return R?W.properties[R]:W.id}function Sn(W,R){if(W==null)return!0;if(W.type==="Feature")return ft(W,R)!=null;if(W.type==="FeatureCollection"){const D=new Set;for(const N of W.features){const G=ft(N,R);if(G==null||D.has(G))return!1;D.add(G)}return!0}return!1}function Un(W,R){const D=new Map;if(W!=null)if(W.type==="Feature")D.set(ft(W,R),W);else for(const N of W.features)D.set(ft(N,R),N);return D}class ss extends te{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(R,D){return w._(this,void 0,void 0,function*(){const N=R.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const G=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!G)return null;const ie=new class{constructor(he){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.X,this.length=he.length,this._features=he}feature(he){return new class{constructor(Q){this._feature=Q,this.extent=w.X,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const _e of this._feature.geometry)Q.push([new w.P(_e[0],_e[1])]);return Q}{const Q=[];for(const _e of this._feature.geometry){const we=[];for(const fe of _e)we.push(new w.P(fe[0],fe[1]));Q.push(we)}return Q}}toGeoJSON(Q,_e,we){return yt.call(this,Q,_e,we)}}(this._features[he])}}(G.features);let oe=Br(ie);return oe.byteOffset===0&&oe.byteLength===oe.buffer.byteLength||(oe=new Uint8Array(oe)),{vectorTile:ie,rawData:oe.buffer}})}loadData(R){return w._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const N=!!(R&&R.request&&R.request.collectResourceTiming)&&new w.bv(R.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(R,this._pendingRequest),this._geoJSONIndex=R.cluster?new br(function({superclusterOptions:oe,clusterProperties:he}){if(!he||!oe)return oe;const Q={},_e={},we={accumulated:null,zoom:0},fe={properties:null},Ce=Object.keys(he);for(const tt of Ce){const[nt,zt]=he[tt],gt=w.bC(zt),Dt=w.bC(typeof nt=="string"?[nt,["accumulated"],["get",tt]]:nt);Q[tt]=gt.value,_e[tt]=Dt.value}return oe.map=tt=>{fe.properties=tt;const nt={};for(const zt of Ce)nt[zt]=Q[zt].evaluate(we,fe);return nt},oe.reduce=(tt,nt)=>{fe.properties=nt;for(const zt of Ce)we.accumulated=tt[zt],tt[zt]=_e[zt].evaluate(we,fe)},oe}(R)).load((yield this._pendingData).features):(G=yield this._pendingData,new di(G,R.geojsonVtOptions)),this.loaded={};const ie={};if(N){const oe=N.finish();oe&&(ie.resourceTiming={},ie.resourceTiming[R.source]=JSON.parse(JSON.stringify(oe)))}return ie}catch(ie){if(delete this._pendingRequest,w.bB(ie))return{abandoned:!0};throw ie}var G})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(R){const D=this.loaded;return D&&D[R.uid]?super.reloadTile(R):this.loadTile(R)}loadAndProcessGeoJSON(R,D){return w._(this,void 0,void 0,function*(){let N=yield this.loadGeoJSON(R,D);if(delete this._pendingRequest,typeof N!="object")throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(Le(N,!0),R.filter){const G=w.bC(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(G.result==="error")throw new Error(G.value.map(oe=>`${oe.key}: ${oe.message}`).join(", "));N={type:"FeatureCollection",features:N.features.filter(oe=>G.value.evaluate({zoom:0},oe))}}return N})}loadGeoJSON(R,D){return w._(this,void 0,void 0,function*(){const{promoteId:N}=R;if(R.request){const G=yield w.h(R.request,D);return this._dataUpdateable=Sn(G.data,N)?Un(G.data,N):void 0,G.data}if(typeof R.data=="string")try{const G=JSON.parse(R.data);return this._dataUpdateable=Sn(G,N)?Un(G,N):void 0,G}catch{throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`)}if(!R.dataDiff)throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${R.source}`);return function(G,ie,oe){var he,Q,_e,we;if(ie.removeAll&&G.clear(),ie.remove)for(const fe of ie.remove)G.delete(fe);if(ie.add)for(const fe of ie.add){const Ce=ft(fe,oe);Ce!=null&&G.set(Ce,fe)}if(ie.update)for(const fe of ie.update){let Ce=G.get(fe.id);if(Ce==null)continue;const tt=!fe.removeAllProperties&&(((he=fe.removeProperties)===null||he===void 0?void 0:he.length)>0||((Q=fe.addOrUpdateProperties)===null||Q===void 0?void 0:Q.length)>0);if((fe.newGeometry||fe.removeAllProperties||tt)&&(Ce=Object.assign({},Ce),G.set(fe.id,Ce),tt&&(Ce.properties=Object.assign({},Ce.properties))),fe.newGeometry&&(Ce.geometry=fe.newGeometry),fe.removeAllProperties)Ce.properties={};else if(((_e=fe.removeProperties)===null||_e===void 0?void 0:_e.length)>0)for(const nt of fe.removeProperties)Object.prototype.hasOwnProperty.call(Ce.properties,nt)&&delete Ce.properties[nt];if(((we=fe.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0)for(const{key:nt,value:zt}of fe.addOrUpdateProperties)Ce.properties[nt]=zt}}(this._dataUpdateable,R.dataDiff,N),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(R){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(R){return this._geoJSONIndex.getClusterExpansionZoom(R.clusterId)}getClusterChildren(R){return this._geoJSONIndex.getChildren(R.clusterId)}getClusterLeaves(R){return this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset)}}class Tn{constructor(R){this.self=R,this.actor=new w.F(R),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,N)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=N},this.self.addProtocol=w.bi,this.self.removeProtocol=w.bj,this.self.registerRTLTextPlugin=D=>{if(w.bD.isParsed())throw new Error("RTL text plugin already registered.");w.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,N)=>this._getDEMWorkerSource(D,N.source).loadTile(N)),this.actor.registerMessageHandler("RDT",(D,N)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,N.source).removeTile(N)})),this.actor.registerMessageHandler("GCEZ",(D,N)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterExpansionZoom(N)})),this.actor.registerMessageHandler("GCC",(D,N)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterChildren(N)})),this.actor.registerMessageHandler("GCL",(D,N)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterLeaves(N)})),this.actor.registerMessageHandler("LD",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadData(N)),this.actor.registerMessageHandler("GD",(D,N)=>this._getWorkerSource(D,N.type,N.source).getData()),this.actor.registerMessageHandler("LT",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadTile(N)),this.actor.registerMessageHandler("RT",(D,N)=>this._getWorkerSource(D,N.type,N.source).reloadTile(N)),this.actor.registerMessageHandler("AT",(D,N)=>this._getWorkerSource(D,N.type,N.source).abortTile(N)),this.actor.registerMessageHandler("RMT",(D,N)=>this._getWorkerSource(D,N.type,N.source).removeTile(N)),this.actor.registerMessageHandler("RS",(D,N)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][N.type]||!this.workerSources[D][N.type][N.source])return;const G=this.workerSources[D][N.type][N.source];delete this.workerSources[D][N.type][N.source],G.removeSource!==void 0&&G.removeSource(N)})),this.actor.registerMessageHandler("RM",D=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,N)=>w._(this,void 0,void 0,function*(){this.referrer=N})),this.actor.registerMessageHandler("SRPS",(D,N)=>this._syncRTLPluginState(D,N)),this.actor.registerMessageHandler("IS",(D,N)=>w._(this,void 0,void 0,function*(){this.self.importScripts(N)})),this.actor.registerMessageHandler("SI",(D,N)=>this._setImages(D,N)),this.actor.registerMessageHandler("UL",(D,N)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(N.layers,N.removedIds)})),this.actor.registerMessageHandler("SL",(D,N)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(N)}))}_setImages(R,D){return w._(this,void 0,void 0,function*(){this.availableImages[R]=D;for(const N in this.workerSources[R]){const G=this.workerSources[R][N];for(const ie in G)G[ie].availableImages=D}})}_syncRTLPluginState(R,D){return w._(this,void 0,void 0,function*(){if(w.bD.isParsed())return w.bD.getState();if(D.pluginStatus!=="loading")return w.bD.setState(D),D;const N=D.pluginURL;if(this.self.importScripts(N),w.bD.isParsed()){const G={pluginStatus:"loaded",pluginURL:N};return w.bD.setState(G),G}throw w.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${N}`)})}_getAvailableImages(R){let D=this.availableImages[R];return D||(D=[]),D}_getLayerIndex(R){let D=this.layerIndexes[R];return D||(D=this.layerIndexes[R]=new d),D}_getWorkerSource(R,D,N){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][D]||(this.workerSources[R][D]={}),!this.workerSources[R][D][N]){const G={sendAsync:(ie,oe)=>(ie.targetMapId=R,this.actor.sendAsync(ie,oe))};switch(D){case"vector":this.workerSources[R][D][N]=new te(G,this._getLayerIndex(R),this._getAvailableImages(R));break;case"geojson":this.workerSources[R][D][N]=new ss(G,this._getLayerIndex(R),this._getAvailableImages(R));break;default:this.workerSources[R][D][N]=new this.externalWorkerSourceTypes[D](G,this._getLayerIndex(R),this._getAvailableImages(R))}}return this.workerSources[R][D][N]}_getDEMWorkerSource(R,D){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][D]||(this.demWorkerSources[R][D]=new $),this.demWorkerSources[R][D]}}return w.i(self)&&(self.worker=new Tn(self)),Tn}),_("index",["exports","./shared"],function(w,d){var j="4.7.1";let Y,me;const te={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((e,o)=>{const u=requestAnimationFrame(e);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),o(d.c())})}),getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,o.drawImage(m,0,0,m.width,m.height),o},resolveURL:m=>(Y||(Y=document.createElement("a")),Y.href=m,Y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(me==null&&(me=matchMedia("(prefers-reduced-motion: reduce)")),me.matches)}};class ${static testProp(e){if(!$.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in $.docStyle)return e[o];return e[0]}static create(e,o,u){const c=window.document.createElement(e);return o!==void 0&&(c.className=o),u&&u.appendChild(c),c}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(e,o){e.style[$.transformProp]=o}static addEventListener(e,o,u,c={}){e.addEventListener(o,u,"passive"in c?c:c.capture)}static removeEventListener(e,o,u,c={}){e.removeEventListener(o,u,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",$.suppressClickInternal,!0)},0)}static getScale(e){const o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,u){const c=o.boundingClientRect;return new d.P((u.clientX-c.left)/o.x-e.clientLeft,(u.clientY-c.top)/o.y-e.clientTop)}static mousePos(e,o){const u=$.getScale(e);return $.getPoint(e,u,o)}static touchPos(e,o){const u=[],c=$.getScale(e);for(let f=0;f<o.length;f++)u.push($.getPoint(e,c,o[f]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);const Ie={supported:!1,testSupport:function(m){!yt&&Le&&(ae?ne(m):Me=m)}};let Me,Le,yt=!1,ae=!1;function ne(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Le),m.isContextLost())return;Ie.supported=!0}catch{}m.deleteTexture(e),yt=!0}var ce;typeof document<"u"&&(Le=document.createElement("img"),Le.onload=()=>{Me&&ne(Me),Me=null,ae=!0},Le.onerror=()=>{yt=!0,Me=null},Le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,o,u,c;m.resetRequestQueue=()=>{e=[],o=0,u=0,c={}},m.addThrottleControl=k=>{const C=u++;return c[C]=k,C},m.removeThrottleControl=k=>{delete c[k],x()},m.getImage=(k,C,A=!0)=>new Promise((M,B)=>{Ie.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),d.e(k,{type:"image"}),e.push({abortController:C,requestParameters:k,supportImageRefresh:A,state:"queued",onError:V=>{B(V)},onSuccess:V=>{M(V)}}),x()});const f=k=>d._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:C,supportImageRefresh:A,onError:M,onSuccess:B,abortController:V}=k,U=A===!1&&!d.i(self)&&!d.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((J,ee)=>J&&ee==="accept",!0));o++;const H=U?S(C,V):d.m(C,V);try{const J=yield H;delete k.abortController,k.state="completed",J.data instanceof HTMLImageElement||d.b(J.data)?B(J):J.data&&B({data:yield(K=J.data,typeof createImageBitmap=="function"?d.d(K):d.f(K)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete k.abortController,M(J)}finally{o--,x()}var K}),x=()=>{const k=(()=>{for(const C of Object.keys(c))if(c[C]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=o;C<k&&e.length>0;C++){const A=e.shift();A.abortController.signal.aborted?C--:f(A)}},S=(k,C)=>new Promise((A,M)=>{const B=new Image,V=k.url,U=k.credentials;U&&U==="include"?B.crossOrigin="use-credentials":(U&&U==="same-origin"||!d.s(V))&&(B.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{B.src="",M(d.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,A({data:B})},B.onerror=()=>{B.onerror=B.onload=null,C.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=V})}(ce||(ce={})),ce.resetRequestQueue();class Se{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function je(m){var e=new d.A(3);return e[0]=m[0],e[1]=m[1],e[2]=m[2],e}var Ne,Fe=function(m,e,o){return m[0]=e[0]-o[0],m[1]=e[1]-o[1],m[2]=e[2]-o[2],m};Ne=new d.A(3),d.A!=Float32Array&&(Ne[0]=0,Ne[1]=0,Ne[2]=0);var Ye=function(m){var e=m[0],o=m[1];return e*e+o*o};function kt(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const o=[];for(const{id:u,url:c}of m){const f=`${u}${c}`;o.indexOf(f)===-1&&(o.push(f),e.push({id:u,url:c}))}}return e}function it(m,e,o){const u=m.split("?");return u[0]+=`${e}${o}`,u.join("?")}(function(){var m=new d.A(2);d.A!=Float32Array&&(m[0]=0,m[1]=0)})();class mt{constructor(e,o,u,c){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(o,c)}update(e,o,u){const{width:c,height:f}=e,x=!(this.size&&this.size[0]===c&&this.size[1]===f||u),{context:S}=this,{gl:k}=S;if(this.useMipmap=!!(o&&o.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[c,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,e):k.texImage2D(k.TEXTURE_2D,0,this.format,c,f,0,this.format,k.UNSIGNED_BYTE,e.data);else{const{x:C,y:A}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?k.texSubImage2D(k.TEXTURE_2D,0,C,A,k.RGBA,k.UNSIGNED_BYTE,e):k.texSubImage2D(k.TEXTURE_2D,0,C,A,c,f,k.RGBA,k.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(e,o,u){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),u!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,u||e),this.filter=e),o!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Et(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Mt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(e){const o=this.images[e];if(o&&!o.data&&o.spriteData){const u=o.spriteData;o.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let u=!0;const c=o.data||o.spriteData;return this._validateStretch(o.stretchX,c&&c.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,c&&c.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,o){if(!e)return!0;let u=0;for(const c of e){if(c[0]<u||c[1]<c[0]||o<c[1])return!1;u=c[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;const u=o.spriteData,c=u&&u.width||o.data.width,f=u&&u.height||o.data.height;return!(e[0]<0||c<e[0]||e[1]<0||f<e[1]||e[2]<0||c<e[2]||e[3]<0||f<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,u=!0){const c=this.getImage(e);if(u&&(c.data.width!==o.data.width||c.data.height!==o.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=c.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){const o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((o,u)=>{let c=!0;if(!this.isLoaded())for(const f of e)this.images[f]||(c=!1);this.isLoaded()||c?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})})}_getImagesForIds(e){const o={};for(const u of e){let c=this.getImage(u);c||(this.fire(new d.k("styleimagemissing",{id:u})),c=this.getImage(u)),c?o[u]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){const o=this.patterns[e],u=this.getImage(e);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const c={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new d.I(c,u);this.patterns[e]={bin:c,position:f}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new mt(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const f in this.patterns)e.push(this.patterns[f].bin);const{w:o,h:u}=d.p(e),c=this.atlasImage;c.resize({width:o||1,height:u||1});for(const f in this.patterns){const{bin:x}=this.patterns[f],S=x.x+1,k=x.y+1,C=this.getImage(f).data,A=C.width,M=C.height;d.R.copy(C,c,{x:0,y:0},{x:S,y:k},{width:A,height:M}),d.R.copy(C,c,{x:0,y:M-1},{x:S,y:k-1},{width:A,height:1}),d.R.copy(C,c,{x:0,y:0},{x:S,y:k+M},{width:A,height:1}),d.R.copy(C,c,{x:A-1,y:0},{x:S-1,y:k},{width:1,height:M}),d.R.copy(C,c,{x:0,y:0},{x:S+A,y:k},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.getImage(o);u||d.w(`Image with ID: "${o}" was not found`),Et(u)&&this.updateImage(o,u)}}}const Yt=1e20;function wr(m,e,o,u,c,f,x,S,k){for(let C=e;C<e+u;C++)ri(m,o*f+C,f,c,x,S,k);for(let C=o;C<o+c;C++)ri(m,C*f+e,1,u,x,S,k)}function ri(m,e,o,u,c,f,x){f[0]=0,x[0]=-Yt,x[1]=Yt,c[0]=m[e];for(let S=1,k=0,C=0;S<u;S++){c[S]=m[e+S*o];const A=S*S;do{const M=f[k];C=(c[S]-c[M]+A-M*M)/(S-M)/2}while(C<=x[k]&&--k>-1);k++,f[k]=S,x[k]=C,x[k+1]=Yt}for(let S=0,k=0;S<u;S++){for(;x[k+1]<S;)k++;const C=f[k],A=S-C;m[e+S*o]=c[C]+A*A}}class Br{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const o=[];for(const f in e)for(const x of e[f])o.push(this._getAndCacheGlyphsPromise(f,x));const u=yield Promise.all(o),c={};for(const{stack:f,id:x,glyph:S}of u)c[f]||(c[f]={}),c[f][x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return c})}_getAndCacheGlyphsPromise(e,o){return d._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=u.glyphs[o];if(c!==void 0)return{stack:e,id:o,glyph:c};if(c=this._tinySDF(u,e,o),c)return u.glyphs[o]=c,{stack:e,id:o,glyph:c};const f=Math.floor(o/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[f])return{stack:e,id:o,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[f]){const S=Br.loadGlyphRange(e,f,this.url,this.requestManager);u.requests[f]=S}const x=yield u.requests[f];for(const S in x)this._doesCharSupportLocalGlyph(+S)||(u.glyphs[+S]=x[+S]);return u.ranges[f]=!0,{stack:e,id:o,glyph:x[o]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,o,u){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(u))return;let f=e.tinySDF;if(!f){let S="400";/bold/i.test(o)?S="900":/medium/i.test(o)?S="500":/light/i.test(o)&&(S="200"),f=e.tinySDF=new Br.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:S})}const x=f.draw(String.fromCharCode(u));return{id:u,bitmap:new d.o({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}Br.loadGlyphRange=function(m,e,o,u){return d._(this,void 0,void 0,function*(){const c=256*e,f=c+255,x=u.transformRequest(o.replace("{fontstack}",m).replace("{range}",`${c}-${f}`),"Glyphs"),S=yield d.l(x,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${f}`);const k={};for(const C of d.n(S.data))k[C.id]=C;return k})},Br.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:o=8,cutoff:u=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=o;const S=this.size=m+4*e,k=this._createCanvas(S),C=this.ctx=k.getContext("2d",{willReadFrequently:!0});C.font=`${x} ${f} ${m}px ${c}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(m),x=Math.ceil(o),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),k=Math.min(this.size-this.buffer,x+Math.ceil(u)),C=S+2*this.buffer,A=k+2*this.buffer,M=Math.max(C*A,0),B=new Uint8ClampedArray(M),V={data:B,width:C,height:A,glyphWidth:S,glyphHeight:k,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(S===0||k===0)return V;const{ctx:U,buffer:H,gridInner:K,gridOuter:J}=this;U.clearRect(H,H,S,k),U.fillText(m,H,H+x);const ee=U.getImageData(H,H,S,k);J.fill(Yt,0,M),K.fill(0,0,M);for(let q=0;q<k;q++)for(let se=0;se<S;se++){const le=ee.data[4*(q*S+se)+3]/255;if(le===0)continue;const pe=(q+H)*C+se+H;if(le===1)J[pe]=0,K[pe]=Yt;else{const xe=.5-le;J[pe]=xe>0?xe*xe:0,K[pe]=xe<0?xe*xe:0}}wr(J,0,0,C,A,C,this.f,this.v,this.z),wr(K,H,H,S,k,C,this.f,this.v,this.z);for(let q=0;q<M;q++){const se=Math.sqrt(J[q])-Math.sqrt(K[q]);B[q]=Math.round(255-255*(se/this.radius+this.cutoff))}return V}};class We{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,o){return d.x(e.expression.evaluate(o))}interpolate(e,o,u){return{x:d.y.number(e.x,o.x,u),y:d.y.number(e.y,o.y,u),z:d.y.number(e.z,o.z,u)}}}let lt;class pt extends d.E{constructor(e){super(),lt=lt||new d.q({anchor:new d.D(d.v.light.anchor),position:new We,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(lt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(d.r,e,o))for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u){return(!u||u.validate!==!1)&&d.t(this,e.call(d.u,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const Tt=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class Ft extends d.E{constructor(e){super(),this._transitionable=new d.T(Tt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,o={}){if(!this._validate(d.B,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u={}){return(u==null?void 0:u.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class nr{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){const u=e.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,o)),this.dashEntry[u]}getDashRanges(e,o,u){const c=[];let f=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,S=!0;c.push({left:f,right:x,isDash:S,zeroLength:e[0]===0});let k=e[0];for(let C=1;C<e.length;C++){S=!S;const A=e[C];f=k*u,k+=A,x=k*u,c.push({left:f,right:x,isDash:S,zeroLength:A===0})}return c}addRoundDash(e,o,u){const c=o/2;for(let f=-u;f<=u;f++){const x=this.width*(this.nextRow+u+f);let S=0,k=e[S];for(let C=0;C<this.width;C++){C/k.right>1&&(k=e[++S]);const A=Math.abs(C-k.left),M=Math.abs(C-k.right),B=Math.min(A,M);let V;const U=f/u*(c+1);if(k.isDash){const H=c-Math.abs(U);V=Math.sqrt(B*B+H*H)}else V=c-Math.sqrt(B*B+U*U);this.data[x+C]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const k=e[S],C=e[S+1];k.zeroLength?e.splice(S,1):C&&C.isDash===k.isDash&&(C.left=k.left,e.splice(S,1))}const o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const c=this.width*this.nextRow;let f=0,x=e[f];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++f]);const k=Math.abs(S-x.left),C=Math.abs(S-x.right),A=Math.min(k,C);this.data[c+S]=Math.max(0,Math.min(255,(x.isDash?A:-A)+128))}}addDash(e,o){const u=o?7:0,c=2*u+1;if(this.nextRow+c>this.height)return d.w("LineAtlas out of space"),null;let f=0;for(let S=0;S<e.length;S++)f+=e[S];if(f!==0){const S=this.width/f,k=this.getDashRanges(e,this.width,S);o?this.addRoundDash(k,S,u):this.addRegularDash(k)}const x={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:f};return this.nextRow+=c,this.dirty=!0,x}bind(e){const o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const br="maplibre_preloaded_worker_pool";class Fr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Fr.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[br]}numActive(){return Object.keys(this.active).length}}const qr=Math.floor(te.hardwareConcurrency/2);let Sr,ki;function On(){return Sr||(Sr=new Fr),Sr}Fr.workerCount=d.C(globalThis)?Math.max(Math.min(qr,3),1):1;class Nn{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;const u=this.workerPool.acquire(o);for(let c=0;c<u.length;c++){const f=new d.F(u[c],o);f.name=`Worker ${c}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){const u=[];for(const c of this.actors)u.push(c.sendAsync({type:e,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(const u of this.actors)u.registerMessageHandler(e,o)}}function ws(){return ki||(ki=new Nn(On(),d.G),ki.registerMessageHandler("GR",(m,e,o)=>d.m(e,o))),ki}function Qi(m,e){const o=d.H();return d.J(o,o,[1,1,0]),d.K(o,o,[.5*m.width,.5*m.height,1]),d.L(o,o,m.calculatePosMatrix(e.toUnwrapped()))}function wn(m,e,o,u,c,f){const x=function(M,B,V){if(M)for(const U of M){const H=B[U];if(H&&H.source===V&&H.type==="fill-extrusion")return!0}else for(const U in B){const H=B[U];if(H.source===V&&H.type==="fill-extrusion")return!0}return!1}(c&&c.layers,e,m.id),S=f.maxPitchScaleFactor(),k=m.tilesIn(u,S,x);k.sort(bn);const C=[];for(const M of k)C.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,o,m._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,c,f,S,Qi(m.transform,M.tileID))});const A=function(M){const B={},V={};for(const U of M){const H=U.queryResults,K=U.wrappedTileID,J=V[K]=V[K]||{};for(const ee in H){const q=H[ee],se=J[ee]=J[ee]||{},le=B[ee]=B[ee]||[];for(const pe of q)se[pe.featureIndex]||(se[pe.featureIndex]=!0,le.push(pe))}}return B}(C);for(const M in A)A[M].forEach(B=>{const V=B.feature,U=m.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=U});return A}function bn(m,e){const o=m.tileID,u=e.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function rs(m,e,o){return d._(this,void 0,void 0,function*(){let u=m;if(m.url?u=(yield d.h(e.transformRequest(m.url,"Source"),o)).data:yield te.frameAsync(o),!u)return null;const c=d.M(d.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(c.vectorLayerIds=u.vector_layers.map(f=>f.id)),c})}class ge{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const o=this._sw,u=this._ne;let c,f;if(e instanceof d.N)c=e,f=e;else{if(!(e instanceof ge))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ge.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return o||u?(o.lng=Math.min(c.lng,o.lng),o.lat=Math.min(c.lat,o.lat),u.lng=Math.max(f.lng,u.lng),u.lat=Math.max(f.lat,u.lat)):(this._sw=new d.N(c.lng,c.lat),this._ne=new d.N(f.lng,f.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:u}=d.N.convert(e);let c=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&c}static convert(e){return e instanceof ge?e:e&&new ge(e)}static fromLngLat(e,o=0){const u=360*o/40075017,c=u/Math.cos(Math.PI/180*e.lat);return new ge(new d.N(e.lng-c,e.lat-u),new d.N(e.lng+c,e.lat+u))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),o=new d.N(this._ne.lng,this._ne.lat);return new ge(e,e.lng>o.lng?new d.N(o.lng+360,o.lat):o)}}class at{constructor(e,o,u){this.bounds=ge.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const o=Math.pow(2,e.z),u=Math.floor(d.O(this.bounds.getWest())*o),c=Math.floor(d.Q(this.bounds.getNorth())*o),f=Math.ceil(d.O(this.bounds.getEast())*o),x=Math.ceil(d.Q(this.bounds.getSouth())*o);return e.x>=u&&e.x<f&&e.y>=c&&e.y<x}}class qt extends d.E{constructor(e,o,u,c){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(o,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield rs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new at(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((f,x)=>{e.reloadPromise={resolve:f,reject:x}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const f=yield e.actor.sendAsync({type:c,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,f)}catch(f){if(delete e.abortController,e.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class wt extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},o),d.e(this,d.M(o,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield rs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new at(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield ce.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const c=this.map.painter.context,f=c.gl,x=u.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new mt(c,x,f.RGBA,{useMipmap:!0}),e.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class sr extends wt{constructor(e,o,u,c){super(e,o,u,c),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield ce.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const f=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const x=d.b(f)&&d.U()?f:yield this.readImageNow(f),S={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const k=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=k,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const o=e.width+2,u=e.height+2;try{return new d.R({width:o,height:u},yield d.W(e,-1,-1,o,u))}catch{}}return te.getImageData(e,1)})}_getNeighboringTiles(e){const o=e.canonical,u=Math.pow(2,o.z),c=(o.x-1+u)%u,f=o.x===0?e.wrap-1:e.wrap,x=(o.x+1+u)%u,S=o.x+1===u?e.wrap+1:e.wrap,k={};return k[new d.S(e.overscaledZ,f,o.z,c,o.y).key]={backfilled:!1},k[new d.S(e.overscaledZ,S,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(k[new d.S(e.overscaledZ,f,o.z,c,o.y-1).key]={backfilled:!1},k[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},k[new d.S(e.overscaledZ,S,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<u&&(k[new d.S(e.overscaledZ,f,o.z,c,o.y+1).key]={backfilled:!1},k[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},k[new d.S(e.overscaledZ,S,o.z,x,o.y+1).key]={backfilled:!1}),k}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class is extends d.E{constructor(e,o,u,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(c),this._data=o.data,this._options=d.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const f=d.X/this.tileSize;o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*f,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*f,extent:d.X,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.X,radius:(o.clusterRadius||50)*f,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:u}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const o=d.e({type:this.type},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(te.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let c=null;u.resourceTiming&&u.resourceTiming[this.id]&&(c=u.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&d.e(f,{resourceTiming:c}),this.fire(new d.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:o,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,o==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var en=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Oi extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=o}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield ce.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new d.j(o))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const o=e.map(d.Z.fromLngLat);this.tileID=function(c){let f=1/0,x=1/0,S=-1/0,k=-1/0;for(const B of c)f=Math.min(f,B.x),x=Math.min(x,B.y),S=Math.max(S,B.x),k=Math.max(k,B.y);const C=Math.max(S-f,k-x),A=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),M=Math.pow(2,A);return new d.a1(A,Math.floor((f+S)/2*M),Math.floor((x+k)/2*M))}(o),this.minzoom=this.maxzoom=this.tileID.z;const u=o.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,d.X,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,d.X),this._boundsArray.emplaceBack(u[2].x,u[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,en.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new mt(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Vn extends Oi{constructor(e,o,u,c){super(e,o,u,c),this.roundZoom=!0,this.type="video",this.options=o}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield d.a3(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new d.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,en.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new mt(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ii extends Oi{constructor(e,o,u,c){super(e,o,u,c),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(x=>typeof x!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,en.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new mt(o,this.canvas,u.RGBA,{premultiply:!0});let c=!1;for(const f in this.tiles){const x=this.tiles[f];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,c=!0)}c&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ks={},jn=m=>{switch(m){case"geojson":return is;case"image":return Oi;case"raster":return wt;case"raster-dem":return sr;case"vector":return qt;case"video":return Vn;case"canvas":return ii}return Ks[m]},ke="RTLPluginLoaded";class Zr extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ws()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=te.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(ke))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Or=null;function Ni(){return Or||(Or=new Zr),Or}class ns{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,f){const x={};if(!f)return x;for(const S of c){const k=S.layerIds.map(C=>f.getLayer(C)).filter(Boolean);if(k.length!==0){S.layers=k,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(C=>k.filter(A=>A.id===C)[0]));for(const C of k)x[C.id]=S}}return x}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof d.a6){if(this.hasSymbolBuckets=!0,!u)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof d.a6&&f.hasRTLText){this.hasRTLText=!0,Ni().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(c).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const c=this.buckets[u];c.uploadPending()&&c.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mt(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mt(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,u,c,f,x,S,k,C,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:f,scale:x,tileSize:this.tileSize,pixelPosMatrix:A,transform:k,params:S,queryPadding:this.queryPadding*C},e,o,u):{}}querySourceFeatures(e,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const c=u.loadVTLayers(),f=o&&o.sourceLayer?o.sourceLayer:"",x=c._geojsonTileLayer||c[f];if(!x)return;const S=d.a7(o&&o.filter),{z:k,x:C,y:A}=this.tileID.canonical,M={z:k,x:C,y:A};for(let B=0;B<x.length;B++){const V=x.feature(B);if(S.needGeometry){const K=d.a8(V,!0);if(!S.filter(new d.z(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!S.filter(new d.z(this.tileID.overscaledZ),V))continue;const U=u.getId(V,f),H=new d.a9(V,k,C,A,U);H.tile=M,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const u=d.aa(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let c=!1;if(this.expirationTime>u)c=!1;else if(o)if(this.expirationTime<o)c=!0;else{const f=this.expirationTime-o;f?this.expirationTime=u+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!o.style.hasLayer(c))continue;const f=this.buckets[c],x=f.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],k=e[x];if(!S||!k||Object.keys(k).length===0)continue;f.update(k,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=o&&o.style&&o.style.getLayer(c);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<te.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=te.now()+e}setDependencies(e,o){const u={};for(const c of o)u[c]=!0;this.dependencies[e]=u}hasDependency(e,o){for(const u of e){const c=this.dependencies[u];if(c){for(const f of o)if(c[f])return!0}}return!1}}class De{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,u){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const f={value:o,timeout:void 0};if(u!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},u)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const u=e.wrapped().key,c=o===void 0?0:this.data[u].indexOf(o),f=this.data[u][c];return this.data[u].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(f.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const u in this.data)for(const c of this.data[u])e(c.value)||o.push(c);for(const u of o)this.remove(u.value.tileID,u)}}class xt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,u){const c=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},d.e(this.stateChanges[e][c],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==c&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const f in this.state[e][c])u[f]||(this.deletedStates[e][c][f]=null)}else for(const f in u)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][f]===null&&delete this.deletedStates[e][c][f]}removeFeatureState(e,o,u){if(this.deletedStates[e]===null)return;const c=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&o!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][u]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(u in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][u]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,o){const u=String(o),c=d.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][o];if(f===null)return{};for(const x in f)delete c[x]}return c}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const u={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const x in this.stateChanges[c])this.state[c][x]||(this.state[c][x]={}),d.e(this.state[c][x],this.stateChanges[c][x]),f[x]=this.state[c][x];u[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(this.deletedStates[c]===null)for(const x in this.state[c])f[x]={},this.state[c][x]={};else for(const x in this.deletedStates[c]){if(this.deletedStates[c][x]===null)this.state[c][x]={};else for(const S of Object.keys(this.deletedStates[c][x]))delete this.state[c][x][S];f[x]=this.state[c][x]}u[c]=u[c]||{},d.e(u[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const c in e)e[c].setFeatureState(u,o)}}class ut extends d.E{constructor(e,o,u){super(),this.id=e,this.dispatcher=u,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,f,x,S)=>{const k=new(jn(f.type))(c,f,x,S);if(k.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${k.id}`);return k})(e,o,u,this),this._tiles={},this._cache=new De(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new xt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,u){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,u)}catch(c){e.state="errored",c.status!==404?this._source.fire(new d.j(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(di).map(e=>e.key)}getRenderableIds(e){const o=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&o.push(this._tiles[u]);return e?o.sort((u,c)=>{const f=u.tileID,x=c.tileID,S=new d.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),k=new d.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-x.overscaledZ||k.y-S.y||k.x-S.x}).map(u=>u.tileID.key):o.map(u=>u.tileID).sort(di).map(u=>u.key)}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,o){return d._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,e,o))})}_tileLoaded(e,o,u){e.timeAdded=te.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const o=this.getRenderableIds();for(let c=0;c<o.length;c++){const f=o[c];if(e.neighboringTiles&&e.neighboringTiles[f]){const x=this.getTileByID(f);u(e,x),u(x,e)}}function u(c,f){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let x=f.tileID.canonical.x-c.tileID.canonical.x;const S=f.tileID.canonical.y-c.tileID.canonical.y,k=Math.pow(2,c.tileID.canonical.z),C=f.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+k)===1?x+=k:Math.abs(x-k)===1&&(x-=k)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,x,S),c.neighboringTiles&&c.neighboringTiles[C]&&(c.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,u,c){for(const f in this._tiles){let x=this._tiles[f];if(c[f]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>u)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){const C=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[C.key],x&&x.hasData()&&(S=C)}let k=S;for(;k.overscaledZ>o;)if(k=k.scaledTo(k.overscaledZ-1),e[k.key]){c[S.key]=S;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=e.overscaledZ-1;u>=o;u--){const c=e.scaledTo(u),f=this._getLoadedTile(c);if(f)return f}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const o=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(f)}handleWrapJump(e){const o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){const u={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+o),u[f.tileID.key]=f}this._tiles=u;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,o,u,c,f,x){const S={},k={},C=Object.keys(e),A=te.now();for(const M of C){const B=e[M],V=this._tiles[M];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=A)continue;const U=this.findLoadedParent(B,o),H=this.findLoadedSibling(B),K=U||H||null;K&&(this._addTile(K.tileID),S[K.tileID.key]=K.tileID),k[M]=B}this._retainLoadedChildren(k,c,u,e);for(const M in S)e[M]||(this._coveredTiles[M]=!0,e[M]=S[M]);if(x){const M={},B={};for(const V of f)this._tiles[V.key].hasData()?M[V.key]=V:B[V.key]=V;for(const V in B){const U=B[V].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(M[U[0].key]=e[U[0].key]=U[0],M[U[1].key]=e[U[1].key]=U[1],M[U[2].key]=e[U[2].key]=U[2],M[U[3].key]=e[U[3].key]=U[3],delete B[V])}for(const V in B){const U=B[V],H=this.findLoadedParent(U,this._source.minzoom),K=this.findLoadedSibling(U),J=H||K||null;if(J){M[J.tileID.key]=e[J.tileID.key]=J.tileID;for(const ee in M)M[ee].isChildOf(J.tileID)&&delete M[ee]}}for(const V in this._tiles)M[V]||(this._coveredTiles[V]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new d.S(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(u=u.filter(A=>this._source.hasTile(A)))):u=[];const c=e.coveringZoomLevel(this._source),f=Math.max(c-ut.maxOverzooming,this._source.minzoom),x=Math.max(c+ut.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const M of u)if(M.canonical.z>this._source.minzoom){const B=M.scaledTo(M.canonical.z-1);A[B.key]=B;const V=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));A[V.key]=V}u=u.concat(Object.values(A))}const S=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(u,c);tn(this._source.type)&&this._updateCoveredAndRetainedTiles(k,f,x,c,u,o);for(const A in k)this._tiles[A].clearFadeHold();const C=d.ab(this._tiles,k);for(const A of C){const M=this._tiles[A];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var u;const c={},f={},x=Math.max(o-ut.maxOverzooming,this._source.minzoom),S=Math.max(o+ut.maxUnderzooming,this._source.minzoom),k={};for(const C of e){const A=this._addTile(C);c[C.key]=C,A.hasData()||o<this._source.maxzoom&&(k[C.key]=C)}this._retainLoadedChildren(k,o,S,c);for(const C of e){let A=this._tiles[C.key];if(A.hasData())continue;if(o+1>this._source.maxzoom){const B=C.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){c[B.key]=B;continue}}else{const B=C.children(this._source.maxzoom);if(c[B[0].key]&&c[B[1].key]&&c[B[2].key]&&c[B[3].key])continue}let M=A.wasRequested();for(let B=C.overscaledZ-1;B>=x;--B){const V=C.scaledTo(B);if(f[V.key])break;if(f[V.key]=!0,A=this.getTile(V),!A&&M&&(A=this._addTile(V)),A){const U=A.hasData();if((U||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||M)&&(c[V.key]=V),M=A.wasRequested(),U)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let u,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){u=this._loadedParentTiles[c.key];break}o.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(u=this._getLoadedTile(f),u)break;c=f}for(const f of o)this._loadedParentTiles[f]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const o=this._tiles[e].tileID,u=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=u}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const u=o;return o||(o=new ns(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,u||this._source.fire(new d.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=o.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){const o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,u){const c=[],f=this.transform;if(!f)return c;const x=u?f.getCameraQueryGeometry(e):e,S=e.map(U=>f.pointCoordinate(U,this.terrain)),k=x.map(U=>f.pointCoordinate(U,this.terrain)),C=this.getIds();let A=1/0,M=1/0,B=-1/0,V=-1/0;for(const U of k)A=Math.min(A,U.x),M=Math.min(M,U.y),B=Math.max(B,U.x),V=Math.max(V,U.y);for(let U=0;U<C.length;U++){const H=this._tiles[C[U]];if(H.holdingForFade())continue;const K=H.tileID,J=Math.pow(2,f.zoom-H.tileID.overscaledZ),ee=o*H.queryPadding*d.X/H.tileSize/J,q=[K.getTilePoint(new d.Z(A,M)),K.getTilePoint(new d.Z(B,V))];if(q[0].x-ee<d.X&&q[0].y-ee<d.X&&q[1].x+ee>=0&&q[1].y+ee>=0){const se=S.map(pe=>K.getTilePoint(pe)),le=k.map(pe=>K.getTilePoint(pe));c.push({tile:H,tileID:K,queryGeometry:se,cameraQueryGeometry:le,scale:J})}}return c}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of o)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(tn(this._source.type)){const e=te.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,u){this._state.updateState(e=e||"_geojsonTileLayer",o,u)}removeFeatureState(e,o,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,u)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,u){const c=this._tiles[e];c&&c.setDependencies(o,u)}reloadTilesForDependencies(e,o){for(const u in this._tiles)this._tiles[u].hasDependency(e,o)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,o))}}function di(m,e){const o=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-o||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function tn(m){return m==="raster"||m==="image"||m==="video"}ut.maxOverzooming=10,ut.maxUnderzooming=3;class ft{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let o=1,u=this._distances[o];const c=e*this.paddedLength+this.padding;for(;u<c&&o<this._distances.length;)u=this._distances[++o];const f=o-1,x=this._distances[f],S=u-x,k=S>0?(c-x)/S:0;return this.points[f].mult(1-k).add(this.points[o].mult(k))}}function Sn(m,e){let o=!0;return m==="always"||m!=="never"&&e!=="never"||(o=!1),o}class Un{constructor(e,o,u){const c=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(o/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)c.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,u,c,f){this._forEachCell(o,u,c,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(f)}insertCircle(e,o,u,c){this._forEachCell(o-c,u-c,o+c,u+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(u),this.circles.push(c)}_insertBoxCell(e,o,u,c,f,x){this.boxCells[f].push(x)}_insertCircleCell(e,o,u,c,f,x){this.circleCells[f].push(x)}_query(e,o,u,c,f,x,S){if(u<0||e>this.width||c<0||o>this.height)return[];const k=[];if(e<=0&&o<=0&&this.width<=u&&this.height<=c){if(f)return[{key:null,x1:e,y1:o,x2:u,y2:c}];for(let C=0;C<this.boxKeys.length;C++)k.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const A=this.circles[3*C],M=this.circles[3*C+1],B=this.circles[3*C+2];k.push({key:this.circleKeys[C],x1:A-B,y1:M-B,x2:A+B,y2:M+B})}}else this._forEachCell(e,o,u,c,this._queryCell,k,{hitTest:f,overlapMode:x,seenUids:{box:{},circle:{}}},S);return k}query(e,o,u,c){return this._query(e,o,u,c,!1,null)}hitTest(e,o,u,c,f,x){return this._query(e,o,u,c,!0,f,x).length>0}hitTestCircle(e,o,u,c,f){const x=e-u,S=e+u,k=o-u,C=o+u;if(S<0||x>this.width||C<0||k>this.height)return!1;const A=[];return this._forEachCell(x,k,S,C,this._queryCellCircle,A,{hitTest:!0,overlapMode:c,circle:{x:e,y:o,radius:u},seenUids:{box:{},circle:{}}},f),A.length>0}_queryCell(e,o,u,c,f,x,S,k){const{seenUids:C,hitTest:A,overlapMode:M}=S,B=this.boxCells[f];if(B!==null){const U=this.bboxes;for(const H of B)if(!C.box[H]){C.box[H]=!0;const K=4*H,J=this.boxKeys[H];if(e<=U[K+2]&&o<=U[K+3]&&u>=U[K+0]&&c>=U[K+1]&&(!k||k(J))&&(!A||!Sn(M,J.overlapMode))&&(x.push({key:J,x1:U[K],y1:U[K+1],x2:U[K+2],y2:U[K+3]}),A))return!0}}const V=this.circleCells[f];if(V!==null){const U=this.circles;for(const H of V)if(!C.circle[H]){C.circle[H]=!0;const K=3*H,J=this.circleKeys[H];if(this._circleAndRectCollide(U[K],U[K+1],U[K+2],e,o,u,c)&&(!k||k(J))&&(!A||!Sn(M,J.overlapMode))){const ee=U[K],q=U[K+1],se=U[K+2];if(x.push({key:J,x1:ee-se,y1:q-se,x2:ee+se,y2:q+se}),A)return!0}}}return!1}_queryCellCircle(e,o,u,c,f,x,S,k){const{circle:C,seenUids:A,overlapMode:M}=S,B=this.boxCells[f];if(B!==null){const U=this.bboxes;for(const H of B)if(!A.box[H]){A.box[H]=!0;const K=4*H,J=this.boxKeys[H];if(this._circleAndRectCollide(C.x,C.y,C.radius,U[K+0],U[K+1],U[K+2],U[K+3])&&(!k||k(J))&&!Sn(M,J.overlapMode))return x.push(!0),!0}}const V=this.circleCells[f];if(V!==null){const U=this.circles;for(const H of V)if(!A.circle[H]){A.circle[H]=!0;const K=3*H,J=this.circleKeys[H];if(this._circlesCollide(U[K],U[K+1],U[K+2],C.x,C.y,C.radius)&&(!k||k(J))&&!Sn(M,J.overlapMode))return x.push(!0),!0}}}_forEachCell(e,o,u,c,f,x,S,k){const C=this._convertToXCellCoord(e),A=this._convertToYCellCoord(o),M=this._convertToXCellCoord(u),B=this._convertToYCellCoord(c);for(let V=C;V<=M;V++)for(let U=A;U<=B;U++)if(f.call(this,e,o,u,c,this.xCellCount*U+V,x,S,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,u,c,f,x){const S=c-e,k=f-o,C=u+x;return C*C>S*S+k*k}_circleAndRectCollide(e,o,u,c,f,x,S){const k=(x-c)/2,C=Math.abs(e-(c+k));if(C>k+u)return!1;const A=(S-f)/2,M=Math.abs(o-(f+A));if(M>A+u)return!1;if(C<=k||M<=A)return!0;const B=C-k,V=M-A;return B*B+V*V<=u*u}}function ss(m,e,o,u,c){const f=d.H();return e?(d.K(f,f,[1/c,1/c,1]),o||d.ad(f,f,u.angle)):d.L(f,u.labelPlaneMatrix,m),f}function Tn(m,e,o,u,c){if(e){const f=d.ae(m);return d.K(f,f,[c,c,1]),o||d.ad(f,f,-u.angle),f}return u.glCoordMatrix}function W(m,e,o,u){let c;u?(c=[m,e,u(m,e),1],d.af(c,c,o)):(c=[m,e,0,1],zt(c,c,o));const f=c[3];return{point:new d.P(c[0]/f,c[1]/f),signedDistanceFromCamera:f,isOccluded:!1}}function R(m,e){return .5+m/e*.5}function D(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function N(m,e,o,u,c,f,x,S,k,C,A,M,B,V,U){const H=u?m.textSizeData:m.iconSizeData,K=d.ag(H,o.transform.zoom),J=[256/o.width*2+1,256/o.height*2+1],ee=u?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ee.clear();const q=m.lineVertexArray,se=u?m.text.placedSymbolArray:m.icon.placedSymbolArray,le=o.transform.width/o.transform.height;let pe=!1;for(let xe=0;xe<se.length;xe++){const Te=se.get(xe);if(Te.hidden||Te.writingMode===d.ah.vertical&&!pe){nt(Te.numGlyphs,ee);continue}pe=!1;const Oe=W(Te.anchorX,Te.anchorY,e,U);if(!D(Oe.point,J)){nt(Te.numGlyphs,ee);continue}const qe=R(o.transform.cameraToCenterDistance,Oe.signedDistanceFromCamera),Ae=d.ai(H,K,Te),Pe=x?Ae/qe:Ae*qe,Ke={getElevation:U,labelPlaneMatrix:c,lineVertexArray:q,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:C,tileAnchorPoint:new d.P(Te.anchorX,Te.anchorY),unwrappedTileID:A,width:M,height:B,translation:V},dt=oe(Ke,Te,Pe,!1,S,e,f,m.glyphOffsetArray,ee,le,k);pe=dt.useVertical,(dt.notEnoughRoom||pe||dt.needsFlipping&&oe(Ke,Te,Pe,!0,S,e,f,m.glyphOffsetArray,ee,le,k).notEnoughRoom)&&nt(Te.numGlyphs,ee)}u?m.text.dynamicLayoutVertexBuffer.updateData(ee):m.icon.dynamicLayoutVertexBuffer.updateData(ee)}function G(m,e,o,u,c,f,x,S){const k=f.glyphStartIndex+f.numGlyphs,C=f.lineStartIndex,A=f.lineStartIndex+f.lineLength,M=e.getoffsetX(f.glyphStartIndex),B=e.getoffsetX(k-1),V=Ce(m*M,o,u,c,f.segment,C,A,S,x);if(!V)return null;const U=Ce(m*B,o,u,c,f.segment,C,A,S,x);return U?S.projectionCache.anyProjectionOccluded?null:{first:V,last:U}:null}function ie(m,e,o,u){return m===d.ah.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*u?{useVertical:!0}:(m===d.ah.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function oe(m,e,o,u,c,f,x,S,k,C,A){const M=o/24,B=e.lineOffsetX*M,V=e.lineOffsetY*M;let U;if(e.numGlyphs>1){const H=e.glyphStartIndex+e.numGlyphs,K=e.lineStartIndex,J=e.lineStartIndex+e.lineLength,ee=G(M,S,B,V,u,e,A,m);if(!ee)return{notEnoughRoom:!0};const q=W(ee.first.point.x,ee.first.point.y,x,m.getElevation).point,se=W(ee.last.point.x,ee.last.point.y,x,m.getElevation).point;if(c&&!u){const le=ie(e.writingMode,q,se,C);if(le)return le}U=[ee.first];for(let le=e.glyphStartIndex+1;le<H-1;le++)U.push(Ce(M*S.getoffsetX(le),B,V,u,e.segment,K,J,m,A));U.push(ee.last)}else{if(c&&!u){const K=W(m.tileAnchorPoint.x,m.tileAnchorPoint.y,f,m.getElevation).point,J=e.lineStartIndex+e.segment+1,ee=new d.P(m.lineVertexArray.getx(J),m.lineVertexArray.gety(J)),q=W(ee.x,ee.y,f,m.getElevation),se=q.signedDistanceFromCamera>0?q.point:function(pe,xe,Te,Oe,qe,Ae){return he(pe,xe,Te,1,qe,Ae)}(m.tileAnchorPoint,ee,K,0,f,m),le=ie(e.writingMode,K,se,C);if(le)return le}const H=Ce(M*S.getoffsetX(e.glyphStartIndex),B,V,u,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,m,A);if(!H||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[H]}for(const H of U)d.aj(k,H.point,H.angle);return{}}function he(m,e,o,u,c,f){const x=m.add(m.sub(e)._unit()),S=c!==void 0?W(x.x,x.y,c,f.getElevation).point:_e(x.x,x.y,f).point,k=o.sub(S);return o.add(k._mult(u/k.mag()))}function Q(m,e,o){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const c=new d.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),f=_e(c.x,c.y,e);if(f.signedDistanceFromCamera>0)return u.projections[m]=f.point,u.anyProjectionOccluded=u.anyProjectionOccluded||f.isOccluded,f.point;const x=m-o.direction;return function(S,k,C,A,M){return he(S,k,C,A,void 0,M)}(o.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),c,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function _e(m,e,o){const u=m+o.translation[0],c=e+o.translation[1];let f;return!o.pitchWithMap&&o.projection.useSpecialProjectionForSymbols?(f=o.projection.projectTileCoordinates(u,c,o.unwrappedTileID,o.getElevation),f.point.x=(.5*f.point.x+.5)*o.width,f.point.y=(.5*-f.point.y+.5)*o.height):(f=W(u,c,o.labelPlaneMatrix,o.getElevation),f.isOccluded=!1),f}function we(m,e,o){return m._unit()._perp()._mult(e*o)}function fe(m,e,o,u,c,f,x,S,k){if(S.projectionCache.offsets[m])return S.projectionCache.offsets[m];const C=o.add(e);if(m+k.direction<u||m+k.direction>=c)return S.projectionCache.offsets[m]=C,C;const A=Q(m+k.direction,S,k),M=we(A.sub(o),x,k.direction),B=o.add(M),V=A.add(M);return S.projectionCache.offsets[m]=d.ak(f,C,B,V)||C,S.projectionCache.offsets[m]}function Ce(m,e,o,u,c,f,x,S,k){const C=u?m-e:m+e;let A=C>0?1:-1,M=0;u&&(A*=-1,M=Math.PI),A<0&&(M+=Math.PI);let B,V=A>0?f+c:f+c+1;S.projectionCache.cachedAnchorPoint?B=S.projectionCache.cachedAnchorPoint:(B=_e(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=B);let U,H,K=B,J=B,ee=0,q=0;const se=Math.abs(C),le=[];let pe;for(;ee+q<=se;){if(V+=A,V<f||V>=x)return null;ee+=q,J=K,H=U;const Oe={absOffsetX:se,direction:A,distanceFromAnchor:ee,previousVertex:J};if(K=Q(V,S,Oe),o===0)le.push(J),pe=K.sub(J);else{let qe;const Ae=K.sub(J);qe=Ae.mag()===0?we(Q(V+A,S,Oe).sub(K),o,A):we(Ae,o,A),H||(H=J.add(qe)),U=fe(V,qe,K,f,x,H,o,S,Oe),le.push(H),pe=U.sub(H)}q=pe.mag()}const xe=pe._mult((se-ee)/q)._add(H||J),Te=M+Math.atan2(K.y-J.y,K.x-J.x);return le.push(xe),{point:xe,angle:k?Te:0,path:le}}const tt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(m,e){for(let o=0;o<m;o++){const u=e.length;e.resize(u+4),e.float32.set(tt,3*u)}}function zt(m,e,o){const u=e[0],c=e[1];return m[0]=o[0]*u+o[4]*c+o[12],m[1]=o[1]*u+o[5]*c+o[13],m[3]=o[3]*u+o[7]*c+o[15],m}const gt=100;class Dt{constructor(e,o,u=new Un(e.width+200,e.height+200,25),c=new Un(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=o,this.grid=u,this.ignoredGrid=c,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+gt,this.screenBottomBoundary=e.height+gt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,u,c,f,x,S,k,C,A,M){const B=e.anchorPointX+k[0],V=e.anchorPointY+k[1],U=this.projectAndGetPerspectiveRatio(c,B,V,f,A),H=u*U.perspectiveRatio;let K;if(x||S)K=this._projectCollisionBox(e,H,c,f,x,S,k,U,A,M);else{const le=U.point.x+(M?M.x*H:0),pe=U.point.y+(M?M.y*H:0);K={allPointsOccluded:!1,box:[le+e.x1*H,pe+e.y1*H,le+e.x2*H,pe+e.y2*H]}}const[J,ee,q,se]=K.box;return this.mapProjection.useSpecialProjectionForSymbols&&(x?K.allPointsOccluded:this.mapProjection.isOccluded(B,V,f))||U.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(J,ee,q,se)||o!=="always"&&this.grid.hitTest(J,ee,q,se,o,C)?{box:[J,ee,q,se],placeable:!1,offscreen:!1}:{box:[J,ee,q,se],placeable:!0,offscreen:this.isOffscreen(J,ee,q,se)}}placeCollisionCircles(e,o,u,c,f,x,S,k,C,A,M,B,V,U,H,K){const J=[],ee=new d.P(o.anchorX,o.anchorY),q=this.getPerspectiveRatio(x,ee.x,ee.y,S,K),se=(M?f/q:f*q)/d.ap,le={getElevation:K,labelPlaneMatrix:k,lineVertexArray:u,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ee,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:H},pe=G(se,c,o.lineOffsetX*se,o.lineOffsetY*se,!1,o,!1,le);let xe=!1,Te=!1,Oe=!0;if(pe){const qe=.5*V*q+U,Ae=new d.P(-100,-100),Pe=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new ft,dt=pe.first,Re=pe.last;let Ue=[];for(let vt=dt.path.length-1;vt>=1;vt--)Ue.push(dt.path[vt]);for(let vt=1;vt<Re.path.length;vt++)Ue.push(Re.path[vt]);const ct=2.5*qe;if(C){const vt=this.projectPathToScreenSpace(Ue,le,C);Ue=vt.some(Ct=>Ct.signedDistanceFromCamera<=0)?[]:vt.map(Ct=>Ct.point)}let er=[];if(Ue.length>0){const vt=Ue[0].clone(),Ct=Ue[0].clone();for(let tr=1;tr<Ue.length;tr++)vt.x=Math.min(vt.x,Ue[tr].x),vt.y=Math.min(vt.y,Ue[tr].y),Ct.x=Math.max(Ct.x,Ue[tr].x),Ct.y=Math.max(Ct.y,Ue[tr].y);er=vt.x>=Ae.x&&Ct.x<=Pe.x&&vt.y>=Ae.y&&Ct.y<=Pe.y?[Ue]:Ct.x<Ae.x||vt.x>Pe.x||Ct.y<Ae.y||vt.y>Pe.y?[]:d.al([Ue],Ae.x,Ae.y,Pe.x,Pe.y)}for(const vt of er){Ke.reset(vt,.25*qe);let Ct=0;Ct=Ke.length<=.5*qe?1:Math.ceil(Ke.paddedLength/ct)+1;for(let tr=0;tr<Ct;tr++){const Hr=tr/Math.max(Ct-1,1),ln=Ke.lerp(Hr),rr=ln.x+gt,mi=ln.y+gt;J.push(rr,mi,qe,0);const si=rr-qe,Wr=mi-qe,oi=rr+qe,Cn=mi+qe;if(Oe=Oe&&this.isOffscreen(si,Wr,oi,Cn),Te=Te||this.isInsideGrid(si,Wr,oi,Cn),e!=="always"&&this.grid.hitTestCircle(rr,mi,qe,e,B)&&(xe=!0,!A))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!A&&xe||!Te||q<this.perspectiveRatioCutoff?[]:J,offscreen:Oe,collisionDetected:xe}}projectPathToScreenSpace(e,o,u){return e.map(c=>W(c.x,c.y,u,o.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,c=1/0,f=-1/0,x=-1/0;for(const A of e){const M=new d.P(A.x+gt,A.y+gt);u=Math.min(u,M.x),c=Math.min(c,M.y),f=Math.max(f,M.x),x=Math.max(x,M.y),o.push(M)}const S=this.grid.query(u,c,f,x).concat(this.ignoredGrid.query(u,c,f,x)),k={},C={};for(const A of S){const M=A.key;if(k[M.bucketInstanceId]===void 0&&(k[M.bucketInstanceId]={}),k[M.bucketInstanceId][M.featureIndex])continue;const B=[new d.P(A.x1,A.y1),new d.P(A.x2,A.y1),new d.P(A.x2,A.y2),new d.P(A.x1,A.y2)];d.am(o,B)&&(k[M.bucketInstanceId][M.featureIndex]=!0,C[M.bucketInstanceId]===void 0&&(C[M.bucketInstanceId]=[]),C[M.bucketInstanceId].push(M.featureIndex))}return C}insertCollisionBox(e,o,u,c,f,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:x,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,u,c,f,x){const S=u?this.ignoredGrid:this.grid,k={bucketInstanceId:c,featureIndex:f,collisionGroupID:x,overlapMode:o};for(let C=0;C<e.length;C+=4)S.insertCircle(k,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,o,u,c,f){let x;f?(x=[o,u,f(o,u),1],d.af(x,x,e)):(x=[o,u,0,1],zt(x,x,e));const S=x[3];return{point:new d.P((x[0]/S+1)/2*this.transform.width+gt,(-x[1]/S+1)/2*this.transform.height+gt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}getPerspectiveRatio(e,o,u,c,f){const x=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(o,u,c,f):W(o,u,e,f);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(e,o,u,c){return u<gt||e>=this.screenRightBoundary||c<gt||o>this.screenBottomBoundary}isInsideGrid(e,o,u,c){return u>=0&&e<this.gridRightBoundary&&c>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,u,c,f,x,S,k,C,A){let M=new d.P(1,0),B=new d.P(0,1);const V=new d.P(e.anchorPointX+S[0],e.anchorPointY+S[1]);if(x&&!f){const Oe=this.projectAndGetPerspectiveRatio(u,V.x+1,V.y,c,C).point.sub(k.point).unit(),qe=Math.atan(Oe.y/Oe.x)+(Oe.x<0?Math.PI:0),Ae=Math.sin(qe),Pe=Math.cos(qe);M=new d.P(Pe,Ae),B=new d.P(-Ae,Pe)}else if(!x&&f){const Oe=-this.transform.angle,qe=Math.sin(Oe),Ae=Math.cos(Oe);M=new d.P(Ae,qe),B=new d.P(-qe,Ae)}let U=k.point,H=o;if(f){U=V;const Oe=this.transform.zoom-Math.floor(this.transform.zoom);H=Math.pow(2,-Oe),H*=this.mapProjection.getPitchedTextCorrection(this.transform,V,c),A||(H*=d.ac(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}A&&(U=U.add(M.mult(A.x*H)).add(B.mult(A.y*H)));const K=e.x1*H,J=e.x2*H,ee=(K+J)/2,q=e.y1*H,se=e.y2*H,le=(q+se)/2,pe=[{offsetX:K,offsetY:q},{offsetX:ee,offsetY:q},{offsetX:J,offsetY:q},{offsetX:J,offsetY:le},{offsetX:J,offsetY:se},{offsetX:ee,offsetY:se},{offsetX:K,offsetY:se},{offsetX:K,offsetY:le}];let xe=[];for(const{offsetX:Oe,offsetY:qe}of pe)xe.push(new d.P(U.x+M.x*Oe+B.x*qe,U.y+M.y*Oe+B.y*qe));let Te=!1;if(f){const Oe=xe.map(qe=>this.projectAndGetPerspectiveRatio(u,qe.x,qe.y,c,C));Te=Oe.some(qe=>!qe.isOccluded),xe=Oe.map(qe=>qe.point)}else Te=!0;return{box:d.ao(xe),allPointsOccluded:!Te}}}function It(m,e,o){return e*(d.X/(m.tileSize*Math.pow(2,o-m.tileID.overscaledZ)))}class Tr{constructor(e,o,u,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):c&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class lr{constructor(e,o,u,c,f){this.text=new Tr(e?e.text:null,o,u,f),this.icon=new Tr(e?e.icon:null,o,c,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bt{constructor(e,o,u){this.text=e,this.icon=o,this.skipFade=u}}class Ut{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class or{constructor(e,o,u,c,f){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=c,this.tileID=f}}class Ar{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[e]}}function Nr(m,e,o,u,c){const{horizontalAlign:f,verticalAlign:x}=d.au(m);return new d.P(-(f-.5)*e+u[0]*c,-(x-.5)*o+u[1]*c)}class ni{constructor(e,o,u,c,f,x){this.transform=e.clone(),this.terrain=u,this.collisionIndex=new Dt(this.transform,o),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Ar(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const o=this.terrain;return o?(u,c)=>o.getElevation(e,u,c):null}getBucketParts(e,o,u,c){const f=u.getBucket(o),x=u.latestFeatureIndex;if(!f||!x||o.id!==f.layerIds[0])return;const S=u.collisionBoxArray,k=f.layers[0].layout,C=f.layers[0].paint,A=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),M=u.tileSize/d.X,B=u.tileID.toUnwrapped(),V=this.transform.calculatePosMatrix(B),U=k.get("text-pitch-alignment")==="map",H=k.get("text-rotation-alignment")==="map",K=It(u,1,this.transform.zoom),J=this.collisionIndex.mapProjection.translatePosition(this.transform,u,C.get("text-translate"),C.get("text-translate-anchor")),ee=this.collisionIndex.mapProjection.translatePosition(this.transform,u,C.get("icon-translate"),C.get("icon-translate-anchor")),q=ss(V,U,H,this.transform,K);let se=null;if(U){const pe=Tn(V,U,H,this.transform,K);se=d.L([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[f.bucketInstanceId]=new or(f.bucketInstanceId,x,f.sourceLayerIndex,f.index,u.tileID);const le={bucket:f,layout:k,translationText:J,translationIcon:ee,posMatrix:V,unwrappedTileID:B,textLabelPlaneMatrix:q,labelToScreenMatrix:se,scale:A,textPixelRatio:M,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:d.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(c)for(const pe of f.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:Te,symbolInstanceEnd:Oe}=pe;e.push({sortKey:xe,symbolInstanceStart:Te,symbolInstanceEnd:Oe,parameters:le})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:le})}attemptAnchorPlacement(e,o,u,c,f,x,S,k,C,A,M,B,V,U,H,K,J,ee,q){const se=d.aq[e.textAnchor],le=[e.textOffset0,e.textOffset1],pe=Nr(se,u,c,le,f),xe=this.collisionIndex.placeCollisionBox(o,B,k,C,A,S,x,K,M.predicate,q,pe);if((!ee||this.collisionIndex.placeCollisionBox(ee,B,k,C,A,S,x,J,M.predicate,q,pe).placeable)&&xe.placeable){let Te;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:le,width:u,height:c,anchor:se,textBoxScale:f,prevAnchor:Te},this.markUsedJustification(U,se,V,H),U.allowVerticalPlacement&&(this.markUsedOrientation(U,H,V),this.placedOrientations[V.crossTileID]=H),{shift:pe,placedGlyphBoxes:xe}}}placeLayerBucketPart(e,o,u){const{bucket:c,layout:f,translationText:x,translationIcon:S,posMatrix:k,unwrappedTileID:C,textLabelPlaneMatrix:A,labelToScreenMatrix:M,textPixelRatio:B,holdingForFade:V,collisionBoxArray:U,partiallyEvaluatedTextSize:H,collisionGroup:K}=e.parameters,J=f.get("text-optional"),ee=f.get("icon-optional"),q=d.ar(f,"text-overlap","text-allow-overlap"),se=q==="always",le=d.ar(f,"icon-overlap","icon-allow-overlap"),pe=le==="always",xe=f.get("text-rotation-alignment")==="map",Te=f.get("text-pitch-alignment")==="map",Oe=f.get("icon-text-fit")!=="none",qe=f.get("symbol-z-order")==="viewport-y",Ae=se&&(pe||!c.hasIconData()||ee),Pe=pe&&(se||!c.hasTextData()||J);!c.collisionArrays&&U&&c.deserializeCollisionBoxes(U);const Ke=this._getTerrainElevationFunc(this.retainedQueryData[c.bucketInstanceId].tileID),dt=(Re,Ue,ct)=>{var er,vt;if(o[Re.crossTileID])return;if(V)return void(this.placements[Re.crossTileID]=new bt(!1,!1,!1));let Ct=!1,tr=!1,Hr=!0,ln=null,rr={box:null,placeable:!1,offscreen:null},mi={placeable:!1},si=null,Wr=null,oi=null,Cn=0,vo=0,vl=0;Ue.textFeatureIndex?Cn=Ue.textFeatureIndex:Re.useRuntimeCollisionCircles&&(Cn=Re.featureIndex),Ue.verticalTextFeatureIndex&&(vo=Ue.verticalTextFeatureIndex);const xo=Ue.textBox;if(xo){const Zi=Vr=>{let Xr=d.ah.horizontal;if(c.allowVerticalPlacement&&!Vr&&this.prevPlacement){const Mi=this.prevPlacement.placedOrientations[Re.crossTileID];Mi&&(this.placedOrientations[Re.crossTileID]=Mi,Xr=Mi,this.markUsedOrientation(c,Xr,Re))}return Xr},Gi=(Vr,Xr)=>{if(c.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&Ue.verticalTextBox){for(const Mi of c.writingModes)if(Mi===d.ah.vertical?(rr=Xr(),mi=rr):rr=Vr(),rr&&rr.placeable)break}else rr=Vr()},ls=Re.textAnchorOffsetStartIndex,un=Re.textAnchorOffsetEndIndex;if(un===ls){const Vr=(Xr,Mi)=>{const At=this.collisionIndex.placeCollisionBox(Xr,q,B,k,C,Te,xe,x,K.predicate,Ke);return At&&At.placeable&&(this.markUsedOrientation(c,Mi,Re),this.placedOrientations[Re.crossTileID]=Mi),At};Gi(()=>Vr(xo,d.ah.horizontal),()=>{const Xr=Ue.verticalTextBox;return c.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&Xr?Vr(Xr,d.ah.vertical):{box:null,offscreen:null}}),Zi(rr&&rr.placeable)}else{let Vr=d.aq[(vt=(er=this.prevPlacement)===null||er===void 0?void 0:er.variableOffsets[Re.crossTileID])===null||vt===void 0?void 0:vt.anchor];const Xr=(At,Rs,wo)=>{const bo=At.x2-At.x1,Jh=At.y2-At.y1,Tf=Re.textBoxScale,Yh=Oe&&le==="never"?Rs:null;let us=null,Qh=q==="never"?1:2,wl="never";Vr&&Qh++;for(let _a=0;_a<Qh;_a++){for(let bl=ls;bl<un;bl++){const Sl=c.textAnchorOffsets.get(bl);if(Vr&&Sl.textAnchor!==Vr)continue;const So=this.attemptAnchorPlacement(Sl,At,bo,Jh,Tf,xe,Te,B,k,C,K,wl,Re,c,wo,x,S,Yh,Ke);if(So&&(us=So.placedGlyphBoxes,us&&us.placeable))return Ct=!0,ln=So.shift,us}Vr?Vr=null:wl=q}return u&&!us&&(us={box:this.collisionIndex.placeCollisionBox(xo,"always",B,k,C,Te,xe,x,K.predicate,Ke,new d.P(0,0)).box,offscreen:!1,placeable:!1}),us};Gi(()=>Xr(xo,Ue.iconBox,d.ah.horizontal),()=>{const At=Ue.verticalTextBox;return c.allowVerticalPlacement&&(!rr||!rr.placeable)&&Re.numVerticalGlyphVertices>0&&At?Xr(At,Ue.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),rr&&(Ct=rr.placeable,Hr=rr.offscreen);const Mi=Zi(rr&&rr.placeable);if(!Ct&&this.prevPlacement){const At=this.prevPlacement.variableOffsets[Re.crossTileID];At&&(this.variableOffsets[Re.crossTileID]=At,this.markUsedJustification(c,At.anchor,Re,Mi))}}}if(si=rr,Ct=si&&si.placeable,Hr=si&&si.offscreen,Re.useRuntimeCollisionCircles){const Zi=c.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex),Gi=d.ai(c.textSizeData,H,Zi),ls=f.get("text-padding");Wr=this.collisionIndex.placeCollisionCircles(q,Zi,c.lineVertexArray,c.glyphOffsetArray,Gi,k,C,A,M,u,Te,K.predicate,Re.collisionCircleDiameter,ls,x,Ke),Wr.circles.length&&Wr.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),Ct=se||Wr.circles.length>0&&!Wr.collisionDetected,Hr=Hr&&Wr.offscreen}if(Ue.iconFeatureIndex&&(vl=Ue.iconFeatureIndex),Ue.iconBox){const Zi=Gi=>this.collisionIndex.placeCollisionBox(Gi,le,B,k,C,Te,xe,S,K.predicate,Ke,Oe&&ln?ln:void 0);mi&&mi.placeable&&Ue.verticalIconBox?(oi=Zi(Ue.verticalIconBox),tr=oi.placeable):(oi=Zi(Ue.iconBox),tr=oi.placeable),Hr=Hr&&oi.offscreen}const qi=J||Re.numHorizontalGlyphVertices===0&&Re.numVerticalGlyphVertices===0,xl=ee||Re.numIconVertices===0;qi||xl?xl?qi||(tr=tr&&Ct):Ct=tr&&Ct:tr=Ct=tr&&Ct;const oc=tr&&oi.placeable;if(Ct&&si.placeable&&this.collisionIndex.insertCollisionBox(si.box,q,f.get("text-ignore-placement"),c.bucketInstanceId,mi&&mi.placeable&&vo?vo:Cn,K.ID),oc&&this.collisionIndex.insertCollisionBox(oi.box,le,f.get("icon-ignore-placement"),c.bucketInstanceId,vl,K.ID),Wr&&Ct&&this.collisionIndex.insertCollisionCircles(Wr.circles,q,f.get("text-ignore-placement"),c.bucketInstanceId,Cn,K.ID),u&&this.storeCollisionData(c.bucketInstanceId,ct,Ue,si,oi,Wr),Re.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Re.crossTileID]=new bt(Ct||Ae,tr||Pe,Hr||c.justReloaded),o[Re.crossTileID]=!0};if(qe){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Re=c.getSortedSymbolIndexes(this.transform.angle);for(let Ue=Re.length-1;Ue>=0;--Ue){const ct=Re[Ue];dt(c.symbolInstances.get(ct),c.collisionArrays[ct],ct)}}else for(let Re=e.symbolInstanceStart;Re<e.symbolInstanceEnd;Re++)dt(c.symbolInstances.get(Re),c.collisionArrays[Re],Re);if(u&&c.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[c.bucketInstanceId];d.as(Re.invProjMatrix,k),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}storeCollisionData(e,o,u,c,f,x){if(u.textBox||u.iconBox){let S,k;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(o)?k=S.get(o):(k={text:null,icon:null},S.set(o,k)),u.textBox&&(k.text=c.box),u.iconBox&&(k.icon=f.box)}if(x){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=new Ut);for(let k=0;k<x.circles.length;k+=4)S.circles.push(x.circles[k+0]),S.circles.push(x.circles[k+1]),S.circles.push(x.circles[k+2]),S.circles.push(x.collisionDetected?1:0)}}markUsedJustification(e,o,u,c){let f;f=c===d.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.at(o)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=f>=0&&S!==f?0:u.crossTileID)}markUsedOrientation(e,o,u){const c=o===d.ah.horizontal||o===d.ah.horizontalOnly?o:0,f=o===d.ah.vertical?o:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of x)e.text.placedSymbolArray.get(S).placedOrientation=c;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const c=o?o.symbolFadeChange(e):1,f=o?o.opacities:{},x=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const k in this.placements){const C=this.placements[k],A=f[k];A?(this.opacities[k]=new lr(A,c,C.text,C.icon),u=u||C.text!==A.text.placed||C.icon!==A.icon.placed):(this.opacities[k]=new lr(null,c,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const k in f){const C=f[k];if(!this.opacities[k]){const A=new lr(C,c,!1,!1);A.isHidden()||(this.opacities[k]=A,u=u||C.text.placed||C.icon.placed)}}for(const k in x)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=x[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){const u={};for(const c of o){const f=c.getBucket(e);f&&c.latestFeatureIndex&&e.id===f.layerIds[0]&&this.updateBucketOpacities(f,c.tileID,u,c.collisionBoxArray)}}updateBucketOpacities(e,o,u,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const f=e.layers[0],x=f.layout,S=new lr(null,0,!1,!1,!0),k=x.get("text-allow-overlap"),C=x.get("icon-allow-overlap"),A=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=x.get("text-rotation-alignment")==="map",B=x.get("text-pitch-alignment")==="map",V=x.get("icon-text-fit")!=="none",U=new lr(null,0,k&&(C||!e.hasIconData()||x.get("icon-optional")),C&&(k||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const H=(J,ee,q)=>{for(let se=0;se<ee/4;se++)J.opacityVertexArray.emplaceBack(q);J.hasVisibleVertices=J.hasVisibleVertices||q!==Ys},K=this.collisionBoxArrays.get(e.bucketInstanceId);for(let J=0;J<e.symbolInstances.length;J++){const ee=e.symbolInstances.get(J),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:se,crossTileID:le}=ee;let pe=this.opacities[le];u[le]?pe=S:pe||(pe=U,this.opacities[le]=pe),u[le]=!0;const xe=ee.numIconVertices>0,Te=this.placedOrientations[ee.crossTileID],Oe=Te===d.ah.vertical,qe=Te===d.ah.horizontal||Te===d.ah.horizontalOnly;if(q>0||se>0){const Pe=Ci(pe.text);H(e.text,q,Oe?Ys:Pe),H(e.text,se,qe?Ys:Pe);const Ke=pe.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(Ue=>{Ue>=0&&(e.text.placedSymbolArray.get(Ue).hidden=Ke||Oe?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Ke||qe?1:0);const dt=this.variableOffsets[ee.crossTileID];dt&&this.markUsedJustification(e,dt.anchor,ee,Te);const Re=this.placedOrientations[ee.crossTileID];Re&&(this.markUsedJustification(e,"left",ee,Re),this.markUsedOrientation(e,Re,ee))}if(xe){const Pe=Ci(pe.icon),Ke=!(V&&ee.verticalPlacedIconSymbolIndex&&Oe);ee.placedIconSymbolIndex>=0&&(H(e.icon,ee.numIconVertices,Ke?Pe:Ys),e.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=pe.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,ee.numVerticalIconVertices,Ke?Ys:Pe),e.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=pe.icon.isHidden())}const Ae=K&&K.has(J)?K.get(J):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Pe=e.collisionArrays[J];if(Pe){let Ke=new d.P(0,0);if(Pe.textBox||Pe.verticalTextBox){let dt=!0;if(A){const Re=this.variableOffsets[le];Re?(Ke=Nr(Re.anchor,Re.width,Re.height,Re.textOffset,Re.textBoxScale),M&&Ke._rotate(B?this.transform.angle:-this.transform.angle)):dt=!1}if(Pe.textBox||Pe.verticalTextBox){let Re;Pe.textBox&&(Re=Oe),Pe.verticalTextBox&&(Re=qe),Js(e.textCollisionBox.collisionVertexArray,pe.text.placed,!dt||Re,Ae.text,Ke.x,Ke.y)}}if(Pe.iconBox||Pe.verticalIconBox){const dt=!!(!qe&&Pe.verticalIconBox);let Re;Pe.iconBox&&(Re=dt),Pe.verticalIconBox&&(Re=!dt),Js(e.iconCollisionBox.collisionVertexArray,pe.icon.placed,Re,Ae.icon,V?Ke.x:0,V?Ke.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=J.invProjMatrix,e.placementViewportMatrix=J.viewportMatrix,e.collisionCircleArray=J.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Js(m,e,o,u,c,f){u&&u.length!==0||(u=[0,0,0,0]);const x=u[0]-gt,S=u[1]-gt,k=u[2]-gt,C=u[3]-gt;m.emplaceBack(e?1:0,o?1:0,c||0,f||0,x,S),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,k,S),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,k,C),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,x,C)}const $t=Math.pow(2,25),yu=Math.pow(2,24),_u=Math.pow(2,17),Ei=Math.pow(2,16),Ii=Math.pow(2,9),Jp=Math.pow(2,8),Vi=Math.pow(2,1);function Ci(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,o=Math.floor(127*m.opacity);return o*$t+e*yu+o*_u+e*Ei+o*Ii+e*Jp+o*Vi+e}const Ys=0;function bs(){return{isOccluded:(m,e,o)=>!1,getPitchedTextCorrection:(m,e,o)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,e,o,u){throw new Error("Not implemented.")},translatePosition:(m,e,o,u)=>function(c,f,x,S,k=!1){if(!x[0]&&!x[1])return[0,0];const C=k?S==="map"?c.angle:0:S==="viewport"?-c.angle:0;if(C){const A=Math.sin(C),M=Math.cos(C);x=[x[0]*M-x[1]*A,x[0]*A+x[1]*M]}return[k?x[0]:It(f,x[0],c.zoom),k?x[1]:It(f,x[1],c.zoom)]}(m,e,o,u),getCircleRadiusCorrection:m=>1}}class kr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,u,c,f){const x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(x,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((S,k)=>S.sortKey-k.sortKey));this._currentPartIndex<x.length;)if(o.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,f())return!0;return!1}}class Qo{constructor(e,o,u,c,f,x,S,k){this.placement=new ni(e,bs(),o,x,S,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(e,o,u){const c=te.now(),f=()=>!this._forceFullPlacement&&te.now()-c>2;for(;this._currentPlacementIndex>=0;){const x=o[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new kr(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const rn=512/d.X/2;class gr{constructor(e,o,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const c=new Map;for(let f=0;f<o.length;f++){const x=o.get(f),S=x.key,k=c.get(S);k?k.push(x):c.set(S,[x])}for(const[f,x]of c){const S={positions:x.map(k=>({x:Math.floor(k.anchorX*rn),y:Math.floor(k.anchorY*rn)})),crossTileIDs:x.map(k=>k.crossTileID)};if(S.positions.length>128){const k=new d.av(S.positions.length,16,Uint16Array);for(const{x:C,y:A}of S.positions)k.add(C,A);k.finish(),delete S.positions,S.index=k}this._symbolsByKey[f]=S}}getScaledCoordinates(e,o){const{x:u,y:c,z:f}=this.tileID.canonical,{x,y:S,z:k}=o.canonical,C=rn/Math.pow(2,k-f),A=(S*d.X+e.anchorY)*C,M=c*d.X*rn;return{x:Math.floor((x*d.X+e.anchorX)*C-u*d.X*rn),y:Math.floor(A-M)}}findMatches(e,o,u){const c=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let f=0;f<e.length;f++){const x=e.get(f);if(x.crossTileID)continue;const S=this._symbolsByKey[x.key];if(!S)continue;const k=this.getScaledCoordinates(x,o);if(S.index){const C=S.index.range(k.x-c,k.y-c,k.x+c,k.y+c).sort();for(const A of C){const M=S.crossTileIDs[A];if(!u[M]){u[M]=!0,x.crossTileID=M;break}}}else if(S.positions)for(let C=0;C<S.positions.length;C++){const A=S.positions[C],M=S.crossTileIDs[C];if(Math.abs(A.x-k.x)<=c&&Math.abs(A.y-k.y)<=c&&!u[M]){u[M]=!0,x.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ua{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const o=Math.round((e-this.lng)/360);if(o!==0)for(const u in this.indexes){const c=this.indexes[u],f={};for(const x in c){const S=c[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),f[S.tileID.key]=S}this.indexes[u]=f}this.lng=e}addBucket(e,o,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let f=0;f<o.symbolInstances.length;f++)o.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const f in this.indexes){const x=this.indexes[f];if(Number(f)>e.overscaledZ)for(const S in x){const k=x[S];k.tileID.isChildOf(e)&&k.findMatches(o.symbolInstances,e,c)}else{const S=x[e.scaledTo(Number(f)).key];S&&S.findMatches(o.symbolInstances,e,c)}}for(let f=0;f<o.symbolInstances.length;f++){const x=o.symbolInstances.get(f);x.crossTileID||(x.crossTileID=u.generate(),c[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new gr(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(const u of o.getCrossTileIDsLists())for(const c of u)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let o=!1;for(const u in this.indexes){const c=this.indexes[u];for(const f in c)e[c[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,c[f]),delete c[f],o=!0)}return o}}class vu{constructor(){this.layerIndexes={},this.crossTileIDs=new Ua,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,u){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new nn);let f=!1;const x={};c.handleWrapJump(u);for(const S of o){const k=S.getBucket(e);k&&e.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(S.tileID,k,this.crossTileIDs)&&(f=!0),x[k.bucketInstanceId]=!0)}return c.removeStaleBuckets(x)&&(f=!0),f}pruneUnusedLayers(e){const o={};e.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const sn=(m,e)=>d.t(m,e&&e.filter(o=>o.identifier!=="source.canvas")),Yp=d.aw();class $a extends d.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const c=this.sourceCaches[u].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new Nn(On(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,c)=>this.getGlyphs(u,c)),this.dispatcher.registerMessageHandler("GI",(u,c)=>this.getImages(u,c)),this.imageManager=new Mt,this.imageManager.setEventedParent(this),this.glyphManager=new Br(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new nr(256,512),this.crossTileSymbolIndex=new vu,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),Ni().on(ke,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const c=this.sourceCaches[u.sourceId];if(!c)return;const f=c.getSource();if(f&&f.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===f.id&&this._validateLayer(S)}})}loadURL(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const f=this._loadStyleRequest;d.h(c,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,o,u)}).catch(x=>{this._loadStyleRequest=null,x&&!f.signal.aborted&&this.fire(new d.j(x))})}loadJSON(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,te.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,u)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(Yp,{validate:!1})}_load(e,o,u){var c;const f=o.transformStyle?o.transformStyle(u,e):e;if(!o.validate||!sn(this,d.u(f))){this._loaded=!0,this.stylesheet=f;for(const x in f.sources)this.addSource(x,f.sources[x],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new pt(this.stylesheet.light),this.sky=new Ft(this.stylesheet.sky),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of e){const u=d.aA(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(e,o=!1,u=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,x,S,k){return d._(this,void 0,void 0,function*(){const C=kt(f),A=S>1?"@2x":"",M={},B={};for(const{id:V,url:U}of C){const H=x.transformRequest(it(U,A,".json"),"SpriteJSON");M[V]=d.h(H,k);const K=x.transformRequest(it(U,A,".png"),"SpriteImage");B[V]=ce.getImage(K,k)}return yield Promise.all([...Object.values(M),...Object.values(B)]),function(V,U){return d._(this,void 0,void 0,function*(){const H={};for(const K in V){H[K]={};const J=te.getImageCanvasContext((yield U[K]).data),ee=(yield V[K]).data;for(const q in ee){const{width:se,height:le,x:pe,y:xe,sdf:Te,pixelRatio:Oe,stretchX:qe,stretchY:Ae,content:Pe,textFitWidth:Ke,textFitHeight:dt}=ee[q];H[K][q]={data:null,pixelRatio:Oe,sdf:Te,stretchX:qe,stretchY:Ae,content:Pe,textFitWidth:Ke,textFitHeight:dt,spriteData:{width:se,height:le,x:pe,y:xe,context:J}}}}return H})}(M,B)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const x in f){this._spritesImagesIds[x]=[];const S=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(k=>!(k in f)):[];for(const k of S)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in f[x]){const C=x==="default"?k:`${x}:${k}`;this._spritesImagesIds[x].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,f[x][k],!1):this.imageManager.addImage(C,f[x][k]),o&&(this._changedImages[C]=!0)}}}).catch(f=>{this._spriteRequest=null,c=f,this.fire(new d.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),u&&u(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const o=this.sourceCaches[e.source];if(!o)return;const u=e.sourceLayer;if(!u)return;const c=o.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.j(new Error(`Source layer "${u}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?d.aB(u):u);const c=[];for(const f of e)if(u[f]){const x=o?d.aB(u[f]):u[f];c.push(x)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const o=Object.keys(this._layers);for(const u of o){const c=this._layers[u];c.type!=="custom"&&(e[u]=c.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const o=this._changed;if(o){const c=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(c.length||f.length)&&this._updateWorkerLayers(c,f);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const c in this.sourceCaches){const f=this.sourceCaches[c];u[c]=f.used,f.used=!1}for(const c of this._order){const f=this._layers[c];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const c in u){const f=this.sourceCaches[c];!!u[c]!=!!f.used&&f.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,o&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var u;this._checkLoaded();const c=this.serialize();if(e=o.transformStyle?o.transformStyle(c,e):e,((u=o.validate)===null||u===void 0||u)&&sn(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const f=d.aC(c,e),x=this._getOperationsToPerform(f);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const S of x.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const o=[],u=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":o.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":o.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,c.args));break;case"setSky":o.push(()=>this.setSky.apply(this,c.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":o.push(()=>{});break;default:u.push(c.command)}return{operations:o,unimplemented:u}}addImage(e,o){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(d.u.source,`sources.${e}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const c=this.sourceCaches[e]=new ut(e,o,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,u={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new d.j(new Error(`Layer "${c}" already exists on this map.`)));let f;if(e.type==="custom"){if(sn(this,d.aD(e)))return;f=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=d.aB(e),e=d.e(e,{source:c})),this._validate(d.u.layer,`layers.${c}`,e,{arrayIndex:-1},u))return;f=d.aA(e),this._validateLayer(f),f.setEventedParent(this,{layer:{id:c}})}const x=o?this._order.indexOf(o):this._order.length;if(o&&x===-1)this.fire(new d.j(new Error(`Cannot add layer "${c}" before non-existing layer "${o}".`)));else{if(this._order.splice(x,0,c),this._layerOrderChanged=!0,this._layers[c]=f,this._removedLayers[c]&&f.source&&f.type!=="custom"){const S=this._removedLayers[c];delete this._removedLayers[c],S.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;const u=this._order.indexOf(e);this._order.splice(u,1);const c=o?this._order.indexOf(o):this._order.length;o&&c===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const o=this._layers[e];if(!o)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,u){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===o&&c.maxzoom===u||(o!=null&&(c.minzoom=o),u!=null&&(c.maxzoom=u),this._updateLayer(c)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,u={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!d.aE(c.filter,o))return o==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(d.u.filter,`layers.${c.id}.filter`,o,null,u)||(c.filter=d.aB(o),this._updateLayer(c)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,o,u,c={}){this._checkLoaded();const f=this.getLayer(e);f?d.aE(f.getLayoutProperty(o),u)||(f.setLayoutProperty(o,u,c),this._updateLayer(f)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){const u=this.getLayer(e);if(u)return u.getLayoutProperty(o);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,u,c={}){this._checkLoaded();const f=this.getLayer(e);f?d.aE(f.getPaintProperty(o),u)||(f.setPaintProperty(o,u,c)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();const u=e.source,c=e.sourceLayer,f=this.sourceCaches[u];if(f===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const x=f.getSource().type;x==="geojson"&&c?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||c?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(c,e.id,o)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();const u=e.source,c=this.sourceCaches[u];if(c===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const f=c.getSource().type,x=f==="vector"?e.sourceLayer:void 0;f!=="vector"||x?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(x,e.id,o):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const o=e.source,u=e.sourceLayer,c=this.sourceCaches[o];if(c!==void 0)return c.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(u,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,f=>f.serialize()),o=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,c=this.stylesheet;return d.aG({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:e,layers:o,terrain:u},f=>f!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const o=x=>this._layers[x].type==="fill-extrusion",u={},c=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(o(S)){u[S]=x;for(const k of e){const C=k[S];if(C)for(const A of C)c.push(A)}}}c.sort((x,S)=>S.intersectionZ-x.intersectionZ);const f=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(o(S))for(let k=c.length-1;k>=0;k--){const C=c[k].feature;if(u[C.layer.id]<x)break;f.push(C),c.pop()}else for(const k of e){const C=k[S];if(C)for(const A of C)f.push(A.feature)}}return f}queryRenderedFeatures(e,o,u){o&&o.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",o.filter,null,o);const c={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const S of o.layers){const k=this._layers[S];if(!k)return this.fire(new d.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];c[k.source]=!0}}const f=[];o.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const S in this.sourceCaches)o.layers&&!c[S]||f.push(wn(this.sourceCaches[S],this._layers,x,e,o,u));return this.placement&&f.push(function(S,k,C,A,M,B,V){const U={},H=B.queryRenderedSymbols(A),K=[];for(const J of Object.keys(H).map(Number))K.push(V[J]);K.sort(bn);for(const J of K){const ee=J.featureIndex.lookupSymbolFeatures(H[J.bucketInstanceId],k,J.bucketIndex,J.sourceLayerIndex,M.filter,M.layers,M.availableImages,S);for(const q in ee){const se=U[q]=U[q]||[],le=ee[q];le.sort((pe,xe)=>{const Te=J.featureSortOrder;if(Te){const Oe=Te.indexOf(pe.featureIndex);return Te.indexOf(xe.featureIndex)-Oe}return xe.featureIndex-pe.featureIndex});for(const pe of le)se.push(pe)}}for(const J in U)U[J].forEach(ee=>{const q=ee.feature,se=C[S[J].source].getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=se});return U}(this._layers,x,this.sourceCaches,e,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,o){o&&o.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this.sourceCaches[e];return u?function(c,f){const x=c.getRenderableIds().map(C=>c.getTileByID(C)),S=[],k={};for(let C=0;C<x.length;C++){const A=x[C],M=A.tileID.canonical.key;k[M]||(k[M]=!0,A.querySourceFeatures(S,f))}return S}(u,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();const u=this.light.getLight();let c=!1;for(const x in e)if(!d.aE(e[x],u[x])){c=!0;break}if(!c)return;const f={now:te.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(f)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){const u=this.getSky();let c=!1;if(!e&&!u)return;if(e&&!u)c=!0;else if(!e&&u)c=!0;else for(const x in e)if(!d.aE(e[x],u[x])){c=!0;break}if(!c)return;const f={now:te.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(f)}_validate(e,o,u,c,f={}){return(!f||f.validate!==!1)&&sn(this,e.call(d.u,d.e({key:o,style:this.serialize(),value:u,styleSpec:d.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ni().off(ke,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,u,c,f=!1){let x=!1,S=!1;const k={};for(const C of this._order){const A=this._layers[C];if(A.type!=="symbol")continue;if(!k[A.source]){const B=this.sourceCaches[A.source];k[A.source]=B.getRenderableIds(!0).map(V=>B.getTileByID(V)).sort((V,U)=>U.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(U.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(A,k[A.source],e.center.lng);x=x||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(te.now(),e.zoom))&&(this.pauseablePlacement=new Qo(e,this.map.terrain,this._order,f,o,u,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(te.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const C of this._order){const A=this._layers[C];A.type==="symbol"&&this.placement.updateLayerOpacities(A,k[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(te.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,o.icons),u})}getGlyphs(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(o.stacks),c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,u={},c){this._checkLoaded();const f=[{id:e,url:o}],x=[...kt(this.stylesheet.sprite),...f];this._validate(d.u.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(f,!0,c))}removeSprite(e){this._checkLoaded();const o=kt(this.stylesheet.sprite);if(o.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex(u=>u.id===e),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return kt(this.stylesheet.sprite)}setSprite(e,o={},u){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var Ss=d.Y([{name:"a_pos",type:"Int16",components:2}]);const os={prelude:Ot(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ot(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ot(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ot(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ot(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ot(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ot(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ot(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ot(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ot(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ot(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ot("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ot("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ot("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Ot("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ot(m,e){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),c=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=f?f.concat(c):c,S={};return{fragmentSource:m=m.replace(o,(k,C,A,M,B)=>(S[B]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${A} ${M} ${B};
#else
uniform ${A} ${M} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${A} ${M} ${B} = u_${B};
#endif
`)),vertexSource:e=e.replace(o,(k,C,A,M,B)=>{const V=M==="float"?"vec2":"vec4",U=B.match(/color/)?"color":V;return S[B]?C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${A} ${V} a_${B};
varying ${A} ${M} ${B};
#else
uniform ${A} ${M} u_${B};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${A} ${M} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${U}(a_${B}, u_${B}_t);
#else
    ${A} ${M} ${B} = u_${B};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${A} ${V} a_${B};
#else
uniform ${A} ${M} u_${B};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${A} ${M} ${B} = a_${B};
#else
    ${A} ${M} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${A} ${M} ${B} = unpack_mix_${U}(a_${B}, u_${B}_t);
#else
    ${A} ${M} ${B} = u_${B};
#endif
`}),staticAttributes:u,staticUniforms:x}}class xu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,u,c,f,x,S,k,C){this.context=e;let A=this.boundPaintVertexBuffers.length!==c.length;for(let M=0;!A&&M<c.length;M++)this.boundPaintVertexBuffers[M]!==c[M]&&(A=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||A||this.boundIndexBuffer!==f||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==C?this.freshBind(o,u,c,f,x,S,k,C):(e.bindVertexArray.set(this.vao),S&&S.bind(),f&&f.dynamicDraw&&f.bind(),k&&k.bind(),C&&C.bind())}freshBind(e,o,u,c,f,x,S,k){const C=e.numAttributes,A=this.context,M=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=c,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=k,o.enableAttributes(M,e);for(const B of u)B.enableAttributes(M,e);x&&x.enableAttributes(M,e),S&&S.enableAttributes(M,e),k&&k.enableAttributes(M,e),o.bind(),o.setVertexAttribPointers(M,e,f);for(const B of u)B.bind(),B.setVertexAttribPointers(M,e,f);x&&(x.bind(),x.setVertexAttribPointers(M,e,f)),c&&c.bind(),S&&(S.bind(),S.setVertexAttribPointers(M,e,f)),k&&(k.bind(),k.setVertexAttribPointers(M,e,f)),A.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const wu=(m,e,o,u,c)=>({u_matrix:m,u_texture:0,u_ele_delta:e,u_fog_matrix:o,u_fog_color:u?u.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?u.calculateFogBlendOpacity(c):0,u_horizon_color:u?u.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1});function Qs(m){const e=[];for(let o=0;o<m.length;o++){if(m[o]===null)continue;const u=m[o].split(" ");e.push(u.pop())}return e}class bu{constructor(e,o,u,c,f,x){const S=e.gl;this.program=S.createProgram();const k=Qs(o.staticAttributes),C=u?u.getBinderAttributes():[],A=k.concat(C),M=os.prelude.staticUniforms?Qs(os.prelude.staticUniforms):[],B=o.staticUniforms?Qs(o.staticUniforms):[],V=u?u.getBinderUniforms():[],U=M.concat(B).concat(V),H=[];for(const pe of U)H.indexOf(pe)<0&&H.push(pe);const K=u?u.defines():[];f&&K.push("#define OVERDRAW_INSPECTOR;"),x&&K.push("#define TERRAIN3D;");const J=K.concat(os.prelude.fragmentSource,o.fragmentSource).join(`
`),ee=K.concat(os.prelude.vertexSource,o.vertexSource).join(`
`),q=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(q,J),S.compileShader(q),!S.getShaderParameter(q,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(q)}`);S.attachShader(this.program,q);const se=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(se,ee),S.compileShader(se),!S.getShaderParameter(se,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(se)}`);S.attachShader(this.program,se),this.attributes={};const le={};this.numAttributes=A.length;for(let pe=0;pe<this.numAttributes;pe++)A[pe]&&(S.bindAttribLocation(this.program,pe,A[pe]),this.attributes[A[pe]]=pe);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(se),S.deleteShader(q);for(let pe=0;pe<H.length;pe++){const xe=H[pe];if(xe&&!le[xe]){const Te=S.getUniformLocation(this.program,xe);Te&&(le[xe]=Te)}}this.fixedUniforms=c(e,le),this.terrainUniforms=((pe,xe)=>({u_depth:new d.aH(pe,xe.u_depth),u_terrain:new d.aH(pe,xe.u_terrain),u_terrain_dim:new d.aI(pe,xe.u_terrain_dim),u_terrain_matrix:new d.aJ(pe,xe.u_terrain_matrix),u_terrain_unpack:new d.aK(pe,xe.u_terrain_unpack),u_terrain_exaggeration:new d.aI(pe,xe.u_terrain_exaggeration)}))(e,le),this.binderUniforms=u?u.getUniforms(e,le):[]}draw(e,o,u,c,f,x,S,k,C,A,M,B,V,U,H,K,J,ee){const q=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(c),e.setColorMode(f),e.setCullFace(x),k){e.activeTexture.set(q.TEXTURE2),q.bindTexture(q.TEXTURE_2D,k.depthTexture),e.activeTexture.set(q.TEXTURE3),q.bindTexture(q.TEXTURE_2D,k.texture);for(const le in this.terrainUniforms)this.terrainUniforms[le].set(k[le])}for(const le in this.fixedUniforms)this.fixedUniforms[le].set(S[le]);H&&H.setUniforms(e,this.binderUniforms,V,{zoom:U});let se=0;switch(o){case q.LINES:se=2;break;case q.TRIANGLES:se=3;break;case q.LINE_STRIP:se=1}for(const le of B.get()){const pe=le.vaos||(le.vaos={});(pe[C]||(pe[C]=new xu)).bind(e,this,A,H?H.getPaintVertexBuffers():[],M,le.vertexOffset,K,J,ee),q.drawElements(o,le.primitiveLength*se,q.UNSIGNED_SHORT,le.primitiveOffset*se*2)}}}function qa(m,e,o){const u=1/It(o,1,e.transform.tileZoom),c=Math.pow(2,o.tileID.overscaledZ),f=o.tileSize*Math.pow(2,e.transform.tileZoom)/c,x=f*(o.tileID.canonical.x+o.tileID.wrap*c),S=f*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const ea=(m,e,o,u)=>{const c=e.style.light,f=c.properties.get("position"),x=[f.x,f.y,f.z],S=function(){var C=new d.A(9);return d.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();c.properties.get("anchor")==="viewport"&&function(C,A){var M=Math.sin(A),B=Math.cos(A);C[0]=B,C[1]=M,C[2]=0,C[3]=-M,C[4]=B,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(S,-e.transform.angle),function(C,A,M){var B=A[0],V=A[1],U=A[2];C[0]=B*M[0]+V*M[3]+U*M[6],C[1]=B*M[1]+V*M[4]+U*M[7],C[2]=B*M[2]+V*M[5]+U*M[8]}(x,x,S);const k=c.properties.get("color");return{u_matrix:m,u_lightpos:x,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+o,u_opacity:u}},Za=(m,e,o,u,c,f,x)=>d.e(ea(m,e,o,u),qa(f,e,x),{u_height_factor:-Math.pow(2,c.overscaledZ)/x.tileSize/8}),eo=m=>({u_matrix:m}),_h=(m,e,o,u)=>d.e(eo(m),qa(o,e,u)),Qp=(m,e)=>({u_matrix:m,u_world:e}),vh=(m,e,o,u,c)=>d.e(_h(m,e,o,u),{u_world:c}),ef=(m,e,o,u)=>{const c=m.transform;let f,x;if(u.paint.get("circle-pitch-alignment")==="map"){const S=It(o,1,c.zoom);f=!0,x=[S,S]}else f=!1,x=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(e.posMatrix,o,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:x}},Ts=(m,e,o)=>({u_matrix:m,u_inv_matrix:e,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}),ta=(m,e,o=1)=>({u_matrix:m,u_color:e,u_overlay:0,u_overlay_scale:o}),pi=m=>({u_matrix:m}),fi=(m,e,o,u)=>({u_matrix:m,u_extrude_scale:It(e,1,o),u_intensity:u}),Ga=(m,e,o,u)=>{const c=d.H();d.aP(c,0,m.width,m.height,0,0,1);const f=m.context.gl;return{u_matrix:c,u_world:[f.drawingBufferWidth,f.drawingBufferHeight],u_image:o,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}};function Ha(m,e){const o=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new d.Z(0,u/o).toLngLat().lat,new d.Z(0,(u+1)/o).toLngLat().lat]}const Wa=(m,e,o,u)=>{const c=m.transform;return{u_matrix:bh(m,e,o,u),u_ratio:1/It(e,1,c.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},xh=(m,e,o,u,c)=>d.e(Wa(m,e,o,c),{u_image:0,u_image_height:u}),to=(m,e,o,u,c)=>{const f=m.transform,x=wh(e,f);return{u_matrix:bh(m,e,o,c),u_texsize:e.imageAtlasTexture.size,u_ratio:1/It(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[x,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},tf=(m,e,o,u,c,f)=>{const x=m.lineAtlas,S=wh(e,m.transform),k=o.layout.get("line-cap")==="round",C=x.getDash(u.from,k),A=x.getDash(u.to,k),M=C.width*c.fromScale,B=A.width*c.toScale;return d.e(Wa(m,e,o,f),{u_patternscale_a:[S/M,-C.height/2],u_patternscale_b:[S/B,-A.height/2],u_sdfgamma:x.width/(256*Math.min(M,B)*m.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:A.y,u_mix:c.t})};function wh(m,e){return 1/It(m,1,e.tileZoom)}function bh(m,e,o,u){return m.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const rf=(m,e,o,u,c)=>{return{u_matrix:m,u_tl_parent:e,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(x=c.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(f=c.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:nf(c.paint.get("raster-hue-rotate"))};var f,x};function nf(m){m*=Math.PI/180;const e=Math.sin(m),o=Math.cos(m);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}const Sh=(m,e,o,u,c,f,x,S,k,C,A,M,B,V)=>{const U=x.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:U.width/U.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:k,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+u,u_is_along_line:c,u_is_variable_anchor:f,u_texsize:B,u_texture:0,u_translation:A,u_pitched_scale:V}},ra=(m,e,o,u,c,f,x,S,k,C,A,M,B,V,U)=>{const H=x.transform;return d.e(Sh(m,e,o,u,c,f,x,S,k,C,A,M,B,U),{u_gamma_scale:u?Math.cos(H._pitch)*H.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},Su=(m,e,o,u,c,f,x,S,k,C,A,M,B,V)=>d.e(ra(m,e,o,u,c,f,x,S,k,C,A,!0,M,!0,V),{u_texsize_icon:B,u_texture_icon:1}),Xa=(m,e,o)=>({u_matrix:m,u_opacity:e,u_color:o}),Tu=(m,e,o,u,c,f)=>d.e(function(x,S,k,C){const A=k.imageManager.getPattern(x.from.toString()),M=k.imageManager.getPattern(x.to.toString()),{width:B,height:V}=k.imageManager.getPixelSize(),U=Math.pow(2,C.tileID.overscaledZ),H=C.tileSize*Math.pow(2,k.transform.tileZoom)/U,K=H*(C.tileID.canonical.x+C.tileID.wrap*U),J=H*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[B,V],u_mix:S.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/It(C,1,k.transform.tileZoom),u_pixel_coord_upper:[K>>16,J>>16],u_pixel_coord_lower:[65535&K,65535&J]}}(u,f,o,c),{u_matrix:m,u_opacity:e}),ku={fillExtrusion:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_lightpos:new d.aN(m,e.u_lightpos),u_lightintensity:new d.aI(m,e.u_lightintensity),u_lightcolor:new d.aN(m,e.u_lightcolor),u_vertical_gradient:new d.aI(m,e.u_vertical_gradient),u_opacity:new d.aI(m,e.u_opacity)}),fillExtrusionPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_lightpos:new d.aN(m,e.u_lightpos),u_lightintensity:new d.aI(m,e.u_lightintensity),u_lightcolor:new d.aN(m,e.u_lightcolor),u_vertical_gradient:new d.aI(m,e.u_vertical_gradient),u_height_factor:new d.aI(m,e.u_height_factor),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade),u_opacity:new d.aI(m,e.u_opacity)}),fill:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix)}),fillPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),fillOutline:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world)}),fillOutlinePattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),circle:(m,e)=>({u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(m,e.u_scale_with_map),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_extrude_scale:new d.aO(m,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_matrix:new d.aJ(m,e.u_matrix)}),collisionBox:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_pixel_extrude_scale:new d.aO(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_inv_matrix:new d.aJ(m,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_viewport_size:new d.aO(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new d.aL(m,e.u_color),u_matrix:new d.aJ(m,e.u_matrix),u_overlay:new d.aH(m,e.u_overlay),u_overlay_scale:new d.aI(m,e.u_overlay_scale)}),clippingMask:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix)}),heatmap:(m,e)=>({u_extrude_scale:new d.aI(m,e.u_extrude_scale),u_intensity:new d.aI(m,e.u_intensity),u_matrix:new d.aJ(m,e.u_matrix)}),heatmapTexture:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world),u_image:new d.aH(m,e.u_image),u_color_ramp:new d.aH(m,e.u_color_ramp),u_opacity:new d.aI(m,e.u_opacity)}),hillshade:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_latrange:new d.aO(m,e.u_latrange),u_light:new d.aO(m,e.u_light),u_shadow:new d.aL(m,e.u_shadow),u_highlight:new d.aL(m,e.u_highlight),u_accent:new d.aL(m,e.u_accent)}),hillshadePrepare:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_dimension:new d.aO(m,e.u_dimension),u_zoom:new d.aI(m,e.u_zoom),u_unpack:new d.aK(m,e.u_unpack)}),line:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_image:new d.aH(m,e.u_image),u_image_height:new d.aI(m,e.u_image_height)}),linePattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texsize:new d.aO(m,e.u_texsize),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_image:new d.aH(m,e.u_image),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),lineSDF:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_patternscale_a:new d.aO(m,e.u_patternscale_a),u_patternscale_b:new d.aO(m,e.u_patternscale_b),u_sdfgamma:new d.aI(m,e.u_sdfgamma),u_image:new d.aH(m,e.u_image),u_tex_y_a:new d.aI(m,e.u_tex_y_a),u_tex_y_b:new d.aI(m,e.u_tex_y_b),u_mix:new d.aI(m,e.u_mix)}),raster:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_tl_parent:new d.aO(m,e.u_tl_parent),u_scale_parent:new d.aI(m,e.u_scale_parent),u_buffer_scale:new d.aI(m,e.u_buffer_scale),u_fade_t:new d.aI(m,e.u_fade_t),u_opacity:new d.aI(m,e.u_opacity),u_image0:new d.aH(m,e.u_image0),u_image1:new d.aH(m,e.u_image1),u_brightness_low:new d.aI(m,e.u_brightness_low),u_brightness_high:new d.aI(m,e.u_brightness_high),u_saturation_factor:new d.aI(m,e.u_saturation_factor),u_contrast_factor:new d.aI(m,e.u_contrast_factor),u_spin_weights:new d.aN(m,e.u_spin_weights)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texture:new d.aH(m,e.u_texture),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texture:new d.aH(m,e.u_texture),u_gamma_scale:new d.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_is_halo:new d.aH(m,e.u_is_halo),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texsize_icon:new d.aO(m,e.u_texsize_icon),u_texture:new d.aH(m,e.u_texture),u_texture_icon:new d.aH(m,e.u_texture_icon),u_gamma_scale:new d.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_is_halo:new d.aH(m,e.u_is_halo),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),background:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_opacity:new d.aI(m,e.u_opacity),u_color:new d.aL(m,e.u_color)}),backgroundPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_opacity:new d.aI(m,e.u_opacity),u_image:new d.aH(m,e.u_image),u_pattern_tl_a:new d.aO(m,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(m,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(m,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(m,e.u_pattern_br_b),u_texsize:new d.aO(m,e.u_texsize),u_mix:new d.aI(m,e.u_mix),u_pattern_size_a:new d.aO(m,e.u_pattern_size_a),u_pattern_size_b:new d.aO(m,e.u_pattern_size_b),u_scale_a:new d.aI(m,e.u_scale_a),u_scale_b:new d.aI(m,e.u_scale_b),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texture:new d.aH(m,e.u_texture),u_ele_delta:new d.aI(m,e.u_ele_delta),u_fog_matrix:new d.aJ(m,e.u_fog_matrix),u_fog_color:new d.aL(m,e.u_fog_color),u_fog_ground_blend:new d.aI(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(m,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(m,e.u_horizon_color),u_horizon_fog_blend:new d.aI(m,e.u_horizon_fog_blend)}),terrainDepth:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ele_delta:new d.aI(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texture:new d.aH(m,e.u_texture),u_terrain_coords_id:new d.aI(m,e.u_terrain_coords_id),u_ele_delta:new d.aI(m,e.u_ele_delta)}),sky:(m,e)=>({u_sky_color:new d.aL(m,e.u_sky_color),u_horizon_color:new d.aL(m,e.u_horizon_color),u_horizon:new d.aI(m,e.u_horizon),u_sky_horizon_blend:new d.aI(m,e.u_sky_horizon_blend)})};class kn{constructor(e,o,u){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const sf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Eu{constructor(e,o,u,c){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=c,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let u=0;u<this.attributes.length;u++){const c=o.attributes[this.attributes[u].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,o,u){for(let c=0;c<this.attributes.length;c++){const f=this.attributes[c],x=o.attributes[f.name];x!==void 0&&e.vertexAttribPointer(x,f.components,e[sf[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ks=new WeakMap;function as(m){var e;if(ks.has(m))return ks.get(m);{const o=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ks.set(m,o),o}}class Vt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ka extends Vt{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class of extends Vt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ro extends Vt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class af extends Vt{getDefault(){return[!0,!0,!0,!0]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Th extends Vt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class lf extends Vt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class kh extends Vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Iu extends Vt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Eh extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ih extends Vt{getDefault(){return[0,1]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ch extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ph extends Vt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Es extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class Ah extends Vt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class uf extends Vt{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Mh extends Vt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ia extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class cf extends Vt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ja extends Vt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class hf extends Vt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class df extends Vt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class zh extends Vt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Dh extends Vt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Rh extends Vt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Cu extends Vt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Lh extends Vt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ya extends Vt{getDefault(){return null}set(e){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class $n extends Vt{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;const u=this.gl;as(u)?u.bindVertexArray(e):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Pu extends Vt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Au extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Mu extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Qa extends Vt{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class zu extends Qa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Is extends Qa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Du extends Qa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class pf{constructor(e,o,u,c,f){this.context=e,this.width=o,this.height=u;const x=e.gl,S=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new zu(e,S),c)this.depthAttachment=f?new Du(e,S):new Is(e,S);else if(f)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class dr{constructor(e,o,u){this.blendFunction=e,this.blendColor=o,this.mask=u}}dr.Replace=[1,0],dr.disabled=new dr(dr.Replace,d.aM.transparent,[!1,!1,!1,!1]),dr.unblended=new dr(dr.Replace,d.aM.transparent,[!0,!0,!0,!0]),dr.alphaBlended=new dr([1,771],d.aM.transparent,[!0,!0,!0,!0]);class ff{constructor(e){var o,u;if(this.gl=e,this.clearColor=new Ka(this),this.clearDepth=new of(this),this.clearStencil=new ro(this),this.colorMask=new af(this),this.depthMask=new Th(this),this.stencilMask=new lf(this),this.stencilFunc=new kh(this),this.stencilOp=new Iu(this),this.stencilTest=new Eh(this),this.depthRange=new Ih(this),this.depthTest=new Ch(this),this.depthFunc=new Ph(this),this.blend=new Es(this),this.blendFunc=new Ah(this),this.blendColor=new uf(this),this.blendEquation=new Mh(this),this.cullFace=new ia(this),this.cullFaceSide=new cf(this),this.frontFace=new Ja(this),this.program=new hf(this),this.activeTexture=new df(this),this.viewport=new zh(this),this.bindFramebuffer=new Dh(this),this.bindRenderbuffer=new Rh(this),this.bindTexture=new Cu(this),this.bindVertexBuffer=new Lh(this),this.bindElementBuffer=new Ya(this),this.bindVertexArray=new $n(this),this.pixelStoreUnpack=new Pu(this),this.pixelStoreUnpackPremultiplyAlpha=new Au(this),this.pixelStoreUnpackFlipY=new Mu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),as(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new kn(this,e,o)}createVertexBuffer(e,o,u){return new Eu(this,e,o,u)}createRenderbuffer(e,o,u){const c=this.gl,f=c.createRenderbuffer();return this.bindRenderbuffer.set(f),c.renderbufferStorage(c.RENDERBUFFER,e,o,u),this.bindRenderbuffer.set(null),f}createFramebuffer(e,o,u,c){return new pf(this,e,o,u,c)}clear({color:e,depth:o,stencil:u}){const c=this.gl;let f=0;e&&(f|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(f|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(f|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),c.clear(f)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,dr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return as(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return as(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class St{constructor(e,o,u){this.func=e,this.mask=o,this.range=u}}St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);const el=7680;class Xt{constructor(e,o,u,c,f,x){this.test=e,this.ref=o,this.mask=u,this.fail=c,this.depthFail=f,this.pass=x}}Xt.disabled=new Xt({func:519,mask:0},0,0,el,el,el);class Zt{constructor(e,o,u){this.enable=e,this.mode=o,this.frontFace=u}}let Cs;function na(m,e,o,u,c){const f=m.context,x=f.gl,S=m.useProgram("collisionBox"),k=[];let C=0,A=0;for(let J=0;J<u.length;J++){const ee=u[J],q=e.getTile(ee).getBucket(o);if(!q)continue;const se=c?q.textCollisionBox:q.iconCollisionBox,le=q.collisionCircleArray;if(le.length>0){const pe=d.H();d.aQ(pe,q.placementInvProjMatrix,m.transform.glCoordMatrix),d.aQ(pe,pe,q.placementViewportMatrix),k.push({circleArray:le,circleOffset:A,transform:ee.posMatrix,invTransform:pe,coord:ee}),C+=le.length/4,A=C}se&&S.draw(f,x.LINES,St.disabled,Xt.disabled,m.colorModeForRenderPass(),Zt.disabled,{u_matrix:ee.posMatrix,u_pixel_extrude_scale:[1/(M=m.transform).width,1/M.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee),o.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,null,m.transform.zoom,null,null,se.collisionVertexBuffer)}var M;if(!c||!k.length)return;const B=m.useProgram("collisionCircle"),V=new d.aR;V.resize(4*C),V._trim();let U=0;for(const J of k)for(let ee=0;ee<J.circleArray.length/4;ee++){const q=4*ee,se=J.circleArray[q+0],le=J.circleArray[q+1],pe=J.circleArray[q+2],xe=J.circleArray[q+3];V.emplace(U++,se,le,pe,xe,0),V.emplace(U++,se,le,pe,xe,1),V.emplace(U++,se,le,pe,xe,2),V.emplace(U++,se,le,pe,xe,3)}(!Cs||Cs.length<2*C)&&(Cs=function(J){const ee=2*J,q=new d.aT;q.resize(ee),q._trim();for(let se=0;se<ee;se++){const le=6*se;q.uint16[le+0]=4*se+0,q.uint16[le+1]=4*se+1,q.uint16[le+2]=4*se+2,q.uint16[le+3]=4*se+2,q.uint16[le+4]=4*se+3,q.uint16[le+5]=4*se+0}return q}(C));const H=f.createIndexBuffer(Cs,!0),K=f.createVertexBuffer(V,d.aS.members,!0);for(const J of k){const ee=Ts(J.transform,J.invTransform,m.transform);B.draw(f,x.TRIANGLES,St.disabled,Xt.disabled,m.colorModeForRenderPass(),Zt.disabled,ee,m.style.map.terrain&&m.style.map.terrain.getTerrainData(J.coord),o.id,K,H,d.a0.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,m.transform.zoom,null,null,null)}K.destroy(),H.destroy()}Zt.disabled=new Zt(!1,1029,2305),Zt.backCCW=new Zt(!0,1029,2305);const sa=d.an(new Float32Array(16));function Ru(m,e,o,u,c,f){const{horizontalAlign:x,verticalAlign:S}=d.au(m);return new d.P((-(x-.5)*e/c+u[0])*f,(-(S-.5)*o/c+u[1])*f)}function Ps(m,e,o,u,c,f){const x=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=u.mult(f);o||(S=S.rotate(-c));const k=x.add(S);return W(k.x,k.y,e.labelPlaneMatrix,e.getElevation).point}if(o){const S=_e(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),k=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return m.add(u.rotate(k))}return m.add(u)}function io(m,e,o,u,c,f,x,S,k,C,A,M,B,V){const U=m.text.placedSymbolArray,H=m.text.dynamicLayoutVertexArray,K=m.icon.dynamicLayoutVertexArray,J={};H.clear();for(let ee=0;ee<U.length;ee++){const q=U.get(ee),se=q.hidden||!q.crossTileID||m.allowVerticalPlacement&&!q.placedOrientation?null:u[q.crossTileID];if(se){const le=new d.P(q.anchorX,q.anchorY),pe={getElevation:V,width:c.width,height:c.height,labelPlaneMatrix:f,pitchWithMap:o,projection:A,tileAnchorPoint:le,translation:M,unwrappedTileID:B},xe=o?W(le.x,le.y,x,V):_e(le.x,le.y,pe),Te=R(c.cameraToCenterDistance,xe.signedDistanceFromCamera);let Oe=d.ai(m.textSizeData,k,q)*Te/d.ap;o&&(Oe*=m.tilePixelRatio/S);const{width:qe,height:Ae,anchor:Pe,textOffset:Ke,textBoxScale:dt}=se,Re=Ru(Pe,qe,Ae,Ke,dt,Oe),Ue=A.getPitchedTextCorrection(c,le.add(new d.P(M[0],M[1])),B),ct=Ps(xe.point,pe,e,Re,c.angle,Ue),er=m.allowVerticalPlacement&&q.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let vt=0;vt<q.numGlyphs;vt++)d.aj(H,ct,er);C&&q.associatedIconIndex>=0&&(J[q.associatedIconIndex]={shiftedAnchor:ct,angle:er})}else nt(q.numGlyphs,H)}if(C){K.clear();const ee=m.icon.placedSymbolArray;for(let q=0;q<ee.length;q++){const se=ee.get(q);if(se.hidden)nt(se.numGlyphs,K);else{const le=J[q];if(le)for(let pe=0;pe<se.numGlyphs;pe++)d.aj(K,le.shiftedAnchor,le.angle);else nt(se.numGlyphs,K)}}m.icon.dynamicLayoutVertexBuffer.updateData(K)}m.text.dynamicLayoutVertexBuffer.updateData(H)}function ji(m,e,o){return o.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Lu(m,e,o,u,c,f,x,S,k,C,A,M){const B=m.context,V=B.gl,U=m.transform,H=bs(),K=S==="map",J=k==="map",ee=S!=="viewport"&&o.layout.get("symbol-placement")!=="point",q=K&&!J&&!ee,se=!J&&ee,le=!o.layout.get("symbol-sort-key").isConstant();let pe=!1;const xe=m.depthModeForSublayer(0,St.ReadOnly),Te=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Oe=[],qe=H.getCircleRadiusCorrection(U);for(const Ae of u){const Pe=e.getTile(Ae),Ke=Pe.getBucket(o);if(!Ke)continue;const dt=c?Ke.text:Ke.icon;if(!dt||!dt.segments.get().length||!dt.hasVisibleVertices)continue;const Re=dt.programConfigurations.get(o.id),Ue=c||Ke.sdfIcons,ct=c?Ke.textSizeData:Ke.iconSizeData,er=J||U.pitch!==0,vt=m.useProgram(ji(Ue,c,Ke),Re),Ct=d.ag(ct,U.zoom),tr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ae);let Hr,ln,rr,mi,si=[0,0],Wr=null;if(c)ln=Pe.glyphAtlasTexture,rr=V.LINEAR,Hr=Pe.glyphAtlasTexture.size,Ke.iconsInText&&(si=Pe.imageAtlasTexture.size,Wr=Pe.imageAtlasTexture,mi=er||m.options.rotating||m.options.zooming||ct.kind==="composite"||ct.kind==="camera"?V.LINEAR:V.NEAREST);else{const At=o.layout.get("icon-size").constantOr(0)!==1||Ke.iconsNeedLinear;ln=Pe.imageAtlasTexture,rr=Ue||m.options.rotating||m.options.zooming||At||er?V.LINEAR:V.NEAREST,Hr=Pe.imageAtlasTexture.size}const oi=It(Pe,1,m.transform.zoom),Cn=se?Ae.posMatrix:sa,vo=ss(Cn,J,K,m.transform,oi),vl=Tn(Cn,J,K,m.transform,oi),xo=Tn(Ae.posMatrix,J,K,m.transform,oi),qi=H.translatePosition(m.transform,Pe,f,x),xl=Te&&Ke.hasTextData(),oc=o.layout.get("icon-text-fit")!=="none"&&xl&&Ke.hasIconData();if(ee){const At=m.style.map.terrain?(wo,bo)=>m.style.map.terrain.getElevation(Ae,wo,bo):null,Rs=o.layout.get("text-rotation-alignment")==="map";N(Ke,Ae.posMatrix,m,c,vo,xo,J,C,Rs,H,Ae.toUnwrapped(),U.width,U.height,qi,At)}const Zi=Ae.posMatrix,Gi=c&&Te||oc,ls=ee||Gi?sa:vo,un=vl,Vr=Ue&&o.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Xr;Xr=Ue?Ke.iconsInText?Su(ct.kind,Ct,q,J,ee,Gi,m,Zi,ls,un,qi,Hr,si,qe):ra(ct.kind,Ct,q,J,ee,Gi,m,Zi,ls,un,qi,c,Hr,!0,qe):Sh(ct.kind,Ct,q,J,ee,Gi,m,Zi,ls,un,qi,c,Hr,qe);const Mi={program:vt,buffers:dt,uniformValues:Xr,atlasTexture:ln,atlasTextureIcon:Wr,atlasInterpolation:rr,atlasInterpolationIcon:mi,isSDF:Ue,hasHalo:Vr};if(le&&Ke.canOverlap){pe=!0;const At=dt.segments.get();for(const Rs of At)Oe.push({segments:new d.a0([Rs]),sortKey:Rs.sortKey,state:Mi,terrainData:tr})}else Oe.push({segments:dt.segments,sortKey:0,state:Mi,terrainData:tr})}pe&&Oe.sort((Ae,Pe)=>Ae.sortKey-Pe.sortKey);for(const Ae of Oe){const Pe=Ae.state;if(B.activeTexture.set(V.TEXTURE0),Pe.atlasTexture.bind(Pe.atlasInterpolation,V.CLAMP_TO_EDGE),Pe.atlasTextureIcon&&(B.activeTexture.set(V.TEXTURE1),Pe.atlasTextureIcon&&Pe.atlasTextureIcon.bind(Pe.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Pe.isSDF){const Ke=Pe.uniformValues;Pe.hasHalo&&(Ke.u_is_halo=1,Bu(Pe.buffers,Ae.segments,o,m,Pe.program,xe,A,M,Ke,Ae.terrainData)),Ke.u_is_halo=0}Bu(Pe.buffers,Ae.segments,o,m,Pe.program,xe,A,M,Pe.uniformValues,Ae.terrainData)}}function Bu(m,e,o,u,c,f,x,S,k,C){const A=u.context;c.draw(A,A.gl.TRIANGLES,f,x,S,Zt.disabled,k,C,o.id,m.layoutVertexBuffer,m.indexBuffer,e,o.paint,u.transform.zoom,m.programConfigurations.get(o.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Fu(m,e,o,u){const c=m.context,f=c.gl,x=Xt.disabled,S=new dr([f.ONE,f.ONE],d.aM.transparent,[!0,!0,!0,!0]),k=e.getBucket(o);if(!k)return;const C=u.key;let A=o.heatmapFbos.get(C);A||(A=oa(c,e.tileSize,e.tileSize),o.heatmapFbos.set(C,A)),c.bindFramebuffer.set(A.framebuffer),c.viewport.set([0,0,e.tileSize,e.tileSize]),c.clear({color:d.aM.transparent});const M=k.programConfigurations.get(o.id),B=m.useProgram("heatmap",M),V=m.style.map.terrain.getTerrainData(u);B.draw(c,f.TRIANGLES,St.disabled,x,S,Zt.disabled,fi(u.posMatrix,e,m.transform.zoom,o.paint.get("heatmap-intensity")),V,o.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,o.paint,m.transform.zoom,M)}function As(m,e,o){const u=m.context,c=u.gl;u.setColorMode(m.colorModeForRenderPass());const f=aa(u,e),x=o.key,S=e.heatmapFbos.get(x);S&&(u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,S.colorAttachment.get()),u.activeTexture.set(c.TEXTURE1),f.bind(c.LINEAR,c.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(u,c.TRIANGLES,St.disabled,Xt.disabled,m.colorModeForRenderPass(),Zt.disabled,Ga(m,e,0,1),null,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,m.transform.zoom),S.destroy(),e.heatmapFbos.delete(x))}function oa(m,e,o){var u,c;const f=m.gl,x=f.createTexture();f.bindTexture(f.TEXTURE_2D,x),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);const S=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:f.UNSIGNED_BYTE,k=(c=m.RGBA16F)!==null&&c!==void 0?c:f.RGBA;f.texImage2D(f.TEXTURE_2D,0,k,e,o,0,f.RGBA,S,null);const C=m.createFramebuffer(e,o,!1,!1);return C.colorAttachment.set(x),C}function aa(m,e){return e.colorRampTexture||(e.colorRampTexture=new mt(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function no(m,e,o,u,c){if(!o||!u||!u.imageAtlas)return;const f=u.imageAtlas.patternPositions;let x=f[o.to.toString()],S=f[o.from.toString()];if(!x&&S&&(x=S),!S&&x&&(S=x),!x||!S){const k=c.getPaintProperty(e);x=f[k],S=f[k]}x&&S&&m.setConstantPatternPositions(x,S)}function la(m,e,o,u,c,f,x){const S=m.context.gl,k="fill-pattern",C=o.paint.get(k),A=C&&C.constantOr(1),M=o.getCrossfadeParameters();let B,V,U,H,K;x?(V=A&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=S.LINES):(V=A?"fillPattern":"fill",B=S.TRIANGLES);const J=C.constantOr(null);for(const ee of u){const q=e.getTile(ee);if(A&&!q.patternsLoaded())continue;const se=q.getBucket(o);if(!se)continue;const le=se.programConfigurations.get(o.id),pe=m.useProgram(V,le),xe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee);A&&(m.context.activeTexture.set(S.TEXTURE0),q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),le.updatePaintBuffers(M)),no(le,k,J,q,o);const Te=xe?ee:null,Oe=m.translatePosMatrix(Te?Te.posMatrix:ee.posMatrix,q,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(x){H=se.indexBuffer2,K=se.segments2;const qe=[S.drawingBufferWidth,S.drawingBufferHeight];U=V==="fillOutlinePattern"&&A?vh(Oe,m,M,q,qe):Qp(Oe,qe)}else H=se.indexBuffer,K=se.segments,U=A?_h(Oe,m,M,q):eo(Oe);pe.draw(m.context,B,c,m.stencilModeForClipping(ee),f,Zt.disabled,U,xe,o.id,se.layoutVertexBuffer,H,K,o.paint,m.transform.zoom,le)}}function tl(m,e,o,u,c,f,x){const S=m.context,k=S.gl,C="fill-extrusion-pattern",A=o.paint.get(C),M=A.constantOr(1),B=o.getCrossfadeParameters(),V=o.paint.get("fill-extrusion-opacity"),U=A.constantOr(null);for(const H of u){const K=e.getTile(H),J=K.getBucket(o);if(!J)continue;const ee=m.style.map.terrain&&m.style.map.terrain.getTerrainData(H),q=J.programConfigurations.get(o.id),se=m.useProgram(M?"fillExtrusionPattern":"fillExtrusion",q);M&&(m.context.activeTexture.set(k.TEXTURE0),K.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),q.updatePaintBuffers(B)),no(q,C,U,K,o);const le=m.translatePosMatrix(H.posMatrix,K,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),pe=o.paint.get("fill-extrusion-vertical-gradient"),xe=M?Za(le,m,pe,V,H,B,K):ea(le,m,pe,V);se.draw(S,S.gl.TRIANGLES,c,f,x,Zt.backCCW,xe,ee,o.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,o.paint,m.transform.zoom,q,m.style.map.terrain&&J.centroidVertexBuffer)}}function so(m,e,o,u,c,f,x){const S=m.context,k=S.gl,C=o.fbo;if(!C)return;const A=m.useProgram("hillshade"),M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(e);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,C.colorAttachment.get()),A.draw(S,k.TRIANGLES,c,f,x,Zt.disabled,((B,V,U,H)=>{const K=U.paint.get("hillshade-shadow-color"),J=U.paint.get("hillshade-highlight-color"),ee=U.paint.get("hillshade-accent-color");let q=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(q-=B.transform.angle);const se=!B.options.moving;return{u_matrix:H?H.posMatrix:B.transform.calculatePosMatrix(V.tileID.toUnwrapped(),se),u_image:0,u_latrange:Ha(0,V.tileID),u_light:[U.paint.get("hillshade-exaggeration"),q],u_shadow:K,u_highlight:J,u_accent:ee}})(m,o,u,M?e:null),M,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function oo(m,e,o,u,c,f){const x=m.context,S=x.gl,k=e.dem;if(k&&k.data){const C=k.dim,A=k.stride,M=k.getPixels();if(x.activeTexture.set(S.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||m.getTileTexture(A),e.demTexture){const V=e.demTexture;V.update(M,{premultiply:!1}),V.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else e.demTexture=new mt(x,M,S.RGBA,{premultiply:!1}),e.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);x.activeTexture.set(S.TEXTURE0);let B=e.fbo;if(!B){const V=new mt(x,{width:C,height:C,data:null},S.RGBA);V.bind(S.LINEAR,S.CLAMP_TO_EDGE),B=e.fbo=x.createFramebuffer(C,C,!0,!1),B.colorAttachment.set(V.texture)}x.bindFramebuffer.set(B.framebuffer),x.viewport.set([0,0,C,C]),m.useProgram("hillshadePrepare").draw(x,S.TRIANGLES,u,c,f,Zt.disabled,((V,U)=>{const H=U.stride,K=d.H();return d.aP(K,0,d.X,-d.X,0,0,1),d.J(K,K,[0,-d.X,0]),{u_matrix:K,u_image:1,u_dimension:[H,H],u_zoom:V.overscaledZ,u_unpack:U.getUnpackVector()}})(e.tileID,k),null,o.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Bh(m,e,o,u,c,f){const x=u.paint.get("raster-fade-duration");if(!f&&x>0){const S=te.now(),k=(S-m.timeAdded)/x,C=e?(S-e.timeAdded)/x:-1,A=o.getSource(),M=c.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-M)>Math.abs(m.tileID.overscaledZ-M),V=B&&m.refreshedUponExpiration?1:d.ac(B?k:1-C,0,1);return m.refreshedUponExpiration&&k>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const Ou=new d.aM(1,0,0,1),Lt=new d.aM(0,1,0,1),rl=new d.aM(0,0,1,1),mf=new d.aM(1,0,1,1),Fh=new d.aM(0,1,1,1);function ao(m,e,o,u){il(m,0,e+o/2,m.transform.width,o,u)}function Oh(m,e,o,u){il(m,e-o/2,0,o,m.transform.height,u)}function il(m,e,o,u,c,f){const x=m.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*m.pixelRatio,o*m.pixelRatio,u*m.pixelRatio,c*m.pixelRatio),x.clear({color:f}),S.disable(S.SCISSOR_TEST)}function Nh(m,e,o){const u=m.context,c=u.gl,f=o.posMatrix,x=m.useProgram("debug"),S=St.disabled,k=Xt.disabled,C=m.colorModeForRenderPass(),A="$debug",M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(o);u.activeTexture.set(c.TEXTURE0);const B=e.getTileByID(o.key).latestRawTileData,V=Math.floor((B&&B.byteLength||0)/1024),U=e.getTile(o).tileSize,H=512/Math.min(U,512)*(o.overscaledZ/m.transform.zoom)*.5;let K=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(K+=` => ${o.overscaledZ}`),function(J,ee){J.initDebugOverlayCanvas();const q=J.debugOverlayCanvas,se=J.context.gl,le=J.debugOverlayCanvas.getContext("2d");le.clearRect(0,0,q.width,q.height),le.shadowColor="white",le.shadowBlur=2,le.lineWidth=1.5,le.strokeStyle="white",le.textBaseline="top",le.font="bold 36px Open Sans, sans-serif",le.fillText(ee,5,5),le.strokeText(ee,5,5),J.debugOverlayTexture.update(q),J.debugOverlayTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE)}(m,`${K} ${V}kB`),x.draw(u,c.TRIANGLES,S,k,dr.alphaBlended,Zt.disabled,ta(f,d.aM.transparent,H),null,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),x.draw(u,c.LINE_STRIP,S,k,C,Zt.disabled,ta(f,d.aM.red),M,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Vh(m,e,o){const u=m.context,c=u.gl,f=m.colorModeForRenderPass(),x=new St(c.LEQUAL,St.ReadWrite,m.depthRangeFor3D),S=m.useProgram("terrain"),k=e.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,m.width,m.height]);for(const C of o){const A=m.renderToTexture.getTexture(C),M=e.getTerrainData(C.tileID);u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,A.texture);const B=m.transform.calculatePosMatrix(C.tileID.toUnwrapped()),V=e.getMeshFrameDelta(m.transform.zoom),U=m.transform.calculateFogMatrix(C.tileID.toUnwrapped()),H=wu(B,V,U,m.style.sky,m.transform.pitch);S.draw(u,c.TRIANGLES,x,Xt.disabled,f,Zt.backCCW,H,M,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class nl{constructor(e,o,u){this.vertexBuffer=e,this.indexBuffer=o,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class sl{constructor(e,o){this.context=new ff(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ut.maxUnderzooming+ut.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new vu}resize(e,o,u){if(this.width=Math.floor(e*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,o=new d.aX;o.emplaceBack(0,0),o.emplaceBack(d.X,0),o.emplaceBack(0,d.X),o.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(o,Ss.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const u=new d.aX;u.emplaceBack(0,0),u.emplaceBack(d.X,0),u.emplaceBack(0,d.X),u.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(u,Ss.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const c=new d.$;c.emplaceBack(0,0,0,0),c.emplaceBack(d.X,0,d.X,0),c.emplaceBack(0,d.X,0,d.X),c.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(c,en.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const f=new d.aX;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,Ss.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const x=new d.aZ;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(x);const S=new d.aY;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const k=this.context.gl;this.stencilClearMode=new Xt({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.H();d.aP(u,0,this.width,this.height,0,0,1),d.K(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,o.TRIANGLES,St.disabled,this.stencilClearMode,dr.disabled,Zt.disabled,pi(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source;const u=this.context,c=u.gl;this.nextStencilID+o.length>256&&this.clearStencil(),u.setColorMode(dr.disabled),u.setDepthMode(St.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of o){const S=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);f.draw(u,c.TRIANGLES,St.disabled,new Xt({func:c.ALWAYS,mask:0},S,255,c.KEEP,c.KEEP,c.REPLACE),dr.disabled,Zt.disabled,pi(x.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,o=this.context.gl;return new Xt({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){const o=this.context.gl;return new Xt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(e){const o=this.context.gl,u=e.sort((x,S)=>S.overscaledZ-x.overscaledZ),c=u[u.length-1].overscaledZ,f=u[0].overscaledZ-c+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const x={};for(let S=0;S<f;S++)x[S+c]=new Xt({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=f,[x,u]}return[{[c]:Xt.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new dr([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?dr.unblended:dr.alphaBlended}depthModeForSublayer(e,o,u){if(!this.opaquePassEnabledForLayer())return St.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new St(u||this.context.gl.LEQUAL,o,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(te.now()),this.imageManager.beginFrame();const u=this.style._order,c=this.style.sourceCaches,f={},x={},S={};for(const k in c){const C=c[k];C.used&&C.prepare(this.context),f[k]=C.getVisibleCoordinates(),x[k]=f[k].slice().reverse(),S[k]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<u.length;k++)if(this.style._layers[u[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const k of u){const C=this.style._layers[k];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const A=x[C.source];(C.type==="custom"||A.length)&&this.renderLayer(this,c[C.source],C,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(k,C){const A=k.context,M=A.gl,B=((J,ee,q)=>({u_sky_color:J.properties.get("sky-color"),u_horizon_color:J.properties.get("horizon-color"),u_horizon:(ee.height/2+ee.getHorizon())*q,u_sky_horizon_blend:J.properties.get("sky-horizon-blend")*ee.height/2*q}))(C,k.style.map.transform,k.pixelRatio),V=new St(M.LEQUAL,St.ReadWrite,[0,1]),U=Xt.disabled,H=k.colorModeForRenderPass(),K=k.useProgram("sky");if(!C.mesh){const J=new d.aX;J.emplaceBack(-1,-1),J.emplaceBack(1,-1),J.emplaceBack(1,1),J.emplaceBack(-1,1);const ee=new d.aY;ee.emplaceBack(0,1,2),ee.emplaceBack(0,2,3),C.mesh=new nl(A.createVertexBuffer(J,Ss.members),A.createIndexBuffer(ee),d.a0.simpleSegment(0,0,J.length,ee.length))}K.draw(A,M.TRIANGLES,V,U,H,Zt.disabled,B,void 0,"sky",C.mesh.vertexBuffer,C.mesh.indexBuffer,C.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[u[this.currentLayer]],C=c[k.source],A=f[k.source];this._renderTileClippingMasks(k,A),this.renderLayer(this,C,k,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const k=this.style._layers[u[this.currentLayer]],C=c[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const A=(k.type==="symbol"?S:x)[k.source];this._renderTileClippingMasks(k,f[k.source]),this.renderLayer(this,C,k,A)}if(this.options.showTileBoundaries){const k=function(C,A){let M=null;const B=Object.values(C._layers).flatMap(K=>K.source&&!K.isHidden(A)?[C.sourceCaches[K.source]]:[]),V=B.filter(K=>K.getSource().type==="vector"),U=B.filter(K=>K.getSource().type!=="vector"),H=K=>{(!M||M.getSource().maxzoom<K.getSource().maxzoom)&&(M=K)};return V.forEach(K=>H(K)),M||U.forEach(K=>H(K)),M}(this.style,this.transform.zoom);k&&function(C,A,M){for(let B=0;B<M.length;B++)Nh(C,A,M[B])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const C=k.transform.padding;ao(k,k.transform.height-(C.top||0),3,Ou),ao(k,C.bottom||0,3,Lt),Oh(k,C.left||0,3,rl),Oh(k,k.transform.width-(C.right||0),3,mf);const A=k.transform.centerPoint;(function(M,B,V,U){il(M,B-1,V-10,2,20,U),il(M,B-10,V-1,20,2,U)})(k,A.x,k.transform.height-A.y,Fh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!d.a_(o,u):!d.a$(o,u)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(d.b0(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,x){const S=f.context,k=S.gl,C=dr.unblended,A=new St(k.LEQUAL,St.ReadWrite,[0,1]),M=x.getTerrainMesh(),B=x.sourceCache.getRenderableTiles(),V=f.useProgram("terrainDepth");S.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),S.clear({color:d.aM.transparent,depth:1});for(const U of B){const H=x.getTerrainData(U.tileID),K={u_matrix:f.transform.calculatePosMatrix(U.tileID.toUnwrapped()),u_ele_delta:x.getMeshFrameDelta(f.transform.zoom)};V.draw(S,k.TRIANGLES,A,Xt.disabled,C,Zt.backCCW,K,H,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,x){const S=f.context,k=S.gl,C=dr.unblended,A=new St(k.LEQUAL,St.ReadWrite,[0,1]),M=x.getTerrainMesh(),B=x.getCoordsTexture(),V=x.sourceCache.getRenderableTiles(),U=f.useProgram("terrainCoords");S.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),S.clear({color:d.aM.transparent,depth:1}),x.coordsIndex=[];for(const H of V){const K=x.getTerrainData(H.tileID);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,B.texture);const J={u_matrix:f.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(f.transform.zoom)};U.draw(S,k.TRIANGLES,A,Xt.disabled,C,Zt.backCCW,J,K,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),x.coordsIndex.push(H.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(e,o,u,c){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(c||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(f,x,S,k,C){if(f.renderPass!=="translucent")return;const A=Xt.disabled,M=f.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,V,U,H,K,J,ee,q,se){const le=V.transform,pe=bs(),xe=K==="map",Te=J==="map";for(const Oe of B){const qe=H.getTile(Oe),Ae=qe.getBucket(U);if(!Ae||!Ae.text||!Ae.text.segments.get().length)continue;const Pe=d.ag(Ae.textSizeData,le.zoom),Ke=It(qe,1,V.transform.zoom),dt=ss(Oe.posMatrix,Te,xe,V.transform,Ke),Re=U.layout.get("icon-text-fit")!=="none"&&Ae.hasIconData();if(Pe){const Ue=Math.pow(2,le.zoom-qe.tileID.overscaledZ),ct=V.style.map.terrain?(vt,Ct)=>V.style.map.terrain.getElevation(Oe,vt,Ct):null,er=pe.translatePosition(le,qe,ee,q);io(Ae,xe,Te,se,le,dt,Oe.posMatrix,Ue,Pe,Re,pe,er,Oe.toUnwrapped(),ct)}}}(k,f,S,x,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),C),S.paint.get("icon-opacity").constantOr(1)!==0&&Lu(f,x,S,k,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),A,M),S.paint.get("text-opacity").constantOr(1)!==0&&Lu(f,x,S,k,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),A,M),x.map.showCollisionBoxes&&(na(f,x,S,k,!0),na(f,x,S,k,!1))})(e,o,u,c,this.style.placement.variableOffsets);break;case"circle":(function(f,x,S,k){if(f.renderPass!=="translucent")return;const C=S.paint.get("circle-opacity"),A=S.paint.get("circle-stroke-width"),M=S.paint.get("circle-stroke-opacity"),B=!S.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(A.constantOr(1)===0||M.constantOr(1)===0))return;const V=f.context,U=V.gl,H=f.depthModeForSublayer(0,St.ReadOnly),K=Xt.disabled,J=f.colorModeForRenderPass(),ee=[];for(let q=0;q<k.length;q++){const se=k[q],le=x.getTile(se),pe=le.getBucket(S);if(!pe)continue;const xe=pe.programConfigurations.get(S.id),Te=f.useProgram("circle",xe),Oe=pe.layoutVertexBuffer,qe=pe.indexBuffer,Ae=f.style.map.terrain&&f.style.map.terrain.getTerrainData(se),Pe={programConfiguration:xe,program:Te,layoutVertexBuffer:Oe,indexBuffer:qe,uniformValues:ef(f,se,le,S),terrainData:Ae};if(B){const Ke=pe.segments.get();for(const dt of Ke)ee.push({segments:new d.a0([dt]),sortKey:dt.sortKey,state:Pe})}else ee.push({segments:pe.segments,sortKey:0,state:Pe})}B&&ee.sort((q,se)=>q.sortKey-se.sortKey);for(const q of ee){const{programConfiguration:se,program:le,layoutVertexBuffer:pe,indexBuffer:xe,uniformValues:Te,terrainData:Oe}=q.state;le.draw(V,U.TRIANGLES,H,K,J,Zt.disabled,Te,Oe,S.id,pe,xe,q.segments,S.paint,f.transform.zoom,se)}})(e,o,u,c);break;case"heatmap":(function(f,x,S,k){if(S.paint.get("heatmap-opacity")===0)return;const C=f.context;if(f.style.map.terrain){for(const A of k){const M=x.getTile(A);x.hasRenderableParent(A)||(f.renderPass==="offscreen"?Fu(f,M,S,A):f.renderPass==="translucent"&&As(f,S,A))}C.viewport.set([0,0,f.width,f.height])}else f.renderPass==="offscreen"?function(A,M,B,V){const U=A.context,H=U.gl,K=Xt.disabled,J=new dr([H.ONE,H.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(ee,q,se){const le=ee.gl;ee.activeTexture.set(le.TEXTURE1),ee.viewport.set([0,0,q.width/4,q.height/4]);let pe=se.heatmapFbos.get(d.aU);pe?(le.bindTexture(le.TEXTURE_2D,pe.colorAttachment.get()),ee.bindFramebuffer.set(pe.framebuffer)):(pe=oa(ee,q.width/4,q.height/4),se.heatmapFbos.set(d.aU,pe))})(U,A,B),U.clear({color:d.aM.transparent});for(let ee=0;ee<V.length;ee++){const q=V[ee];if(M.hasRenderableParent(q))continue;const se=M.getTile(q),le=se.getBucket(B);if(!le)continue;const pe=le.programConfigurations.get(B.id),xe=A.useProgram("heatmap",pe),{zoom:Te}=A.transform;xe.draw(U,H.TRIANGLES,St.disabled,K,J,Zt.disabled,fi(q.posMatrix,se,Te,B.paint.get("heatmap-intensity")),null,B.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,B.paint,A.transform.zoom,pe)}U.viewport.set([0,0,A.width,A.height])}(f,x,S,k):f.renderPass==="translucent"&&function(A,M){const B=A.context,V=B.gl;B.setColorMode(A.colorModeForRenderPass());const U=M.heatmapFbos.get(d.aU);U&&(B.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,U.colorAttachment.get()),B.activeTexture.set(V.TEXTURE1),aa(B,M).bind(V.LINEAR,V.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(B,V.TRIANGLES,St.disabled,Xt.disabled,A.colorModeForRenderPass(),Zt.disabled,Ga(A,M,0,1),null,M.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,M.paint,A.transform.zoom))}(f,S)})(e,o,u,c);break;case"line":(function(f,x,S,k){if(f.renderPass!=="translucent")return;const C=S.paint.get("line-opacity"),A=S.paint.get("line-width");if(C.constantOr(1)===0||A.constantOr(1)===0)return;const M=f.depthModeForSublayer(0,St.ReadOnly),B=f.colorModeForRenderPass(),V=S.paint.get("line-dasharray"),U=S.paint.get("line-pattern"),H=U.constantOr(1),K=S.paint.get("line-gradient"),J=S.getCrossfadeParameters(),ee=H?"linePattern":V?"lineSDF":K?"lineGradient":"line",q=f.context,se=q.gl;let le=!0;for(const pe of k){const xe=x.getTile(pe);if(H&&!xe.patternsLoaded())continue;const Te=xe.getBucket(S);if(!Te)continue;const Oe=Te.programConfigurations.get(S.id),qe=f.context.program.get(),Ae=f.useProgram(ee,Oe),Pe=le||Ae.program!==qe,Ke=f.style.map.terrain&&f.style.map.terrain.getTerrainData(pe),dt=U.constantOr(null);if(dt&&xe.imageAtlas){const ct=xe.imageAtlas,er=ct.patternPositions[dt.to.toString()],vt=ct.patternPositions[dt.from.toString()];er&&vt&&Oe.setConstantPatternPositions(er,vt)}const Re=Ke?pe:null,Ue=H?to(f,xe,S,J,Re):V?tf(f,xe,S,V,J,Re):K?xh(f,xe,S,Te.lineClipsArray.length,Re):Wa(f,xe,S,Re);if(H)q.activeTexture.set(se.TEXTURE0),xe.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Oe.updatePaintBuffers(J);else if(V&&(Pe||f.lineAtlas.dirty))q.activeTexture.set(se.TEXTURE0),f.lineAtlas.bind(q);else if(K){const ct=Te.gradients[S.id];let er=ct.texture;if(S.gradientVersion!==ct.version){let vt=256;if(S.stepInterpolant){const Ct=x.getSource().maxzoom,tr=pe.canonical.z===Ct?Math.ceil(1<<f.transform.maxZoom-pe.canonical.z):1;vt=d.ac(d.aV(Te.maxLineLength/d.X*1024*tr),256,q.maxTextureSize)}ct.gradient=d.aW({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:vt,image:ct.gradient||void 0,clips:Te.lineClipsArray}),ct.texture?ct.texture.update(ct.gradient):ct.texture=new mt(q,ct.gradient,se.RGBA),ct.version=S.gradientVersion,er=ct.texture}q.activeTexture.set(se.TEXTURE0),er.bind(S.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}Ae.draw(q,se.TRIANGLES,M,f.stencilModeForClipping(pe),B,Zt.disabled,Ue,Ke,S.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,S.paint,f.transform.zoom,Oe,Te.layoutVertexBuffer2),le=!1}})(e,o,u,c);break;case"fill":(function(f,x,S,k){const C=S.paint.get("fill-color"),A=S.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const M=f.colorModeForRenderPass(),B=S.paint.get("fill-pattern"),V=f.opaquePassEnabledForLayer()&&!B.constantOr(1)&&C.constantOr(d.aM.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===V){const U=f.depthModeForSublayer(1,f.renderPass==="opaque"?St.ReadWrite:St.ReadOnly);la(f,x,S,k,U,M,!1)}if(f.renderPass==="translucent"&&S.paint.get("fill-antialias")){const U=f.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);la(f,x,S,k,U,M,!0)}})(e,o,u,c);break;case"fill-extrusion":(function(f,x,S,k){const C=S.paint.get("fill-extrusion-opacity");if(C!==0&&f.renderPass==="translucent"){const A=new St(f.context.gl.LEQUAL,St.ReadWrite,f.depthRangeFor3D);if(C!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))tl(f,x,S,k,A,Xt.disabled,dr.disabled),tl(f,x,S,k,A,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const M=f.colorModeForRenderPass();tl(f,x,S,k,A,Xt.disabled,M)}}})(e,o,u,c);break;case"hillshade":(function(f,x,S,k){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const C=f.context,A=f.depthModeForSublayer(0,St.ReadOnly),M=f.colorModeForRenderPass(),[B,V]=f.renderPass==="translucent"?f.stencilConfigForOverlap(k):[{},k];for(const U of V){const H=x.getTile(U);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&f.renderPass==="offscreen"?oo(f,H,S,A,Xt.disabled,M):f.renderPass==="translucent"&&so(f,U,H,S,A,B[U.overscaledZ],M)}C.viewport.set([0,0,f.width,f.height])})(e,o,u,c);break;case"raster":(function(f,x,S,k){if(f.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!k.length)return;const C=f.context,A=C.gl,M=x.getSource(),B=f.useProgram("raster"),V=f.colorModeForRenderPass(),[U,H]=M instanceof Oi?[{},k]:f.stencilConfigForOverlap(k),K=H[H.length-1].overscaledZ,J=!f.options.moving;for(const ee of H){const q=f.depthModeForSublayer(ee.overscaledZ-K,S.paint.get("raster-opacity")===1?St.ReadWrite:St.ReadOnly,A.LESS),se=x.getTile(ee);se.registerFadeDuration(S.paint.get("raster-fade-duration"));const le=x.findLoadedParent(ee,0),pe=x.findLoadedSibling(ee),xe=Bh(se,le||pe||null,x,S,f.transform,f.style.map.terrain);let Te,Oe;const qe=S.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;C.activeTexture.set(A.TEXTURE0),se.texture.bind(qe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(A.TEXTURE1),le?(le.texture.bind(qe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Te=Math.pow(2,le.tileID.overscaledZ-se.tileID.overscaledZ),Oe=[se.tileID.canonical.x*Te%1,se.tileID.canonical.y*Te%1]):se.texture.bind(qe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),se.texture.useMipmap&&C.extTextureFilterAnisotropic&&f.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const Ae=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ee),Pe=Ae?ee:null,Ke=Pe?Pe.posMatrix:f.transform.calculatePosMatrix(ee.toUnwrapped(),J),dt=rf(Ke,Oe||[0,0],Te||1,xe,S);M instanceof Oi?B.draw(C,A.TRIANGLES,q,Xt.disabled,V,Zt.disabled,dt,Ae,S.id,M.boundsBuffer,f.quadTriangleIndexBuffer,M.boundsSegments):B.draw(C,A.TRIANGLES,q,U[ee.overscaledZ],V,Zt.disabled,dt,Ae,S.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(e,o,u,c);break;case"background":(function(f,x,S,k){const C=S.paint.get("background-color"),A=S.paint.get("background-opacity");if(A===0)return;const M=f.context,B=M.gl,V=f.transform,U=V.tileSize,H=S.paint.get("background-pattern");if(f.isPatternMissing(H))return;const K=!H&&C.a===1&&A===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==K)return;const J=Xt.disabled,ee=f.depthModeForSublayer(0,K==="opaque"?St.ReadWrite:St.ReadOnly),q=f.colorModeForRenderPass(),se=f.useProgram(H?"backgroundPattern":"background"),le=k||V.coveringTiles({tileSize:U,terrain:f.style.map.terrain});H&&(M.activeTexture.set(B.TEXTURE0),f.imageManager.bind(f.context));const pe=S.getCrossfadeParameters();for(const xe of le){const Te=k?xe.posMatrix:f.transform.calculatePosMatrix(xe.toUnwrapped()),Oe=H?Tu(Te,A,f,H,{tileID:xe,tileSize:U},pe):Xa(Te,A,C),qe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(xe);se.draw(M,B.TRIANGLES,ee,J,q,Zt.disabled,Oe,qe,S.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(e,0,u,c);break;case"custom":(function(f,x,S){const k=f.context,C=S.implementation;if(f.renderPass==="offscreen"){const A=C.prerender;A&&(f.setCustomLayerDefaults(),k.setColorMode(f.colorModeForRenderPass()),A.call(C,k.gl,f.transform.customLayerMatrix()),k.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),k.setColorMode(f.colorModeForRenderPass()),k.setStencilMode(Xt.disabled);const A=C.renderingMode==="3d"?new St(f.context.gl.LEQUAL,St.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,St.ReadOnly);k.setDepthMode(A),C.render(k.gl,f.transform.customLayerMatrix(),{farZ:f.transform.farZ,nearZ:f.transform.nearZ,fov:f.transform._fov,modelViewProjectionMatrix:f.transform.modelViewProjectionMatrix,projectionMatrix:f.transform.projectionMatrix}),k.setDirty(),f.setBaseState(),k.bindFramebuffer.set(null)}})(e,0,u)}}translatePosMatrix(e,o,u,c,f){if(!u[0]&&!u[1])return e;const x=f?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(x){const C=Math.sin(x),A=Math.cos(x);u=[u[0]*A-u[1]*C,u[0]*C+u[1]*A]}const S=[f?u[0]:It(o,u[0],this.transform.zoom),f?u[1]:It(o,u[1],this.transform.zoom),0],k=new Float32Array(16);return d.J(k,e,S),k}saveTileTexture(e){const o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const o=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!o||!u}useProgram(e,o){this.cache=this.cache||{};const u=e+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new bu(this.context,os[e],o,ku[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new mt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}class lo{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,u){const c=Math.pow(2,u),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const k=1/(S=d.af([],S,e))[3]/o*c;return d.b1(S,S,[k,k,1/S[3],k])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const k=function(B,V){var U=V[0],H=V[1],K=V[2],J=U*U+H*H+K*K;return J>0&&(J=1/Math.sqrt(J)),B[0]=V[0]*J,B[1]=V[1]*J,B[2]=V[2]*J,B}([],function(B,V,U){var H=V[0],K=V[1],J=V[2],ee=U[0],q=U[1],se=U[2];return B[0]=K*se-J*q,B[1]=J*ee-H*se,B[2]=H*q-K*ee,B}([],Fe([],f[S[0]],f[S[1]]),Fe([],f[S[2]],f[S[1]]))),C=-((A=k)[0]*(M=f[S[1]])[0]+A[1]*M[1]+A[2]*M[2]);var A,M;return k.concat(C)});return new lo(f,x)}}class uo{constructor(e,o){this.min=e,this.max=o,this.center=function(u,c,f){return u[0]=.5*c[0],u[1]=.5*c[1],u[2]=.5*c[2],u}([],function(u,c,f){return u[0]=c[0]+f[0],u[1]=c[1]+f[1],u[2]=c[2]+f[2],u}([],this.min,this.max))}quadrant(e){const o=[e%2==0,e<2],u=je(this.min),c=je(this.max);for(let f=0;f<o.length;f++)u[f]=o[f]?this.min[f]:this.center[f],c[f]=o[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new uo(u,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let c=0;c<e.planes.length;c++){const f=e.planes[c];let x=0;for(let S=0;S<o.length;S++)d.b2(f,o[S])>=0&&x++;if(x===0)return 0;x!==o.length&&(u=!1)}if(u)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let S=0;S<e.points.length;S++){const k=e.points[S][c]-this.min[c];f=Math.min(f,k),x=Math.max(x,k)}if(x<0||f>this.max[c]-this.min[c])return 0}return 1}}class co{constructor(e=0,o=0,u=0,c=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=u,this.right=c}interpolate(e,o,u){return o.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,o.top,u)),o.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,o.bottom,u)),o.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,o.left,u)),o.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,o.right,u)),this}getCenter(e,o){const u=d.ac((this.left+e-this.right)/2,0,e),c=d.ac((this.top+o-this.bottom)/2,0,o);return new d.P(u,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new co(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Nu=85.051129;class ho{constructor(e,o,u,c,f){this.tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=e||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new co,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new ho(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const o=-d.b3(e,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var u=new d.A(4);return d.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,c,f){var x=c[0],S=c[1],k=c[2],C=c[3],A=Math.sin(f),M=Math.cos(f);u[0]=x*M+k*A,u[1]=S*M+C*A,u[2]=x*-A+k*M,u[3]=S*-A+C*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const o=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const o=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,u){this._unmodified=!1,this._edgeInsets.interpolate(e,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const o=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(e){const o=[new d.b4(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new d.P(0,0)),c=this.pointCoordinate(new d.P(this.width,0)),f=this.pointCoordinate(new d.P(this.width,this.height)),x=this.pointCoordinate(new d.P(0,this.height)),S=Math.floor(Math.min(u.x,c.x,f.x,x.x)),k=Math.floor(Math.max(u.x,c.x,f.x,x.x)),C=1;for(let A=S-C;A<=k+C;A++)A!==0&&o.push(new d.b4(A,e))}return o}coveringTiles(e){var o,u;let c=this.coveringZoomLevel(e);const f=c;if(e.minzoom!==void 0&&c<e.minzoom)return[];e.maxzoom!==void 0&&c>e.maxzoom&&(c=e.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),S=d.Z.fromLngLat(this.center),k=Math.pow(2,c),C=[k*x.x,k*x.y,0],A=[k*S.x,k*S.y,0],M=lo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,c);let B=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=c);const V=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,U=q=>({aabb:new uo([q*k,0,0],[(q+1)*k,k,0]),zoom:0,x:0,y:0,wrap:q,fullyVisible:!1}),H=[],K=[],J=c,ee=e.reparseOverscaled?f:c;if(this._renderWorldCopies)for(let q=1;q<=3;q++)H.push(U(-q)),H.push(U(q));for(H.push(U(0));H.length>0;){const q=H.pop(),se=q.x,le=q.y;let pe=q.fullyVisible;if(!pe){const Ae=q.aabb.intersects(M);if(Ae===0)continue;pe=Ae===2}const xe=e.terrain?C:A,Te=q.aabb.distanceX(xe),Oe=q.aabb.distanceY(xe),qe=Math.max(Math.abs(Te),Math.abs(Oe));if(q.zoom===J||qe>V+(1<<J-q.zoom)-2&&q.zoom>=B){const Ae=J-q.zoom,Pe=C[0]-.5-(se<<Ae),Ke=C[1]-.5-(le<<Ae);K.push({tileID:new d.S(q.zoom===J?ee:q.zoom,q.wrap,q.zoom,se,le),distanceSq:Ye([A[0]-.5-se,A[1]-.5-le]),tileDistanceToCamera:Math.sqrt(Pe*Pe+Ke*Ke)})}else for(let Ae=0;Ae<4;Ae++){const Pe=(se<<1)+Ae%2,Ke=(le<<1)+(Ae>>1),dt=q.zoom+1;let Re=q.aabb.quadrant(Ae);if(e.terrain){const Ue=new d.S(dt,q.wrap,dt,Pe,Ke),ct=e.terrain.getMinMaxElevation(Ue),er=(o=ct.minElevation)!==null&&o!==void 0?o:this.elevation,vt=(u=ct.maxElevation)!==null&&u!==void 0?u:this.elevation;Re=new uo([Re.min[0],Re.min[1],er],[Re.max[0],Re.max[1],vt])}H.push({aabb:Re,zoom:dt,x:Pe,y:Ke,wrap:q.wrap,fullyVisible:pe})}}return K.sort((q,se)=>q.distanceSq-se.distanceSq).map(q=>q.tileID)}resize(e,o){this.width=e,this.height=o,this.pixelsToGLUnits=[2/e,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const o=d.ac(e.lat,-85.051129,Nu);return new d.P(d.O(e.lng)*this.worldSize,d.Q(o)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const o=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,e),f=e.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-f))return;const x=u+o-f,S=Math.cos(this._pitch)*this.cameraToCenterDistance/x/d.b5(1,c.lat),k=this.scaleZoom(S/this.tileSize);this._elevation=f,this._center=c,this.zoom=k}setLocationAtPoint(e,o){const u=this.pointCoordinate(o),c=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(e),x=new d.Z(f.x-(u.x-c.x),f.y-(u.y-c.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,o){return o?this.coordinatePoint(this.locationCoordinate(e),o.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,o){return this.coordinateLocation(this.pointCoordinate(e,o))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,o){if(o){const B=o.pointCoordinate(e);if(B!=null)return B}const u=[e.x,e.y,0,1],c=[e.x,e.y,1,1];d.af(u,u,this.pixelMatrixInverse),d.af(c,c,this.pixelMatrixInverse);const f=u[3],x=c[3],S=u[1]/f,k=c[1]/x,C=u[2]/f,A=c[2]/x,M=C===A?0:(0-C)/(A-C);return new d.Z(d.y.number(u[0]/f,c[0]/x,M)/this.worldSize,d.y.number(S,k,M)/this.worldSize)}coordinatePoint(e,o=0,u=this.pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,o,1];return d.af(c,c,u),new d.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new ge().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ge([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Nu])}calculateTileMatrix(e){const o=e.canonical,u=this.worldSize/this.zoomScale(o.z),c=o.x+Math.pow(2,o.z)*e.wrap,f=d.an(new Float64Array(16));return d.J(f,f,[c*u,o.y*u,0]),d.K(f,f,[u/d.X,u/d.X,1]),f}calculatePosMatrix(e,o=!1){const u=e.key,c=o?this._alignedPosMatrixCache:this._posMatrixCache;if(c[u])return c[u];const f=this.calculateTileMatrix(e);return d.L(f,o?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,f),c[u]=new Float32Array(f),c[u]}calculateFogMatrix(e){const o=e.key,u=this._fogMatrixCache;if(u[o])return u[o];const c=this.calculateTileMatrix(e);return d.L(c,this.fogMatrix,c),u[o]=new Float32Array(c),u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,o){o=d.ac(+o,this.minZoom,this.maxZoom);const u={center:new d.N(e.lng,e.lat),zoom:o};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const q=179.9999999999;c=[-q,q]}const f=this.tileSize*this.zoomScale(u.zoom);let x=0,S=f,k=0,C=f,A=0,M=0;const{x:B,y:V}=this.size;if(this.latRange){const q=this.latRange;x=d.Q(q[1])*f,S=d.Q(q[0])*f,S-x<V&&(A=V/(S-x))}c&&(k=d.b3(d.O(c[0])*f,0,f),C=d.b3(d.O(c[1])*f,0,f),C<k&&(C+=f),C-k<B&&(M=B/(C-k)));const{x:U,y:H}=this.project.call({worldSize:f},e);let K,J;const ee=Math.max(M||0,A||0);if(ee){const q=new d.P(M?(C+k)/2:U,A?(S+x)/2:H);return u.center=this.unproject.call({worldSize:f},q).wrap(),u.zoom+=this.scaleZoom(ee),u}if(this.latRange){const q=V/2;H-q<x&&(J=x+q),H+q>S&&(J=S-q)}if(c){const q=(k+C)/2;let se=U;this._renderWorldCopies&&(se=d.b3(U,q-f/2,q+f/2));const le=B/2;se-le<k&&(K=k+le),se+le>C&&(K=C-le)}if(K!==void 0||J!==void 0){const q=new d.P(K??U,J??H);u.center=this.unproject.call({worldSize:f},q).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=u,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,o=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let c=d.an(new Float64Array(16));d.K(c,c,[this.width/2,-this.height/2,1]),d.J(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=d.an(new Float64Array(16)),d.K(c,c,[1,-1,1]),d.J(c,c,[-1,-1,0]),d.K(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this.minElevationForCurrentTile),S=f-x*this._pixelPerMeter/Math.cos(this._pitch),k=x<0?S:f,C=Math.PI/2+this._pitch,A=this._fov*(.5+e.y/this.height),M=Math.sin(A)*k/Math.sin(d.ac(Math.PI-C-A,.01,Math.PI-.01)),B=this.getHorizon(),V=2*Math.atan(B/this.cameraToCenterDistance)*(.5+e.y/(2*B)),U=Math.sin(V)*k/Math.sin(d.ac(Math.PI-C-V,.01,Math.PI-.01)),H=Math.min(M,U);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*H+k),this.nearZ=this.height/50,c=new Float64Array(16),d.b6(c,this._fov,this.width/this.height,this.nearZ,this.farZ),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,this.projectionMatrix=d.ae(c),d.K(c,c,[1,-1,1]),d.J(c,c,[0,0,-this.cameraToCenterDistance]),d.b7(c,c,this._pitch),d.ad(c,c,this.angle),d.J(c,c,[-o,-u,0]),this.mercatorMatrix=d.K([],c,[this.worldSize,this.worldSize,this.worldSize]),d.K(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,c),d.J(c,c,[0,0,-this.elevation]),this.modelViewProjectionMatrix=c,this.invModelViewProjectionMatrix=d.as([],c),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,f,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-o,-u,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,c);const K=this.width%2/2,J=this.height%2/2,ee=Math.cos(this.angle),q=Math.sin(this.angle),se=o-Math.round(o)+ee*K+q*J,le=u-Math.round(u)+ee*J+q*K,pe=new Float64Array(c);if(d.J(pe,pe,[se>.5?se-1:se,le>.5?le-1:le,0]),this.alignedModelViewProjectionMatrix=pe,c=d.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const o=this.getCameraPoint();if(e.length===1)return[e[0],o];{let u=o.x,c=o.y,f=o.x,x=o.y;for(const S of e)u=Math.min(u,S.x),c=Math.min(c,S.y),f=Math.max(f,S.x),x=Math.max(x,S.y);return[new d.P(u,c),new d.P(f,c),new d.P(f,x),new d.P(u,x),new d.P(u,c)]}}lngLatToCameraDepth(e,o){const u=this.locationCoordinate(e),c=[u.x*this.worldSize,u.y*this.worldSize,o,1];return d.af(c,c,this.modelViewProjectionMatrix),c[2]/c[3]}}function ua(m,e){let o,u=!1,c=null,f=null;const x=()=>{c=null,u&&(m.apply(f,o),c=setTimeout(x,e),u=!1)};return(...S)=>(u=!0,f=this,o=S,c||x(),c)}class ol{constructor(e){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(u=c)}),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const u=o.join("/");let c=u;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${u}`);let f=window.location.hash.replace(c,"");f.startsWith("#&")?f=f.slice(0,1)+f.slice(2):f==="#"&&(f="");let x=window.location.href.replace(/(#.+)?$/,f);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=ua(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,c=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,c),x=Math.round(o.lng*f)/f,S=Math.round(o.lat*f)/f,k=this._map.getBearing(),C=this._map.getPitch();let A="";if(A+=e?`/${x}/${S}/${u}`:`${u}/${S}/${x}`,(k||C)&&(A+="/"+Math.round(10*k)/10),C&&(A+=`/${Math.round(C)}`),this._hashName){const M=this._hashName;let B=!1;const V=window.location.hash.slice(1).split("&").map(U=>{const H=U.split("=")[0];return H===M?(B=!0,`${H}=${A}`):U}).filter(U=>U);return B||V.push(`${M}=${A}`),`#${V.join("&")}`}return`#${A}`}}const al={linearity:.3,easing:d.b8(0,0,.3,1)},Vu=d.e({deceleration:2500,maxSpeed:1400},al),gf=d.e({deceleration:20,maxSpeed:1400},al),jh=d.e({deceleration:1e3,maxSpeed:360},al),ll=d.e({deceleration:1e3,maxSpeed:90},al);class ju{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:te.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,o=te.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)o.zoom+=f.zoomDelta||0,o.bearing+=f.bearingDelta||0,o.pitch+=f.pitchDelta||0,f.panDelta&&o.pan._add(f.panDelta),f.around&&(o.around=f.around),f.pinchAround&&(o.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(o.pan.mag()){const f=ha(o.pan.mag(),u,d.e({},Vu,e||{}));c.offset=o.pan.mult(f.amount/o.pan.mag()),c.center=this._map.transform.center,ca(c,f)}if(o.zoom){const f=ha(o.zoom,u,gf);c.zoom=this._map.transform.zoom+f.amount,ca(c,f)}if(o.bearing){const f=ha(o.bearing,u,jh);c.bearing=this._map.transform.bearing+d.ac(f.amount,-179,179),ca(c,f)}if(o.pitch){const f=ha(o.pitch,u,ll);c.pitch=this._map.transform.pitch+f.amount,ca(c,f)}if(c.zoom||c.bearing){const f=o.pinchAround===void 0?o.around:o.pinchAround;c.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),d.e(c,{noMoveStart:!0})}}function ca(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function ha(m,e,o){const{maxSpeed:u,linearity:c,deceleration:f}=o,x=d.ac(m*c/(e/1e3),-u,u),S=Math.abs(x)/(f*c);return{easing:o.easing,duration:1e3*S,amount:x*(S/2)}}class Gr extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u,c={}){const f=$.mousePos(o.getCanvas(),u),x=o.unproject(f);super(e,d.e({point:f,lngLat:x,originalEvent:u},c)),this._defaultPrevented=!1,this.target=o}}class Ms extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){const c=e==="touchend"?u.changedTouches:u.touches,f=$.touchPos(o.getCanvasContainer(),c),x=f.map(k=>o.unproject(k)),S=f.reduce((k,C,A,M)=>k.add(C.div(M.length)),new d.P(0,0));super(e,{points:f,point:S,lngLats:x,lngLat:o.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class Uh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class $h{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Uh(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new Gr(e.type,this._map,e))}mouseup(e){this._map.fire(new Gr(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Gr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Gr(e.type,this._map,e))}mouseover(e){this._map.fire(new Gr(e.type,this._map,e))}mouseout(e){this._map.fire(new Gr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ms(e.type,this._map,e))}touchmove(e){this._map.fire(new Ms(e.type,this._map,e))}touchend(e){this._map.fire(new Ms(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ms(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Gr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Gr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class on{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class Pi{constructor(e,o){this._map=e,this._tr=new on(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&($.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=u,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const f=Math.min(c.x,u.x),x=Math.max(c.x,u.x),S=Math.min(c.y,u.y),k=Math.max(c.y,u.y);$.setTransform(this._box,`translate(${f}px,${S}px)`),this._box.style.width=x-f+"px",this._box.style.height=k-S+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;const u=this._startPos,c=o;if(this.reset(),$.suppressClick(),u.x!==c.x||u.y!==c.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:f=>f.fitScreenCoordinates(u,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new d.k(e,{originalEvent:o}))}}function da(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const o={};for(let u=0;u<m.length;u++)o[m[u].identifier]=e[u];return o}class Uu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(c){const f=new d.P(0,0);for(const x of c)f._add(x);return f.div(c.length)}(o),this.touches=da(u,o)))}touchmove(e,o,u){if(this.aborted||!this.centroid)return;const c=da(u,o);for(const f in this.touches){const x=c[f];(!x||x.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(e,o,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class ul{constructor(e){this.singleTap=new Uu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,u){this.singleTap.touchstart(e,o,u)}touchmove(e,o,u){this.singleTap.touchmove(e,o,u)}touchend(e,o,u){const c=this.singleTap.touchend(e,o,u);if(c){const f=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(c)<30;if(f&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class po{constructor(e){this._tr=new on(e),this._zoomIn=new ul({numTouches:1,numTaps:2}),this._zoomOut=new ul({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,u){this._zoomIn.touchstart(e,o,u),this._zoomOut.touchstart(e,o,u)}touchmove(e,o,u){this._zoomIn.touchmove(e,o,u),this._zoomOut.touchmove(e,o,u)}touchend(e,o,u){const c=this._zoomIn.touchend(e,o,u),f=this._zoomOut.touchend(e,o,u),x=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(c)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=o.length?o[0]:o;return!this._moved&&c.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(u,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&$.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const $u={0:1,2:2};class cl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const o=$.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(o,u){const c=$u[u];return o.buttons===void 0||(o.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return $.mouseButton(e)===this._eventButton}}class qu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const hl=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}},Zu=({enable:m,clickTolerance:e,bearingDegreesPerPixelMoved:o=.8})=>{const u=new cl({checkCorrectEvent:c=>$.mouseButton(c)===0&&c.ctrlKey||$.mouseButton(c)===2});return new qn({clickTolerance:e,move:(c,f)=>({bearingDelta:(f.x-c.x)*o}),moveStateManager:u,enable:m,assignEvents:hl})},Gu=({enable:m,clickTolerance:e,pitchDegreesPerPixelMoved:o=-.5})=>{const u=new cl({checkCorrectEvent:c=>$.mouseButton(c)===0&&c.ctrlKey||$.mouseButton(c)===2});return new qn({clickTolerance:e,move:(c,f)=>({pitchDelta:(f.y-c.y)*o}),moveStateManager:u,enable:m,assignEvents:hl})};class zs{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,u){return this._calculateTransform(e,o,u)}touchmove(e,o,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,o,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,u){this._calculateTransform(e,o,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,u){u.length>0&&(this._active=!0);const c=da(u,o),f=new d.P(0,0),x=new d.P(0,0);let S=0;for(const C in c){const A=c[C],M=this._touches[C];M&&(f._add(A),x._add(A.sub(M)),S++,c[C]=A)}if(this._touches=c,this._shouldBePrevented(S)||!x.mag())return;const k=x.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(S),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,u){if(!this._firstTwoTouches)return;e.preventDefault();const[c,f]=this._firstTwoTouches,x=pa(u,o,c),S=pa(u,o,f);if(!x||!S)return;const k=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],k,e)}touchend(e,o,u){if(!this._firstTwoTouches)return;const[c,f]=this._firstTwoTouches,x=pa(u,o,c),S=pa(u,o,f);x&&S||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function pa(m,e,o){for(let u=0;u<m.length;u++)if(m[u].identifier===o)return e[u]}function Hu(m,e){return Math.log(m/e)/Math.LN2}class Wu extends dl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Hu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hu(this._distance,u),pinchAround:o}}}function Xu(m,e){return 180*m.angleWith(e)/Math.PI}class Ku extends dl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,u){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Xu(this._vector,c),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const o=25/(Math.PI*this._minDiameter)*360,u=Xu(e,this._startVector);return Math.abs(u)<o}}function pl(m){return Math.abs(m.y)>Math.abs(m.x)}class fa extends dl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,u){super.touchstart(e,o,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,pl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),f=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,f,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,u){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,f=o.mag()>=2;if(!c&&!f)return;if(!c||!f)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=e.y>0==o.y>0;return pl(e)&&pl(o)&&x}}const qh={panStep:100,bearingStep:15,pitchStep:10};class Ui{constructor(e){this._tr=new on(e);const o=qh;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,u=0,c=0,f=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,c=0),{cameraAnimation:S=>{const k=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:En,zoom:o?Math.round(k.zoom)+o*(e.shiftKey?2:1):k.zoom,bearing:k.bearing+u*this._bearingStep,pitch:k.pitch+c*this._pitchStep,offset:[-f*this._panStep,-x*this._panStep],center:k.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function En(m){return m*(2-m)}const Ju=4.000244140625;class an{constructor(e,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new on(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=te.now(),c=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Ju==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=$.mousePos(this._map.getCanvas(),e),u=this._tr;this._around=o.y>u.transform.height/2-u.transform.getHorizon()?d.N.convert(this._aroundCenter?u.center:u.unproject(o)):d.N.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Ju?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&C!==0&&(C=1/C);const A=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(A*C))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,c=this._easing;let f,x=!1;const S=te.now()-this._lastWheelEventTime;if(this._type==="wheel"&&u&&c&&S){const k=Math.min(S/200,1),C=c(k);f=d.y.number(u,o,C),k<1?this._frameId||(this._frameId=!0):x=!0}else f=o,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=d.b9;if(this._prevEase){const u=this._prevEase,c=(te.now()-u.start)/u.duration,f=u.easing(c+.01)-u.easing(c),x=.27/Math.sqrt(f*f+1e-4)*.01,S=Math.sqrt(.0729-x*x);o=d.b8(x,S,.25,1)}return this._prevEase={start:te.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ds{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yf{constructor(e){this._tr=new on(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _f{constructor(){this._tap=new ul({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,u){if(!this._swipePoint)if(this._tapTime){const c=o[0],f=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(c)<30;f&&x?u.length>0&&(this._swipePoint=c,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,o,u)}touchmove(e,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const c=o[0],f=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(e,o,u)}touchend(e,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const c=this._tap.touchend(e,o,u);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zh{constructor(e,o,u){this._el=e,this._mousePan=o,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gh{constructor(e,o,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Yu{constructor(e,o,u,c){this._el=e,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class fo{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=$.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=o,this._container.appendChild(c);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=u,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&($.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const $i=m=>m.zoom||m.drag||m.pitch||m.rotate;class Ge extends d.k{}function fl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Qu{constructor(e,o){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,f)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=c.type==="renderFrame"?void 0:c,S={needsRenderFrame:!1},k={},C={},A=c.touches,M=A?this._getMapTouches(A):void 0,B=M?$.touchPos(this._map.getCanvas(),M):$.mousePos(this._map.getCanvas(),c);for(const{handlerName:H,handler:K,allowed:J}of this._handlers){if(!K.isEnabled())continue;let ee;this._blockedByActive(C,J,H)?K.reset():K[f||c.type]&&(ee=K[f||c.type](c,B,M),this.mergeHandlerResult(S,k,ee,H,x),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||K.isActive())&&(C[H]=K)}const V={};for(const H in this._previousActiveHandlers)C[H]||(V[H]=x);this._previousActiveHandlers=C,(Object.keys(V).length||fl(S))&&(this._changes.push([S,k,V]),this._triggerRenderFrame()),(Object.keys(C).length||fl(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=S;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ju(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,f,x]of this._listeners)$.addEventListener(c,f,c===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[e,o,u]of this._listeners)$.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new $h(o,e));const c=o.boxZoom=new Pi(o,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const f=o.cooperativeGestures=new fo(o,e.cooperativeGestures);this._add("cooperativeGestures",f),e.cooperativeGestures&&f.enable();const x=new po(o),S=new yf(o);o.doubleClickZoom=new Ds(S,x),this._add("tapZoom",x),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();const k=new _f;this._add("tapDragZoom",k);const C=o.touchPitch=new fa(o);this._add("touchPitch",C),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);const A=Zu(e),M=Gu(e);o.dragRotate=new Gh(e,A,M),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();const B=(({enable:ee,clickTolerance:q})=>{const se=new cl({checkCorrectEvent:le=>$.mouseButton(le)===0&&!le.ctrlKey});return new qn({clickTolerance:q,move:(le,pe)=>({around:pe,panDelta:pe.sub(le)}),activateOnStart:!0,moveStateManager:se,enable:ee,assignEvents:hl})})(e),V=new zs(e,o);o.dragPan=new Zh(u,B,V),this._add("mousePan",B),this._add("touchPan",V,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);const U=new Ku,H=new Wu;o.touchZoomRotate=new Yu(u,H,U,k),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);const K=o.scrollZoom=new an(o,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);const J=o.keyboard=new Ui(o);this._add("keyboard",J),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new pr(o))}_add(e,o,u){this._handlers.push({handlerName:e,handler:o,allowed:u}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$i(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,u){for(const c in e)if(c!==u&&(!o||o.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const o=[];for(const u of e)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(e,o,u,c,f){if(!u)return;d.e(e,u);const x={handlerName:c,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(o.zoom=x),u.panDelta!==void 0&&(o.drag=x),u.pitchDelta!==void 0&&(o.pitch=x),u.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){const e={},o={},u={};for(const[c,f,x]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),d.e(o,f),d.e(u,x);this._updateMapTransform(e,o,u),this._changes=[]}_updateMapTransform(e,o,u){const c=this._map,f=c._getTransformForUpdate(),x=c.terrain;if(!(fl(e)||x&&this._terrainMovement))return this._fireEvents(o,u,!0);let{panDelta:S,zoomDelta:k,bearingDelta:C,pitchDelta:A,around:M,pinchAround:B}=e;B!==void 0&&(M=B),c._stop(!0),M=M||c.transform.centerPoint;const V=f.pointLocation(S?M.sub(S):M);C&&(f.bearing+=C),A&&(f.pitch+=A),k&&(f.zoom+=k),x?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(S)):f.setLocationAtPoint(V,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(V,M)):f.setLocationAtPoint(V,M),c._applyUpdatedTransform(f),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,u,!0)}_fireEvents(e,o,u){const c=$i(this._eventsInProgress),f=$i(e),x={};for(const M in e){const{originalEvent:B}=e[M];this._eventsInProgress[M]||(x[`${M}start`]=B),this._eventsInProgress[M]=e[M]}!c&&f&&this._fireEvent("movestart",f.originalEvent);for(const M in x)this._fireEvent(M,x[M]);f&&this._fireEvent("move",f.originalEvent);for(const M in e){const{originalEvent:B}=e[M];this._fireEvent(M,B)}const S={};let k;for(const M in this._eventsInProgress){const{handlerName:B,originalEvent:V}=this._eventsInProgress[M];this._handlersById[B].isActive()||(delete this._eventsInProgress[M],k=o[B]||V,S[`${M}end`]=k)}for(const M in S)this._fireEvent(M,S[M]);const C=$i(this._eventsInProgress),A=(c||f)&&!C;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const M=this._map._getTransformForUpdate();M.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(M)}if(u&&A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!M||!M.essential&&te.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:k})),B(this._map.getBearing())&&this._map.resetNorth()):(B(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new d.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Ge("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Hh extends d.E{constructor(e,o){super(),this._renderFrameCallback=()=>{const u=Math.min((te.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}panBy(e,o,u){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},o),u)}panTo(e,o,u){return this.easeTo(d.e({center:e},o),u)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,u){return this.easeTo(d.e({zoom:e},o),u)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,u){return this.easeTo(d.e({bearing:e},o),u)}resetNorth(e,o){return this.rotateTo(0,d.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}cameraForBounds(e,o){e=ge.convert(e).adjustAntiMeridian();const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,o)}_cameraForBoxAndBearing(e,o,u,c){const f={top:0,bottom:0,right:0,left:0};if(typeof(c=d.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const Ae=c.padding;c.padding={top:Ae,bottom:Ae,right:Ae,left:Ae}}c.padding=d.e(f,c.padding);const x=this.transform,S=x.padding,k=new ge(e,o),C=x.project(k.getNorthWest()),A=x.project(k.getNorthEast()),M=x.project(k.getSouthEast()),B=x.project(k.getSouthWest()),V=d.ba(-u),U=C.rotate(V),H=A.rotate(V),K=M.rotate(V),J=B.rotate(V),ee=new d.P(Math.max(U.x,H.x,J.x,K.x),Math.max(U.y,H.y,J.y,K.y)),q=new d.P(Math.min(U.x,H.x,J.x,K.x),Math.min(U.y,H.y,J.y,K.y)),se=ee.sub(q),le=(x.width-(S.left+S.right+c.padding.left+c.padding.right))/se.x,pe=(x.height-(S.top+S.bottom+c.padding.top+c.padding.bottom))/se.y;if(pe<0||le<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const xe=Math.min(x.scaleZoom(x.scale*Math.min(le,pe)),c.maxZoom),Te=d.P.convert(c.offset),Oe=new d.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(d.ba(u)),qe=Te.add(Oe).mult(x.scale/x.zoomScale(xe));return{center:x.unproject(C.add(M).div(2).sub(qe)),zoom:xe,bearing:u}}fitBounds(e,o,u){return this._fitInternal(this.cameraForBounds(e,o),o,u)}fitScreenCoordinates(e,o,u,c,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(o)),u,c),c,f)}_fitInternal(e,o,u){return e?(delete(o=d.e(e,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(e,o){this.stop();const u=this._getTransformForUpdate();let c=!1,f=!1,x=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(c=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=d.N.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(f=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(x=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this._applyUpdatedTransform(u),this.fire(new d.k("movestart",o)).fire(new d.k("move",o)),c&&this.fire(new d.k("zoomstart",o)).fire(new d.k("zoom",o)).fire(new d.k("zoomend",o)),f&&this.fire(new d.k("rotatestart",o)).fire(new d.k("rotate",o)).fire(new d.k("rotateend",o)),x&&this.fire(new d.k("pitchstart",o)).fire(new d.k("pitch",o)).fire(new d.k("pitchend",o)),this.fire(new d.k("moveend",o))}calculateCameraOptionsFromTo(e,o,u,c=0){const f=d.Z.fromLngLat(e,o),x=d.Z.fromLngLat(u,c),S=x.x-f.x,k=x.y-f.y,C=x.z-f.z,A=Math.hypot(S,k,C);if(A===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(S,k),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),V=180*Math.atan2(S,-k)/Math.PI;let U=180*Math.acos(M/A)/Math.PI;return U=C<0?90-U:90+U,{center:x.toLngLat(),zoom:B,pitch:U,bearing:V}}easeTo(e,o){var u;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&te.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),f=c.zoom,x=c.bearing,S=c.pitch,k=c.padding,C="bearing"in e?this._normalizeBearing(e.bearing,x):x,A="pitch"in e?+e.pitch:S,M="padding"in e?e.padding:c.padding,B=d.P.convert(e.offset);let V=c.centerPoint.add(B);const U=c.pointLocation(V),{center:H,zoom:K}=c.getConstrained(d.N.convert(e.center||U),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(H,c);const J=c.project(U),ee=c.project(H).sub(J),q=c.zoomScale(K-f);let se,le;e.around&&(se=d.N.convert(e.around),le=c.locationPoint(se));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==f,this._rotating=this._rotating||x!==C,this._pitching=this._pitching||A!==S,this._padding=!c.isPaddingEqual(M),this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,pe),this.terrain&&this._prepareElevation(H),this._ease(xe=>{if(this._zooming&&(c.zoom=d.y.number(f,K,xe)),this._rotating&&(c.bearing=d.y.number(x,C,xe)),this._pitching&&(c.pitch=d.y.number(S,A,xe)),this._padding&&(c.interpolatePadding(k,M,xe),V=c.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(xe),se)c.setLocationAtPoint(se,le);else{const Te=c.zoomScale(c.zoom-f),Oe=K>f?Math.min(2,q):Math.max(.5,q),qe=Math.pow(Oe,1-xe),Ae=c.unproject(J.add(ee.mult(xe*qe)).mult(Te));c.setLocationAtPoint(c.renderWorldCopies?Ae.wrap():Ae,V)}this._applyUpdatedTransform(c),this._fireMoveEvents(o)},xe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,xe)},e),this}_prepareEase(e,o,u={}){this._moving=!0,o||u.moving||this.fire(new d.k("movestart",e)),this._zooming&&!u.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(o-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const o=e.getCameraPosition(),u=this.terrain.getElevationForLngLatZoom(o.lngLat,e.zoom);if(o.altitude<u){const c=this.calculateCameraOptionsFromTo(o.lngLat,u,e.center,e.elevation);return{pitch:c.pitch,zoom:c.zoom}}return{}}_applyUpdatedTransform(e){const o=[];if(this.terrain&&o.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&o.push(c=>this.transformCameraUpdate(c)),!o.length)return;const u=e.clone();for(const c of o){const f=u.clone(),{center:x,zoom:S,pitch:k,bearing:C,elevation:A}=c(f);x&&(f.center=x),S!==void 0&&(f.zoom=S),k!==void 0&&(f.pitch=k),C!==void 0&&(f.bearing=C),A!==void 0&&(f.elevation=A),u.apply(f)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const u=this._zooming,c=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new d.k("zoomend",e)),c&&this.fire(new d.k("rotateend",e)),f&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,o){var u;if(!e.essential&&te.prefersReducedMotion){const Ue=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ue,o)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const c=this._getTransformForUpdate(),f=c.zoom,x=c.bearing,S=c.pitch,k=c.padding,C="bearing"in e?this._normalizeBearing(e.bearing,x):x,A="pitch"in e?+e.pitch:S,M="padding"in e?e.padding:c.padding,B=d.P.convert(e.offset);let V=c.centerPoint.add(B);const U=c.pointLocation(V),{center:H,zoom:K}=c.getConstrained(d.N.convert(e.center||U),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(H,c);const J=c.zoomScale(K-f),ee=c.project(U),q=c.project(H).sub(ee);let se=e.curve;const le=Math.max(c.width,c.height),pe=le/J,xe=q.mag();if("minZoom"in e){const Ue=d.ac(Math.min(e.minZoom,f,K),c.minZoom,c.maxZoom),ct=le/c.zoomScale(Ue-f);se=Math.sqrt(ct/xe*2)}const Te=se*se;function Oe(Ue){const ct=(pe*pe-le*le+(Ue?-1:1)*Te*Te*xe*xe)/(2*(Ue?pe:le)*Te*xe);return Math.log(Math.sqrt(ct*ct+1)-ct)}function qe(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function Ae(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const Pe=Oe(!1);let Ke=function(Ue){return Ae(Pe)/Ae(Pe+se*Ue)},dt=function(Ue){return le*((Ae(Pe)*(qe(ct=Pe+se*Ue)/Ae(ct))-qe(Pe))/Te)/xe;var ct},Re=(Oe(!0)-Pe)/se;if(Math.abs(xe)<1e-6||!isFinite(Re)){if(Math.abs(le-pe)<1e-6)return this.easeTo(e,o);const Ue=pe<le?-1:1;Re=Math.abs(Math.log(pe/le))/se,dt=()=>0,Ke=ct=>Math.exp(Ue*se*ct)}return e.duration="duration"in e?+e.duration:1e3*Re/("screenSpeed"in e?+e.screenSpeed/se:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=x!==C,this._pitching=A!==S,this._padding=!c.isPaddingEqual(M),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(H),this._ease(Ue=>{const ct=Ue*Re,er=1/Ke(ct);c.zoom=Ue===1?K:f+c.scaleZoom(er),this._rotating&&(c.bearing=d.y.number(x,C,Ue)),this._pitching&&(c.pitch=d.y.number(S,A,Ue)),this._padding&&(c.interpolatePadding(k,M,Ue),V=c.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ue);const vt=Ue===1?H:c.unproject(ee.add(q.mult(dt(ct))).mult(er));c.setLocationAtPoint(c.renderWorldCopies?vt.wrap():vt,V),this._applyUpdatedTransform(c),this._fireMoveEvents(o)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,o)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,o,u){u.animate===!1||u.duration===0?(e(1),o()):(this._easeStart=te.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=d.b3(e,-180,180);const u=Math.abs(e-o);return Math.abs(e-360-o)<u&&(e-=360),Math.abs(e+360-o)<u&&(e+=360),e}_normalizeCenter(e,o){if(!o.renderWorldCopies||o.lngRange)return;const u=e.lng-o.center.lng;e.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const mo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class go{constructor(e=mo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){const u=this._map._getUIString(`AttributionControl.${o}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const o=this._map.style.sourceCaches;for(const c in o){const f=o[c];if(f.used||f.usedForTerrain){const x=f.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,f)=>c.length-f.length),e=e.filter((c,f)=>{for(let x=f+1;x<e.length;x++)if(e[x].indexOf(c)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ec{constructor(e={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");const o=$.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Pt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const c of u)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var tc=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class vf extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];const u={};for(const c of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))u[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),d.aP(c.posMatrix,0,d.X,0,d.X,0,1),this._tiles[c.key]=new ns(c,this.tileSize));for(const c in this._tiles)u[c]||delete this._tiles[c]}freeRtt(e){for(const o in this._tiles){const u=this._tiles[o];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const o={};for(const u of this._renderableTilesKeys){const c=this._tiles[u].tileID;if(c.canonical.equals(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16),d.aP(f.posMatrix,0,d.X,0,d.X,0,1),o[u]=f}else if(c.canonical.isChildOf(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const x=c.canonical.z-e.canonical.z,S=c.canonical.x-(c.canonical.x>>x<<x),k=c.canonical.y-(c.canonical.y>>x<<x),C=d.X>>x;d.aP(f.posMatrix,0,C,0,C,0,1),d.J(f.posMatrix,f.posMatrix,[-S*C,-k*C,0]),o[u]=f}else if(e.canonical.isChildOf(c.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const x=e.canonical.z-c.canonical.z,S=e.canonical.x-(e.canonical.x>>x<<x),k=e.canonical.y-(e.canonical.y>>x<<x),C=d.X>>x;d.aP(f.posMatrix,0,d.X,0,d.X,0,1),d.J(f.posMatrix,f.posMatrix,[S*C,k*C,0]),d.K(f.posMatrix,f.posMatrix,[1/2**x,1/2**x,0]),o[u]=f}}return o}getSourceTile(e,o){const u=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>u.maxzoom&&(c=u.maxzoom),c<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!f||!f.dem)&&o)for(;c>=u.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(e.scaledTo(c--).key);return f}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=e)}}class rc{constructor(e,o,u){this.painter=e,this.sourceCache=new vf(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,u,c=d.X){var f;if(!(o>=0&&o<c&&u>=0&&u<c))return 0;const x=this.getTerrainData(e),S=(f=x.tile)===null||f===void 0?void 0:f.dem;if(!S)return 0;const k=function(U,H,K){var J=H[0],ee=H[1];return U[0]=K[0]*J+K[4]*ee+K[12],U[1]=K[1]*J+K[5]*ee+K[13],U}([],[o/c*d.X,u/c*d.X],x.u_terrain_matrix),C=[k[0]*S.dim,k[1]*S.dim],A=Math.floor(C[0]),M=Math.floor(C[1]),B=C[0]-A,V=C[1]-M;return S.get(A,M)*(1-B)*(1-V)+S.get(A+1,M)*B*(1-V)+S.get(A,M+1)*(1-B)*V+S.get(A+1,M+1)*B*V}getElevationForLngLatZoom(e,o){if(!d.bb(o,e.wrap()))return 0;const{tileID:u,mercatorX:c,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(u,c%d.X,f%d.X,d.X)}getElevation(e,o,u,c=d.X){return this.getDEMElevation(e,o,u,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,f=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new mt(c,f,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new mt(c,new d.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const c=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new mt(c,o.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),o.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const u=o&&o+o.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const c=this.sourceCache.sourceCache._source.maxzoom;let f=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?f=e.canonical.z-c:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=e.canonical.x-(e.canonical.x>>f<<f),S=e.canonical.y-(e.canonical.y>>f<<f),k=d.bc(new Float64Array(16),[1/(d.X<<f),1/(d.X<<f),0]);d.J(k,k,[x*d.X,S*d.X,0]),this._demMatrixCache[e.key]={matrix:k,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){const o=this.painter,u=o.width/devicePixelRatio,c=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new mt(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new mt(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,c,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,x=0;f<this._coordsTextureSize;f++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)o[x+0]=255&S,o[x+1]=255&f,o[x+2]=S>>8<<4|f>>8,o[x+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),c=new mt(e,u,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),u=this.painter.context,c=u.gl,f=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(f,S-x-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);const k=o[0]+(o[2]>>4<<8),C=o[1]+((15&o[2])<<8),A=this.coordsIndex[255-o[3]],M=A&&this.sourceCache.getTileByID(A);if(!M)return null;const B=this._coordsTextureSize,V=(1<<M.tileID.canonical.z)*B;return new d.Z((M.tileID.canonical.x*B+k)/V+M.tileID.wrap,(M.tileID.canonical.y*B+C)/V,this.getElevation(M.tileID,k,C,B))}depthAtPoint(e){const o=new Uint8Array(4),u=this.painter.context,c=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,o=new d.bd,u=new d.aY,c=this.meshSize,f=d.X/c,x=c*c;for(let M=0;M<=c;M++)for(let B=0;B<=c;B++)o.emplaceBack(B*f,M*f,0);for(let M=0;M<x;M+=c+1)for(let B=0;B<c;B++)u.emplaceBack(B+M,c+B+M+1,c+B+M+2),u.emplaceBack(B+M,c+B+M+2,B+M+1);const S=o.length,k=S+2*(c+1);for(const M of[0,1])for(let B=0;B<=c;B++)for(const V of[0,1])o.emplaceBack(B*f,M*d.X,V);for(let M=0;M<2*c;M+=2)u.emplaceBack(k+M,k+M+1,k+M+3),u.emplaceBack(k+M,k+M+3,k+M+2),u.emplaceBack(S+M,S+M+3,S+M+1),u.emplaceBack(S+M,S+M+2,S+M+3);const C=o.length,A=C+2*(c+1);for(const M of[0,1])for(let B=0;B<=c;B++)for(const V of[0,1])o.emplaceBack(M*d.X,B*f,V);for(let M=0;M<2*c;M+=2)u.emplaceBack(C+M,C+M+1,C+M+3),u.emplaceBack(C+M,C+M+3,C+M+2),u.emplaceBack(A+M,A+M+3,A+M+1),u.emplaceBack(A+M,A+M+2,A+M+3);return this._mesh=new nl(e.createVertexBuffer(o,tc.members),e.createIndexBuffer(u),d.a0.simpleSegment(0,0,o.length,u.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,o){var u;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(u=this.getMinMaxElevation(c).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const o=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,o){const u=d.Z.fromLngLat(e.wrap()),c=(1<<o)*d.X,f=u.x*c,x=u.y*c,S=Math.floor(f/d.X),k=Math.floor(x/d.X);return{tileID:new d.S(o,0,o,S,k),mercatorX:f,mercatorY:x}}}class xf{constructor(e,o,u){this._context=e,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new mt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:e,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>e.id!==o),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const yo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Wh{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new xf(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(o)),this._coordsDescendingInv={};for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const c=e.sourceCaches[u].getVisibleCoordinates();for(const f of c){const x=this.terrain.sourceCache.getTerrainCoords(f);for(const S in x)this._coordsDescendingInv[u][S]||(this._coordsDescendingInv[u][S]=[]),this._coordsDescendingInv[u][S].push(x[S])}}this._coordsDescendingInvStr={};for(const u of e._order){const c=e._layers[u],f=c.source;if(yo[c.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const x in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][x]=this._coordsDescendingInv[f][x].map(S=>S.key).sort().join()}}for(const u of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[c][u.tileID.key];f&&f!==u.rttCoords[c]&&(u.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const o=e.type,u=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(yo[o]&&(this._prevType&&yo[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!c))return!0;if(yo[this._prevType]||yo[o]&&c){this._prevType=o;const f=this._stacks.length-1,x=this._stacks[f]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Vh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[f]){const C=this.pool.getObjectForId(S.rtt[f].id);if(C.stamp===S.rtt[f].stamp){this.pool.useObject(C);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),S.rtt[f]={id:k.id,stamp:k.stamp},u.context.bindFramebuffer.set(k.fbo.framebuffer),u.context.clear({color:d.aM.transparent,stencil:0}),u.currentStencilSource=void 0;for(let C=0;C<x.length;C++){const A=u.style._layers[x[C]],M=A.source?this._coordsDescendingInv[A.source][S.tileID.key]:[S.tileID];u.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),u._renderTileClippingMasks(A,M),u.renderLayer(u,u.style.sourceCaches[A.source],A,M),A.source&&(S.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][S.tileID.key])}}return Vh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),yo[o]}return!1}}const ic={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Xh=j,wf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:mo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},nc=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},bf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Sf{constructor(e,o,u=!1){this.mousedown=x=>{this.startMouse(d.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),$.mousePos(this.element,x)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,$.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=e.dragRotate._mouseRotate.getClickTolerance(),f=e.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=Zu({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:S,bearingDegreesPerPixelMoved:k=.8})=>{const C=new qu;return new qn({clickTolerance:S,move:(A,M)=>({bearingDelta:(M.x-A.x)*k}),moveStateManager:C,enable:x,assignEvents:nc})})({clickTolerance:c,enable:!0}),this.map=e,u&&(this.mousePitch=Gu({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:S,pitchDegreesPerPixelMoved:k=-.5})=>{const C=new qu;return new qn({clickTolerance:S,move:(A,M)=>({pitchDelta:(M.y-A.y)*k}),moveStateManager:C,enable:x,assignEvents:nc})})({clickTolerance:f,enable:!0})),$.addEventListener(o,"mousedown",this.mousedown),$.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(o,"touchcancel",this.reset)}startMouse(e,o){this.mouseRotate.dragStart(e,o),this.mousePitch&&this.mousePitch.dragStart(e,o),$.disableDrag()}startTouch(e,o){this.touchRotate.dragStart(e,o),this.touchPitch&&this.touchPitch.dragStart(e,o),$.disableDrag()}moveMouse(e,o){const u=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(e,o)||{};f&&u.setPitch(u.getPitch()+f)}}moveTouch(e,o){const u=this.map,{bearingDelta:c}=this.touchRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(e,o)||{};f&&u.setPitch(u.getPitch()+f)}}off(){const e=this.element;$.removeEventListener(e,"mousedown",this.mousedown),$.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let Ai;function Qt(m,e,o){const u=new d.N(m.lng,m.lat);if(m=new d.N(m.lng,m.lat),e){const c=new d.N(m.lng-360,m.lat),f=new d.N(m.lng+360,m.lat),x=o.locationPoint(m).distSqr(e);o.locationPoint(c).distSqr(e)<x?m=c:o.locationPoint(f).distSqr(e)<x&&(m=f)}for(;Math.abs(m.lng-o.center.lng)>180;){const c=o.locationPoint(m);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;m.lng>o.center.lng?m.lng-=360:m.lng+=360}return m.lng!==u.lng&&o.locationPoint(m).y>o.height/2-o.getHorizon()?m:u}const _o={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ml(m,e,o){const u=m.classList;for(const c in _o)u.remove(`maplibregl-${o}-anchor-${c}`);u.add(`maplibregl-${o}-anchor-${e}`)}class gl extends d.E{constructor(e){if(super(),this._onKeyPress=o=>{const u=o.code,c=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=o=>{const u=o.originalEvent.target,c=this._element;this._popup&&(u===c||c.contains(u))&&this.togglePopup()},this._update=o=>{var u;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Qt(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${_o[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${f}`),te.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div");const o=$.createNS("http://www.w3.org/2000/svg","svg"),u=41,c=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${c}px`),o.setAttributeNS(null,"viewBox",`0 0 ${c} ${u}`);const f=$.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const x=$.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const S=$.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of k){const ee=$.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",J.rx),ee.setAttributeNS(null,"ry",J.ry),S.appendChild(ee)}const C=$.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const A=$.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(A);const M=$.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const B=$.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(B);const V=$.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const U=$.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=$.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const K=$.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),U.appendChild(H),U.appendChild(K),x.appendChild(S),x.appendChild(C),x.appendChild(M),x.appendChild(V),x.appendChild(U),o.appendChild(x),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(o),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),ml(this._element,this._anchor,"marker"),e&&e.className)for(const o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,u;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,f=c.terrain.depthAtPoint(this._pos),x=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,x)-f<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/c.transform._pixelPerMeter,k=Math.sin(c.getPitch()*Math.PI/180)*S,C=c.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),A=c.transform.lngLatToCameraDepth(this._lngLat,x+k)-C>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return e===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Kh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ma=0,ga=!1;const In={maxWidth:100,unit:"metric"};function ya(m,e,o){const u=o&&o.maxWidth||100,c=m._container.clientHeight/2,f=m.unproject([0,c]),x=m.unproject([u,c]),S=f.distanceTo(x);if(o&&o.unit==="imperial"){const k=3.2808*S;k>5280?Xe(e,u,k/5280,m._getUIString("ScaleControl.Miles")):Xe(e,u,k,m._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Xe(e,u,S/1852,m._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Xe(e,u,S/1e3,m._getUIString("ScaleControl.Kilometers")):Xe(e,u,S,m._getUIString("ScaleControl.Meters"))}function Xe(m,e,o,u){const c=function(f){const x=Math.pow(10,`${Math.floor(f)}`.length-1);let S=f/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(k){const C=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*C)/C}(S),x*S}(o);m.style.width=e*(c/o)+"px",m.innerHTML=`${c}&nbsp;${u}`}const ot={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},yl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _l(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-m),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const e=d.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return _l(new d.P(0,0))}const sc=j;w.AJAXError=d.bh,w.Evented=d.E,w.LngLat=d.N,w.MercatorCoordinate=d.Z,w.Point=d.P,w.addProtocol=d.bi,w.config=d.a,w.removeProtocol=d.bj,w.AttributionControl=go,w.BoxZoomHandler=Pi,w.CanvasSource=ii,w.CooperativeGesturesHandler=fo,w.DoubleClickZoomHandler=Ds,w.DragPanHandler=Zh,w.DragRotateHandler=Gh,w.EdgeInsets=co,w.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o==null?void 0:o.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=is,w.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const o=new d.N(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,c=this._map.getBearing(),f=d.e({bearing:c},this.options.fitBoundsOptions),x=ge.fromLngLat(o,u);this._map.fitBounds(x,f,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const o=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&ga)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new gl({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Kh,m)}onAdd(m){return this._map=m,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(Ai!==void 0&&!e)return Ai;if(window.navigator.permissions===void 0)return Ai=!!window.navigator.geolocation,Ai;try{Ai=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ai=!!window.navigator.geolocation}return Ai})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ma=0,ga=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),o=m.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),o=m.getNorthEast(),u=e.distanceTo(o),c=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ma--,ga=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ma++,ma>1?(m={maximumAge:6e5,timeout:0},ga=!0):(m=this.options.positionOptions,ga=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.Hash=ol,w.ImageSource=Oi,w.KeyboardHandler=Ui,w.LngLatBounds=ge,w.LogoControl=ec,w.Map=class extends Hh{constructor(m){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},wf),m);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ho(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Pt,this._controls=[],this._mapId=d.a4(),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ic),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ce.addThrottleControl(()=>this.isMoving()),this._requestManager=new Se(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const u=ua(c=>{this._trackResize&&!this._removed&&(this.resize(c),this.redraw())},50);this._resizeObserver=new ResizeObserver(c=>{o?u(c):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Qu(this,e),this._hash=e.hash&&new ol(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new go(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new ec,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new d.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new d.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,o,u)}resize(m){var e;const o=this._containerDimensions(),u=o[0],c=o[1],f=this._getClampedPixelRatio(u,c);if(this._resizeCanvas(u,c,f),this.painter.resize(u,c,f),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const k=this._getClampedPixelRatio(u,c);this._resizeCanvas(u,c,k),this.painter.resize(u,c,k)}this.transform.resize(u,c),(e=this._requestedCameraState)===null||e===void 0||e.resize(u,c);const x=!this._moving;return x&&(this.stop(),this.fire(new d.k("movestart",m)).fire(new d.k("move",m))),this.fire(new d.k("resize",m)),x&&this.fire(new d.k("moveend",m)),this}_getClampedPixelRatio(m,e){const{0:o,1:u}=this._maxCanvasSize,c=this.getPixelRatio(),f=m*c,x=e*c;return Math.min(f>o?o/f:1,x>u?u/x:1)*c}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(ge.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(d.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,o){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:f=>{const x=e.filter(k=>this.getLayer(k)),S=x.length!==0?this.queryRenderedFeatures(f.point,{layers:x}):[];S.length?u||(u=!0,o.call(this,new Gr(m,this,f.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:x=>{const S=e.filter(k=>this.getLayer(k));(S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[]).length?u=!0:u&&(u=!1,o.call(this,new Gr(m,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,o.call(this,new Gr(m,this,x.originalEvent)))}}}}{const u=c=>{const f=e.filter(S=>this.getLayer(S)),x=f.length!==0?this.queryRenderedFeatures(c.point,{layers:f}):[];x.length&&(c.features=x,o.call(this,c),delete c.features)};return{layers:e,listener:o,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,o){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let c=0;c<u.length;c++){const f=u[c];if(f.listener===o&&f.layers.length===e.length&&f.layers.every(x=>e.includes(x))){for(const x in f.delegates)this.off(x,f.delegates[x]);return void u.splice(c,1)}}}on(m,e,o){if(o===void 0)return super.on(m,e);const u=this._createDelegatedListener(m,typeof e=="string"?[e]:e,o);this._saveDelegatedListener(m,u);for(const c in u.delegates)this.on(c,u.delegates[c]);return this}once(m,e,o){if(o===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,c=this._createDelegatedListener(m,u,o);for(const f in c.delegates){const x=c.delegates[f];c.delegates[f]=(...S)=>{this._removeDelegatedListener(m,u,o),x(...S)}}this._saveDelegatedListener(m,c);for(const f in c.delegates)this.once(f,c.delegates[f]);return this}off(m,e,o){return o===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let o;const u=m instanceof d.P||Array.isArray(m),c=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},c instanceof d.P||typeof c[0]=="number")o=[d.P.convert(c)];else{const f=d.P.convert(c[0]),x=d.P.convert(c[1]);o=[f,new d.P(x.x,f.y),x,new d.P(f.x,x.y),f]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new $a(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,o):this.style.loadJSON(m,e,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new $a(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const o=this._requestManager.transformRequest(m,"Style");d.h(o,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new d.j(u))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(o){d.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const o in this.style._layers){const u=this.style._layers[o];u.type==="hillshade"&&u.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new rc(this.painter,e,m),this.painter.renderToTexture=new Wh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const o=m[e]._tiles;for(const u in o){const c=o[u];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,e,o={}){const{pixelRatio:u=1,sdf:c=!1,stretchX:f,stretchY:x,content:S,textFitWidth:k,textFitHeight:C}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:M,data:B}=e,V=e;return this.style.addImage(m,{data:new d.R({width:A,height:M},new Uint8Array(B)),pixelRatio:u,stretchX:f,stretchY:x,content:S,textFitWidth:k,textFitHeight:C,sdf:c,version:0,userImage:V}),V.onAdd&&V.onAdd(this,m),this}}{const{width:A,height:M,data:B}=te.getImageData(e);this.style.addImage(m,{data:new d.R({width:A,height:M},B),pixelRatio:u,stretchX:f,stretchY:x,content:S,textFitWidth:k,textFitHeight:C,sdf:c,version:0})}}updateImage(m,e){const o=this.style.getImage(m);if(!o)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||d.b(e)?te.getImageData(e):e,{width:c,height:f,data:x}=u;if(c===void 0||f===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==o.data.width||f!==o.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||d.b(e));return o.data.replace(x,S),this.style.updateImage(m,o),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return ce.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,o){return this.style.setLayerZoomRange(m,e,o),this._update(!0)}setFilter(m,e,o={}){return this.style.setFilter(m,e,o),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,o,u={}){return this.style.setPaintProperty(m,e,o,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,o,u={}){return this.style.setLayoutProperty(m,e,o,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,o,u=>{u||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,o=>{o||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m){return this._lazyInitEmptyStyle(),this.style.setSky(m),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=$.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);const c=this._controlContainer=$.create("div","maplibregl-control-container",m),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{f[x]=$.create("div",`maplibregl-ctrl-${x} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,o){this._canvas.width=Math.floor(o*m),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});const o=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!o){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new sl(o,this.transform),Ie.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,f=te.now();this.style.zoomHistory.update(c,f);const x=new d.z(c,{now:f,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=x.crossFadingFactor();S===1&&S===this._crossFadingFactor||(o=!0,this._crossFadingFactor=S),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ce.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,te.frameAsync(this._frameRequest).then(m=>{d.bf.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Xh}getCameraTargetElevation(){return this.transform.elevation}},w.MapMouseEvent=Gr,w.MapTouchEvent=Ms,w.MapWheelEvent=Uh,w.Marker=gl,w.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),o=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,o)=>{const u=this._map._getUIString(`NavigationControl.${o}`);e.title=u,e.setAttribute("aria-label",u)},this.options=d.e({},bf,m),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Sf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const o=$.create("button",m,this._container);return o.type="button",o.addEventListener("click",e),o}},w.Popup=class extends d.E{constructor(m){super(),this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Qt(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const f=_l(this.options.offset);if(!c){const S=this._container.offsetWidth,k=this._container.offsetHeight;let C;C=u.y+f.bottom.y<k?["top"]:u.y>this._map.transform.height-k?["bottom"]:[],u.x<S/2?C.push("left"):u.x>this._map.transform.width-S/2&&C.push("right"),c=C.length===0?"bottom":C.join("-")}let x=u.add(f[c]);this.options.subpixelPositioning||(x=x.round()),$.setTransform(this._container,`${_o[c]} translate(${x.x}px,${x.y}px)`),ml(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(ot),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=m;u=o.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(yl);m&&m.focus()}},w.RasterDEMTileSource=sr,w.RasterTileSource=wt,w.ScaleControl=class{constructor(m){this._onMove=()=>{ya(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,ya(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},In),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=an,w.Style=$a,w.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=fa,w.TwoFingersTouchRotateHandler=Ku,w.TwoFingersTouchZoomHandler=Wu,w.TwoFingersTouchZoomRotateHandler=Yu,w.VectorTileSource=qt,w.VideoSource=Vn,w.addSourceType=(m,e)=>d._(void 0,void 0,void 0,function*(){if(jn(m))throw new Error(`A source type called "${m}" already exists.`);((o,u)=>{Ks[o]=u})(m,e)}),w.clearPrewarmedResources=function(){const m=Sr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(br),Sr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return Ni().getRTLTextPluginStatus()},w.getVersion=function(){return sc},w.getWorkerCount=function(){return Fr.workerCount},w.getWorkerUrl=function(){return d.a.WORKER_URL},w.importScriptInWorkers=function(m){return ws().broadcast("IS",m)},w.prewarm=function(){On().acquire(br)},w.setMaxParallelImageRequests=function(m){d.a.MAX_PARALLEL_IMAGE_REQUESTS=m},w.setRTLTextPlugin=function(m,e){return Ni().setRTLTextPlugin(m,e)},w.setWorkerCount=function(m){Fr.workerCount=m},w.setWorkerUrl=function(m){d.a.WORKER_URL=m}});var T=l;return T})})(P1);var CE=P1.exports;const Rc=Xx(CE),Hx=[-122.4194,37.7749];function PE({pickup:r,dropoff:n,drivers:l,routeGeoJson:p,onMapClick:_}){const T=_t.useRef(null),w=_t.useRef(null),d=_t.useRef([]);return _t.useEffect(()=>{if(!T.current||w.current)return;const j=new Rc.Map({container:T.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:" OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm"}]},center:Hx,zoom:12});return j.addControl(new Rc.NavigationControl,"bottom-right"),j.on("click",Y=>{_(Y.lngLat.lat,Y.lngLat.lng)}),j.on("load",()=>{j.getSource("route")||(j.addSource("route",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),j.addLayer({id:"route-line",type:"line",source:"route",paint:{"line-color":"#f59e0b","line-width":4}}))}),w.current=j,()=>{j.remove(),w.current=null}},[_]),_t.useEffect(()=>{const j=w.current;if(!j)return;const Y=r?[r.lng,r.lat]:Hx;j.easeTo({center:Y,duration:800})},[r]),_t.useEffect(()=>{const j=w.current;if(j){if(d.current.forEach(Y=>Y.remove()),d.current=[],r){const Y=document.createElement("div");Y.className="marker pickup",Y.textContent="P";const me=[r.lng,r.lat];d.current.push(new Rc.Marker({element:Y}).setLngLat(me).addTo(j))}if(n){const Y=document.createElement("div");Y.className="marker dropoff",Y.textContent="D";const me=[n.lng,n.lat];d.current.push(new Rc.Marker({element:Y}).setLngLat(me).addTo(j))}l.forEach(Y=>{if(Y.lat==null||Y.lng==null)return;const me=document.createElement("div");me.className=`marker driver ${Y.isAi?"ai":"human"}`,me.textContent=Y.isAi?"AI":"DR";const te=[Y.lng,Y.lat];d.current.push(new Rc.Marker({element:me}).setLngLat(te).addTo(j))})}},[r,n,l]),_t.useEffect(()=>{const j=w.current;if(!j)return;const Y=j.getSource("route");Y&&Y.setData({type:"FeatureCollection",features:p?[{type:"Feature",geometry:p,properties:{}}]:[]})},[p]),ze.jsx("div",{className:"map",ref:T})}function AE({isAi:r,vehicle:n,openRides:l,onAccept:p,directions:_}){return ze.jsxs("div",{className:"driver-panel",children:[ze.jsx("div",{className:"panel-header",children:"Driver Ops"}),ze.jsxs("div",{className:"driver-meta",children:[ze.jsx("div",{children:r?"AI Agent Driver":"Human Driver"}),ze.jsx("div",{className:"muted",children:n})]}),ze.jsx("div",{className:"panel-sub",children:"Open requests"}),l.length===0&&ze.jsx("div",{className:"muted",children:"No open rides."}),ze.jsx("div",{className:"ride-list",children:l.map(T=>ze.jsxs("div",{className:"ride-card",children:[ze.jsxs("div",{children:["Ride ",T.id.slice(0,6)]}),ze.jsxs("div",{className:"muted",children:["Pickup ",T.pickupLat.toFixed(3),", ",T.pickupLng.toFixed(3)]}),ze.jsx("button",{className:"primary",onClick:()=>p(T.id),children:"Accept"})]},T.id))}),_.length>0&&ze.jsxs(ze.Fragment,{children:[ze.jsx("div",{className:"panel-sub",children:"Turn-by-turn"}),ze.jsx("div",{className:"directions",children:_.slice(0,6).map((T,w)=>ze.jsxs("div",{className:"direction-step",children:[w+1,". ",T]},`${T}-${w}`))})]})]})}function ME({userName:r,persona:n,mode:l,onPersona:p,onMode:_,onContinue:T}){return ze.jsx("div",{className:"gate",children:ze.jsxs("div",{className:"gate-card",children:[ze.jsxs("div",{className:"gate-title",children:["Welcome, ",r]}),ze.jsx("div",{className:"gate-sub",children:"Choose who you are and what you want to do."}),ze.jsxs("div",{className:"gate-section",children:[ze.jsx("div",{className:"gate-label",children:"You are a"}),ze.jsxs("div",{className:"gate-actions",children:[ze.jsx("button",{className:n==="HUMAN"?"primary":"ghost",onClick:()=>p("HUMAN"),children:"Human"}),ze.jsx("button",{className:n==="AGENT"?"primary":"ghost",onClick:()=>p("AGENT"),children:"AI Agent"})]})]}),ze.jsxs("div",{className:"gate-section",children:[ze.jsx("div",{className:"gate-label",children:"I want to"}),ze.jsxs("div",{className:"gate-actions",children:[ze.jsx("button",{className:l==="RIDER"?"primary":"ghost",onClick:()=>_("RIDER"),children:"Ride"}),ze.jsx("button",{className:l==="DRIVER"?"primary":"ghost",onClick:()=>_("DRIVER"),children:"Drive"})]})]}),ze.jsx("button",{className:"primary",onClick:T,disabled:!n||!l,children:"Continue"})]})})}function zE({ride:r,destination:n,onDestinationChange:l,onRequest:p,canRequest:_,onAssignDriver:T,onStart:w,onComplete:d,onReset:j}){const Y=r.status==="IDLE",me=r.status==="MATCHING",te=r.status==="DRIVER_ASSIGNED",$=r.status==="IN_RIDE",Ie=r.status==="COMPLETED";return ze.jsxs("div",{className:"ride-panel",children:[ze.jsx("div",{className:"panel-header",children:"Request a ride"}),ze.jsxs("label",{className:"field",children:["Destination",ze.jsx("input",{type:"text",placeholder:"Enter destination",value:n,onChange:Me=>l(Me.target.value),disabled:!Y})]}),!_&&Y&&ze.jsx("div",{className:"ride-metric",children:"Tip: click the map to set dropoff pin."}),Y&&ze.jsx("button",{className:"primary",onClick:p,disabled:!_,children:"Request Ride"}),me&&ze.jsx("button",{className:"primary",onClick:T,children:"Simulate Driver Match"}),te&&ze.jsxs("div",{className:"stack",children:[ze.jsxs("div",{className:"driver-card",children:[ze.jsx("div",{className:"driver-name",children:r.driverName}),ze.jsx("div",{className:"driver-car",children:r.vehicle}),ze.jsxs("div",{className:"driver-eta",children:["ETA ",r.etaMinutes," min"]})]}),ze.jsx("button",{className:"primary",onClick:w,children:"Start Ride"})]}),$&&ze.jsxs("div",{className:"stack",children:[ze.jsxs("div",{className:"ride-metric",children:["Remaining: ",r.etaMinutes," min"]}),ze.jsx("button",{className:"primary",onClick:d,children:"Complete Ride"})]}),Ie&&ze.jsxs("div",{className:"stack",children:[ze.jsx("div",{className:"ride-metric",children:"Trip complete. Thanks for riding."}),ze.jsx("button",{className:"ghost",onClick:j,children:"Request Another Ride"})]})]})}function DE({ride:r}){return ze.jsxs("footer",{className:"status",children:[ze.jsxs("div",{children:["Status: ",r.status]}),ze.jsx("div",{children:r.etaMinutes?`ETA ${r.etaMinutes} min`:"ETA --"})]})}const Wx={id:"local-ride",pickup:"Current Location",dropoff:"Select destination",status:"IDLE"};function RE(){const r=m1(),n=r.authToken??"",l=r.isBridgeAvailable??!1,p=kk(),[_,T]=_t.useState("Rider"),[w,d]=_t.useState(""),[j,Y]=_t.useState("RIDER"),[me,te]=_t.useState(null),[$,Ie]=_t.useState(null),[Me,Le]=_t.useState(!1),[yt,ae]=_t.useState(null),[ne,ce]=_t.useState(!1),[Se,je]=_t.useState("Alien EV  42-AZ"),[Ne,Fe]=_t.useState(Wx),[Ye,kt]=_t.useState(""),[it,mt]=_t.useState(null),[Et,Mt]=_t.useState(null),[Yt,wr]=_t.useState([]),[ri,Br]=_t.useState([]),[We,lt]=_t.useState(null),[pt,Tt]=_t.useState([]),[Ft,nr]=_t.useState(""),br=_t.useRef(null);_t.useEffect(()=>{let at=!0;return n?(Gx({token:n,role:j}).then(qt=>{var wt;at&&(d(qt.user.id),T(qt.user.name??"Rider"),ae(((wt=qt.user.driver)==null?void 0:wt.id)??null))}).catch(()=>{nr("Backend offline  running in demo mode")}),()=>{at=!1}):(nr("Open in Alien Mini App to authenticate"),()=>{at=!1})},[n]),_t.useEffect(()=>{it&&xE(it.lat,it.lng).then(at=>wr(at.drivers)).catch(()=>wr([]))},[it]),_t.useEffect(()=>{if(j!=="DRIVER")return;const at=setInterval(()=>{kE().then(qt=>Br(qt.rides)).catch(()=>Br([]))},5e3);return()=>clearInterval(at)},[j]),_t.useEffect(()=>{br.current||(br.current=ip("http://localhost:4000"));const at=br.current;return at.on("ride:update",qt=>{qt.id===Ne.id&&Fe(wt=>({...wt,...qt}))}),()=>{at.off("ride:update")}},[Ne.id]),_t.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(at=>{mt({lat:at.coords.latitude,lng:at.coords.longitude})},()=>{mt({lat:37.7749,lng:-122.4194})})},[]);const Fr=_t.useMemo(()=>Ye.trim().length>2&&!!it&&!!Et,[Ye,it,Et]);_t.useEffect(()=>{const at=new AbortController;async function qt(){var is,en,Oi,Vn;if(!it||!Et){lt(null),Tt([]);return}const sr=`https://router.project-osrm.org/route/v1/driving/${it.lng},${it.lat};${Et.lng},${Et.lat}?overview=full&geometries=geojson&steps=true`;try{const ii=await fetch(sr,{signal:at.signal});if(!ii.ok)return;const jn=(is=(await ii.json()).routes)==null?void 0:is[0];if(!jn)return;lt(jn.geometry);const ke=((Vn=(Oi=(en=jn.legs)==null?void 0:en[0])==null?void 0:Oi.steps)==null?void 0:Vn.map(Zr=>{const Or=Zr.maneuver.modifier?` ${Zr.maneuver.modifier}`:"",Ni=Zr.name?` onto ${Zr.name}`:"";return`${Zr.maneuver.type}${Or}${Ni}`}))??[];Tt(ke)}catch{lt(null),Tt([])}}return qt(),()=>at.abort()},[it,Et]);async function qr(){if(Fr&&!(!it||!Et||!w))try{const at=await wE({riderId:w,pickupLat:it.lat,pickupLng:it.lng,dropLat:Et.lat,dropLng:Et.lng,fareCents:1200});Fe({id:at.ride.id,pickup:"Current Location",dropoff:Ye,status:at.ride.status,etaMinutes:6,fareCents:at.ride.fareCents})}catch{nr("Backend offline  using local ride flow"),Fe({id:"demo-ride",pickup:"Current Location",dropoff:Ye,status:"MATCHING",etaMinutes:6,fareCents:1200})}}function Sr(){Fe(at=>({...at,status:"DRIVER_ASSIGNED",driverName:"Ari Nova",vehicle:"Alien EV  42-AZ",etaMinutes:4}))}async function ki(){if(Ne.id)try{const at=await SE(Ne.id);Fe(qt=>({...qt,status:at.ride.status,etaMinutes:12}))}catch{nr("Backend offline  local ride started"),Fe(at=>({...at,status:"IN_RIDE",etaMinutes:12}))}}async function On(){if(Ne.id)try{const at=await TE(Ne.id);Fe(qt=>({...qt,status:at.ride.status,etaMinutes:0}))}catch{nr("Backend offline  local ride completed"),Fe(at=>({...at,status:"COMPLETED",etaMinutes:0}))}}async function Nn(){if(!(!n||!Ne.id)){try{const at=await EE({token:n,amount:"1200",rideId:Ne.id});await p.pay({recipient:at.recipient,amount:at.amount,network:"alien",token:"ALIEN",invoice:at.invoice}),nr("Payment successful")}catch{nr("Payment failed or cancelled")}setTimeout(()=>nr(""),2e3)}}function ws(){Fe(Wx),kt("")}async function Qi(at){var qt;if(Y(at),!!n)try{const wt=await Gx({token:n,role:at});d(wt.user.id),ae(((qt=wt.user.driver)==null?void 0:qt.id)??null)}catch{nr("Backend offline  role set locally")}}async function wn(){if(!me||!$)return;Le(!0),await Qi($==="DRIVER"?"DRIVER":"RIDER"),ce(me==="AGENT")}async function bn(){if(w)try{const at=await _E({userId:w,vehicle:Se,isAi:ne});ae(at.driver.id)}catch{nr("Backend offline  driver registered locally"),ae("demo-driver")}}async function rs(at){if(yt)try{const qt=await bE(at,yt);Fe({id:qt.ride.id,pickup:"Driver pickup",dropoff:"Driver dropoff",status:qt.ride.status})}catch{Fe({id:at,pickup:"Driver pickup",dropoff:"Driver dropoff",status:"DRIVER_ASSIGNED"})}}async function ge(){if(!(!it||!yt)){try{await vE({driverId:yt,lat:it.lat,lng:it.lng}),nr("Driver location updated")}catch{nr("Backend offline  GPS cached locally")}setTimeout(()=>nr(""),2e3)}}return ze.jsxs("div",{className:"app",children:[ze.jsx(IE,{userName:_,authToken:n}),ze.jsx("main",{className:"layout",children:Me?ze.jsxs(ze.Fragment,{children:[ze.jsx(PE,{pickup:it,dropoff:Et,drivers:Yt,routeGeoJson:We,onMapClick:(at,qt)=>{Mt({lat:at,lng:qt}),kt(`Dropoff ${at.toFixed(4)}, ${qt.toFixed(4)}`)}}),ze.jsxs("section",{className:"panel",children:[!l&&ze.jsxs("div",{className:"ride-panel",children:[ze.jsx("div",{className:"panel-header",children:"Alien Mini App Required"}),ze.jsx("div",{className:"ride-metric",children:"Open this inside the Alien Mini App to authenticate and pay with Alien Coins."})]}),ze.jsxs("div",{className:"ride-panel",children:[ze.jsx("div",{className:"panel-header",children:"Driver Profile"}),ze.jsxs("div",{className:"stack",children:[ze.jsx("div",{className:"ride-metric",children:me==="AGENT"?"AI Agent Driver":"Human Driver"}),ze.jsxs("label",{className:"field",children:["Vehicle",ze.jsx("input",{value:Se,onChange:at=>je(at.target.value)})]}),ze.jsx("button",{className:"primary",onClick:bn,disabled:!w||j!=="DRIVER",children:"Register Driver"}),ze.jsx("button",{className:"ghost",onClick:ge,disabled:!yt||!it||j!=="DRIVER",children:"Sync Driver GPS"}),Ft&&ze.jsx("div",{className:"ride-metric",children:Ft})]})]}),j==="RIDER"&&ze.jsx(zE,{ride:Ne,destination:Ye,onDestinationChange:kt,onRequest:qr,canRequest:Fr,onAssignDriver:Sr,onStart:ki,onComplete:On,onReset:ws}),Ne.status==="COMPLETED"&&j==="RIDER"&&ze.jsx("button",{className:"primary",onClick:Nn,disabled:!n,children:"Pay with Alien"}),j==="DRIVER"&&yt&&ze.jsx(AE,{isAi:ne,vehicle:Se,openRides:ri,onAccept:rs,directions:pt})]})]}):ze.jsx(ME,{userName:_,persona:me,mode:$,onPersona:te,onMode:Ie,onContinue:wn})}),ze.jsx(DE,{ride:Ne})]})}$m.createRoot(document.getElementById("root")).render(ze.jsx(j2.StrictMode,{children:ze.jsx(bk,{children:ze.jsx(RE,{})})}));
